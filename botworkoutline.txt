[38;5;238mâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[0m
       [38;5;238mâ”‚ [0mFile: [1msuper.py[0m
       [38;5;238mâ”‚ [0mSize: [1m134.0 KB[0m
[38;5;238mâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[0m
[38;5;238m   1[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m!/usr/bin/env python[0m
[38;5;238m   2[0m   [38;5;238mâ”‚[0m 
[38;5;238m   3[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m"""[0m
[38;5;238m   4[0m   [38;5;238mâ”‚[0m [38;2;98;114;164mHigh-Frequency Trading Bot (Scalping) for Bybit USDT Futures[0m
[38;5;238m   5[0m   [38;5;238mâ”‚[0m [38;2;98;114;164mVersion: 1.6.0 (Added StochRSI/Momentum, Ehlers Fisher, Trailing Stop, Enhanced Output)[0m
[38;5;238m   6[0m   [38;5;238mâ”‚[0m 
[38;5;238m   7[0m   [38;5;238mâ”‚[0m [38;2;98;114;164mFeatures:[0m
[38;5;238m   8[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- Multiple strategies selectable via config: Dual Supertrend, StochRSI+Momentum, Ehlers Fisher.[0m
[38;5;238m   9[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- Optional Volume spike and Order Book pressure confirmation for all strategies.[0m
[38;5;238m  10[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- ATR for volatility measurement and initial Stop-Loss/Take-Profit calculation.[0m
[38;5;238m  11[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- Trailing Stop Loss activation and movement based on profit and latest price.[0m
[38;5;238m  12[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- Risk-based position sizing with margin checks.[0m
[38;5;238m  13[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- Termux SMS alerts for critical events and trade actions.[0m
[38;5;238m  14[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- Robust error handling and logging with color support and detailed output.[0m
[38;5;238m  15[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- Graceful shutdown on KeyboardInterrupt with position closing attempt.[0m
[38;5;238m  16[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- Stricter position detection logic (Bybit V5 API 'side' and 'size').[0m
[38;5;238m  17[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- Fetches latest ticker price for more reactive checks (still NOT real-time).[0m
[38;5;238m  18[0m   [38;5;238mâ”‚[0m 
[38;5;238m  19[0m   [38;5;238mâ”‚[0m [38;2;98;114;164mDisclaimer:[0m
[38;5;238m  20[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- **EXTREME RISK**: This software is for educational purposes ONLY. Scalping bots are[0m
[38;5;238m  21[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m  extremely high-risk due to market noise, latency, slippage, fees, and the[0m
[38;5;238m  22[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m  critical need for precise, low-latency execution. Use at your own absolute risk.[0m
[38;5;238m  23[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- **CRITICAL SL/TP/TS LIMITATION (LOOP-BASED CHECK)**: The Stop-Loss/Take-Profit and[0m
[38;5;238m  24[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m  Trailing Stop mechanisms in this version use a loop-based check against the *latest[0m
[38;5;238m  25[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m  ticker price* which is checked *periodically* (controlled by SLEEP_SECONDS). This is[0m
[38;5;238m  26[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m  **HIGHLY INACCURATE AND UNSAFE** for live scalping. Price can move significantly[0m
[38;5;238m  27[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m  beyond calculated levels between checks. For real scalping, you **MUST** implement[0m
[38;5;238m  28[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m  exchange-native conditional orders (e.g., stopMarket, takeProfitMarket, trailingStop)[0m
[38;5;238m  29[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m  using `exchange.create_order` or similar methods, placed *immediately* after entry[0m
[38;5;238m  30[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m  confirmation, ideally based on the actual fill price.[0m
[38;5;238m  31[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- Parameter Sensitivity: Bot performance is highly dependent on parameter tuning.[0m
[38;5;238m  32[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m  Requires significant backtesting and forward testing. Defaults are illustrative.[0m
[38;5;238m  33[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- API Rate Limits: Frequent API calls can hit exchange rate limits. Monitor usage.[0m
[38;5;238m  34[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- Slippage: Market orders used for entry/exit are prone to slippage, especially[0m
[38;5;238m  35[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m  during volatile periods.[0m
[38;5;238m  36[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- Test Thoroughly: **DO NOT RUN LIVE WITHOUT EXTENSIVE TESTNET/DEMO TESTING.**[0m
[38;5;238m  37[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- Termux Dependency: SMS alerts require running within Termux on Android with[0m
[38;5;238m  38[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m  Termux:API installed (`pkg install termux-api`) and configured (SMS permissions).[0m
[38;5;238m  39[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- API Changes: Exchange APIs (like Bybit V3 vs V5) can change. This code targets[0m
[38;5;238m  40[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m  structures observed in V5 via CCXT, but updates may be needed.[0m
[38;5;238m  41[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m"""[0m
[38;5;238m  42[0m   [38;5;238mâ”‚[0m 
[38;5;238m  43[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m Standard Library Imports[0m
[38;5;238m  44[0m   [38;5;238mâ”‚[0m [38;2;255;121;198mimport[0m[38;2;248;248;242m [0m[38;2;248;248;242mlogging[0m
[38;5;238m  45[0m   [38;5;238mâ”‚[0m [38;2;255;121;198mimport[0m[38;2;248;248;242m [0m[38;2;248;248;242mos[0m
[38;5;238m  46[0m   [38;5;238mâ”‚[0m [38;2;255;121;198mimport[0m[38;2;248;248;242m [0m[38;2;248;248;242msys[0m
[38;5;238m  47[0m   [38;5;238mâ”‚[0m [38;2;255;121;198mimport[0m[38;2;248;248;242m [0m[38;2;248;248;242mtime[0m
[38;5;238m  48[0m   [38;5;238mâ”‚[0m [38;2;255;121;198mimport[0m[38;2;248;248;242m [0m[38;2;248;248;242mtraceback[0m
[38;5;238m  49[0m   [38;5;238mâ”‚[0m [38;2;255;121;198mimport[0m[38;2;248;248;242m [0m[38;2;248;248;242msubprocess[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m For Termux API calls[0m
[38;5;238m  50[0m   [38;5;238mâ”‚[0m [38;2;255;121;198mfrom[0m[38;2;248;248;242m [0m[38;2;248;248;242mtyping[0m[38;2;248;248;242m [0m[38;2;255;121;198mimport[0m[38;2;248;248;242m [0m[38;2;248;248;242mDict[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mAny[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mTuple[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mList[0m
[38;5;238m  51[0m   [38;5;238mâ”‚[0m 
[38;5;238m  52[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m Third-party Libraries[0m
[38;5;238m  53[0m   [38;5;238mâ”‚[0m [38;2;255;121;198mimport[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m
[38;5;238m  54[0m   [38;5;238mâ”‚[0m [38;2;255;121;198mimport[0m[38;2;248;248;242m [0m[38;2;248;248;242mpandas[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m
[38;5;238m  55[0m   [38;5;238mâ”‚[0m [38;2;255;121;198mimport[0m[38;2;248;248;242m [0m[38;2;248;248;242mpandas_ta[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242mta[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Ensure pandas-ta is installed: pip install pandas-ta[0m
[38;5;238m  56[0m   [38;5;238mâ”‚[0m [38;2;255;121;198mfrom[0m[38;2;248;248;242m [0m[38;2;248;248;242mdotenv[0m[38;2;248;248;242m [0m[38;2;255;121;198mimport[0m[38;2;248;248;242m [0m[38;2;248;248;242mload_dotenv[0m
[38;5;238m  57[0m   [38;5;238mâ”‚[0m 
[38;5;238m  58[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Configuration Loading ---[0m
[38;5;238m  59[0m   [38;5;238mâ”‚[0m [38;2;80;250;123mload_dotenv[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Load variables from .env file into environment variables[0m
[38;5;238m  60[0m   [38;5;238mâ”‚[0m 
[38;5;238m  61[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Constants ---[0m
[38;5;238m  62[0m   [38;5;238mâ”‚[0m 
[38;5;238m  63[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- API Credentials (Required in .env) ---[0m
[38;5;238m  64[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mBYBIT_API_KEY[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mBYBIT_API_KEY[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m  65[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mBYBIT_API_SECRET[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mBYBIT_API_SECRET[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m  66[0m   [38;5;238mâ”‚[0m 
[38;5;238m  67[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Trading Parameters (Set Defaults, Override in .env) ---[0m
[38;5;238m  68[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mDEFAULT_SYMBOL[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mSYMBOL[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mBTC/USDT:USDT[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m CCXT unified symbol format[0m
[38;5;238m  69[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mDEFAULT_INTERVAL[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mINTERVAL[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140m1m[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Timeframe (e.g., '1m', '5m')[0m
[38;5;238m  70[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mDEFAULT_LEVERAGE[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mLEVERAGE[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m10[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Desired leverage[0m
[38;5;238m  71[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mDEFAULT_SLEEP_SECONDS[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mSLEEP_SECONDS[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m10[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Pause between cycles[0m
[38;5;238m  72[0m   [38;5;238mâ”‚[0m 
[38;5;238m  73[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Strategy Selection ---[0m
[38;5;238m  74[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m Choose ONE strategy: "DUAL_SUPERTREND", "STOCHRSI_MOMENTUM", "EHLERS_FISHER"[0m
[38;5;238m  75[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mSTRATEGY_NAME[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mSTRATEGY_NAME[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mDUAL_SUPERTREND[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m
[38;5;238m  76[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mVALID_STRATEGIES[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mDUAL_SUPERTREND[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mSTOCHRSI_MOMENTUM[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mEHLERS_FISHER[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m
[38;5;238m  77[0m   [38;5;238mâ”‚[0m 
[38;5;238m  78[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Risk Management (CRITICAL - TUNE CAREFULLY!) ---[0m
[38;5;238m  79[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mRISK_PER_TRADE_PERCENTAGE[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mRISK_PER_TRADE_PERCENTAGE[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m005[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m 0.5% risk per trade based on equity[0m
[38;5;238m  80[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mATR_STOP_LOSS_MULTIPLIER[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mATR_STOP_LOSS_MULTIPLIER[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m[38;2;189;147;249m.[0m[38;2;189;147;249m5[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Multiplier for ATR to set SL distance (Initial SL)[0m
[38;5;238m  81[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mATR_TAKE_PROFIT_MULTIPLIER[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mATR_TAKE_PROFIT_MULTIPLIER[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m2[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Multiplier for ATR to set TP distance (Fixed TP - Unsafe)[0m
[38;5;238m  82[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mMAX_ORDER_USDT_AMOUNT[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mMAX_ORDER_USDT_AMOUNT[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m500[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Maximum position size in USDT value[0m
[38;5;238m  83[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mREQUIRED_MARGIN_BUFFER[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mREQUIRED_MARGIN_BUFFER[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m[38;2;189;147;249m.[0m[38;2;189;147;249m05[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Margin check buffer (e.g., 1.05 = requires 5% extra free margin)[0m
[38;5;238m  84[0m   [38;5;238mâ”‚[0m 
[38;5;238m  85[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Trailing Stop Loss Parameters (Loop-Based - UNSAFE) ---[0m
[38;5;238m  86[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mENABLE_TRAILING_STOP[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mbool[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mENABLE_TRAILING_STOP[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mfalse[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mlower[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mtrue[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Master switch for Trailing Stop[0m
[38;5;238m  87[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mTS_ACTIVATION_PROFIT_PERCENT[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTS_ACTIVATION_PROFIT_PERCENT[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m2[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Activate TS when profit reaches this percentage (e.g., 0.2 = 20% profit)[0m
[38;5;238m  88[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mTS_DISTANCE_PERCENT[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTS_DISTANCE_PERCENT[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m5[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Trail stop behind current price by this percentage (e.g., 0.5 = 0.5%)[0m
[38;5;238m  89[0m   [38;5;238mâ”‚[0m 
[38;5;238m  90[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Dual Supertrend Indicator Parameters ---[0m
[38;5;238m  91[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mDEFAULT_ST_ATR_LENGTH[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mST_ATR_LENGTH[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m7[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Primary Supertrend ATR period[0m
[38;5;238m  92[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mDEFAULT_ST_MULTIPLIER[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mST_MULTIPLIER[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m2[0m[38;2;189;147;249m.[0m[38;2;189;147;249m5[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Primary Supertrend ATR multiplier[0m
[38;5;238m  93[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mCONFIRM_ST_ATR_LENGTH[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mCONFIRM_ST_ATR_LENGTH[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m5[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Confirmation Supertrend ATR period[0m
[38;5;238m  94[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mCONFIRM_ST_MULTIPLIER[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mCONFIRM_ST_MULTIPLIER[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m2[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Confirmation Supertrend ATR multiplier[0m
[38;5;238m  95[0m   [38;5;238mâ”‚[0m 
[38;5;238m  96[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- StochRSI + Momentum Indicator Parameters ---[0m
[38;5;238m  97[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mSTOCHRSI_RSI_LENGTH[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mSTOCHRSI_RSI_LENGTH[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m14[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m RSI period for StochRSI[0m
[38;5;238m  98[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mSTOCHRSI_STOCH_LENGTH[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mSTOCHRSI_STOCH_LENGTH[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m14[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Stochastic period for StochRSI[0m
[38;5;238m  99[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mSTOCHRSI_K_PERIOD[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mSTOCHRSI_K_PERIOD[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m3[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m K period for StochRSI[0m
[38;5;238m 100[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mSTOCHRSI_D_PERIOD[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mSTOCHRSI_D_PERIOD[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m3[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m D period for StochRSI[0m
[38;5;238m 101[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mSTOCHRSI_OVERBOUGHT[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mSTOCHRSI_OVERBOUGHT[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m80[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Overbought threshold[0m
[38;5;238m 102[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mSTOCHRSI_OVERSOLD[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mSTOCHRSI_OVERSOLD[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m20[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Oversold threshold[0m
[38;5;238m 103[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mMOMENTUM_LENGTH[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mMOMENTUM_LENGTH[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m5[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Momentum lookback period[0m
[38;5;238m 104[0m   [38;5;238mâ”‚[0m 
[38;5;238m 105[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Ehlers Fisher Transform Parameters ---[0m
[38;5;238m 106[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mEHLERS_FISHER_LENGTH[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mEHLERS_FISHER_LENGTH[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m10[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Fisher Transform length[0m
[38;5;238m 107[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mEHLERS_FISHER_SIGNAL_LENGTH[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mEHLERS_FISHER_SIGNAL_LENGTH[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Fisher Signal line length (shift)[0m
[38;5;238m 108[0m   [38;5;238mâ”‚[0m 
[38;5;238m 109[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Volume Analysis Parameters ---[0m
[38;5;238m 110[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mVOLUME_MA_PERIOD[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mVOLUME_MA_PERIOD[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m20[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Moving average period for volume[0m
[38;5;238m 111[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mVOLUME_SPIKE_THRESHOLD[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mVOLUME_SPIKE_THRESHOLD[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m[38;2;189;147;249m.[0m[38;2;189;147;249m5[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Volume must be > this * MA for a spike[0m
[38;5;238m 112[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mREQUIRE_VOLUME_SPIKE_FOR_ENTRY[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mbool[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mREQUIRE_VOLUME_SPIKE_FOR_ENTRY[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mfalse[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mlower[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mtrue[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Require volume spike for entry signal[0m
[38;5;238m 113[0m   [38;5;238mâ”‚[0m 
[38;5;238m 114[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Order Book Analysis Parameters ---[0m
[38;5;238m 115[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mORDER_BOOK_DEPTH[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mORDER_BOOK_DEPTH[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m10[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Levels of bids/asks to analyze[0m
[38;5;238m 116[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mORDER_BOOK_RATIO_THRESHOLD_LONG[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mORDER_BOOK_RATIO_THRESHOLD_LONG[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m[38;2;189;147;249m.[0m[38;2;189;147;249m2[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Bid/Ask volume ratio must be >= this for long confirmation[0m
[38;5;238m 117[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mORDER_BOOK_RATIO_THRESHOLD_SHORT[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mORDER_BOOK_RATIO_RATIO_THRESHOLD_SHORT[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m8[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Bid/Ask volume ratio must be <= this for short confirmation[0m
[38;5;238m 118[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mFETCH_ORDER_BOOK_PER_CYCLE[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mbool[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mFETCH_ORDER_BOOK_PER_CYCLE[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mfalse[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mlower[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mtrue[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Fetch OB every cycle (costly) or only on potential signals[0m
[38;5;238m 119[0m   [38;5;238mâ”‚[0m 
[38;5;238m 120[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- ATR Calculation Parameter (for SL/TP) ---[0m
[38;5;238m 121[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mATR_CALCULATION_PERIOD[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mATR_CALCULATION_PERIOD[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m14[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m ATR period used specifically for SL/TP calculation[0m
[38;5;238m 122[0m   [38;5;238mâ”‚[0m 
[38;5;238m 123[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Termux SMS Alert Configuration (Set in .env) ---[0m
[38;5;238m 124[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mENABLE_SMS_ALERTS[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mbool[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mENABLE_SMS_ALERTS[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mfalse[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mlower[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mtrue[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Master switch for SMS alerts[0m
[38;5;238m 125[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mSMS_RECIPIENT_NUMBER[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mSMS_RECIPIENT_NUMBER[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Phone number to send alerts to[0m
[38;5;238m 126[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mSMS_TIMEOUT_SECONDS[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mSMS_TIMEOUT_SECONDS[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m30[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Timeout for the termux-sms-send command[0m
[38;5;238m 127[0m   [38;5;238mâ”‚[0m 
[38;5;238m 128[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- CCXT / API Parameters ---[0m
[38;5;238m 129[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mDEFAULT_RECV_WINDOW[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249m10000[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m API receive window (milliseconds)[0m
[38;5;238m 130[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mORDER_BOOK_FETCH_LIMIT[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;139;233;253mmax[0m[38;2;248;248;242m([0m[38;2;189;147;249m25[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mORDER_BOOK_DEPTH[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m How many OB levels to fetch (API often requires min 25/50/100)[0m
[38;5;238m 131[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mSHALLOW_OB_FETCH_DEPTH[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249m5[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Depth for quick best bid/ask fetch for entry price estimate[0m
[38;5;238m 132[0m   [38;5;238mâ”‚[0m 
[38;5;238m 133[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Internal Constants ---[0m
[38;5;238m 134[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mSIDE_BUY[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mbuy[0m[38;2;241;250;140m"[0m
[38;5;238m 135[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mSIDE_SELL[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140msell[0m[38;2;241;250;140m"[0m
[38;5;238m 136[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mPOSITION_SIDE_LONG[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mLong[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Internal representation for long position[0m
[38;5;238m 137[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mPOSITION_SIDE_SHORT[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mShort[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Internal representation for short position[0m
[38;5;238m 138[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mPOSITION_SIDE_NONE[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mNone[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Internal representation for no position[0m
[38;5;238m 139[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mUSDT_SYMBOL[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mUSDT[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Base currency symbol for balance checks[0m
[38;5;238m 140[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mRETRY_COUNT[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249m3[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Number of retries for certain API calls (e.g., leverage setting)[0m
[38;5;238m 141[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mRETRY_DELAY_SECONDS[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Delay between retries[0m
[38;5;238m 142[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mAPI_FETCH_LIMIT_BUFFER[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249m10[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Fetch slightly more OHLCV data than strictly needed for indicator calculation buffer[0m
[38;5;238m 143[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mPOSITION_QTY_EPSILON[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249m1e-9[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Small value for floating point comparisons (e.g., checking if quantity is effectively zero)[0m
[38;5;238m 144[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mPOST_CLOSE_DELAY_SECONDS[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249m2[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Brief delay after closing a position before potentially opening a new one[0m
[38;5;238m 145[0m   [38;5;238mâ”‚[0m 
[38;5;238m 146[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Global State for Trailing Stop ---[0m
[38;5;238m 147[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m NOTE: This simple global state will be LOST if the bot restarts.[0m
[38;5;238m 148[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m For robustness, TS activation and price should be persisted (e.g., in a file or DB).[0m
[38;5;238m 149[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m For this example, we use globals for simplicity but highlight the limitation.[0m
[38;5;238m 150[0m   [38;5;238mâ”‚[0m [38;2;248;248;242mtrailing_stop_activated[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mDict[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m, [0m[3;38;2;102;217;239mbool[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m {symbol: bool}[0m
[38;5;238m 151[0m   [38;5;238mâ”‚[0m [38;2;248;248;242mcurrent_trailing_stop_price[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mDict[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m, [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m {symbol: price}[0m
[38;5;238m 152[0m   [38;5;238mâ”‚[0m 
[38;5;238m 153[0m   [38;5;238mâ”‚[0m 
[38;5;238m 154[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Logger Setup ---[0m
[38;5;238m 155[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m ---> SET TO DEBUG FOR DETAILED TROUBLESHOOTING <---[0m
[38;5;238m 156[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m ---> REMEMBER TO SET BACK TO INFO FOR NORMAL OPERATION <---[0m
[38;5;238m 157[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mLOGGING_LEVEL[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;255;255;255mINFO[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Default level[0m
[38;5;238m 158[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m LOGGING_LEVEL = logging.DEBUG # Uncomment for verbose debugging[0m
[38;5;238m 159[0m   [38;5;238mâ”‚[0m [38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123mbasicConfig[0m[38;2;248;248;242m([0m
[38;5;238m 160[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mlevel[0m[38;2;255;121;198m=[0m[38;2;255;255;255mLOGGING_LEVEL[0m[38;2;248;248;242m,[0m
[38;5;238m 161[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mformat[0m[38;2;255;121;198m=[0m[38;2;241;250;140m"[0m[38;2;189;147;249m%([0m[38;2;255;255;255masctime[0m[38;2;189;147;249m)s[0m[38;2;241;250;140m [[0m[38;2;189;147;249m%([0m[38;2;255;255;255mlevelname[0m[38;2;189;147;249m)s[0m[38;2;241;250;140m] [0m[38;2;189;147;249m%([0m[38;2;255;255;255mmessage[0m[38;2;189;147;249m)s[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m
[38;5;238m 162[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mdatefmt[0m[38;2;255;121;198m=[0m[38;2;241;250;140m"[0m[38;2;189;147;249m%Y[0m[38;2;241;250;140m-[0m[38;2;189;147;249m%m[0m[38;2;241;250;140m-[0m[38;2;189;147;249m%d[0m[38;2;241;250;140m [0m[38;2;189;147;249m%H[0m[38;2;241;250;140m:[0m[38;2;189;147;249m%M[0m[38;2;241;250;140m:[0m[38;2;189;147;249m%S[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m
[38;5;238m 163[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mhandlers[0m[38;2;255;121;198m=[0m[38;2;248;248;242m[[0m
[38;5;238m 164[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m logging.FileHandler("scalp_bot.log"), # Optional: Log to file[0m
[38;5;238m 165[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123mStreamHandler[0m[38;2;248;248;242m([0m[38;2;248;248;242msys[0m[38;2;255;121;198m.[0m[38;2;248;248;242mstdout[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log to console[0m
[38;5;238m 166[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242m][0m
[38;5;238m 167[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m)[0m
[38;5;238m 168[0m   [38;5;238mâ”‚[0m [38;2;248;248;242mlogger[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;248;248;242mLogger[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetLogger[0m[38;2;248;248;242m([0m[38;2;248;248;242m__name__[0m[38;2;248;248;242m)[0m
[38;5;238m 169[0m   [38;5;238mâ”‚[0m 
[38;5;238m 170[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m Custom SUCCESS level and color formatting[0m
[38;5;238m 171[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mSUCCESS_LEVEL[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249m25[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Between INFO and WARNING[0m
[38;5;238m 172[0m   [38;5;238mâ”‚[0m [38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123maddLevelName[0m[38;2;248;248;242m([0m[38;2;255;255;255mSUCCESS_LEVEL[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mSUCCESS[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 173[0m   [38;5;238mâ”‚[0m 
[38;5;238m 174[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123mlog_success[0m[38;2;248;248;242m([0m[3;38;2;255;184;108mself[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mmessage[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[3;38;2;255;184;108margs[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;121;198m**[0m[3;38;2;255;184;108mkwargs[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 175[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m[38;2;98;114;164mAdds a 'success' log level method to the Logger class.[0m[38;2;98;114;164m"""[0m
[38;5;238m 176[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;189;147;249mself[0m[38;2;255;121;198m.[0m[38;2;80;250;123misEnabledFor[0m[38;2;248;248;242m([0m[38;2;255;255;255mSUCCESS_LEVEL[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 177[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m pylint: disable=protected-access[0m
[38;5;238m 178[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;189;147;249mself[0m[38;2;255;121;198m.[0m[38;2;80;250;123m_log[0m[38;2;248;248;242m([0m[38;2;255;255;255mSUCCESS_LEVEL[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mmessage[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242margs[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;121;198m**[0m[38;2;248;248;242mkwargs[0m[38;2;248;248;242m)[0m
[38;5;238m 179[0m   [38;5;238mâ”‚[0m 
[38;5;238m 180[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m Bind the new method to the Logger class[0m
[38;5;238m 181[0m   [38;5;238mâ”‚[0m [38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;248;248;242mLogger[0m[38;2;255;121;198m.[0m[38;2;248;248;242msuccess[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlog_success[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m type: ignore[0m
[38;5;238m 182[0m   [38;5;238mâ”‚[0m 
[38;5;238m 183[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m ANSI escape codes for colored logging output (adjust based on terminal support)[0m
[38;5;238m 184[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m Check if the output stream is a TTY (terminal) before adding colors[0m
[38;5;238m 185[0m   [38;5;238mâ”‚[0m [38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242msys[0m[38;2;255;121;198m.[0m[38;2;248;248;242mstdout[0m[38;2;255;121;198m.[0m[38;2;80;250;123misatty[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 186[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123maddLevelName[0m[38;2;248;248;242m([0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;255;255;255mDEBUG[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[90m[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetLevelName[0m[38;2;248;248;242m([0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;255;255;255mDEBUG[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[0m[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Gray[0m
[38;5;238m 187[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123maddLevelName[0m[38;2;248;248;242m([0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;255;255;255mINFO[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[96m[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetLevelName[0m[38;2;248;248;242m([0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;255;255;255mINFO[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[0m[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Cyan[0m
[38;5;238m 188[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123maddLevelName[0m[38;2;248;248;242m([0m[38;2;255;255;255mSUCCESS_LEVEL[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[92m[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetLevelName[0m[38;2;248;248;242m([0m[38;2;255;255;255mSUCCESS_LEVEL[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[0m[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Green[0m
[38;5;238m 189[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123maddLevelName[0m[38;2;248;248;242m([0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;255;255;255mWARNING[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[93m[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetLevelName[0m[38;2;248;248;242m([0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;255;255;255mWARNING[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[0m[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Yellow[0m
[38;5;238m 190[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123maddLevelName[0m[38;2;248;248;242m([0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;255;255;255mERROR[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[91m[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetLevelName[0m[38;2;248;248;242m([0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;255;255;255mERROR[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[0m[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Red[0m
[38;5;238m 191[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123maddLevelName[0m[38;2;248;248;242m([0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;255;255;255mCRITICAL[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[91m[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[1m[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetLevelName[0m[38;2;248;248;242m([0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;255;255;255mCRITICAL[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[0m[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Bold Red[0m
[38;5;238m 192[0m   [38;5;238mâ”‚[0m 
[38;5;238m 193[0m   [38;5;238mâ”‚[0m 
[38;5;238m 194[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Termux SMS Alert Function ---[0m
[38;5;238m 195[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;255;184;108mmessage[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;248;248;242m->[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mbool[0m[38;2;248;248;242m:[0m
[38;5;238m 196[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 197[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Sends an SMS alert using the 'termux-sms-send' command via subprocess.[0m
[38;5;238m 198[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Requires Termux and Termux:API with SMS permissions granted.[0m
[38;5;238m 199[0m   [38;5;238mâ”‚[0m 
[38;5;238m 200[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Args:[0m
[38;5;238m 201[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        message (str): The text message content to send.[0m
[38;5;238m 202[0m   [38;5;238mâ”‚[0m 
[38;5;238m 203[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Returns:[0m
[38;5;238m 204[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        bool: True if the command executed successfully (return code 0),[0m
[38;5;238m 205[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m              False otherwise (config disabled, missing number, command error, timeout).[0m
[38;5;238m 206[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m              Note: True only means the command ran successfully, not guaranteed SMS delivery.[0m
[38;5;238m 207[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 208[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;255;255;255mENABLE_SMS_ALERTS[0m[38;2;248;248;242m:[0m
[38;5;238m 209[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mSMS alerts disabled via configuration.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 210[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m
[38;5;238m 211[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;255;255;255mSMS_RECIPIENT_NUMBER[0m[38;2;248;248;242m:[0m
[38;5;238m 212[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mSMS alerts enabled, but SMS_RECIPIENT_NUMBER not set in .env file.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 213[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m
[38;5;238m 214[0m   [38;5;238mâ”‚[0m 
[38;5;238m 215[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m 216[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Command arguments: send SMS (-n recipient_number) with the message content[0m
[38;5;238m 217[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m No complex shell injection risk here with direct message content, shlex not strictly needed[0m
[38;5;238m 218[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mcommand[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mList[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mtermux-sms-send[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140m-n[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mSMS_RECIPIENT_NUMBER[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mmessage[0m[38;2;248;248;242m][0m
[38;5;238m 219[0m   [38;5;238mâ”‚[0m 
[38;5;238m 220[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mAttempting to send SMS alert to [0m[38;2;248;248;242m{[0m[38;2;255;255;255mSMS_RECIPIENT_NUMBER[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (Timeout: [0m[38;2;248;248;242m{[0m[38;2;255;255;255mSMS_TIMEOUT_SECONDS[0m[38;2;248;248;242m}[0m[38;2;241;250;140ms)...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 221[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mExecuting command: [0m[38;2;248;248;242m{[0m[38;2;241;250;140m'[0m[38;2;241;250;140m [0m[38;2;241;250;140m'[0m[38;2;255;121;198m.[0m[38;2;80;250;123mjoin[0m[38;2;248;248;242m([0m[38;2;248;248;242mcommand[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log the command for debugging[0m
[38;5;238m 222[0m   [38;5;238mâ”‚[0m 
[38;5;238m 223[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mresult[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242msubprocess[0m[38;2;255;121;198m.[0m[38;2;80;250;123mrun[0m[38;2;248;248;242m([0m
[38;5;238m 224[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mcommand[0m[38;2;248;248;242m,[0m
[38;5;238m 225[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mcapture_output[0m[38;2;255;121;198m=[0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Capture stdout/stderr[0m
[38;5;238m 226[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mtext[0m[38;2;255;121;198m=[0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Decode stdout/stderr as text[0m
[38;5;238m 227[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mcheck[0m[38;2;255;121;198m=[0m[38;2;189;147;249mFalse[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Do not raise exception on non-zero exit, check manually[0m
[38;5;238m 228[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mtimeout[0m[38;2;255;121;198m=[0m[38;2;255;255;255mSMS_TIMEOUT_SECONDS[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Set a timeout for the command[0m
[38;5;238m 229[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242m)[0m
[38;5;238m 230[0m   [38;5;238mâ”‚[0m 
[38;5;238m 231[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mresult[0m[38;2;255;121;198m.[0m[38;2;248;248;242mreturncode[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m:[0m
[38;5;238m 232[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123msuccess[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTermux API command for SMS to [0m[38;2;248;248;242m{[0m[38;2;255;255;255mSMS_RECIPIENT_NUMBER[0m[38;2;248;248;242m}[0m[38;2;241;250;140m executed successfully.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 233[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m
[38;5;238m 234[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m 235[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log detailed error information if the command failed[0m
[38;5;238m 236[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTermux API command 'termux-sms-send' failed. Return code: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mresult[0m[38;2;255;121;198m.[0m[38;2;248;248;242mreturncode[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 237[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mresult[0m[38;2;255;121;198m.[0m[38;2;248;248;242mstderr[0m[38;2;248;248;242m:[0m
[38;5;238m 238[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTermux API Stderr: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mresult[0m[38;2;255;121;198m.[0m[38;2;248;248;242mstderr[0m[38;2;255;121;198m.[0m[38;2;80;250;123mstrip[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 239[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mresult[0m[38;2;255;121;198m.[0m[38;2;248;248;242mstdout[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Sometimes error info might be on stdout[0m
[38;5;238m 240[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTermux API Stdout: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mresult[0m[38;2;255;121;198m.[0m[38;2;248;248;242mstdout[0m[38;2;255;121;198m.[0m[38;2;80;250;123mstrip[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 241[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mPotential issues: SMS permissions not granted in Android settings for Termux:API, [0m[38;2;241;250;140m"[0m
[38;5;238m 242[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                         [0m[38;2;241;250;140m"[0m[38;2;241;250;140mTermux:API app not running or installed, incorrect recipient number format, [0m[38;2;241;250;140m"[0m
[38;5;238m 243[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                         [0m[38;2;241;250;140m"[0m[38;2;241;250;140mAndroid battery optimization interfering with Termux.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 244[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m
[38;5;238m 245[0m   [38;5;238mâ”‚[0m 
[38;5;238m 246[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mFileNotFoundError[0m[38;2;248;248;242m:[0m
[38;5;238m 247[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mFailed to send SMS: 'termux-sms-send' command not found. [0m[38;2;241;250;140m"[0m
[38;5;238m 248[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                     [0m[38;2;241;250;140m"[0m[38;2;241;250;140mEnsure Termux:API package is installed (`pkg install termux-api`) and the Termux:API app is running.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 249[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m
[38;5;238m 250[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242msubprocess[0m[38;2;248;248;242m.[0m[38;2;248;248;242mTimeoutExpired[0m[38;2;248;248;242m:[0m
[38;5;238m 251[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mFailed to send SMS: 'termux-sms-send' command timed out after [0m[38;2;248;248;242m{[0m[38;2;255;255;255mSMS_TIMEOUT_SECONDS[0m[38;2;248;248;242m}[0m[38;2;241;250;140m seconds. [0m[38;2;241;250;140m"[0m
[38;5;238m 252[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                     [0m[38;2;241;250;140m"[0m[38;2;241;250;140mCheck Termux:API service status, permissions, and Android battery optimization settings.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 253[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m
[38;5;238m 254[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 255[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mAn unexpected error occurred while sending SMS via Termux API: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 256[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log full traceback for unexpected errors[0m
[38;5;238m 257[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m
[38;5;238m 258[0m   [38;5;238mâ”‚[0m 
[38;5;238m 259[0m   [38;5;238mâ”‚[0m 
[38;5;238m 260[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Exchange Initialization ---[0m
[38;5;238m 261[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123minitialize_exchange[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;248;248;242m->[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[38;2;248;248;242mccxt[0m[38;2;255;121;198m.[0m[38;2;248;248;242mExchange[0m[38;2;248;248;242m][0m[38;2;248;248;242m:[0m
[38;5;238m 262[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 263[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Initializes and returns the CCXT Bybit exchange instance.[0m
[38;5;238m 264[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Performs connectivity/authentication checks and sends SMS alerts.[0m
[38;5;238m 265[0m   [38;5;238mâ”‚[0m 
[38;5;238m 266[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Returns:[0m
[38;5;238m 267[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        Optional[ccxt.Exchange]: Initialized exchange object or None on failure.[0m
[38;5;238m 268[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 269[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mInitializing CCXT Bybit connection...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 270[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;255;255;255mBYBIT_API_KEY[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;255;255;255mBYBIT_API_SECRET[0m[38;2;248;248;242m:[0m
[38;5;238m 271[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mCRITICAL: BYBIT_API_KEY and/or BYBIT_API_SECRET missing in .env file.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 272[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m[ScalpBot] CRITICAL: API keys missing in .env. Bot stopped.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 273[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 274[0m   [38;5;238mâ”‚[0m 
[38;5;238m 275[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Validate Strategy Name[0m
[38;5;238m 276[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;255;255mSTRATEGY_NAME[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;255;255;255mVALID_STRATEGIES[0m[38;2;248;248;242m:[0m
[38;5;238m 277[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mCRITICAL: Invalid STRATEGY_NAME '[0m[38;2;248;248;242m{[0m[38;2;255;255;255mSTRATEGY_NAME[0m[38;2;248;248;242m}[0m[38;2;241;250;140m' in .env. Must be one of [0m[38;2;248;248;242m{[0m[38;2;255;255;255mVALID_STRATEGIES[0m[38;2;248;248;242m}[0m[38;2;241;250;140m.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 278[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[ScalpBot] CRITICAL: Invalid strategy name '[0m[38;2;248;248;242m{[0m[38;2;255;255;255mSTRATEGY_NAME[0m[38;2;248;248;242m}[0m[38;2;241;250;140m'. Bot stopped.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 279[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 280[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSelected Strategy: [0m[38;2;248;248;242m{[0m[38;2;255;255;255mSTRATEGY_NAME[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 281[0m   [38;5;238mâ”‚[0m 
[38;5;238m 282[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m 283[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;255;121;198m.[0m[38;2;80;250;123mbybit[0m[38;2;248;248;242m([0m
[38;5;238m 284[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242m{[0m
[38;5;238m 285[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;241;250;140m"[0m[38;2;241;250;140mapiKey[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;255;255;255mBYBIT_API_KEY[0m[38;2;248;248;242m,[0m
[38;5;238m 286[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;241;250;140m"[0m[38;2;241;250;140msecret[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;255;255;255mBYBIT_API_SECRET[0m[38;2;248;248;242m,[0m
[38;5;238m 287[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;241;250;140m"[0m[38;2;241;250;140menableRateLimit[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Enable CCXT's built-in rate limiter[0m
[38;5;238m 288[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;241;250;140m"[0m[38;2;241;250;140moptions[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m
[38;5;238m 289[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;241;250;140m"[0m[38;2;241;250;140mdefaultType[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mlinear[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Crucial: Use 'linear' for USDT Perpetual, 'inverse' for inverse contracts[0m
[38;5;238m 290[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;241;250;140m"[0m[38;2;241;250;140mrecvWindow[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;255;255;255mDEFAULT_RECV_WINDOW[0m[38;2;248;248;242m,[0m
[38;5;238m 291[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m 'adjustForTimeDifference': True, # Consider if clock skew issues arise[0m
[38;5;238m 292[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m 'verbose': True, # Uncomment for extremely detailed API request/response logging[0m
[38;5;238m 293[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242m}[0m[38;2;248;248;242m,[0m
[38;5;238m 294[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242m}[0m
[38;5;238m 295[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242m)[0m
[38;5;238m 296[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Test connection and authentication by fetching markets and balance[0m
[38;5;238m 297[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mLoading markets...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 298[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mload_markets[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m
[38;5;238m 299[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mFetching balance (tests authentication)...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 300[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mfetch_balance[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Throws AuthenticationError on bad keys[0m
[38;5;238m 301[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mCCXT Bybit Session Initialized (LIVE FUTURES SCALPING MODE - EXTREME CAUTION!).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 302[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m[ScalpBot] Initialized successfully and authenticated.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 303[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m
[38;5;238m 304[0m   [38;5;238mâ”‚[0m 
[38;5;238m 305[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mAuthenticationError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 306[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mAuthentication failed: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Check API key/secret and ensure IP whitelist (if used) is correct and API permissions are sufficient.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 307[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[ScalpBot] CRITICAL: Authentication FAILED: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Bot stopped.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 308[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mNetworkError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 309[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mNetwork error during initialization: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Check internet connection and Bybit status.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 310[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[ScalpBot] CRITICAL: Network Error on Init: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Bot stopped.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 311[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mExchangeError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 312[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mExchange error during initialization: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Check Bybit status page or API documentation for details.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 313[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[ScalpBot] CRITICAL: Exchange Error on Init: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Bot stopped.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 314[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 315[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mFailed to initialize exchange due to an unexpected error: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 316[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m 317[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[ScalpBot] CRITICAL: Unexpected Init Error: [0m[38;2;248;248;242m{[0m[38;2;139;233;253mtype[0m[38;2;248;248;242m([0m[38;2;248;248;242me[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;248;248;242m__name__[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Bot stopped.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 318[0m   [38;5;238mâ”‚[0m 
[38;5;238m 319[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 320[0m   [38;5;238mâ”‚[0m 
[38;5;238m 321[0m   [38;5;238mâ”‚[0m 
[38;5;238m 322[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Indicator Calculation Functions ---[0m
[38;5;238m 323[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123mcalculate_supertrend[0m[38;2;248;248;242m([0m
[38;5;238m 324[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mdf[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;248;248;242mDataFrame[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mlength[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mmultiplier[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mprefix[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140m"[0m
[38;5;238m 325[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;248;248;242m->[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;248;248;242mDataFrame[0m[38;2;248;248;242m:[0m
[38;5;238m 326[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 327[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Calculates the Supertrend indicator using the pandas_ta library.[0m
[38;5;238m 328[0m   [38;5;238mâ”‚[0m 
[38;5;238m 329[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Args:[0m
[38;5;238m 330[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        df (pd.DataFrame): Input DataFrame with 'high', 'low', 'close' columns.[0m
[38;5;238m 331[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        length (int): The ATR lookback period for Supertrend.[0m
[38;5;238m 332[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        multiplier (float): The ATR multiplier for Supertrend.[0m
[38;5;238m 333[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        prefix (str): Optional prefix for the generated columns (e.g., "confirm_").[0m
[38;5;238m 334[0m   [38;5;238mâ”‚[0m 
[38;5;238m 335[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Returns:[0m
[38;5;238m 336[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        pd.DataFrame: DataFrame with added Supertrend columns.[0m
[38;5;238m 337[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m                      Returns original DataFrame with NA columns if calculation fails or data is insufficient.[0m
[38;5;238m 338[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 339[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mprefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mprefix[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140m"[0m
[38;5;238m 340[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Define the target column names we want to keep[0m
[38;5;238m 341[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mtarget_cols[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m[[0m
[38;5;238m 342[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140msupertrend[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m
[38;5;238m 343[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140mtrend[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m
[38;5;238m 344[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140mst_long[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m
[38;5;238m 345[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140mst_short[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m
[38;5;238m 346[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242m][0m
[38;5;238m 347[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Define the raw column names expected from pandas_ta based on its naming convention[0m
[38;5;238m 348[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mst_col_name[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSUPERT_[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlength[0m[38;2;248;248;242m}[0m[38;2;241;250;140m_[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmultiplier[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Supertrend line value[0m
[38;5;238m 349[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mst_trend_col[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSUPERTd_[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlength[0m[38;2;248;248;242m}[0m[38;2;241;250;140m_[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmultiplier[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Trend direction (-1 down, 1 up)[0m
[38;5;238m 350[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m st_long_col = f"SUPERTl_{length}_{multiplier}" # Lower band value (used when trend is up)[0m
[38;5;238m 351[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m st_short_col = f"SUPERTs_{length}_{multiplier}"# Upper band value (used when trend is down)[0m
[38;5;238m 352[0m   [38;5;238mâ”‚[0m 
[38;5;238m 353[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Input validation[0m
[38;5;238m 354[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mrequired_input_cols[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mhigh[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mlow[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mclose[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m
[38;5;238m 355[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mempty[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;139;233;253mall[0m[38;2;248;248;242m([0m[38;2;248;248;242mc[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mcolumns[0m[38;2;248;248;242m [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mc[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mrequired_input_cols[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 356[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140mSupertrend): Input DataFrame is missing required columns [0m[38;2;248;248;242m{[0m[38;2;248;248;242mrequired_input_cols[0m[38;2;248;248;242m}[0m[38;2;241;250;140m or is empty.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 357[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mcol[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mtarget_cols[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mcol[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;255;255;255mNA[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Add NA columns if they don't exist[0m
[38;5;238m 358[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m
[38;5;238m 359[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;139;233;253mlen[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;248;248;242mlength[0m[38;2;248;248;242m:[0m
[38;5;238m 360[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Need ATR length (length) + 1 candle for the first Supertrend value[0m
[38;5;238m 361[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140mSupertrend): DataFrame length ([0m[38;2;248;248;242m{[0m[38;2;139;233;253mlen[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) is less than ST period ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mlength[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Need at least [0m[38;2;248;248;242m{[0m[38;2;248;248;242mlength[0m[38;2;255;121;198m+[0m[38;2;189;147;249m1[0m[38;2;248;248;242m}[0m[38;2;241;250;140m.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 362[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mcol[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mtarget_cols[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mcol[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;255;255;255mNA[0m
[38;5;238m 363[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m
[38;5;238m 364[0m   [38;5;238mâ”‚[0m 
[38;5;238m 365[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m 366[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Calculate Supertrend using pandas_ta, appending results to the DataFrame[0m
[38;5;238m 367[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mta[0m[38;2;255;121;198m.[0m[38;2;80;250;123msupertrend[0m[38;2;248;248;242m([0m[3;38;2;255;184;108mlength[0m[38;2;255;121;198m=[0m[38;2;248;248;242mlength[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mmultiplier[0m[38;2;255;121;198m=[0m[38;2;248;248;242mmultiplier[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mappend[0m[38;2;255;121;198m=[0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m)[0m
[38;5;238m 368[0m   [38;5;238mâ”‚[0m 
[38;5;238m 369[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Verify that the expected raw columns were created[0m
[38;5;238m 370[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mst_col_name[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mcolumns[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mst_trend_col[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mcolumns[0m[38;2;248;248;242m:[0m
[38;5;238m 371[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;255;121;198mraise[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mKeyError[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mpandas_ta failed to create expected raw columns: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mst_col_name[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, [0m[38;2;248;248;242m{[0m[38;2;248;248;242mst_trend_col[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 372[0m   [38;5;238mâ”‚[0m 
[38;5;238m 373[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Process and Rename Columns ---[0m
[38;5;238m 374[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m 1. Rename the main Supertrend value column[0m
[38;5;238m 375[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140msupertrend[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mst_col_name[0m[38;2;248;248;242m][0m
[38;5;238m 376[0m   [38;5;238mâ”‚[0m 
[38;5;238m 377[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m 2. Create a boolean trend column (True if trend is up)[0m
[38;5;238m 378[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140mtrend[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mst_trend_col[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m
[38;5;238m 379[0m   [38;5;238mâ”‚[0m 
[38;5;238m 380[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m 3. Calculate flip signals: Signal is True *only* on the candle where the flip occurs[0m
[38;5;238m 381[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mprev_trend_direction[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mst_trend_col[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;80;250;123mshift[0m[38;2;248;248;242m([0m[38;2;189;147;249m1[0m[38;2;248;248;242m)[0m
[38;5;238m 382[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Long signal: Previous was down (-1) and current is up (1)[0m
[38;5;238m 383[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140mst_long[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242mprev_trend_direction[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m&[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mst_trend_col[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m[38;2;248;248;242m)[0m
[38;5;238m 384[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Short signal: Previous was up (1) and current is down (-1)[0m
[38;5;238m 385[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140mst_short[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242mprev_trend_direction[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m&[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mst_trend_col[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m)[0m
[38;5;238m 386[0m   [38;5;238mâ”‚[0m 
[38;5;238m 387[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Clean up intermediate pandas_ta columns ---[0m
[38;5;238m 388[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Identify all columns starting with 'SUPERT_' that are NOT our target columns[0m
[38;5;238m 389[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Explicitly list the raw output columns from pandas_ta to drop[0m
[38;5;238m 390[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mraw_st_cols[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m[[0m[38;2;248;248;242mst_col_name[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mst_trend_col[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSUPERTl_[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlength[0m[38;2;248;248;242m}[0m[38;2;241;250;140m_[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmultiplier[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSUPERTs_[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlength[0m[38;2;248;248;242m}[0m[38;2;241;250;140m_[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmultiplier[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m
[38;5;238m 391[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdrop[0m[38;2;248;248;242m([0m[3;38;2;255;184;108mcolumns[0m[38;2;255;121;198m=[0m[38;2;248;248;242mraw_st_cols[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108merrors[0m[38;2;255;121;198m=[0m[38;2;241;250;140m'[0m[38;2;241;250;140mignore[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108minplace[0m[38;2;255;121;198m=[0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m)[0m
[38;5;238m 392[0m   [38;5;238mâ”‚[0m 
[38;5;238m 393[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log the result of the last candle (only if it's valid)[0m
[38;5;238m 394[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m'[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140msupertrend[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;255;255;255mNA[0m[38;2;248;248;242m:[0m
[38;5;238m 395[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlast_trend_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mUp[0m[38;2;241;250;140m'[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m'[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140mtrend[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mDown[0m[38;2;241;250;140m'[0m
[38;5;238m 396[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140mSupertrend([0m[38;2;248;248;242m{[0m[38;2;248;248;242mlength[0m[38;2;248;248;242m}[0m[38;2;241;250;140m,[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmultiplier[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)): [0m[38;2;241;250;140m"[0m
[38;5;238m 397[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                         [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrend: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mlast_trend_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Value: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m'[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140msupertrend[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, [0m[38;2;241;250;140m"[0m
[38;5;238m 398[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                         [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSignal: [0m[38;2;248;248;242m{[0m[38;2;241;250;140m'[0m[38;2;241;250;140mLONG[0m[38;2;241;250;140m'[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m'[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140mst_long[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mSHORT[0m[38;2;241;250;140m'[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m'[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140mst_short[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mNone[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 399[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m 400[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140mSupertrend([0m[38;2;248;248;242m{[0m[38;2;248;248;242mlength[0m[38;2;248;248;242m}[0m[38;2;241;250;140m,[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmultiplier[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)): Calculation resulted in NA for last candle.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 401[0m   [38;5;238mâ”‚[0m 
[38;5;238m 402[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 403[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc: Error calculating [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140mSupertrend([0m[38;2;248;248;242m{[0m[38;2;248;248;242mlength[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, [0m[38;2;248;248;242m{[0m[38;2;248;248;242mmultiplier[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 404[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m 405[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Ensure target columns exist with NA values on error[0m
[38;5;238m 406[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mcol[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mtarget_cols[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mcol[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;255;255;255mNA[0m
[38;5;238m 407[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m
[38;5;238m 408[0m   [38;5;238mâ”‚[0m 
[38;5;238m 409[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123mcalculate_stochrsi_momentum[0m[38;2;248;248;242m([0m
[38;5;238m 410[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mdf[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;248;248;242mDataFrame[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mrsi_len[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mstoch_len[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mk_period[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108md_period[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mmom_len[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m
[38;5;238m 411[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;248;248;242m->[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;248;248;242mDataFrame[0m[38;2;248;248;242m:[0m
[38;5;238m 412[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 413[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Calculates StochRSI and Momentum using pandas_ta.[0m
[38;5;238m 414[0m   [38;5;238mâ”‚[0m 
[38;5;238m 415[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Args:[0m
[38;5;238m 416[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        df (pd.DataFrame): Input DataFrame with 'high', 'low', 'close'.[0m
[38;5;238m 417[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        rsi_len (int): RSI lookback period for StochRSI.[0m
[38;5;238m 418[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        stoch_len (int): Stochastic lookback period for StochRSI.[0m
[38;5;238m 419[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        k_period (int): %K smoothing period for StochRSI.[0m
[38;5;238m 420[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        d_period (int): %D smoothing period for StochRSI.[0m
[38;5;238m 421[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        mom_len (int): Momentum lookback period.[0m
[38;5;238m 422[0m   [38;5;238mâ”‚[0m 
[38;5;238m 423[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Returns:[0m
[38;5;238m 424[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        pd.DataFrame: DataFrame with added StochRSI (%K, %D) and Momentum columns.[0m
[38;5;238m 425[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m                      Returns original DataFrame with NA columns on calculation failure.[0m
[38;5;238m 426[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 427[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Define target column names[0m
[38;5;238m 428[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mtarget_cols[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m[[0m
[38;5;238m 429[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;241;250;140m'[0m[38;2;241;250;140mstochrsi_k[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mstochrsi_d[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mmomentum[0m[38;2;241;250;140m'[0m
[38;5;238m 430[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242m][0m
[38;5;238m 431[0m   [38;5;238mâ”‚[0m 
[38;5;238m 432[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mrequired_input_cols[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mhigh[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mlow[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mclose[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m
[38;5;238m 433[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mempty[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;139;233;253mall[0m[38;2;248;248;242m([0m[38;2;248;248;242mc[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mcolumns[0m[38;2;248;248;242m [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mc[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mrequired_input_cols[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 434[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc (StochRSI/Mom): Input DataFrame is missing required columns [0m[38;2;248;248;242m{[0m[38;2;248;248;242mrequired_input_cols[0m[38;2;248;248;242m}[0m[38;2;241;250;140m or is empty.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 435[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mcol[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mtarget_cols[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mcol[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;255;255;255mNA[0m
[38;5;238m 436[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m
[38;5;238m 437[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Minimum data needed is the maximum of indicator lengths[0m
[38;5;238m 438[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mmin_len[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;139;233;253mmax[0m[38;2;248;248;242m([0m[38;2;248;248;242mrsi_len[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mstoch_len[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mk_period[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242md_period[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mmom_len[0m[38;2;248;248;242m)[0m
[38;5;238m 439[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;139;233;253mlen[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;248;248;242mmin_len[0m[38;2;248;248;242m:[0m
[38;5;238m 440[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc (StochRSI/Mom): DataFrame length ([0m[38;2;248;248;242m{[0m[38;2;139;233;253mlen[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) is less than required ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mmin_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) for indicators.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 441[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mcol[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mtarget_cols[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mcol[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;255;255;255mNA[0m
[38;5;238m 442[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m
[38;5;238m 443[0m   [38;5;238mâ”‚[0m 
[38;5;238m 444[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m 445[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Calculate StochRSI[0m
[38;5;238m 446[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m pandas_ta appends columns like STOCHRSIk_{rsi_len}_{stoch_len}_{k_period}_{d_period}, STOCHRSId...[0m
[38;5;238m 447[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mta[0m[38;2;255;121;198m.[0m[38;2;80;250;123mstochrsi[0m[38;2;248;248;242m([0m[3;38;2;255;184;108mlength[0m[38;2;255;121;198m=[0m[38;2;248;248;242mrsi_len[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mstochlength[0m[38;2;255;121;198m=[0m[38;2;248;248;242mstoch_len[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mk[0m[38;2;255;121;198m=[0m[38;2;248;248;242mk_period[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108md[0m[38;2;255;121;198m=[0m[38;2;248;248;242md_period[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mappend[0m[38;2;255;121;198m=[0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m)[0m
[38;5;238m 448[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mstochrsi_k_col_name[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSTOCHRSIk_[0m[38;2;248;248;242m{[0m[38;2;248;248;242mrsi_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m_[0m[38;2;248;248;242m{[0m[38;2;248;248;242mstoch_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m_[0m[38;2;248;248;242m{[0m[38;2;248;248;242mk_period[0m[38;2;248;248;242m}[0m[38;2;241;250;140m_[0m[38;2;248;248;242m{[0m[38;2;248;248;242md_period[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m
[38;5;238m 449[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mstochrsi_d_col_name[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSTOCHRSId_[0m[38;2;248;248;242m{[0m[38;2;248;248;242mrsi_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m_[0m[38;2;248;248;242m{[0m[38;2;248;248;242mstoch_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m_[0m[38;2;248;248;242m{[0m[38;2;248;248;242mk_period[0m[38;2;248;248;242m}[0m[38;2;241;250;140m_[0m[38;2;248;248;242m{[0m[38;2;248;248;242md_period[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m
[38;5;238m 450[0m   [38;5;238mâ”‚[0m 
[38;5;238m 451[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mstochrsi_k_col_name[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mcolumns[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mstochrsi_d_col_name[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mcolumns[0m[38;2;248;248;242m:[0m
[38;5;238m 452[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mstochrsi_k[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mstochrsi_k_col_name[0m[38;2;248;248;242m][0m
[38;5;238m 453[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mstochrsi_d[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mstochrsi_d_col_name[0m[38;2;248;248;242m][0m
[38;5;238m 454[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Clean up raw columns[0m
[38;5;238m 455[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdrop[0m[38;2;248;248;242m([0m[3;38;2;255;184;108mcolumns[0m[38;2;255;121;198m=[0m[38;2;248;248;242m[[0m[38;2;248;248;242mstochrsi_k_col_name[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mstochrsi_d_col_name[0m[38;2;248;248;242m][0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108merrors[0m[38;2;255;121;198m=[0m[38;2;241;250;140m'[0m[38;2;241;250;140mignore[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108minplace[0m[38;2;255;121;198m=[0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m)[0m
[38;5;238m 456[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m 457[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc (StochRSI): pandas_ta failed to create expected StochRSI columns.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 458[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mstochrsi_k[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;255;255;255mNA[0m
[38;5;238m 459[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mstochrsi_d[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;255;255;255mNA[0m
[38;5;238m 460[0m   [38;5;238mâ”‚[0m 
[38;5;238m 461[0m   [38;5;238mâ”‚[0m 
[38;5;238m 462[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Calculate Momentum[0m
[38;5;238m 463[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m pandas_ta appends columns like MOM_{mom_len}[0m
[38;5;238m 464[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mta[0m[38;2;255;121;198m.[0m[38;2;80;250;123mmom[0m[38;2;248;248;242m([0m[3;38;2;255;184;108mlength[0m[38;2;255;121;198m=[0m[38;2;248;248;242mmom_len[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mappend[0m[38;2;255;121;198m=[0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m)[0m
[38;5;238m 465[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mmom_col_name[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mMOM_[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmom_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m
[38;5;238m 466[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mmom_col_name[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mcolumns[0m[38;2;248;248;242m:[0m
[38;5;238m 467[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mmomentum[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mmom_col_name[0m[38;2;248;248;242m][0m
[38;5;238m 468[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Clean up raw column[0m
[38;5;238m 469[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdrop[0m[38;2;248;248;242m([0m[3;38;2;255;184;108mcolumns[0m[38;2;255;121;198m=[0m[38;2;248;248;242m[[0m[38;2;248;248;242mmom_col_name[0m[38;2;248;248;242m][0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108merrors[0m[38;2;255;121;198m=[0m[38;2;241;250;140m'[0m[38;2;241;250;140mignore[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108minplace[0m[38;2;255;121;198m=[0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m)[0m
[38;5;238m 470[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m 471[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc (Momentum): pandas_ta failed to create expected Momentum column.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 472[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mmomentum[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;255;255;255mNA[0m
[38;5;238m 473[0m   [38;5;238mâ”‚[0m 
[38;5;238m 474[0m   [38;5;238mâ”‚[0m 
[38;5;238m 475[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log the result of the last candle (only if values are valid)[0m
[38;5;238m 476[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlast_k[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mstochrsi_k[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m
[38;5;238m 477[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlast_d[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mstochrsi_d[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m
[38;5;238m 478[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlast_mom[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mmomentum[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m
[38;5;238m 479[0m   [38;5;238mâ”‚[0m 
[38;5;238m 480[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;80;250;123mnotna[0m[38;2;248;248;242m([0m[38;2;248;248;242mlast_k[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;80;250;123mnotna[0m[38;2;248;248;242m([0m[38;2;248;248;242mlast_d[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;80;250;123mnotna[0m[38;2;248;248;242m([0m[38;2;248;248;242mlast_mom[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 481[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc (StochRSI/Mom): StochRSI([0m[38;2;248;248;242m{[0m[38;2;248;248;242mrsi_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m,[0m[38;2;248;248;242m{[0m[38;2;248;248;242mstoch_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m,[0m[38;2;248;248;242m{[0m[38;2;248;248;242mk_period[0m[38;2;248;248;242m}[0m[38;2;241;250;140m,[0m[38;2;248;248;242m{[0m[38;2;248;248;242md_period[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) K=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlast_k[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, D=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlast_d[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. [0m[38;2;241;250;140m"[0m
[38;5;238m 482[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                         [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mMomentum([0m[38;2;248;248;242m{[0m[38;2;248;248;242mmom_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlast_mom[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 483[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m 484[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc (StochRSI/Mom): Calculation resulted in NA for last candle.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 485[0m   [38;5;238mâ”‚[0m 
[38;5;238m 486[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 487[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc: Error calculating StochRSI/Momentum: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 488[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m 489[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mcol[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mtarget_cols[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mcol[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;255;255;255mNA[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Ensure columns exist with NA values on error[0m
[38;5;238m 490[0m   [38;5;238mâ”‚[0m 
[38;5;238m 491[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m
[38;5;238m 492[0m   [38;5;238mâ”‚[0m 
[38;5;238m 493[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123mcalculate_ehlers_fisher[0m[38;2;248;248;242m([0m
[38;5;238m 494[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mdf[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;248;248;242mDataFrame[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mlength[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108msignal_length[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m
[38;5;238m 495[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;248;248;242m->[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;248;248;242mDataFrame[0m[38;2;248;248;242m:[0m
[38;5;238m 496[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 497[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Calculates Ehlers Fisher Transform using pandas_ta.[0m
[38;5;238m 498[0m   [38;5;238mâ”‚[0m 
[38;5;238m 499[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Args:[0m
[38;5;238m 500[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        df (pd.DataFrame): Input DataFrame with 'high', 'low', 'close'.[0m
[38;5;238m 501[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        length (int): Lookback period for the Fisher Transform calculation.[0m
[38;5;238m 502[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        signal_length (int): Period for smoothing the Fisher line (signal line).[0m
[38;5;238m 503[0m   [38;5;238mâ”‚[0m 
[38;5;238m 504[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Returns:[0m
[38;5;238m 505[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        pd.DataFrame: DataFrame with added 'ehlers_fisher' and 'ehlers_signal' columns.[0m
[38;5;238m 506[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m                      Returns original DataFrame with NA columns on calculation failure.[0m
[38;5;238m 507[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 508[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Define target column names[0m
[38;5;238m 509[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mtarget_cols[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mehlers_fisher[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mehlers_signal[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m
[38;5;238m 510[0m   [38;5;238mâ”‚[0m 
[38;5;238m 511[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mrequired_input_cols[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mhigh[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mlow[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mclose[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m
[38;5;238m 512[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mempty[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;139;233;253mall[0m[38;2;248;248;242m([0m[38;2;248;248;242mc[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mcolumns[0m[38;2;248;248;242m [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mc[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mrequired_input_cols[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 513[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc (EhlersFisher): Input DataFrame is missing required columns [0m[38;2;248;248;242m{[0m[38;2;248;248;242mrequired_input_cols[0m[38;2;248;248;242m}[0m[38;2;241;250;140m or is empty.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 514[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mcol[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mtarget_cols[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mcol[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;255;255;255mNA[0m
[38;5;238m 515[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m
[38;5;238m 516[0m   [38;5;238mâ”‚[0m 
[38;5;238m 517[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Ehlers Fisher needs at least `length` periods.[0m
[38;5;238m 518[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;139;233;253mlen[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;248;248;242mlength[0m[38;2;248;248;242m:[0m
[38;5;238m 519[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc (EhlersFisher): DataFrame length ([0m[38;2;248;248;242m{[0m[38;2;139;233;253mlen[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) is less than required ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mlength[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) for Fisher Transform.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 520[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mcol[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mtarget_cols[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mcol[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;255;255;255mNA[0m
[38;5;238m 521[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m
[38;5;238m 522[0m   [38;5;238mâ”‚[0m 
[38;5;238m 523[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m 524[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Calculate Fisher Transform[0m
[38;5;238m 525[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m pandas_ta appends columns like FISHERT_{length}, FISHERTs_{length}[0m
[38;5;238m 526[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mta[0m[38;2;255;121;198m.[0m[38;2;80;250;123mfisher[0m[38;2;248;248;242m([0m[3;38;2;255;184;108mlength[0m[38;2;255;121;198m=[0m[38;2;248;248;242mlength[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108msignal[0m[38;2;255;121;198m=[0m[38;2;248;248;242msignal_length[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mappend[0m[38;2;255;121;198m=[0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m)[0m
[38;5;238m 527[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mfisher_t_col_name[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mFISHERT_[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlength[0m[38;2;248;248;242m}[0m[38;2;241;250;140m_[0m[38;2;248;248;242m{[0m[38;2;248;248;242msignal_length[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m
[38;5;238m 528[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mfisher_s_col_name[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mFISHERTs_[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlength[0m[38;2;248;248;242m}[0m[38;2;241;250;140m_[0m[38;2;248;248;242m{[0m[38;2;248;248;242msignal_length[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m
[38;5;238m 529[0m   [38;5;238mâ”‚[0m 
[38;5;238m 530[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mfisher_t_col_name[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mcolumns[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mfisher_s_col_name[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mcolumns[0m[38;2;248;248;242m:[0m
[38;5;238m 531[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mehlers_fisher[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mfisher_t_col_name[0m[38;2;248;248;242m][0m
[38;5;238m 532[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mehlers_signal[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mfisher_s_col_name[0m[38;2;248;248;242m][0m
[38;5;238m 533[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Clean up raw columns[0m
[38;5;238m 534[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdrop[0m[38;2;248;248;242m([0m[3;38;2;255;184;108mcolumns[0m[38;2;255;121;198m=[0m[38;2;248;248;242m[[0m[38;2;248;248;242mfisher_t_col_name[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mfisher_s_col_name[0m[38;2;248;248;242m][0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108merrors[0m[38;2;255;121;198m=[0m[38;2;241;250;140m'[0m[38;2;241;250;140mignore[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108minplace[0m[38;2;255;121;198m=[0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m)[0m
[38;5;238m 535[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m 536[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc (EhlersFisher): pandas_ta failed to create expected Fisher Transform columns.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 537[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mehlers_fisher[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;255;255;255mNA[0m
[38;5;238m 538[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mehlers_signal[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;255;255;255mNA[0m
[38;5;238m 539[0m   [38;5;238mâ”‚[0m 
[38;5;238m 540[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log the result of the last candle (only if values are valid)[0m
[38;5;238m 541[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlast_fisher[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mehlers_fisher[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m
[38;5;238m 542[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlast_signal[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mehlers_signal[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m
[38;5;238m 543[0m   [38;5;238mâ”‚[0m 
[38;5;238m 544[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;80;250;123mnotna[0m[38;2;248;248;242m([0m[38;2;248;248;242mlast_fisher[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;80;250;123mnotna[0m[38;2;248;248;242m([0m[38;2;248;248;242mlast_signal[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 545[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc (EhlersFisher([0m[38;2;248;248;242m{[0m[38;2;248;248;242mlength[0m[38;2;248;248;242m}[0m[38;2;241;250;140m,[0m[38;2;248;248;242m{[0m[38;2;248;248;242msignal_length[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)): Fisher=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlast_fisher[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Signal=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlast_signal[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 546[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m 547[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc (EhlersFisher): Calculation resulted in NA for last candle.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 548[0m   [38;5;238mâ”‚[0m 
[38;5;238m 549[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 550[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc: Error calculating Ehlers Fisher Transform: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 551[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m 552[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mcol[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mtarget_cols[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mcol[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;255;255;255mNA[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Ensure columns exist with NA values on error[0m
[38;5;238m 553[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m
[38;5;238m 554[0m   [38;5;238mâ”‚[0m 
[38;5;238m 555[0m   [38;5;238mâ”‚[0m 
[38;5;238m 556[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Volume and ATR Analysis ---[0m
[38;5;238m 557[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m (Keep this function as is, it's general purpose)[0m
[38;5;238m 558[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123manalyze_volume_atr[0m[38;2;248;248;242m([0m
[38;5;238m 559[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mdf[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;248;248;242mDataFrame[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108matr_len[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mvol_ma_len[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m
[38;5;238m 560[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;248;248;242m->[0m[38;2;248;248;242m [0m[38;2;248;248;242mDict[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m, [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m][0m[38;2;248;248;242m:[0m
[38;5;238m 561[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 562[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Calculates ATR, Volume Moving Average, and checks for volume spikes relative to the MA.[0m
[38;5;238m 563[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    ... (docstring truncated for brevity) ...[0m
[38;5;238m 564[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 565[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mDict[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m, [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m
[38;5;238m 566[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;241;250;140m"[0m[38;2;241;250;140matr[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mvolume_ma[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mlast_volume[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mvolume_ratio[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 567[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242m}[0m
[38;5;238m 568[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mrequired_cols[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mhigh[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mlow[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mclose[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mvolume[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m
[38;5;238m 569[0m   [38;5;238mâ”‚[0m 
[38;5;238m 570[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Input validation[0m
[38;5;238m 571[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mempty[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;139;233;253mall[0m[38;2;248;248;242m([0m[38;2;248;248;242mc[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mcolumns[0m[38;2;248;248;242m [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mc[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mrequired_cols[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 572[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc (Vol/ATR): Input DataFrame is missing required columns [0m[38;2;248;248;242m{[0m[38;2;248;248;242mrequired_cols[0m[38;2;248;248;242m}[0m[38;2;241;250;140m or is empty.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 573[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m
[38;5;238m 574[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mmin_len[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;139;233;253mmax[0m[38;2;248;248;242m([0m[38;2;248;248;242matr_len[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mvol_ma_len[0m[38;2;248;248;242m)[0m
[38;5;238m 575[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;139;233;253mlen[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;248;248;242mmin_len[0m[38;2;248;248;242m:[0m
[38;5;238m 576[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc (Vol/ATR): DataFrame length ([0m[38;2;248;248;242m{[0m[38;2;139;233;253mlen[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) is less than required ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mmin_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) for ATR([0m[38;2;248;248;242m{[0m[38;2;248;248;242matr_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)/VolMA([0m[38;2;248;248;242m{[0m[38;2;248;248;242mvol_ma_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 577[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m
[38;5;238m 578[0m   [38;5;238mâ”‚[0m 
[38;5;238m 579[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m 580[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Calculate ATR using pandas_ta[0m
[38;5;238m 581[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242matr_col[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mATRr_[0m[38;2;248;248;242m{[0m[38;2;248;248;242matr_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m pandas_ta default name for ATR[0m
[38;5;238m 582[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mta[0m[38;2;255;121;198m.[0m[38;2;80;250;123matr[0m[38;2;248;248;242m([0m[3;38;2;255;184;108mlength[0m[38;2;255;121;198m=[0m[38;2;248;248;242matr_len[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mappend[0m[38;2;255;121;198m=[0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m)[0m
[38;5;238m 583[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242matr_col[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mcolumns[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;80;250;123mnotna[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242matr_col[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 584[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140matr[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242matr_col[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m
[38;5;238m 585[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m 586[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc: Failed to calculate valid ATR([0m[38;2;248;248;242m{[0m[38;2;248;248;242matr_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Check input data.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 587[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Clean up ATR column[0m
[38;5;238m 588[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdrop[0m[38;2;248;248;242m([0m[3;38;2;255;184;108mcolumns[0m[38;2;255;121;198m=[0m[38;2;248;248;242m[[0m[38;2;248;248;242matr_col[0m[38;2;248;248;242m][0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108merrors[0m[38;2;255;121;198m=[0m[38;2;241;250;140m'[0m[38;2;241;250;140mignore[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108minplace[0m[38;2;255;121;198m=[0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m)[0m
[38;5;238m 589[0m   [38;5;238mâ”‚[0m 
[38;5;238m 590[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Calculate Volume Moving Average[0m
[38;5;238m 591[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mvolume_ma_col[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mvolume_ma[0m[38;2;241;250;140m'[0m
[38;5;238m 592[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Use min_periods to get MA sooner, but it might be less stable initially[0m
[38;5;238m 593[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mvolume_ma_col[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mvolume[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;80;250;123mrolling[0m[38;2;248;248;242m([0m[3;38;2;255;184;108mwindow[0m[38;2;255;121;198m=[0m[38;2;248;248;242mvol_ma_len[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mmin_periods[0m[38;2;255;121;198m=[0m[38;2;139;233;253mmax[0m[38;2;248;248;242m([0m[38;2;189;147;249m1[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mvol_ma_len[0m[38;2;248;248;242m [0m[38;2;255;121;198m/[0m[38;2;255;121;198m/[0m[38;2;248;248;242m [0m[38;2;189;147;249m2[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mmean[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m
[38;5;238m 594[0m   [38;5;238mâ”‚[0m 
[38;5;238m 595[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;80;250;123mnotna[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mvolume_ma_col[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 596[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mvolume_ma[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mvolume_ma_col[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m
[38;5;238m 597[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mlast_volume[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mvolume[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Get the volume of the last candle[0m
[38;5;238m 598[0m   [38;5;238mâ”‚[0m 
[38;5;238m 599[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Calculate Volume Ratio (Last Volume / Volume MA)[0m
[38;5;238m 600[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Check if MA is not None and significantly greater than zero before dividing[0m
[38;5;238m 601[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mvolume_ma[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mvolume_ma[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_QTY_EPSILON[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mlast_volume[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m:[0m
[38;5;238m 602[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mvolume_ratio[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mlast_volume[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m/[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mvolume_ma[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m
[38;5;238m 603[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m 604[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mvolume_ratio[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Avoid division by zero or near-zero MA[0m
[38;5;238m 605[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc: Volume ratio calculation skipped (LastVol=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mlast_volume[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;248;248;242m}[0m[38;2;241;250;140m, VolMA=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mvolume_ma[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 606[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m 607[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc: Failed to calculate valid Volume MA([0m[38;2;248;248;242m{[0m[38;2;248;248;242mvol_ma_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Check input data.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 608[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Clean up Volume MA column[0m
[38;5;238m 609[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdrop[0m[38;2;248;248;242m([0m[3;38;2;255;184;108mcolumns[0m[38;2;255;121;198m=[0m[38;2;248;248;242m[[0m[38;2;248;248;242mvolume_ma_col[0m[38;2;248;248;242m][0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108merrors[0m[38;2;255;121;198m=[0m[38;2;241;250;140m'[0m[38;2;241;250;140mignore[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108minplace[0m[38;2;255;121;198m=[0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m)[0m
[38;5;238m 610[0m   [38;5;238mâ”‚[0m 
[38;5;238m 611[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log results using safe formatting for potentially None values[0m
[38;5;238m 612[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242matr_val[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140matr[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m 613[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242matr_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242matr_val[0m[38;2;189;147;249m:.5f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242matr_val[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m'[0m
[38;5;238m 614[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlast_vol_val[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mlast_volume[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m 615[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mvol_ma_val[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mvolume_ma[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m 616[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mvol_ratio_val[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mvolume_ratio[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m 617[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlast_vol_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlast_vol_val[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_vol_val[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m'[0m
[38;5;238m 618[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mvol_ma_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mvol_ma_val[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mvol_ma_val[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m'[0m
[38;5;238m 619[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mvol_ratio_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mvol_ratio_val[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mvol_ratio_val[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m'[0m
[38;5;238m 620[0m   [38;5;238mâ”‚[0m 
[38;5;238m 621[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc: ATR([0m[38;2;248;248;242m{[0m[38;2;248;248;242matr_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) = [0m[38;2;248;248;242m{[0m[38;2;248;248;242matr_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 622[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc: Volume Analysis: Last=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlast_vol_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, MA([0m[38;2;248;248;242m{[0m[38;2;248;248;242mvol_ma_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mvol_ma_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Ratio=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mvol_ratio_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 623[0m   [38;5;238mâ”‚[0m 
[38;5;238m 624[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 625[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc: Error during Volume/ATR analysis: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 626[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m 627[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242mkey[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mkey[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m}[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Reset results to None on error[0m
[38;5;238m 628[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m
[38;5;238m 629[0m   [38;5;238mâ”‚[0m 
[38;5;238m 630[0m   [38;5;238mâ”‚[0m 
[38;5;238m 631[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Order Book Analysis ---[0m
[38;5;238m 632[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m (Keep this function as is, it's general purpose)[0m
[38;5;238m 633[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123manalyze_order_book[0m[38;2;248;248;242m([0m
[38;5;238m 634[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mexchange[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;255;121;198m.[0m[38;2;248;248;242mExchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108msymbol[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mdepth[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mfetch_limit[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m
[38;5;238m 635[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;248;248;242m->[0m[38;2;248;248;242m [0m[38;2;248;248;242mDict[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m, [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m][0m[38;2;248;248;242m:[0m
[38;5;238m 636[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 637[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Fetches the L2 order book and analyzes bid/ask pressure (cumulative volume ratio)[0m
[38;5;238m 638[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    and spread within the specified depth.[0m
[38;5;238m 639[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    ... (docstring truncated for brevity) ...[0m
[38;5;238m 640[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 641[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mDict[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m, [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m
[38;5;238m 642[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;241;250;140m"[0m[38;2;241;250;140mbid_ask_ratio[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mspread[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mbest_bid[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mbest_ask[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 643[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242m}[0m
[38;5;238m 644[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mOrder Book: Fetching L2 for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (Analyze Depth: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mdepth[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, API Fetch Limit: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfetch_limit[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 645[0m   [38;5;238mâ”‚[0m 
[38;5;238m 646[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;248;248;242mhas[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mfetchL2OrderBook[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 647[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mOrder Book: Exchange '[0m[38;2;248;248;242m{[0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;248;248;242mid[0m[38;2;248;248;242m}[0m[38;2;241;250;140m' does not support fetchL2OrderBook method. Skipping analysis.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 648[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m
[38;5;238m 649[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m 650[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242morder_book[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mfetch_l2_order_book[0m[38;2;248;248;242m([0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mlimit[0m[38;2;255;121;198m=[0m[38;2;248;248;242mfetch_limit[0m[38;2;248;248;242m)[0m
[38;5;238m 651[0m   [38;5;238mâ”‚[0m 
[38;5;238m 652[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242morder_book[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;139;233;253misinstance[0m[38;2;248;248;242m([0m[38;2;248;248;242morder_book[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mbids[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mlist[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;139;233;253misinstance[0m[38;2;248;248;242m([0m[38;2;248;248;242morder_book[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140masks[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mlist[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 653[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mOrder Book: Incomplete or invalid data structure received for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Removed logging full OB to avoid verbosity[0m
[38;5;238m 654[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m
[38;5;238m 655[0m   [38;5;238mâ”‚[0m 
[38;5;238m 656[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mbids[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mList[0m[38;2;248;248;242m[[0m[38;2;248;248;242mList[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242morder_book[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mbids[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m[[0m[38;2;248;248;242m][0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Use .get with default empty list[0m
[38;5;238m 657[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242masks[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mList[0m[38;2;248;248;242m[[0m[38;2;248;248;242mList[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242morder_book[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140masks[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m[[0m[38;2;248;248;242m][0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Use .get with default empty list[0m
[38;5;238m 658[0m   [38;5;238mâ”‚[0m 
[38;5;238m 659[0m   [38;5;238mâ”‚[0m 
[38;5;238m 660[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Get best bid/ask and calculate spread[0m
[38;5;238m 661[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mbest_bid[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mbids[0m[38;2;248;248;242m[[0m[38;2;189;147;249m0[0m[38;2;248;248;242m][0m[38;2;248;248;242m[[0m[38;2;189;147;249m0[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mbids[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;139;233;253mlen[0m[38;2;248;248;242m([0m[38;2;248;248;242mbids[0m[38;2;248;248;242m[[0m[38;2;189;147;249m0[0m[38;2;248;248;242m][0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m
[38;5;238m 662[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mbest_ask[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242masks[0m[38;2;248;248;242m[[0m[38;2;189;147;249m0[0m[38;2;248;248;242m][0m[38;2;248;248;242m[[0m[38;2;189;147;249m0[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242masks[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;139;233;253mlen[0m[38;2;248;248;242m([0m[38;2;248;248;242masks[0m[38;2;248;248;242m[[0m[38;2;189;147;249m0[0m[38;2;248;248;242m][0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m
[38;5;238m 663[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mbest_bid[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mbest_bid[0m
[38;5;238m 664[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mbest_ask[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mbest_ask[0m
[38;5;238m 665[0m   [38;5;238mâ”‚[0m 
[38;5;238m 666[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mspread[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 667[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mbest_bid[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mbest_ask[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m:[0m
[38;5;238m 668[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mspread[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mbest_ask[0m[38;2;248;248;242m [0m[38;2;255;121;198m-[0m[38;2;248;248;242m [0m[38;2;248;248;242mbest_bid[0m
[38;5;238m 669[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mspread[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mspread[0m
[38;5;238m 670[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mOrder Book: Best Bid=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mbest_bid[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Best Ask=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mbest_ask[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Spread=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mspread[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 671[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m 672[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log even if spread calculation isn't possible (e.g., one side is empty)[0m
[38;5;238m 673[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mOrder Book: Best Bid=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mbest_bid[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Best Ask=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mbest_ask[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (Spread calculation requires both > 0)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 674[0m   [38;5;238mâ”‚[0m 
[38;5;238m 675[0m   [38;5;238mâ”‚[0m 
[38;5;238m 676[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Calculate cumulative volume within the specified analysis depth[0m
[38;5;238m 677[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Sum the 'amount' (index 1) for the top 'depth' levels[0m
[38;5;238m 678[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mbid_volume_sum[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;139;233;253msum[0m[38;2;248;248;242m([0m[38;2;248;248;242mbid[0m[38;2;248;248;242m[[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mbid[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mbids[0m[38;2;248;248;242m[[0m[38;2;248;248;242m:[0m[38;2;248;248;242mdepth[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;139;233;253mlen[0m[38;2;248;248;242m([0m[38;2;248;248;242mbid[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;139;233;253misinstance[0m[38;2;248;248;242m([0m[38;2;248;248;242mbid[0m[38;2;248;248;242m[[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m 679[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mask_volume_sum[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;139;233;253msum[0m[38;2;248;248;242m([0m[38;2;248;248;242mask[0m[38;2;248;248;242m[[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mask[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242masks[0m[38;2;248;248;242m[[0m[38;2;248;248;242m:[0m[38;2;248;248;242mdepth[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;139;233;253mlen[0m[38;2;248;248;242m([0m[38;2;248;248;242mask[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;139;233;253misinstance[0m[38;2;248;248;242m([0m[38;2;248;248;242mask[0m[38;2;248;248;242m[[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m 680[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mOrder Book: Analysis (Depth [0m[38;2;248;248;242m{[0m[38;2;248;248;242mdepth[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Total Bid Vol=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mbid_volume_sum[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Total Ask Vol=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mask_volume_sum[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 681[0m   [38;5;238mâ”‚[0m 
[38;5;238m 682[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Calculate Bid/Ask Ratio (Total Bid Volume / Total Ask Volume)[0m
[38;5;238m 683[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mbid_ask_ratio[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 684[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Check if ask volume is significantly greater than zero to avoid division issues[0m
[38;5;238m 685[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mask_volume_sum[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_QTY_EPSILON[0m[38;2;248;248;242m:[0m
[38;5;238m 686[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mbid_ask_ratio[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mbid_volume_sum[0m[38;2;248;248;242m [0m[38;2;255;121;198m/[0m[38;2;248;248;242m [0m[38;2;248;248;242mask_volume_sum[0m
[38;5;238m 687[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mbid_ask_ratio[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mbid_ask_ratio[0m
[38;5;238m 688[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mOrder Book: Bid/Ask Ratio (Depth [0m[38;2;248;248;242m{[0m[38;2;248;248;242mdepth[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) = [0m[38;2;248;248;242m{[0m[38;2;248;248;242mbid_ask_ratio[0m[38;2;189;147;249m:.3f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 689[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m 690[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mOrder Book: Bid/Ask Ratio calculation skipped (Ask volume at depth [0m[38;2;248;248;242m{[0m[38;2;248;248;242mdepth[0m[38;2;248;248;242m}[0m[38;2;241;250;140m is zero or negligible)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 691[0m   [38;5;238mâ”‚[0m 
[38;5;238m 692[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mNetworkError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 693[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mOrder Book: Network error fetching order book for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 694[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mExchangeError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 695[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mOrder Book: Exchange error fetching order book for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 696[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mIndexError[0m[38;2;248;248;242m:[0m
[38;5;238m 697[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log more detail for the index error[0m
[38;5;238m 698[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mOrder Book: Index error processing bids/asks for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Data might be malformed or empty. Bids count: [0m[38;2;248;248;242m{[0m[38;2;139;233;253mlen[0m[38;2;248;248;242m([0m[38;2;248;248;242mbids[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Asks count: [0m[38;2;248;248;242m{[0m[38;2;139;233;253mlen[0m[38;2;248;248;242m([0m[38;2;248;248;242masks[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. First bid/ask: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mbids[0m[38;2;248;248;242m[[0m[38;2;248;248;242m:[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m[38;2;248;248;242m}[0m[38;2;241;250;140m, [0m[38;2;248;248;242m{[0m[38;2;248;248;242masks[0m[38;2;248;248;242m[[0m[38;2;248;248;242m:[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 699[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 700[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mOrder Book: Unexpected error analyzing order book for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 701[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m 702[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242mkey[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mkey[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m}[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Reset results to None on error[0m
[38;5;238m 703[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m
[38;5;238m 704[0m   [38;5;238mâ”‚[0m 
[38;5;238m 705[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Data Fetching ---[0m
[38;5;238m 706[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m (Keep this function as is, it's general purpose)[0m
[38;5;238m 707[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123mget_market_data[0m[38;2;248;248;242m([0m
[38;5;238m 708[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mexchange[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;255;121;198m.[0m[38;2;248;248;242mExchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108msymbol[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108minterval[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mlimit[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249m100[0m
[38;5;238m 709[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;248;248;242m->[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;248;248;242mDataFrame[0m[38;2;248;248;242m][0m[38;2;248;248;242m:[0m
[38;5;238m 710[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 711[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Fetches OHLCV (Open, High, Low, Close, Volume) data from the exchange.[0m
[38;5;238m 712[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    ... (docstring truncated for brevity) ...[0m
[38;5;238m 713[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 714[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;248;248;242mhas[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mfetchOHLCV[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 715[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mData Fetch: Exchange '[0m[38;2;248;248;242m{[0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;248;248;242mid[0m[38;2;248;248;242m}[0m[38;2;241;250;140m' does not support fetchOHLCV method.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 716[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 717[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m 718[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mData Fetch: Fetching [0m[38;2;248;248;242m{[0m[38;2;248;248;242mlimit[0m[38;2;248;248;242m}[0m[38;2;241;250;140m OHLCV candles for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (Timeframe: [0m[38;2;248;248;242m{[0m[38;2;248;248;242minterval[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 719[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Fetch data: Returns a list of lists [timestamp, open, high, low, close, volume][0m
[38;5;238m 720[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mohlcv[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mList[0m[38;2;248;248;242m[[0m[38;2;248;248;242mList[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mfetch_ohlcv[0m[38;2;248;248;242m([0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mtimeframe[0m[38;2;255;121;198m=[0m[38;2;248;248;242minterval[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mlimit[0m[38;2;255;121;198m=[0m[38;2;248;248;242mlimit[0m[38;2;248;248;242m)[0m
[38;5;238m 721[0m   [38;5;238mâ”‚[0m 
[38;5;238m 722[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mohlcv[0m[38;2;248;248;242m:[0m
[38;5;238m 723[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mData Fetch: No OHLCV data returned from exchange for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m ([0m[38;2;248;248;242m{[0m[38;2;248;248;242minterval[0m[38;2;248;248;242m}[0m[38;2;241;250;140m).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 724[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 725[0m   [38;5;238mâ”‚[0m 
[38;5;238m 726[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Convert to pandas DataFrame[0m
[38;5;238m 727[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;80;250;123mDataFrame[0m[38;2;248;248;242m([0m[38;2;248;248;242mohlcv[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mcolumns[0m[38;2;255;121;198m=[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mtimestamp[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mopen[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mhigh[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mlow[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mclose[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mvolume[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m)[0m
[38;5;238m 728[0m   [38;5;238mâ”‚[0m 
[38;5;238m 729[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Convert timestamp to datetime objects (UTC) and set as index[0m
[38;5;238m 730[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mtimestamp[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;80;250;123mto_datetime[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mtimestamp[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108munit[0m[38;2;255;121;198m=[0m[38;2;241;250;140m"[0m[38;2;241;250;140mms[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mutc[0m[38;2;255;121;198m=[0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m)[0m
[38;5;238m 731[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;80;250;123mset_index[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mtimestamp[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108minplace[0m[38;2;255;121;198m=[0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m)[0m
[38;5;238m 732[0m   [38;5;238mâ”‚[0m 
[38;5;238m 733[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Basic data validation: Check for NaN values[0m
[38;5;238m 734[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;80;250;123misnull[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;248;248;242mvalues[0m[38;2;255;121;198m.[0m[38;2;80;250;123many[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 735[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mnan_counts[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;80;250;123misnull[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123msum[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m
[38;5;238m 736[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mData Fetch: Fetched OHLCV data contains NaN values. Counts:[0m[38;2;255;121;198m\n[0m[38;2;248;248;242m{[0m[38;2;248;248;242mnan_counts[0m[38;2;248;248;242m[[0m[38;2;248;248;242mnan_counts[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m][0m[38;2;248;248;242m[[0m[38;2;248;248;242mnan_counts[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m][0m[38;2;248;248;242m}[0m[38;2;255;121;198m\n[0m[38;2;241;250;140mAttempting forward fill...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log counts > 0[0m
[38;5;238m 737[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;80;250;123mffill[0m[38;2;248;248;242m([0m[3;38;2;255;184;108minplace[0m[38;2;255;121;198m=[0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m)[0m
[38;5;238m 738[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;80;250;123misnull[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;248;248;242mvalues[0m[38;2;255;121;198m.[0m[38;2;80;250;123many[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 739[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mData Fetch: NaN values remain after forward fill. Cannot proceed with this data batch.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 740[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 741[0m   [38;5;238mâ”‚[0m 
[38;5;238m 742[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Ensure columns are numeric (especially after ffill which might propagate NaNs)[0m
[38;5;238m 743[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mcol[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mopen[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mhigh[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mlow[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mclose[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mvolume[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m:[0m
[38;5;238m 744[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mcol[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;80;250;123mto_numeric[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mcol[0m[38;2;248;248;242m][0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108merrors[0m[38;2;255;121;198m=[0m[38;2;241;250;140m'[0m[38;2;241;250;140mcoerce[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Coerce errors to NaN[0m
[38;5;238m 745[0m   [38;5;238mâ”‚[0m 
[38;5;238m 746[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Re-check for NaNs after coercion if needed, or handle in indicator calcs[0m
[38;5;238m 747[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;80;250;123misnull[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;248;248;242mvalues[0m[38;2;255;121;198m.[0m[38;2;80;250;123many[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 748[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mData Fetch: NaN values introduced or remain after numeric conversion. Indicators might fail.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 749[0m   [38;5;238mâ”‚[0m 
[38;5;238m 750[0m   [38;5;238mâ”‚[0m 
[38;5;238m 751[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mData Fetch: Successfully fetched and processed [0m[38;2;248;248;242m{[0m[38;2;139;233;253mlen[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m OHLCV candles for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 752[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m
[38;5;238m 753[0m   [38;5;238mâ”‚[0m 
[38;5;238m 754[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mNetworkError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 755[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mData Fetch: Network error fetching OHLCV for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 756[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mExchangeError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 757[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mData Fetch: Exchange error fetching OHLCV for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 758[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 759[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mData Fetch: Unexpected error fetching market data for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 760[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m 761[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 762[0m   [38;5;238mâ”‚[0m 
[38;5;238m 763[0m   [38;5;238mâ”‚[0m 
[38;5;238m 764[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Position & Order Management (REVISED - v1.6.0) ---[0m
[38;5;238m 765[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123mget_current_position[0m[38;2;248;248;242m([0m[3;38;2;255;184;108mexchange[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;255;121;198m.[0m[38;2;248;248;242mExchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108msymbol[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;248;248;242m->[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[38;2;248;248;242mDict[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m, [0m[38;2;248;248;242mAny[0m[38;2;248;248;242m][0m[38;2;248;248;242m][0m[38;2;248;248;242m:[0m
[38;5;238m 766[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 767[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Fetches the current position details for a given symbol, focusing on[0m
[38;5;238m 768[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Bybit V5 API structure via CCXT for robustness against zero-size entries[0m
[38;5;238m 769[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    and using the 'side' field for direction. Assumes One-Way mode.[0m
[38;5;238m 770[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Returns the raw CCXT position dictionary for the symbol if found and active,[0m
[38;5;238m 771[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    or None otherwise.[0m
[38;5;238m 772[0m   [38;5;238mâ”‚[0m 
[38;5;238m 773[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Args:[0m
[38;5;238m 774[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        exchange (ccxt.Exchange): Initialized CCXT exchange object.[0m
[38;5;238m 775[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        symbol (str): Market symbol in CCXT unified format (e.g., 'BTC/USDT:USDT').[0m
[38;5;238m 776[0m   [38;5;238mâ”‚[0m 
[38;5;238m 777[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Returns:[0m
[38;5;238m 778[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        Optional[Dict[str, Any]]: The raw CCXT position dictionary for the symbol[0m
[38;5;238m 779[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m                                   if an active position (size > epsilon and side[0m
[38;5;238m 780[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m                                   is 'Buy'/'Sell') exists in One-Way mode.[0m
[38;5;238m 781[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m                                   Returns None if no such position is found or on error.[0m
[38;5;238m 782[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 783[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mccxt_unified_symbol[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m
[38;5;238m 784[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mmarket_id[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 785[0m   [38;5;238mâ”‚[0m 
[38;5;238m 786[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m 787[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mmarket[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mmarket[0m[38;2;248;248;242m([0m[38;2;248;248;242mccxt_unified_symbol[0m[38;2;248;248;242m)[0m
[38;5;238m 788[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mmarket_id[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mmarket[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mid[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m The ID used by the exchange (e.g., 'BTCUSDT')[0m
[38;5;238m 789[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Check: Fetching position for CCXT symbol '[0m[38;2;248;248;242m{[0m[38;2;248;248;242mccxt_unified_symbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m' (Target Exchange Market ID: '[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_id[0m[38;2;248;248;242m}[0m[38;2;241;250;140m')...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 790[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mBadSymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mKeyError[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 791[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Check: Failed to get market info/ID for '[0m[38;2;248;248;242m{[0m[38;2;248;248;242mccxt_unified_symbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m': [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 792[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 793[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Catch other potential errors during market lookup[0m
[38;5;238m 794[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Check: Unexpected error getting market info for '[0m[38;2;248;248;242m{[0m[38;2;248;248;242mccxt_unified_symbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m': [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 795[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m 796[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 797[0m   [38;5;238mâ”‚[0m 
[38;5;238m 798[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m 799[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;248;248;242mhas[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mfetchPositions[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 800[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Check: Exchange '[0m[38;2;248;248;242m{[0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;248;248;242mid[0m[38;2;248;248;242m}[0m[38;2;241;250;140m' does not support fetchPositions. Cannot reliably get position status.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 801[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 802[0m   [38;5;238mâ”‚[0m 
[38;5;238m 803[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mparams[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m
[38;5;238m 804[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mmarket[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mlinear[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 805[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mparams[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;241;250;140m'[0m[38;2;241;250;140mcategory[0m[38;2;241;250;140m'[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mlinear[0m[38;2;241;250;140m'[0m[38;2;248;248;242m}[0m
[38;5;238m 806[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melif[0m[38;2;248;248;242m [0m[38;2;248;248;242mmarket[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140minverse[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 807[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mparams[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;241;250;140m'[0m[38;2;241;250;140mcategory[0m[38;2;241;250;140m'[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140minverse[0m[38;2;241;250;140m'[0m[38;2;248;248;242m}[0m
[38;5;238m 808[0m   [38;5;238mâ”‚[0m 
[38;5;238m 809[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Check: Calling fetchPositions with params: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mparams[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 810[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Fetch positions - Pass the unified symbol explicitly to filter on exchange side if supported[0m
[38;5;238m 811[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mfetched_positions[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mfetch_positions[0m[38;2;248;248;242m([0m[3;38;2;255;184;108msymbols[0m[38;2;255;121;198m=[0m[38;2;248;248;242m[[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m][0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mparams[0m[38;2;255;121;198m=[0m[38;2;248;248;242mparams[0m[38;2;248;248;242m)[0m
[38;5;238m 812[0m   [38;5;238mâ”‚[0m 
[38;5;238m 813[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Check: Raw data from fetch_positions (filtered for symbol '[0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m'):[0m[38;2;255;121;198m\n[0m[38;2;248;248;242m{[0m[38;2;248;248;242mfetched_positions[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 814[0m   [38;5;238mâ”‚[0m 
[38;5;238m 815[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mpos[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mfetched_positions[0m[38;2;248;248;242m:[0m
[38;5;238m 816[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Check: Evaluating raw position entry: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mpos[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 817[0m   [38;5;238mâ”‚[0m 
[38;5;238m 818[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- 1. Symbol Check (using raw exchange ID) ---[0m
[38;5;238m 819[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mpos_symbol_raw[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140minfo[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140msymbol[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m 820[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mpos_symbol_raw[0m[38;2;248;248;242m [0m[38;2;255;121;198m!=[0m[38;2;248;248;242m [0m[38;2;248;248;242mmarket_id[0m[38;2;248;248;242m:[0m
[38;5;238m 821[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSkipping position entry: Symbol mismatch (Got Raw ID '[0m[38;2;248;248;242m{[0m[38;2;248;248;242mpos_symbol_raw[0m[38;2;248;248;242m}[0m[38;2;241;250;140m', Expected Target ID '[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_id[0m[38;2;248;248;242m}[0m[38;2;241;250;140m')[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 822[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mcontinue[0m
[38;5;238m 823[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSymbol '[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_id[0m[38;2;248;248;242m}[0m[38;2;241;250;140m' matches target.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 824[0m   [38;5;238mâ”‚[0m 
[38;5;238m 825[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- 2. Position Mode Check (Assume One-Way) ---[0m
[38;5;238m 826[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mposition_idx[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140minfo[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mpositionIdx[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m
[38;5;238m 827[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition_idx[0m[38;2;248;248;242m [0m[38;2;255;121;198m!=[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m:[0m
[38;5;238m 828[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSkipping position entry: Position Index is [0m[38;2;248;248;242m{[0m[38;2;248;248;242mposition_idx[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (Expected 0 for One-Way Mode).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 829[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mcontinue[0m
[38;5;238m 830[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Index is [0m[38;2;248;248;242m{[0m[38;2;248;248;242mposition_idx[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (OK for One-Way Mode).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 831[0m   [38;5;238mâ”‚[0m 
[38;5;238m 832[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- 3. Strict Side Check (Using Bybit V5 'side' from 'info') ---[0m
[38;5;238m 833[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mpos_side_v5[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140minfo[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mside[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mNone[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m 834[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRaw position side from info.side: '[0m[38;2;248;248;242m{[0m[38;2;248;248;242mpos_side_v5[0m[38;2;248;248;242m}[0m[38;2;241;250;140m'[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 835[0m   [38;5;238mâ”‚[0m 
[38;5;238m 836[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m *** IMPORTANT: If the API explicitly reports side as 'None', treat as no position ***[0m
[38;5;238m 837[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mpos_side_v5[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mNone[0m[38;2;241;250;140m'[0m[38;2;248;248;242m:[0m
[38;5;238m 838[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSkipping position entry: Side reported by API is '[0m[38;2;248;248;242m{[0m[38;2;248;248;242mpos_side_v5[0m[38;2;248;248;242m}[0m[38;2;241;250;140m'.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 839[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mcontinue[0m
[38;5;238m 840[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSide '[0m[38;2;248;248;242m{[0m[38;2;248;248;242mpos_side_v5[0m[38;2;248;248;242m}[0m[38;2;241;250;140m' found.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 841[0m   [38;5;238mâ”‚[0m 
[38;5;238m 842[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- 4. Check Position Size (Using Bybit V5 'size' from 'info') ---[0m
[38;5;238m 843[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242msize_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140minfo[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140msize[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m 844[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242msize_str[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242msize_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m
[38;5;238m 845[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242msize_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mcontracts[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Fallback to CCXT unified field[0m
[38;5;238m 846[0m   [38;5;238mâ”‚[0m 
[38;5;238m 847[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242msize_str[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242msize_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m
[38;5;238m 848[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSkipping position entry: Could not find valid quantity string. Data: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mpos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140minfo[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 849[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mcontinue[0m
[38;5;238m 850[0m   [38;5;238mâ”‚[0m 
[38;5;238m 851[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- 5. Parse and Validate Size ---[0m
[38;5;238m 852[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m 853[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242msize[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242msize_str[0m[38;2;248;248;242m)[0m
[38;5;238m 854[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mParsed quantity: [0m[38;2;248;248;242m{[0m[38;2;248;248;242msize[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (from string: '[0m[38;2;248;248;242m{[0m[38;2;248;248;242msize_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m')[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 855[0m   [38;5;238mâ”‚[0m 
[38;5;238m 856[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Final Check: Is the size significantly non-zero? ---[0m
[38;5;238m 857[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;139;233;253mabs[0m[38;2;248;248;242m([0m[38;2;248;248;242msize[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_QTY_EPSILON[0m[38;2;248;248;242m:[0m
[38;5;238m 858[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m We found an active position! Return the full raw CCXT position object.[0m
[38;5;238m 859[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mdetermined_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_LONG[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mpos_side_v5[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mBuy[0m[38;2;241;250;140m'[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_SHORT[0m
[38;5;238m 860[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mentry_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mpos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mentryPrice[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mpos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140minfo[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mavgPrice[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Use CCXT or raw avgPrice[0m
[38;5;238m 861[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242munrealized_pnl[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mpos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140munrealizedPnl[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mpos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140minfo[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140munrealisedPnl[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Use CCXT or raw[0m
[38;5;238m 862[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mpnl_percentage[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mpos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mpercentage[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mpos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140minfo[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mpnlRatio[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Use CCXT or raw pnlRatio (note: pnlRatio might need *100 for percent)[0m
[38;5;238m 863[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Bybit V5 pnlRatio is typically 0-1, convert to %[0m
[38;5;238m 864[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpnl_percentage[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mpnl_percentage[0m[38;2;248;248;242m [0m[38;2;255;121;198m*=[0m[38;2;248;248;242m [0m[38;2;189;147;249m100[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m
[38;5;238m 865[0m   [38;5;238mâ”‚[0m 
[38;5;238m 866[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Check: Found ACTIVE position: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mdetermined_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m Qty=[0m[38;2;248;248;242m{[0m[38;2;139;233;253mabs[0m[38;2;248;248;242m([0m[38;2;248;248;242msize[0m[38;2;248;248;242m)[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m @ Entry=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mentry_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. [0m[38;2;241;250;140m"[0m
[38;5;238m 867[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                                [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPNL=[0m[38;2;248;248;242m{[0m[38;2;248;248;242munrealized_pnl[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mpnl_percentage[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m%). Raw: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mpos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140minfo[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 868[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mpos[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Return the entire position dictionary[0m
[38;5;238m 869[0m   [38;5;238mâ”‚[0m 
[38;5;238m 870[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m 871[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSkipping position entry: Position size [0m[38;2;248;248;242m{[0m[38;2;248;248;242msize[0m[38;2;248;248;242m}[0m[38;2;241;250;140m is <= epsilon [0m[38;2;248;248;242m{[0m[38;2;255;255;255mPOSITION_QTY_EPSILON[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Treating as effectively closed.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 872[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;255;121;198mcontinue[0m
[38;5;238m 873[0m   [38;5;238mâ”‚[0m 
[38;5;238m 874[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[3;38;2;102;217;239mValueError[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mTypeError[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 875[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Check: Error parsing size/quantity or price/pnl for [0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_id[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Data: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mpos[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Error: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 876[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mcontinue[0m
[38;5;238m 877[0m   [38;5;238mâ”‚[0m 
[38;5;238m 878[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m If the loop finishes without returning, no active position was found for the target symbol/mode[0m
[38;5;238m 879[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Check: No active position found for [0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_id[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (One-Way Mode).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 880[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 881[0m   [38;5;238mâ”‚[0m 
[38;5;238m 882[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mNetworkError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 883[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Check: Network error during fetch_positions for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 884[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mExchangeError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 885[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Check: Exchange error during fetch_positions for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 886[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Specific Bybit V5 errors might occur here, e.g., category not supported if not config'd[0m
[38;5;238m 887[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 888[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Check: Unexpected error during position check for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 889[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m 890[0m   [38;5;238mâ”‚[0m 
[38;5;238m 891[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Return None if any error occurred or no position was found[0m
[38;5;238m 892[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Check: Returning None due to error or no active position found for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 893[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 894[0m   [38;5;238mâ”‚[0m 
[38;5;238m 895[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Leverage Setting ---[0m
[38;5;238m 896[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m (Keep this function as is)[0m
[38;5;238m 897[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123mset_leverage[0m[38;2;248;248;242m([0m[3;38;2;255;184;108mexchange[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;255;121;198m.[0m[38;2;248;248;242mExchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108msymbol[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mleverage[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;248;248;242m->[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mbool[0m[38;2;248;248;242m:[0m
[38;5;238m 898[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 899[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Sets the leverage for a given futures symbol with retries and checks.[0m
[38;5;238m 900[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Verifies that the symbol is a contract market first.[0m
[38;5;238m 901[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    ... (docstring truncated for brevity) ...[0m
[38;5;238m 902[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 903[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLeverage Setting: Attempting to set [0m[38;2;248;248;242m{[0m[38;2;248;248;242mleverage[0m[38;2;248;248;242m}[0m[38;2;241;250;140mx leverage for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 904[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m 905[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mmarket[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mmarket[0m[38;2;248;248;242m([0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m)[0m
[38;5;238m 906[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mmarket[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mcontract[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mmarket[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mspot[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 907[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLeverage Setting: Cannot set leverage for non-contract market: [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Market type: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mtype[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 908[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m
[38;5;238m 909[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mMarket info for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: Type=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mtype[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Contract=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mcontract[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 910[0m   [38;5;238mâ”‚[0m 
[38;5;238m 911[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mBadSymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mKeyError[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 912[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLeverage Setting: Failed to get market info for symbol '[0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m': [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 913[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m
[38;5;238m 914[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 915[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLeverage Setting: Unexpected error getting market info for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 916[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m 917[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m
[38;5;238m 918[0m   [38;5;238mâ”‚[0m 
[38;5;238m 919[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mattempt[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;139;233;253mrange[0m[38;2;248;248;242m([0m[38;2;255;255;255mRETRY_COUNT[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 920[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m 921[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLeverage Setting: Calling exchange.set_leverage([0m[38;2;248;248;242m{[0m[38;2;248;248;242mleverage[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, '[0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m') (Attempt [0m[38;2;248;248;242m{[0m[38;2;248;248;242mattempt[0m[38;2;255;121;198m+[0m[38;2;189;147;249m1[0m[38;2;248;248;242m}[0m[38;2;241;250;140m/[0m[38;2;248;248;242m{[0m[38;2;255;255;255mRETRY_COUNT[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 922[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mresponse[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mset_leverage[0m[38;2;248;248;242m([0m[3;38;2;255;184;108mleverage[0m[38;2;255;121;198m=[0m[38;2;248;248;242mleverage[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108msymbol[0m[38;2;255;121;198m=[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m)[0m
[38;5;238m 923[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123msuccess[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLeverage Setting: Successfully set leverage to [0m[38;2;248;248;242m{[0m[38;2;248;248;242mleverage[0m[38;2;248;248;242m}[0m[38;2;241;250;140mx for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Removed logging full response to reduce verbosity[0m
[38;5;238m 924[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m
[38;5;238m 925[0m   [38;5;238mâ”‚[0m 
[38;5;238m 926[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mExchangeError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 927[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242merror_msg_lower[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m([0m[38;2;248;248;242me[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mlower[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m
[38;5;238m 928[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mleverage not modified[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242merror_msg_lower[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242m\[0m
[38;5;238m 929[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m               [0m[38;2;241;250;140m"[0m[38;2;241;250;140msame leverage[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242merror_msg_lower[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242m\[0m
[38;5;238m 930[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m               [0m[38;2;241;250;140m"[0m[38;2;241;250;140mleverage is not changed[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242merror_msg_lower[0m[38;2;248;248;242m:[0m
[38;5;238m 931[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLeverage Setting: Leverage for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m already set to [0m[38;2;248;248;242m{[0m[38;2;248;248;242mleverage[0m[38;2;248;248;242m}[0m[38;2;241;250;140mx (Confirmed by exchange message).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 932[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m
[38;5;238m 933[0m   [38;5;238mâ”‚[0m 
[38;5;238m 934[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLeverage Setting: Exchange error on attempt [0m[38;2;248;248;242m{[0m[38;2;248;248;242mattempt[0m[38;2;255;121;198m+[0m[38;2;189;147;249m1[0m[38;2;248;248;242m}[0m[38;2;241;250;140m/[0m[38;2;248;248;242m{[0m[38;2;255;255;255mRETRY_COUNT[0m[38;2;248;248;242m}[0m[38;2;241;250;140m for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 935[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mattempt[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;255;255;255mRETRY_COUNT[0m[38;2;248;248;242m [0m[38;2;255;121;198m-[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m[38;2;248;248;242m:[0m
[38;5;238m 936[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRetrying leverage setting after [0m[38;2;248;248;242m{[0m[38;2;255;255;255mRETRY_DELAY_SECONDS[0m[38;2;248;248;242m}[0m[38;2;241;250;140ms...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 937[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mtime[0m[38;2;255;121;198m.[0m[38;2;80;250;123msleep[0m[38;2;248;248;242m([0m[38;2;255;255;255mRETRY_DELAY_SECONDS[0m[38;2;248;248;242m)[0m
[38;5;238m 938[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m 939[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLeverage Setting: Failed to set leverage for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m after [0m[38;2;248;248;242m{[0m[38;2;255;255;255mRETRY_COUNT[0m[38;2;248;248;242m}[0m[38;2;241;250;140m attempts due to exchange error: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 940[0m   [38;5;238mâ”‚[0m 
[38;5;238m 941[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mNetworkError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 942[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLeverage Setting: Network error on attempt [0m[38;2;248;248;242m{[0m[38;2;248;248;242mattempt[0m[38;2;255;121;198m+[0m[38;2;189;147;249m1[0m[38;2;248;248;242m}[0m[38;2;241;250;140m/[0m[38;2;248;248;242m{[0m[38;2;255;255;255mRETRY_COUNT[0m[38;2;248;248;242m}[0m[38;2;241;250;140m for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 943[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mattempt[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;255;255;255mRETRY_COUNT[0m[38;2;248;248;242m [0m[38;2;255;121;198m-[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m[38;2;248;248;242m:[0m
[38;5;238m 944[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mtime[0m[38;2;255;121;198m.[0m[38;2;80;250;123msleep[0m[38;2;248;248;242m([0m[38;2;255;255;255mRETRY_DELAY_SECONDS[0m[38;2;248;248;242m)[0m
[38;5;238m 945[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m 946[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLeverage Setting: Failed to set leverage for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m after [0m[38;2;248;248;242m{[0m[38;2;255;255;255mRETRY_COUNT[0m[38;2;248;248;242m}[0m[38;2;241;250;140m attempts due to network errors.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 947[0m   [38;5;238mâ”‚[0m 
[38;5;238m 948[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 949[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLeverage Setting: Unexpected error on attempt [0m[38;2;248;248;242m{[0m[38;2;248;248;242mattempt[0m[38;2;255;121;198m+[0m[38;2;189;147;249m1[0m[38;2;248;248;242m}[0m[38;2;241;250;140m for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 950[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m 951[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m
[38;5;238m 952[0m   [38;5;238mâ”‚[0m 
[38;5;238m 953[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m
[38;5;238m 954[0m   [38;5;238mâ”‚[0m 
[38;5;238m 955[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Close Position ---[0m
[38;5;238m 956[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123mclose_position[0m[38;2;248;248;242m([0m
[38;5;238m 957[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mexchange[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;255;121;198m.[0m[38;2;248;248;242mExchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108msymbol[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mposition_info[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[38;2;248;248;242mDict[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m, [0m[38;2;248;248;242mAny[0m[38;2;248;248;242m][0m[38;2;248;248;242m][0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mreason[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mSignal[0m[38;2;241;250;140m"[0m
[38;5;238m 958[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;248;248;242m->[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[38;2;248;248;242mDict[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m, [0m[38;2;248;248;242mAny[0m[38;2;248;248;242m][0m[38;2;248;248;242m][0m[38;2;248;248;242m:[0m
[38;5;238m 959[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 960[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Closes the specified active position using a market order with reduce_only=True.[0m
[38;5;238m 961[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Includes a pre-close position re-validation step to mitigate race conditions.[0m
[38;5;238m 962[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Sends SMS alerts on success or failure.[0m
[38;5;238m 963[0m   [38;5;238mâ”‚[0m 
[38;5;238m 964[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Args:[0m
[38;5;238m 965[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        exchange (ccxt.Exchange): Initialized CCXT exchange object.[0m
[38;5;238m 966[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        symbol (str): Market symbol (e.g., 'BTC/USDT:USDT').[0m
[38;5;238m 967[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        position_info (Optional[Dict[str, Any]]): The position dictionary (can be None)[0m
[38;5;238m 968[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m                                                    as identified *before* calling this.[0m
[38;5;238m 969[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m                                                    Used for initial info and re-validation.[0m
[38;5;238m 970[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m                                                    Expected format is the raw CCXT position object.[0m
[38;5;238m 971[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        reason (str): Reason for closing (e.g., "SL", "TP", "TS", "Reversal", "Shutdown").[0m
[38;5;238m 972[0m   [38;5;238mâ”‚[0m 
[38;5;238m 973[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Returns:[0m
[38;5;238m 974[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        Optional[Dict[str, Any]]: The CCXT order dictionary if the close order was[0m
[38;5;238m 975[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m                                  successfully placed, None otherwise.[0m
[38;5;238m 976[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 977[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Extract info from the potentially existing position_info dict passed in[0m
[38;5;238m 978[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242minitial_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition_info[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mside[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition_info[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_NONE[0m
[38;5;238m 979[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242minitial_qty[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;139;233;253mabs[0m[38;2;248;248;242m([0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mposition_info[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140minfo[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140msize[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition_info[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mcontracts[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition_info[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Use raw size or contracts[0m
[38;5;238m 980[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;255;121;198m.[0m[38;2;80;250;123msplit[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140m/[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m[[0m[38;2;189;147;249m0[0m[38;2;248;248;242m][0m
[38;5;238m 981[0m   [38;5;238mâ”‚[0m 
[38;5;238m 982[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mClose Position: Initiated for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Reason: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mreason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Initial check state: [0m[38;2;248;248;242m{[0m[38;2;248;248;242minitial_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m Qty=[0m[38;2;248;248;242m{[0m[38;2;248;248;242minitial_qty[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 983[0m   [38;5;238mâ”‚[0m 
[38;5;238m 984[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m ** Crucial Pre-Close Re-validation Step **[0m
[38;5;238m 985[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Fetch the position state *again* immediately before attempting to close.[0m
[38;5;238m 986[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mClose Position: Re-validating current position state for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 987[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlive_position[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mget_current_position[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Get the latest, full position dict[0m
[38;5;238m 988[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlive_position_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlive_position[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mside[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mlive_position[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_NONE[0m
[38;5;238m 989[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlive_amount_to_close[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;139;233;253mabs[0m[38;2;248;248;242m([0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mlive_position[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140minfo[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140msize[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mlive_position[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mcontracts[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mlive_position[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m
[38;5;238m 990[0m   [38;5;238mâ”‚[0m 
[38;5;238m 991[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mlive_position_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_NONE[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mlive_amount_to_close[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_QTY_EPSILON[0m[38;2;248;248;242m:[0m
[38;5;238m 992[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mClose Position: Re-validation shows NO active position for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (Live Side: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mlive_position_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Qty: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mlive_amount_to_close[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Aborting close attempt.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 993[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242minitial_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m!=[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_NONE[0m[38;2;248;248;242m:[0m
[38;5;238m 994[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mClose Position: Discrepancy detected. Initial check showed [0m[38;2;248;248;242m{[0m[38;2;248;248;242minitial_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, but live check shows none.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 995[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Reset global TS state if position is confirmed closed[0m
[38;5;238m 996[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mtrailing_stop_activated[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;255;121;198mdel[0m[38;2;248;248;242m [0m[38;2;248;248;242mtrailing_stop_activated[0m[38;2;248;248;242m[[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m][0m
[38;5;238m 997[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_trailing_stop_price[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;255;121;198mdel[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_trailing_stop_price[0m[38;2;248;248;242m[[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m][0m
[38;5;238m 998[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 999[0m   [38;5;238mâ”‚[0m 
[38;5;238m1000[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Determine the closing side based on the *live* position side[0m
[38;5;238m1001[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mside_to_execute_close[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;255;255;255mSIDE_SELL[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mlive_position_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_LONG[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;255;255;255mSIDE_BUY[0m
[38;5;238m1002[0m   [38;5;238mâ”‚[0m 
[38;5;238m1003[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m1004[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Format the amount to the exchange's required precision[0m
[38;5;238m1005[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mamount_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mamount_to_precision[0m[38;2;248;248;242m([0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mlive_amount_to_close[0m[38;2;248;248;242m)[0m
[38;5;238m1006[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mamount_float[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mamount_str[0m[38;2;248;248;242m)[0m
[38;5;238m1007[0m   [38;5;238mâ”‚[0m 
[38;5;238m1008[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mamount_float[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_QTY_EPSILON[0m[38;2;248;248;242m:[0m
[38;5;238m1009[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mClose Position: Calculated closing amount after precision ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mamount_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) is zero or negligible ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mlive_amount_to_close[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m raw). Aborting.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1010[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1011[0m   [38;5;238mâ”‚[0m 
[38;5;238m1012[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mClose Position: Attempting to CLOSE [0m[38;2;248;248;242m{[0m[38;2;248;248;242mlive_position_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m position ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mreason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): [0m[38;2;241;250;140m"[0m
[38;5;238m1013[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                       [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mExecuting [0m[38;2;248;248;242m{[0m[38;2;248;248;242mside_to_execute_close[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m MARKET order for [0m[38;2;248;248;242m{[0m[38;2;248;248;242mamount_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m [0m[38;2;241;250;140m"[0m
[38;5;238m1014[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                       [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mwith params [0m[38;2;255;121;198m{{[0m[38;2;241;250;140m'reduce_only': True[0m[38;2;255;121;198m}}[0m[38;2;241;250;140m...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1015[0m   [38;5;238mâ”‚[0m 
[38;5;238m1016[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mparams[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;241;250;140m'[0m[38;2;241;250;140mreduce_only[0m[38;2;241;250;140m'[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m}[0m
[38;5;238m1017[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242morder[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcreate_market_order[0m[38;2;248;248;242m([0m
[38;5;238m1018[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108msymbol[0m[38;2;255;121;198m=[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m
[38;5;238m1019[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mside[0m[38;2;255;121;198m=[0m[38;2;248;248;242mside_to_execute_close[0m[38;2;248;248;242m,[0m
[38;5;238m1020[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mamount[0m[38;2;255;121;198m=[0m[38;2;248;248;242mamount_float[0m[38;2;248;248;242m,[0m
[38;5;238m1021[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mparams[0m[38;2;255;121;198m=[0m[38;2;248;248;242mparams[0m
[38;5;238m1022[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242m)[0m
[38;5;238m1023[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Post-Order Placement ---[0m
[38;5;238m1024[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mfill_price_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242morder[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140maverage[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242morder[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140maverage[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mMarket (Check Fills)[0m[38;2;241;250;140m"[0m
[38;5;238m1025[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mfilled_qty_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242morder[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mfilled[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242morder[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mfilled[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140m?[0m[38;2;241;250;140m"[0m
[38;5;238m1026[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242morder_id_short[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m([0m[38;2;248;248;242morder[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mid[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m6[0m[38;2;248;248;242m:[0m[38;2;248;248;242m][0m
[38;5;238m1027[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mcost_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242morder[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mcost[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242morder[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mcost[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m"[0m
[38;5;238m1028[0m   [38;5;238mâ”‚[0m 
[38;5;238m1029[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123msuccess[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mClose Position: CLOSE Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mreason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) placed successfully for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. [0m[38;2;241;250;140m"[0m
[38;5;238m1030[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                       [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mQty Filled: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfilled_qty_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m/[0m[38;2;248;248;242m{[0m[38;2;248;248;242mamount_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Avg Fill ~[0m[38;2;248;248;242m{[0m[38;2;248;248;242mfill_price_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Cost: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcost_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT. ID:...[0m[38;2;248;248;242m{[0m[38;2;248;248;242morder_id_short[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1031[0m   [38;5;238mâ”‚[0m 
[38;5;238m1032[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Send SMS Alert on successful order placement[0m
[38;5;238m1033[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242msms_msg[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] Closed [0m[38;2;248;248;242m{[0m[38;2;248;248;242mlive_position_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m [0m[38;2;248;248;242m{[0m[38;2;248;248;242mamount_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m @ ~[0m[38;2;248;248;242m{[0m[38;2;248;248;242mfill_price_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mreason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). [0m[38;2;241;250;140m"[0m
[38;5;238m1034[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                   [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mID:...[0m[38;2;248;248;242m{[0m[38;2;248;248;242morder_id_short[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1035[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[38;2;248;248;242msms_msg[0m[38;2;248;248;242m)[0m
[38;5;238m1036[0m   [38;5;238mâ”‚[0m 
[38;5;238m1037[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Reset global TS state as we successfully placed a close order[0m
[38;5;238m1038[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mtrailing_stop_activated[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;255;121;198mdel[0m[38;2;248;248;242m [0m[38;2;248;248;242mtrailing_stop_activated[0m[38;2;248;248;242m[[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m][0m
[38;5;238m1039[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_trailing_stop_price[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;255;121;198mdel[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_trailing_stop_price[0m[38;2;248;248;242m[[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m][0m
[38;5;238m1040[0m   [38;5;238mâ”‚[0m 
[38;5;238m1041[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242morder[0m
[38;5;238m1042[0m   [38;5;238mâ”‚[0m 
[38;5;238m1043[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mInsufficientFunds[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1044[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mClose Position ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mreason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Insufficient funds error during close attempt: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1045[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ERROR Closing ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mreason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Insufficient funds! Check margin.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1046[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mNetworkError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1047[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mClose Position ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mreason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Network error placing close order: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1048[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mExchangeError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1049[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mClose Position ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mreason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Exchange error placing close order: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1050[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Check if the error indicates the position is already closed or zero[0m
[38;5;238m1051[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242merror_msg_lower[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m([0m[38;2;248;248;242me[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mlower[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m
[38;5;238m1052[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mposition is zero[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242merror_msg_lower[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140morder would not reduce position size[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242merror_msg_lower[0m[38;2;248;248;242m:[0m
[38;5;238m1053[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mClose Position ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mreason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Exchange indicates position already zero or order ineffective. Likely closed recently.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1054[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;98;114;164m#[0m[38;2;98;114;164m If the exchange confirms the position is zero, act as if it was closed successfully[0m
[38;5;238m1055[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mtrailing_stop_activated[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;255;121;198mdel[0m[38;2;248;248;242m [0m[38;2;248;248;242mtrailing_stop_activated[0m[38;2;248;248;242m[[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m][0m
[38;5;238m1056[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_trailing_stop_price[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;255;121;198mdel[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_trailing_stop_price[0m[38;2;248;248;242m[[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m][0m
[38;5;238m1057[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Indicate no order placed, but condition might be met[0m
[38;5;238m1058[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ERROR Closing ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mreason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Exchange error ([0m[38;2;248;248;242m{[0m[38;2;139;233;253mtype[0m[38;2;248;248;242m([0m[38;2;248;248;242me[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;248;248;242m__name__[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Check logs.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1059[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mValueError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1060[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mClose Position ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mreason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Value error during amount processing (Qty: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mlive_amount_to_close[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1061[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1062[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mClose Position ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mreason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Unexpected error placing close order: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1063[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m1064[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ERROR Closing ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mreason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Unexpected error ([0m[38;2;248;248;242m{[0m[38;2;139;233;253mtype[0m[38;2;248;248;242m([0m[38;2;248;248;242me[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;248;248;242m__name__[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Check logs.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1065[0m   [38;5;238mâ”‚[0m 
[38;5;238m1066[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1067[0m   [38;5;238mâ”‚[0m 
[38;5;238m1068[0m   [38;5;238mâ”‚[0m 
[38;5;238m1069[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Risk Calculation ---[0m
[38;5;238m1070[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m (Keep this function as is, it's general purpose)[0m
[38;5;238m1071[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123mcalculate_position_size[0m[38;2;248;248;242m([0m
[38;5;238m1072[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mequity[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mrisk_per_trade_pct[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mentry_price[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mstop_loss_price[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m
[38;5;238m1073[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mleverage[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108msymbol[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mexchange[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;255;121;198m.[0m[38;2;248;248;242mExchange[0m
[38;5;238m1074[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;248;248;242m->[0m[38;2;248;248;242m [0m[38;2;248;248;242mTuple[0m[38;2;248;248;242m[[0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m, [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m][0m[38;2;248;248;242m:[0m
[38;5;238m1075[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m
[38;5;238m1076[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Calculates position size (quantity) based on risk percentage, entry/SL prices,[0m
[38;5;238m1077[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    and estimates the required initial margin (without buffer).[0m
[38;5;238m1078[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    ... (docstring truncated for brevity) ...[0m
[38;5;238m1079[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    [0m[38;2;98;114;164m"""[0m
[38;5;238m1080[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRisk Calc Input: Equity=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mequity[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Risk%=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mrisk_per_trade_pct[0m[38;2;189;147;249m:.3%[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, [0m[38;2;241;250;140m"[0m
[38;5;238m1081[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mEntry=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mentry_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, SL=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mstop_loss_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Lev=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mleverage[0m[38;2;248;248;242m}[0m[38;2;241;250;140mx, Symbol=[0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1082[0m   [38;5;238mâ”‚[0m 
[38;5;238m1083[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242mentry_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mstop_loss_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m1084[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mRisk Calc: Invalid entry or stop-loss price (must be > 0).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1085[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m, [0m[38;2;189;147;249mNone[0m
[38;5;238m1086[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mprice_difference_per_unit[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;139;233;253mabs[0m[38;2;248;248;242m([0m[38;2;248;248;242mentry_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m-[0m[38;2;248;248;242m [0m[38;2;248;248;242mstop_loss_price[0m[38;2;248;248;242m)[0m
[38;5;238m1087[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mprice_difference_per_unit[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;189;147;249m1e-5[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Check against a tiny fraction of price instead of epsilon for price difference[0m
[38;5;238m1088[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRisk Calc: Entry ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mentry_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) and stop-loss ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mstop_loss_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) prices are too close (< 0.001% difference). Cannot calculate size.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1089[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m, [0m[38;2;189;147;249mNone[0m
[38;5;238m1090[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;248;248;242mrisk_per_trade_pct[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m[38;2;248;248;242m:[0m
[38;5;238m1091[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRisk Calc: Invalid risk_per_trade_pct: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mrisk_per_trade_pct[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Must be between 0 and 1 (exclusive).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1092[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m, [0m[38;2;189;147;249mNone[0m
[38;5;238m1093[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mequity[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m:[0m
[38;5;238m1094[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRisk Calc: Invalid equity (<= 0): [0m[38;2;248;248;242m{[0m[38;2;248;248;242mequity[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1095[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m, [0m[38;2;189;147;249mNone[0m
[38;5;238m1096[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mleverage[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m:[0m
[38;5;238m1097[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRisk Calc: Invalid leverage (<= 0): [0m[38;2;248;248;242m{[0m[38;2;248;248;242mleverage[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1098[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m, [0m[38;2;189;147;249mNone[0m
[38;5;238m1099[0m   [38;5;238mâ”‚[0m 
[38;5;238m1100[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Calculation ---[0m
[38;5;238m1101[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mrisk_amount_usdt[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mequity[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;248;248;242mrisk_per_trade_pct[0m
[38;5;238m1102[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mquantity[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mrisk_amount_usdt[0m[38;2;248;248;242m [0m[38;2;255;121;198m/[0m[38;2;248;248;242m [0m[38;2;248;248;242mprice_difference_per_unit[0m
[38;5;238m1103[0m   [38;5;238mâ”‚[0m 
[38;5;238m1104[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Apply exchange precision to the calculated quantity[0m
[38;5;238m1105[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m1106[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mquantity_precise_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mamount_to_precision[0m[38;2;248;248;242m([0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mquantity[0m[38;2;248;248;242m)[0m
[38;5;238m1107[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mquantity_precise[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mquantity_precise_str[0m[38;2;248;248;242m)[0m
[38;5;238m1108[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRisk Calc: Raw Qty=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mquantity[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Precise Qty=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mquantity_precise_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1109[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mquantity[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mquantity_precise[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Use the precise quantity for further calculations[0m
[38;5;238m1110[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1111[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRisk Calc: Could not apply precision to quantity [0m[38;2;248;248;242m{[0m[38;2;248;248;242mquantity[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Using raw value. Error: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1112[0m   [38;5;238mâ”‚[0m 
[38;5;238m1113[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mquantity[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_QTY_EPSILON[0m[38;2;248;248;242m:[0m
[38;5;238m1114[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRisk Calc: Calculated quantity ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mquantity[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) is zero or negligible based on risk parameters. [0m[38;2;241;250;140m"[0m
[38;5;238m1115[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                       [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRiskAmt=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mrisk_amount_usdt[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, PriceDiff=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mprice_difference_per_unit[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1116[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m, [0m[38;2;189;147;249mNone[0m
[38;5;238m1117[0m   [38;5;238mâ”‚[0m 
[38;5;238m1118[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mposition_value_usdt[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mquantity[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price[0m
[38;5;238m1119[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mrequired_margin_estimate[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition_value_usdt[0m[38;2;248;248;242m [0m[38;2;255;121;198m/[0m[38;2;248;248;242m [0m[38;2;248;248;242mleverage[0m
[38;5;238m1120[0m   [38;5;238mâ”‚[0m 
[38;5;238m1121[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRisk Calc Output: RiskAmt=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mrisk_amount_usdt[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, PriceDiff=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mprice_difference_per_unit[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m [0m[38;2;241;250;140m"[0m
[38;5;238m1122[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m=> PreciseQty=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mquantity[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, EstPosValue=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mposition_value_usdt[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, EstMarginBase=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mrequired_margin_estimate[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1123[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mquantity[0m[38;2;248;248;242m, [0m[38;2;248;248;242mrequired_margin_estimate[0m
[38;5;238m1124[0m   [38;5;238mâ”‚[0m 
[38;5;238m1125[0m   [38;5;238mâ”‚[0m 
[38;5;238m1126[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Place Order ---[0m
[38;5;238m1127[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123mplace_risked_market_order[0m[38;2;248;248;242m([0m
[38;5;238m1128[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mexchange[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;255;121;198m.[0m[38;2;248;248;242mExchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108msymbol[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mside[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m,[0m
[38;5;238m1129[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mrisk_percentage[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mcurrent_atr[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108msl_atr_multiplier[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m
[38;5;238m1130[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mtp_atr_multiplier[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mleverage[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mmax_order_cap_usdt[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mmargin_check_buffer[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m
[38;5;238m1131[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mentry_price_estimate[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Pass the estimate here[0m
[38;5;238m1132[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;248;248;242m->[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[38;2;248;248;242mDict[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m, [0m[38;2;248;248;242mAny[0m[38;2;248;248;242m][0m[38;2;248;248;242m][0m[38;2;248;248;242m:[0m
[38;5;238m1133[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m
[38;5;238m1134[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Calculates position size based on risk & ATR SL, checks balance, limits, and margin,[0m
[38;5;238m1135[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    then places a market order if all checks pass. Sends SMS alerts.[0m
[38;5;238m1136[0m   [38;5;238mâ”‚[0m 
[38;5;238m1137[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Args:[0m
[38;5;238m1138[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        exchange (ccxt.Exchange): Initialized CCXT exchange object.[0m
[38;5;238m1139[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        symbol (str): Market symbol (e.g., 'BTC/USDT:USDT').[0m
[38;5;238m1140[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        side (str): 'buy' or 'sell'.[0m
[38;5;238m1141[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        risk_percentage (float): Risk per trade as a decimal (e.g., 0.01 for 1%).[0m
[38;5;238m1142[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        current_atr (Optional[float]): The current ATR value for SL calculation.[0m
[38;5;238m1143[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        sl_atr_multiplier (float): Multiplier for ATR to determine SL distance.[0m
[38;5;238m1144[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        tp_atr_multiplier (float): Multiplier for ATR to determine TP distance (for SMS info).[0m
[38;5;238m1145[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        leverage (int): Leverage confirmed for the symbol.[0m
[38;5;238m1146[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        max_order_cap_usdt (float): Maximum allowed position size in USDT value.[0m
[38;5;238m1147[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        margin_check_buffer (float): Buffer multiplier for checking available margin.[0m
[38;5;238m1148[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        entry_price_estimate (float): The estimated market price used for calculations.[0m
[38;5;238m1149[0m   [38;5;238mâ”‚[0m 
[38;5;238m1150[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Returns:[0m
[38;5;238m1151[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        Optional[Dict[str, Any]]: The CCXT order dictionary if the order was successfully placed, None otherwise.[0m
[38;5;238m1152[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    [0m[38;2;98;114;164m"""[0m
[38;5;238m1153[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;255;121;198m.[0m[38;2;80;250;123msplit[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140m/[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m[[0m[38;2;189;147;249m0[0m[38;2;248;248;242m][0m
[38;5;238m1154[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Initiating [0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m market order placement for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m at estimated price [0m[38;2;248;248;242m{[0m[38;2;248;248;242mentry_price_estimate[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1155[0m   [38;5;238mâ”‚[0m 
[38;5;238m1156[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Pre-computation Checks ---[0m
[38;5;238m1157[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_QTY_EPSILON[0m[38;2;248;248;242m:[0m
[38;5;238m1158[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Invalid ATR value ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) provided for SL calculation. Cannot place order.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1159[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ORDER FAIL ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Invalid ATR provided.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1160[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1161[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price_estimate[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_QTY_EPSILON[0m[38;2;248;248;242m:[0m
[38;5;238m1162[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Invalid entry price estimate ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mentry_price_estimate[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Cannot place order.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1163[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1164[0m   [38;5;238mâ”‚[0m 
[38;5;238m1165[0m   [38;5;238mâ”‚[0m 
[38;5;238m1166[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mfinal_quantity[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1167[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m"[0m
[38;5;238m1168[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mstop_loss_price[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m
[38;5;238m1169[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mtake_profit_price[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Calculate TP price for SMS/logging even if check is loop-based[0m
[38;5;238m1170[0m   [38;5;238mâ”‚[0m 
[38;5;238m1171[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m1172[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- 1. Get Balance, Market Info, and Limits ---[0m
[38;5;238m1173[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Fetching balance and market details...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1174[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mbalance[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mfetch_balance[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m
[38;5;238m1175[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mmarket[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mmarket[0m[38;2;248;248;242m([0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m)[0m
[38;5;238m1176[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlimits[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mmarket[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mlimits[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m)[0m
[38;5;238m1177[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mamount_limits[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlimits[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mamount[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m)[0m
[38;5;238m1178[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mprice_limits[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlimits[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mprice[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m)[0m
[38;5;238m1179[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mmin_qty[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mamount_limits[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mmin[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m1180[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mmax_qty[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mamount_limits[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mmax[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m1181[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mqty_precision[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mmarket[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mprecision[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mamount[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m1182[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mprice_precision[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mmarket[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mprecision[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mprice[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m1183[0m   [38;5;238mâ”‚[0m 
[38;5;238m1184[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242musdt_balance[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mbalance[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;255;255;255mUSDT_SYMBOL[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m)[0m
[38;5;238m1185[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242musdt_total[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242musdt_balance[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mtotal[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m1186[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242musdt_free[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242musdt_balance[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mfree[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m1187[0m   [38;5;238mâ”‚[0m 
[38;5;238m1188[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242musdt_equity[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242musdt_total[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242musdt_total[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242musdt_total[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242musdt_free[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242musdt_free[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m
[38;5;238m1189[0m   [38;5;238mâ”‚[0m 
[38;5;238m1190[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242musdt_equity[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242musdt_equity[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m:[0m
[38;5;238m1191[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Cannot determine valid account equity (USDT total/free is zero, negative, or None).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1192[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ORDER FAIL ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Zero/Invalid equity.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1193[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1194[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242musdt_free[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242musdt_free[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m:[0m
[38;5;238m1195[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Invalid free margin (USDT free is [0m[38;2;248;248;242m{[0m[38;2;248;248;242musdt_free[0m[38;2;248;248;242m}[0m[38;2;241;250;140m).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1196[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ORDER FAIL ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Invalid free margin.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1197[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1198[0m   [38;5;238mâ”‚[0m 
[38;5;238m1199[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Account Balance -> Equity=[0m[38;2;248;248;242m{[0m[38;2;248;248;242musdt_equity[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT, Free Margin=[0m[38;2;248;248;242m{[0m[38;2;248;248;242musdt_free[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1200[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Market Limits -> MinQty=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmin_qty[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, MaxQty=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmax_qty[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, QtyPrec=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mqty_precision[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, PricePrec=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mprice_precision[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1201[0m   [38;5;238mâ”‚[0m 
[38;5;238m1202[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- 2. Calculate Stop Loss and Take Profit Prices based on Estimate ---[0m
[38;5;238m1203[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m SL/TP calculation is based on the *estimated* entry price and ATR.[0m
[38;5;238m1204[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m This is **NOT SAFE** for actual SL/TP orders.[0m
[38;5;238m1205[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242msl_distance[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;248;248;242msl_atr_multiplier[0m
[38;5;238m1206[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mtp_distance[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;248;248;242mtp_atr_multiplier[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Calculate TP distance for info[0m
[38;5;238m1207[0m   [38;5;238mâ”‚[0m 
[38;5;238m1208[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mside[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;255;255mSIDE_BUY[0m[38;2;248;248;242m:[0m
[38;5;238m1209[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mstop_loss_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price_estimate[0m[38;2;248;248;242m [0m[38;2;255;121;198m-[0m[38;2;248;248;242m [0m[38;2;248;248;242msl_distance[0m
[38;5;238m1210[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mtake_profit_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price_estimate[0m[38;2;248;248;242m [0m[38;2;255;121;198m+[0m[38;2;248;248;242m [0m[38;2;248;248;242mtp_distance[0m
[38;5;238m1211[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m SIDE_SELL[0m
[38;5;238m1212[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mstop_loss_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price_estimate[0m[38;2;248;248;242m [0m[38;2;255;121;198m+[0m[38;2;248;248;242m [0m[38;2;248;248;242msl_distance[0m
[38;5;238m1213[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mtake_profit_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price_estimate[0m[38;2;248;248;242m [0m[38;2;255;121;198m-[0m[38;2;248;248;242m [0m[38;2;248;248;242mtp_distance[0m
[38;5;238m1214[0m   [38;5;238mâ”‚[0m 
[38;5;238m1215[0m   [38;5;238mâ”‚[0m 
[38;5;238m1216[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Ensure SL/TP prices are positive and respect exchange limits[0m
[38;5;238m1217[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mmin_price_limit[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mprice_limits[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mmin[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Default to 0 if min limit not found[0m
[38;5;238m1218[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mstop_loss_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;248;248;242mmin_price_limit[0m[38;2;248;248;242m:[0m
[38;5;238m1219[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Calculated SL price [0m[38;2;248;248;242m{[0m[38;2;248;248;242mstop_loss_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m below min limit [0m[38;2;248;248;242m{[0m[38;2;248;248;242mmin_price_limit[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Adjusting.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1220[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mstop_loss_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mmin_price_limit[0m
[38;5;238m1221[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mtake_profit_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;248;248;242mmin_price_limit[0m[38;2;248;248;242m:[0m
[38;5;238m1222[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Calculated TP price [0m[38;2;248;248;242m{[0m[38;2;248;248;242mtake_profit_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m below min limit [0m[38;2;248;248;242m{[0m[38;2;248;248;242mmin_price_limit[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Adjusting.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1223[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mtake_profit_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mmin_price_limit[0m
[38;5;238m1224[0m   [38;5;238mâ”‚[0m 
[38;5;238m1225[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Apply price precision to SL/TP prices[0m
[38;5;238m1226[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m1227[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mstop_loss_price_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mprice_to_precision[0m[38;2;248;248;242m([0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;139;233;253mmax[0m[38;2;248;248;242m([0m[38;2;255;255;255mPOSITION_QTY_EPSILON[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mstop_loss_price[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Ensure positive[0m
[38;5;238m1228[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mstop_loss_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mstop_loss_price_str[0m[38;2;248;248;242m)[0m
[38;5;238m1229[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mtake_profit_price_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mprice_to_precision[0m[38;2;248;248;242m([0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;139;233;253mmax[0m[38;2;248;248;242m([0m[38;2;255;255;255mPOSITION_QTY_EPSILON[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mtake_profit_price[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Ensure positive[0m
[38;5;238m1230[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mtake_profit_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mtake_profit_price_str[0m[38;2;248;248;242m)[0m
[38;5;238m1231[0m   [38;5;238mâ”‚[0m 
[38;5;238m1232[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Calculated SL/TP -> EntryEst=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mentry_price_estimate[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, ATR=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_atr[0m[38;2;189;147;249m:.5f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, [0m[38;2;241;250;140m"[0m
[38;5;238m1233[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSL Dist=[0m[38;2;248;248;242m{[0m[38;2;248;248;242msl_distance[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, TP Dist=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mtp_distance[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m => [0m[38;2;241;250;140m"[0m
[38;5;238m1234[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mEst. SL Price ~[0m[38;2;248;248;242m{[0m[38;2;248;248;242mstop_loss_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Est. TP Price ~[0m[38;2;248;248;242m{[0m[38;2;248;248;242mtake_profit_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1235[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1236[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Error applying precision to SL/TP prices: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Aborting.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1237[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1238[0m   [38;5;238mâ”‚[0m 
[38;5;238m1239[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Check if SL is still valid relative to entry after precision[0m
[38;5;238m1240[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mprice_diff_after_precision[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;139;233;253mabs[0m[38;2;248;248;242m([0m[38;2;248;248;242mentry_price_estimate[0m[38;2;248;248;242m [0m[38;2;255;121;198m-[0m[38;2;248;248;242m [0m[38;2;248;248;242mstop_loss_price[0m[38;2;248;248;242m)[0m
[38;5;238m1241[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mprice_diff_after_precision[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price_estimate[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;189;147;249m1e-5[0m[38;2;248;248;242m:[0m
[38;5;238m1242[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Calculated SL price [0m[38;2;248;248;242m{[0m[38;2;248;248;242mstop_loss_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m is too close to entry estimate [0m[38;2;248;248;242m{[0m[38;2;248;248;242mentry_price_estimate[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m after precision. Cannot calculate size safely. Aborting.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1243[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1244[0m   [38;5;238mâ”‚[0m 
[38;5;238m1245[0m   [38;5;238mâ”‚[0m 
[38;5;238m1246[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- 3. Calculate Position Size and Estimate Initial Margin ---[0m
[38;5;238m1247[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mcalculated_quantity[0m[38;2;248;248;242m, [0m[38;2;248;248;242mrequired_margin_estimate[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mcalculate_position_size[0m[38;2;248;248;242m([0m
[38;5;238m1248[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mequity[0m[38;2;255;121;198m=[0m[38;2;248;248;242musdt_equity[0m[38;2;248;248;242m,[0m
[38;5;238m1249[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mrisk_per_trade_pct[0m[38;2;255;121;198m=[0m[38;2;248;248;242mrisk_percentage[0m[38;2;248;248;242m,[0m
[38;5;238m1250[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mentry_price[0m[38;2;255;121;198m=[0m[38;2;248;248;242mentry_price_estimate[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Use estimated entry for size calc[0m
[38;5;238m1251[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mstop_loss_price[0m[38;2;255;121;198m=[0m[38;2;248;248;242mstop_loss_price[0m[38;2;248;248;242m,[0m[38;2;248;248;242m   [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Use calculated SL price for size calc[0m
[38;5;238m1252[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mleverage[0m[38;2;255;121;198m=[0m[38;2;248;248;242mleverage[0m[38;2;248;248;242m,[0m
[38;5;238m1253[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108msymbol[0m[38;2;255;121;198m=[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m
[38;5;238m1254[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mexchange[0m[38;2;255;121;198m=[0m[38;2;248;248;242mexchange[0m
[38;5;238m1255[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242m)[0m
[38;5;238m1256[0m   [38;5;238mâ”‚[0m 
[38;5;238m1257[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mcalculated_quantity[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mrequired_margin_estimate[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m:[0m
[38;5;238m1258[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Failed to calculate valid position size/margin.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1259[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ORDER FAIL ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Risk calculation failed.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1260[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1261[0m   [38;5;238mâ”‚[0m 
[38;5;238m1262[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mfinal_quantity[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mcalculated_quantity[0m
[38;5;238m1263[0m   [38;5;238mâ”‚[0m 
[38;5;238m1264[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- 4. Apply Max Order Cap (USDT Value) ---[0m
[38;5;238m1265[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242morder_value_usdt[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mfinal_quantity[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price_estimate[0m
[38;5;238m1266[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242morder_value_usdt[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;248;248;242mmax_order_cap_usdt[0m[38;2;248;248;242m:[0m
[38;5;238m1267[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Initial risk-based order value [0m[38;2;248;248;242m{[0m[38;2;248;248;242morder_value_usdt[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT exceeds MAX Cap [0m[38;2;248;248;242m{[0m[38;2;248;248;242mmax_order_cap_usdt[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT. Capping quantity.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1268[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mfinal_quantity[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mmax_order_cap_usdt[0m[38;2;248;248;242m [0m[38;2;255;121;198m/[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price_estimate[0m
[38;5;238m1269[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Recalculate estimated margin based on the capped quantity[0m
[38;5;238m1270[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mrequired_margin_estimate[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242mmax_order_cap_usdt[0m[38;2;248;248;242m [0m[38;2;255;121;198m/[0m[38;2;248;248;242m [0m[38;2;248;248;242mleverage[0m[38;2;248;248;242m)[0m
[38;5;238m1271[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Quantity capped to ~[0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_quantity[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. New Est. Margin ~[0m[38;2;248;248;242m{[0m[38;2;248;248;242mrequired_margin_estimate[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1272[0m   [38;5;238mâ”‚[0m 
[38;5;238m1273[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- 5. Apply Exchange Precision and Check Min/Max Quantity Limits ---[0m
[38;5;238m1274[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m1275[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mamount_to_precision[0m[38;2;248;248;242m([0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mfinal_quantity[0m[38;2;248;248;242m)[0m
[38;5;238m1276[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mfinal_quantity[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m)[0m
[38;5;238m1277[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Quantity after precision: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1278[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1279[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Error applying precision to final quantity [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_quantity[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Aborting.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1280[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1281[0m   [38;5;238mâ”‚[0m 
[38;5;238m1282[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mfinal_quantity[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_QTY_EPSILON[0m[38;2;248;248;242m:[0m
[38;5;238m1283[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Final quantity [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m is zero or negligible. Cannot place order.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1284[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ORDER FAIL ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Calculated Qty too small [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1285[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1286[0m   [38;5;238mâ”‚[0m 
[38;5;238m1287[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mmin_qty[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mfinal_quantity[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;248;248;242mmin_qty[0m[38;2;248;248;242m:[0m
[38;5;238m1288[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Final Qty [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m is LESS than exchange minimum quantity [0m[38;2;248;248;242m{[0m[38;2;248;248;242mmin_qty[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Skipping order.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1289[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ORDER FAIL ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Qty [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m < Min [0m[38;2;248;248;242m{[0m[38;2;248;248;242mmin_qty[0m[38;2;248;248;242m}[0m[38;2;241;250;140m.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1290[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1291[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mmax_qty[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mfinal_quantity[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;248;248;242mmax_qty[0m[38;2;248;248;242m:[0m
[38;5;238m1292[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Final Qty [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m is GREATER than exchange maximum quantity [0m[38;2;248;248;242m{[0m[38;2;248;248;242mmax_qty[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Capping to max qty.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1293[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mfinal_quantity[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mmax_qty[0m
[38;5;238m1294[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m1295[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mamount_to_precision[0m[38;2;248;248;242m([0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mfinal_quantity[0m[38;2;248;248;242m)[0m
[38;5;238m1296[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mfinal_quantity[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m)[0m
[38;5;238m1297[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mrequired_margin_estimate[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242m([0m[38;2;248;248;242mfinal_quantity[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price_estimate[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m/[0m[38;2;248;248;242m [0m[38;2;248;248;242mleverage[0m[38;2;248;248;242m)[0m
[38;5;238m1298[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Quantity capped to exchange max: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. New Est. Margin ~[0m[38;2;248;248;242m{[0m[38;2;248;248;242mrequired_margin_estimate[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1299[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1300[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Error applying precision after capping to max qty [0m[38;2;248;248;242m{[0m[38;2;248;248;242mmax_qty[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Aborting.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1301[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1302[0m   [38;5;238mâ”‚[0m 
[38;5;238m1303[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mfinal_pos_value[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mfinal_quantity[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price_estimate[0m
[38;5;238m1304[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mfinal_req_margin[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mfinal_pos_value[0m[38;2;248;248;242m [0m[38;2;255;121;198m/[0m[38;2;248;248;242m [0m[38;2;248;248;242mleverage[0m
[38;5;238m1305[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Final Order Details -> Qty=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, [0m[38;2;241;250;140m"[0m
[38;5;238m1306[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mEst. Value=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_pos_value[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT, [0m[38;2;241;250;140m"[0m
[38;5;238m1307[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mEst. Req. Margin=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_req_margin[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1308[0m   [38;5;238mâ”‚[0m 
[38;5;238m1309[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- 6. Check Available Margin ---[0m
[38;5;238m1310[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mrequired_margin_with_buffer[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mfinal_req_margin[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;248;248;242mmargin_check_buffer[0m
[38;5;238m1311[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242musdt_free[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;248;248;242mrequired_margin_with_buffer[0m[38;2;248;248;242m:[0m
[38;5;238m1312[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Insufficient FREE margin. [0m[38;2;241;250;140m"[0m
[38;5;238m1313[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                         [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRequires ~[0m[38;2;248;248;242m{[0m[38;2;248;248;242mrequired_margin_with_buffer[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT [0m[38;2;241;250;140m"[0m
[38;5;238m1314[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                         [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m(Base: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_req_margin[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Buffer: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mmargin_check_buffer[0m[38;2;189;147;249m:.1%[0m[38;2;248;248;242m}[0m[38;2;241;250;140m), [0m[38;2;241;250;140m"[0m
[38;5;238m1315[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                         [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mAvailable Free: [0m[38;2;248;248;242m{[0m[38;2;248;248;242musdt_free[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1316[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ORDER FAIL ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Insufficient Free Margin (Need ~[0m[38;2;248;248;242m{[0m[38;2;248;248;242mrequired_margin_with_buffer[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Have [0m[38;2;248;248;242m{[0m[38;2;248;248;242musdt_free[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1317[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1318[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1319[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Margin check passed. Required w/ Buffer: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mrequired_margin_with_buffer[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT <= Available Free: [0m[38;2;248;248;242m{[0m[38;2;248;248;242musdt_free[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1320[0m   [38;5;238mâ”‚[0m 
[38;5;238m1321[0m   [38;5;238mâ”‚[0m 
[38;5;238m1322[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- 7. Place the Market Order ---[0m
[38;5;238m1323[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m*** Placing [0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m MARKET ORDER: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m ***[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1324[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mparams[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m
[38;5;238m1325[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242morder[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcreate_market_order[0m[38;2;248;248;242m([0m
[38;5;238m1326[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108msymbol[0m[38;2;255;121;198m=[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m
[38;5;238m1327[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mside[0m[38;2;255;121;198m=[0m[38;2;248;248;242mside[0m[38;2;248;248;242m,[0m
[38;5;238m1328[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mamount[0m[38;2;255;121;198m=[0m[38;2;248;248;242mfinal_quantity[0m[38;2;248;248;242m,[0m
[38;5;238m1329[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mparams[0m[38;2;255;121;198m=[0m[38;2;248;248;242mparams[0m
[38;5;238m1330[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242m)[0m
[38;5;238m1331[0m   [38;5;238mâ”‚[0m 
[38;5;238m1332[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- 8. Post-Order Handling & Logging ---[0m
[38;5;238m1333[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mfilled_qty[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242morder[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mfilled[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m
[38;5;238m1334[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mavg_fill_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242morder[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140maverage[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m1335[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242morder_id[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242morder[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mid[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m1336[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242morder_status[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242morder[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mstatus[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m1337[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242morder_cost[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242morder[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mcost[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m
[38;5;238m1338[0m   [38;5;238mâ”‚[0m 
[38;5;238m1339[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mfill_price_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mavg_fill_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mavg_fill_price[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m"[0m
[38;5;238m1340[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mfilled_qty_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mfilled_qty[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mfilled_qty[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140m?[0m[38;2;241;250;140m"[0m
[38;5;238m1341[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242morder_id_short[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m([0m[38;2;248;248;242morder_id[0m[38;2;248;248;242m)[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m6[0m[38;2;248;248;242m:[0m[38;2;248;248;242m][0m
[38;5;238m1342[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mcost_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242morder_cost[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242morder_cost[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m"[0m
[38;5;238m1343[0m   [38;5;238mâ”‚[0m 
[38;5;238m1344[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123msuccess[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m Market Order Placed Successfully! [0m[38;2;241;250;140m"[0m
[38;5;238m1345[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                       [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mID:...[0m[38;2;248;248;242m{[0m[38;2;248;248;242morder_id_short[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Status: [0m[38;2;248;248;242m{[0m[38;2;248;248;242morder_status[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, [0m[38;2;241;250;140m"[0m
[38;5;238m1346[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                       [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mFilled Qty: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfilled_qty_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m/[0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, [0m[38;2;241;250;140m"[0m
[38;5;238m1347[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                       [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mAvg Fill Price: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfill_price_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Cost: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcost_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1348[0m   [38;5;238mâ”‚[0m 
[38;5;238m1349[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Send SMS Alert for successful entry - include estimated SL/TP for context[0m
[38;5;238m1350[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242msms_msg[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ENTER [0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m @ ~[0m[38;2;248;248;242m{[0m[38;2;248;248;242mfill_price_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. [0m[38;2;241;250;140m"[0m
[38;5;238m1351[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                   [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mEst. SL ~[0m[38;2;248;248;242m{[0m[38;2;248;248;242mstop_loss_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Est. TP ~[0m[38;2;248;248;242m{[0m[38;2;248;248;242mtake_profit_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. ID:...[0m[38;2;248;248;242m{[0m[38;2;248;248;242morder_id_short[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1352[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[38;2;248;248;242msms_msg[0m[38;2;248;248;242m)[0m
[38;5;238m1353[0m   [38;5;238mâ”‚[0m 
[38;5;238m1354[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- !!! CRITICAL SCALPING TODO !!! ---[0m
[38;5;238m1355[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m You MUST place exchange-native SL/TP/TS orders *after* this market order fills,[0m
[38;5;238m1356[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m using the actual `avg_fill_price` and `filled_qty`.[0m
[38;5;238m1357[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!![0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1358[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m!!! ACTION REQUIRED: Loop-based SL/TP/TS is active for position ID ...[0m[38;2;248;248;242m{[0m[38;2;248;248;242morder_id_short[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. !!![0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1359[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m!!! This is UNSAFE. Implement exchange-native conditional orders based on fill price [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfill_price_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m !!![0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1360[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!![0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1361[0m   [38;5;238mâ”‚[0m 
[38;5;238m1362[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Initialize TS state for this symbol if enabled[0m
[38;5;238m1363[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;255;255mENABLE_TRAILING_STOP[0m[38;2;248;248;242m:[0m
[38;5;238m1364[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mtrailing_stop_activated[0m[38;2;248;248;242m[[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m
[38;5;238m1365[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mcurrent_trailing_stop_price[0m[38;2;248;248;242m[[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Will be set when activated[0m
[38;5;238m1366[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrailing Stop: State initialized for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Not yet activated.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1367[0m   [38;5;238mâ”‚[0m 
[38;5;238m1368[0m   [38;5;238mâ”‚[0m 
[38;5;238m1369[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242morder[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Return the order dictionary[0m
[38;5;238m1370[0m   [38;5;238mâ”‚[0m 
[38;5;238m1371[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mInsufficientFunds[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1372[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Insufficient funds error during order placement: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1373[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ORDER FAIL ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Insufficient funds reported by exchange![0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1374[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mNetworkError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1375[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Network error during order placement: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1376[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mExchangeError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1377[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Exchange error during order placement: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1378[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ORDER FAIL ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Exchange error ([0m[38;2;248;248;242m{[0m[38;2;139;233;253mtype[0m[38;2;248;248;242m([0m[38;2;248;248;242me[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;248;248;242m__name__[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Check logs.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1379[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mValueError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1380[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Value error during price/amount processing: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1381[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1382[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Unexpected critical error during order placement logic: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1383[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m1384[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ORDER FAIL ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Unexpected error ([0m[38;2;248;248;242m{[0m[38;2;139;233;253mtype[0m[38;2;248;248;242m([0m[38;2;248;248;242me[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;248;248;242m__name__[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Check logs.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1385[0m   [38;5;238mâ”‚[0m 
[38;5;238m1386[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1387[0m   [38;5;238mâ”‚[0m 
[38;5;238m1388[0m   [38;5;238mâ”‚[0m 
[38;5;238m1389[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Trading Logic ---[0m
[38;5;238m1390[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123mtrade_logic[0m[38;2;248;248;242m([0m
[38;5;238m1391[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mexchange[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;255;121;198m.[0m[38;2;248;248;242mExchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108msymbol[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mdf[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;248;248;242mDataFrame[0m[38;2;248;248;242m,[0m
[38;5;238m1392[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Pass all potential indicator parameters[0m
[38;5;238m1393[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mst_len[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mst_mult[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mcf_st_len[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mcf_st_mult[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m
[38;5;238m1394[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mrsi_len[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mstoch_len[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mk_period[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108md_period[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mmom_len[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m
[38;5;238m1395[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mehlers_len[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mehlers_signal_len[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m
[38;5;238m1396[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108matr_len[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mvol_ma_len[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m
[38;5;238m1397[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mrisk_pct[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108msl_atr_mult[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mtp_atr_mult[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mleverage[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m
[38;5;238m1398[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mmax_order_cap[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mmargin_buffer[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m
[38;5;238m1399[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Pass TS parameters[0m
[38;5;238m1400[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108menable_ts[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mbool[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mts_activation_profit_pct[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mts_distance_pct[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m
[38;5;238m1401[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;248;248;242m->[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m:[0m
[38;5;238m1402[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m
[38;5;238m1403[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Executes the main trading logic for a single cycle based on the selected strategy.[0m
[38;5;238m1404[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    1. Fetches latest market price.[0m
[38;5;238m1405[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    2. Gets current position status (with PNL).[0m
[38;5;238m1406[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    3. Calculates relevant indicators.[0m
[38;5;238m1407[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    4. Analyzes Order Book (conditionally).[0m
[38;5;238m1408[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    5. Logs current market/position/indicator state.[0m
[38;5;238m1409[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    6. Checks loop-based Stop-Loss / Take-Profit / Trailing Stop (UNSAFE).[0m
[38;5;238m1410[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    7. Checks for entry signals based on selected strategy and optional confirmations.[0m
[38;5;238m1411[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    8. Executes entry or exit actions (closing existing position if reversing).[0m
[38;5;238m1412[0m   [38;5;238mâ”‚[0m 
[38;5;238m1413[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    *** WARNING: Contains loop-based SL/TP/TS check which is unsuitable for live scalping. ***[0m
[38;5;238m1414[0m   [38;5;238mâ”‚[0m 
[38;5;238m1415[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Args:[0m
[38;5;238m1416[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        exchange (...): Exchange object.[0m
[38;5;238m1417[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        symbol (str): Trading symbol.[0m
[38;5;238m1418[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        df (pd.DataFrame): DataFrame with fresh OHLCV data.[0m
[38;5;238m1419[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        st_len, st_mult, cf_st_len, cf_st_mult: Dual Supertrend params.[0m
[38;5;238m1420[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        rsi_len, stoch_len, k_period, d_period, mom_len: StochRSI/Momentum params.[0m
[38;5;238m1421[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        ehlers_len, ehlers_signal_len: Ehlers Fisher params.[0m
[38;5;238m1422[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        atr_len: ATR period for SL/TP calculation.[0m
[38;5;238m1423[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        vol_ma_len: Volume MA period.[0m
[38;5;238m1424[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        risk_pct, sl_atr_mult, tp_atr_mult, leverage, max_order_cap, margin_buffer: Risk params.[0m
[38;5;238m1425[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        enable_ts (bool): Trailing stop master switch.[0m
[38;5;238m1426[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        ts_activation_profit_pct (float): TS activation threshold (%).[0m
[38;5;238m1427[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        ts_distance_pct (float): TS trailing distance (%).[0m
[38;5;238m1428[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    [0m[38;2;98;114;164m"""[0m
[38;5;238m1429[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mcycle_time_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mindex[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;80;250;123mstrftime[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;189;147;249m%Y[0m[38;2;241;250;140m-[0m[38;2;189;147;249m%m[0m[38;2;241;250;140m-[0m[38;2;189;147;249m%d[0m[38;2;241;250;140m [0m[38;2;189;147;249m%H[0m[38;2;241;250;140m:[0m[38;2;189;147;249m%M[0m[38;2;241;250;140m:[0m[38;2;189;147;249m%S[0m[38;2;241;250;140m [0m[38;2;189;147;249m%Z[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mempty[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m"[0m
[38;5;238m1430[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m========== New Check Cycle ([0m[38;2;248;248;242m{[0m[38;2;255;255;255mSTRATEGY_NAME[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m | Candle Time: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcycle_time_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m ==========[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1431[0m   [38;5;238mâ”‚[0m 
[38;5;238m1432[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Data Validation ---[0m
[38;5;238m1433[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Determine required data length based on longest indicator lookback periods[0m
[38;5;238m1434[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mrequired_rows_st[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;139;233;253mmax[0m[38;2;248;248;242m([0m[38;2;248;248;242mst_len[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mcf_st_len[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m+[0m[38;2;248;248;242m [0m[38;2;189;147;249m5[0m
[38;5;238m1435[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mrequired_rows_stoch[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;139;233;253mmax[0m[38;2;248;248;242m([0m[38;2;248;248;242mrsi_len[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mstoch_len[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mk_period[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242md_period[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mmom_len[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m+[0m[38;2;248;248;242m [0m[38;2;189;147;249m5[0m
[38;5;238m1436[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mrequired_rows_ehlers[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mehlers_len[0m[38;2;248;248;242m [0m[38;2;255;121;198m+[0m[38;2;248;248;242m [0m[38;2;189;147;249m5[0m
[38;5;238m1437[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Need enough data for ATR and VolMA regardless of strategy[0m
[38;5;238m1438[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mrequired_rows_common[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;139;233;253mmax[0m[38;2;248;248;242m([0m[38;2;248;248;242matr_len[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mvol_ma_len[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m+[0m[38;2;248;248;242m [0m[38;2;189;147;249m5[0m
[38;5;238m1439[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mrequired_rows[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;139;233;253mmax[0m[38;2;248;248;242m([0m[38;2;248;248;242mrequired_rows_st[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mrequired_rows_stoch[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mrequired_rows_ehlers[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mrequired_rows_common[0m[38;2;248;248;242m)[0m
[38;5;238m1440[0m   [38;5;238mâ”‚[0m 
[38;5;238m1441[0m   [38;5;238mâ”‚[0m 
[38;5;238m1442[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;139;233;253mlen[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;248;248;242mrequired_rows[0m[38;2;248;248;242m:[0m
[38;5;238m1443[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: Insufficient data ([0m[38;2;248;248;242m{[0m[38;2;139;233;253mlen[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m}[0m[38;2;241;250;140m rows, [0m[38;2;241;250;140m"[0m
[38;5;238m1444[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                       [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mneed at least [0m[38;2;248;248;242m{[0m[38;2;248;248;242mrequired_rows[0m[38;2;248;248;242m}[0m[38;2;241;250;140m for selected strategy's indicators). Skipping logic cycle.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1445[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m
[38;5;238m1446[0m   [38;5;238mâ”‚[0m 
[38;5;238m1447[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Initialize variables[0m
[38;5;238m1448[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mob_data[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[38;2;248;248;242mDict[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m, [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m][0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1449[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1450[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242maction_taken_this_cycle[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mbool[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Flag to track if an order was placed/closed[0m
[38;5;238m1451[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mentry_price_for_size_calc[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Estimated entry price for risk calc[0m
[38;5;238m1452[0m   [38;5;238mâ”‚[0m 
[38;5;238m1453[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m1454[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- 1. Fetch Latest Market Price ---[0m
[38;5;238m1455[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Get a price that is more recent than the last candle close for SL/TP/TS checks[0m
[38;5;238m1456[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mcurrent_market_price[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1457[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m1458[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Prioritize shallow OB best bid/ask for a quasi-instantaneous price[0m
[38;5;238m1459[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mob_quick_data[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123manalyze_order_book[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mSHALLOW_OB_FETCH_DEPTH[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mSHALLOW_OB_FETCH_DEPTH[0m[38;2;248;248;242m)[0m
[38;5;238m1460[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mbest_bid[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mob_quick_data[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mbest_bid[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1461[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mbest_ask[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mob_quick_data[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mbest_ask[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1462[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Use the midpoint or the price closest to the last close?[0m
[38;5;238m1463[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m For SL/TP/TS checks, just getting *a* recent price is the goal. Midpoint is reasonable.[0m
[38;5;238m1464[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mbest_bid[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mbest_ask[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mbest_bid[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mbest_ask[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m:[0m
[38;5;238m1465[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mcurrent_market_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242mbest_bid[0m[38;2;248;248;242m [0m[38;2;255;121;198m+[0m[38;2;248;248;242m [0m[38;2;248;248;242mbest_ask[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m/[0m[38;2;248;248;242m [0m[38;2;189;147;249m2[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m
[38;5;238m1466[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: Fetched latest price from shallow OB midpoint: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_market_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1467[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Also use best bid/ask for entry price estimate in `place_risked_market_order`[0m
[38;5;238m1468[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mentry_price_for_size_calc[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mbest_ask[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;255;255mSTRATEGY_NAME[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mDUAL_SUPERTREND[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;255;255;255mSTRATEGY_NAME[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mSTOCHRSI_MOMENTUM[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;255;255;255mSTRATEGY_NAME[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mEHLERS_FISHER[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Use Ask for Long entry estimate[0m
[38;5;238m1469[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price_for_size_calc[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price_for_size_calc[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mbest_bid[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Use Bid for Short entry estimate[0m
[38;5;238m1470[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1471[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: Failed to get price from shallow OB. Falling back to ticker 'last'.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1472[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;255;121;198mraise[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mValueError[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mFailed OB price[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Trigger fallback[0m
[38;5;238m1473[0m   [38;5;238mâ”‚[0m 
[38;5;238m1474[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Catch OB errors and fall back to ticker[0m
[38;5;238m1475[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m1476[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mticker[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mfetch_ticker[0m[38;2;248;248;242m([0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m)[0m
[38;5;238m1477[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mcurrent_market_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mticker[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mlast[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m1478[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mentry_price_for_size_calc[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mticker[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mlast[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Use ticker last as estimate fallback[0m
[38;5;238m1479[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_market_price[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m:[0m
[38;5;238m1480[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                     [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: Fetched latest price from ticker 'last': [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_market_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1481[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242mticker_err[0m[38;2;248;248;242m:[0m
[38;5;238m1482[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: Failed to fetch ticker price as fallback: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mticker_err[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1483[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mcurrent_market_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1484[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mentry_price_for_size_calc[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Ensure estimate is None if ticker fails[0m
[38;5;238m1485[0m   [38;5;238mâ”‚[0m 
[38;5;238m1486[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_market_price[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_market_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m:[0m
[38;5;238m1487[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: Could not fetch a valid current market price. Skipping SL/TP/TS checks and entries this cycle.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1488[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;98;114;164m#[0m[38;2;98;114;164m We still proceed to calculate indicators and check position, but won't trade.[0m
[38;5;238m1489[0m   [38;5;238mâ”‚[0m 
[38;5;238m1490[0m   [38;5;238mâ”‚[0m 
[38;5;238m1491[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m === 2. Get Current Position Status (with PNL) ===[0m
[38;5;238m1492[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m This fetches the live position state from the exchange[0m
[38;5;238m1493[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m position is now the raw CCXT dictionary or None[0m
[38;5;238m1494[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mposition[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mget_current_position[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m)[0m
[38;5;238m1495[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Safely extract required info from the potential None or dictionary[0m
[38;5;238m1496[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mside[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_NONE[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Uses the 'side' attribute added by CCXT parsing[0m
[38;5;238m1497[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mposition_qty[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;139;233;253mabs[0m[38;2;248;248;242m([0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mposition[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140minfo[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140msize[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mcontracts[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Use raw size or contracts[0m
[38;5;238m1498[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mentry_price[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mposition[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mentryPrice[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140minfo[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mavgPrice[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Use CCXT or raw avgPrice[0m
[38;5;238m1499[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242munrealized_pnl_usdt[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mposition[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140munrealizedPnl[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140minfo[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140munrealisedPnl[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m
[38;5;238m1500[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Bybit V5 pnlRatio is typically 0-1, convert to %[0m
[38;5;238m1501[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mpnl_percentage[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mposition[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mpercentage[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140minfo[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mpnlRatio[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m
[38;5;238m1502[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpnl_percentage[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mpnl_percentage[0m[38;2;248;248;242m [0m[38;2;255;121;198m*=[0m[38;2;248;248;242m [0m[38;2;189;147;249m100[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Assume Bybit V5 structure if position exists[0m
[38;5;238m1503[0m   [38;5;238mâ”‚[0m 
[38;5;238m1504[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m === 3. Calculate Indicators based on selected strategy ===[0m
[38;5;238m1505[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: Calculating technical indicators...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1506[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mcalculate_supertrend[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mst_len[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mst_mult[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Always calculate for dual ST[0m
[38;5;238m1507[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mcalculate_supertrend[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mcf_st_len[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mcf_st_mult[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mprefix[0m[38;2;255;121;198m=[0m[38;2;241;250;140m"[0m[38;2;241;250;140mconfirm_[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Always calculate confirm ST[0m
[38;5;238m1508[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mcalculate_stochrsi_momentum[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mrsi_len[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mstoch_len[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mk_period[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242md_period[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mmom_len[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Always calculate StochRSI/Mom[0m
[38;5;238m1509[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mcalculate_ehlers_fisher[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mehlers_len[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mehlers_signal_len[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Always calculate Ehlers Fisher[0m
[38;5;238m1510[0m   [38;5;238mâ”‚[0m 
[38;5;238m1511[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Calculate ATR (for initial SL/TP) and Volume metrics[0m
[38;5;238m1512[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mvol_atr_data[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123manalyze_volume_atr[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242matr_len[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mvol_ma_len[0m[38;2;248;248;242m)[0m
[38;5;238m1513[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mvol_atr_data[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140matr[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1514[0m   [38;5;238mâ”‚[0m 
[38;5;238m1515[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Validate Essential Indicator Results from LAST CANDLE ---[0m
[38;5;238m1516[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Check if essential columns exist and the last row has valid values for the *selected* strategy[0m
[38;5;238m1517[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mstrategy_required_cols[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mList[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mclose[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m
[38;5;238m1518[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;255;255mSTRATEGY_NAME[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mDUAL_SUPERTREND[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m
[38;5;238m1519[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mstrategy_required_cols[0m[38;2;255;121;198m.[0m[38;2;80;250;123mextend[0m[38;2;248;248;242m([0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140msupertrend[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mtrend[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mst_long[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mst_short[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mconfirm_supertrend[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mconfirm_trend[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;248;248;242m)[0m
[38;5;238m1520[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melif[0m[38;2;248;248;242m [0m[38;2;255;255;255mSTRATEGY_NAME[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mSTOCHRSI_MOMENTUM[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m
[38;5;238m1521[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mstrategy_required_cols[0m[38;2;255;121;198m.[0m[38;2;80;250;123mextend[0m[38;2;248;248;242m([0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mstochrsi_k[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mstochrsi_d[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mmomentum[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;248;248;242m)[0m
[38;5;238m1522[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melif[0m[38;2;248;248;242m [0m[38;2;255;255;255mSTRATEGY_NAME[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mEHLERS_FISHER[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m
[38;5;238m1523[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mstrategy_required_cols[0m[38;2;255;121;198m.[0m[38;2;80;250;123mextend[0m[38;2;248;248;242m([0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mehlers_fisher[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mehlers_signal[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;248;248;242m)[0m
[38;5;238m1524[0m   [38;5;238mâ”‚[0m 
[38;5;238m1525[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Add common required cols for Vol/ATR if needed for confirmations or SL calc[0m
[38;5;238m1526[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mcommon_required_cols[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mvolume[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Volume is needed if REQUIRE_VOLUME_SPIKE_FOR_ENTRY is True[0m
[38;5;238m1527[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_QTY_EPSILON[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m ATR needed for risk calc / initial SL[0m
[38;5;238m1528[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Add ATR's raw source columns if ATR calc failed, to check data issue[0m
[38;5;238m1529[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mcommon_required_cols[0m[38;2;255;121;198m.[0m[38;2;80;250;123mextend[0m[38;2;248;248;242m([0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mhigh[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mlow[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mclose[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m ATR needs these[0m
[38;5;238m1530[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: ATR is invalid, risk/SL calculations may be affected.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1531[0m   [38;5;238mâ”‚[0m 
[38;5;238m1532[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mrequired_indicator_cols[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mlist[0m[38;2;248;248;242m([0m[3;38;2;102;217;239mset[0m[38;2;248;248;242m([0m[38;2;248;248;242mstrategy_required_cols[0m[38;2;248;248;242m [0m[38;2;255;121;198m+[0m[38;2;248;248;242m [0m[38;2;248;248;242mcommon_required_cols[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Use set to remove duplicates[0m
[38;5;238m1533[0m   [38;5;238mâ”‚[0m 
[38;5;238m1534[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;139;233;253mall[0m[38;2;248;248;242m([0m[38;2;248;248;242mcol[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mcolumns[0m[38;2;248;248;242m [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mcol[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mrequired_indicator_cols[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m1535[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mmissing[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m[[0m[38;2;248;248;242mcol[0m[38;2;248;248;242m [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mcol[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mrequired_indicator_cols[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mcol[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mcolumns[0m[38;2;248;248;242m][0m
[38;5;238m1536[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: Missing one or more required indicator columns ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mmissing[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Skipping cycle.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1537[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;255;121;198mreturn[0m
[38;5;238m1538[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m[38;2;248;248;242m[[0m[38;2;248;248;242mrequired_indicator_cols[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;80;250;123misnull[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123many[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m1539[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mnan_cols[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m[38;2;248;248;242m[[0m[38;2;248;248;242mrequired_indicator_cols[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;80;250;123misnull[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m
[38;5;238m1540[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: Indicator calculation resulted in NA values for the latest candle in required columns ([0m[38;2;248;248;242m{[0m[3;38;2;102;217;239mlist[0m[38;2;248;248;242m([0m[38;2;248;248;242mnan_cols[0m[38;2;248;248;242m[[0m[38;2;248;248;242mnan_cols[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;248;248;242mindex[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Skipping cycle.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1541[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;255;121;198mreturn[0m
[38;5;238m1542[0m   [38;5;238mâ”‚[0m 
[38;5;238m1543[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m === Extract Data from the Last Closed Candle (for signals) ===[0m
[38;5;238m1544[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlast_candle[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m
[38;5;238m1545[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlast_candle_close[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_candle[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mclose[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Close of the last completed candle[0m
[38;5;238m1546[0m   [38;5;238mâ”‚[0m 
[38;5;238m1547[0m   [38;5;238mâ”‚[0m 
[38;5;238m1548[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m === 4. Analyze Order Book (Conditionally) ===[0m
[38;5;238m1549[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Fetch OB if configured to do so every cycle OR if a primary signal just occurred (potential entry)[0m
[38;5;238m1550[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Need to check signals *first* to know if OB needs fetching this cycle if not FETCH_ORDER_BOOK_PER_CYCLE[0m
[38;5;238m1551[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Let's peek at primary signals *before* fetching OB[0m
[38;5;238m1552[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mprimary_long_signal_check[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m
[38;5;238m1553[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mprimary_short_signal_check[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m
[38;5;238m1554[0m   [38;5;238mâ”‚[0m 
[38;5;238m1555[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;255;255mSTRATEGY_NAME[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mDUAL_SUPERTREND[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m
[38;5;238m1556[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mprimary_long_signal_check[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_candle[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mst_long[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m
[38;5;238m1557[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mprimary_short_signal_check[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_candle[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mst_short[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m
[38;5;238m1558[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melif[0m[38;2;248;248;242m [0m[38;2;255;255;255mSTRATEGY_NAME[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mSTOCHRSI_MOMENTUM[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m
[38;5;238m1559[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Define StochRSI+Mom signals (e.g., K cross D, confirm momentum & thresholds)[0m
[38;5;238m1560[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlast_k[0m[38;2;248;248;242m, [0m[38;2;248;248;242mlast_d[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_candle[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mstochrsi_k[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;248;248;242m, [0m[38;2;248;248;242mlast_candle[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mstochrsi_d[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m
[38;5;238m1561[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mprev_k[0m[38;2;248;248;242m, [0m[38;2;248;248;242mprev_d[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mstochrsi_k[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m2[0m[38;2;248;248;242m][0m[38;2;248;248;242m, [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mstochrsi_d[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m2[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Previous candle values[0m
[38;5;238m1562[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlast_mom[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_candle[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mmomentum[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m
[38;5;238m1563[0m   [38;5;238mâ”‚[0m 
[38;5;238m1564[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Long: K crosses above D AND K/D are below Oversold AND Momentum > 0[0m
[38;5;238m1565[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mprimary_long_signal_check[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m
[38;5;238m1566[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mprev_k[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;248;248;242mprev_d[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_k[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_d[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m          [0m[38;2;98;114;164m#[0m[38;2;98;114;164m K crossed above D[0m
[38;5;238m1567[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mlast_k[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;255;255;255mSTOCHRSI_OVERSOLD[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_d[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;255;255;255mSTOCHRSI_OVERSOLD[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Both K/D below Oversold threshold[0m
[38;5;238m1568[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mlast_mom[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_QTY_EPSILON[0m[38;2;248;248;242m                  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Positive momentum[0m
[38;5;238m1569[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242m)[0m
[38;5;238m1570[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Short: K crosses below D AND K/D are above Overbought AND Momentum < 0[0m
[38;5;238m1571[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mprimary_short_signal_check[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m
[38;5;238m1572[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mprev_k[0m[38;2;248;248;242m [0m[38;2;255;121;198m>=[0m[38;2;248;248;242m [0m[38;2;248;248;242mprev_d[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_k[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_d[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m          [0m[38;2;98;114;164m#[0m[38;2;98;114;164m K crossed below D[0m
[38;5;238m1573[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mlast_k[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;255;255;255mSTOCHRSI_OVERBOUGHT[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_d[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;255;255;255mSTOCHRSI_OVERBOUGHT[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Both K/D above Overbought threshold[0m
[38;5;238m1574[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mlast_mom[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;255;121;198m-[0m[38;2;255;255;255mPOSITION_QTY_EPSILON[0m[38;2;248;248;242m                 [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Negative momentum[0m
[38;5;238m1575[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242m)[0m
[38;5;238m1576[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mStochRSI/Mom Check (Last Candle): K=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlast_k[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, D=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlast_d[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Mom=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlast_mom[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. [0m[38;2;241;250;140m"[0m
[38;5;238m1577[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                          [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPrev K=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mprev_k[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Prev D=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mprev_d[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. [0m[38;2;241;250;140m"[0m
[38;5;238m1578[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                          [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLong Signal Check: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mprimary_long_signal_check[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Short Signal Check: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mprimary_short_signal_check[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1579[0m   [38;5;238mâ”‚[0m 
[38;5;238m1580[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melif[0m[38;2;248;248;242m [0m[38;2;255;255;255mSTRATEGY_NAME[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mEHLERS_FISHER[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m
[38;5;238m1581[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Define Ehlers Fisher signals (Fisher crossing Signal line)[0m
[38;5;238m1582[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlast_fisher[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_candle[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mehlers_fisher[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m
[38;5;238m1583[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlast_signal[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_candle[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mehlers_signal[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m
[38;5;238m1584[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mprev_fisher[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mehlers_fisher[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m2[0m[38;2;248;248;242m][0m
[38;5;238m1585[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mprev_signal[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mehlers_signal[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m2[0m[38;2;248;248;242m][0m
[38;5;238m1586[0m   [38;5;238mâ”‚[0m 
[38;5;238m1587[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Long: Fisher crosses above Signal line[0m
[38;5;238m1588[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mprimary_long_signal_check[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242mprev_fisher[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;248;248;242mprev_signal[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_fisher[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_signal[0m[38;2;248;248;242m)[0m
[38;5;238m1589[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Short: Fisher crosses below Signal line[0m
[38;5;238m1590[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mprimary_short_signal_check[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242mprev_fisher[0m[38;2;248;248;242m [0m[38;2;255;121;198m>=[0m[38;2;248;248;242m [0m[38;2;248;248;242mprev_signal[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_fisher[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_signal[0m[38;2;248;248;242m)[0m
[38;5;238m1591[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mEhlers Fisher Check (Last Candle): Fisher=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlast_fisher[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Signal=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlast_signal[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. [0m[38;2;241;250;140m"[0m
[38;5;238m1592[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                         [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPrev Fisher=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mprev_fisher[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Prev Signal=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mprev_signal[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. [0m[38;2;241;250;140m"[0m
[38;5;238m1593[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                         [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLong Signal Check: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mprimary_long_signal_check[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Short Signal Check: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mprimary_short_signal_check[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1594[0m   [38;5;238mâ”‚[0m 
[38;5;238m1595[0m   [38;5;238mâ”‚[0m 
[38;5;238m1596[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Now decide if we need to fetch Order Book[0m
[38;5;238m1597[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;255;255mFETCH_ORDER_BOOK_PER_CYCLE[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mprimary_long_signal_check[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mprimary_short_signal_check[0m[38;2;248;248;242m:[0m
[38;5;238m1598[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: Fetching and analyzing order book...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1599[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mob_data[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123manalyze_order_book[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mORDER_BOOK_DEPTH[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mORDER_BOOK_FETCH_LIMIT[0m[38;2;248;248;242m)[0m
[38;5;238m1600[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1601[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: Order book fetch skipped (FETCH_PER_CYCLE=False and no primary signal generated this candle).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1602[0m   [38;5;238mâ”‚[0m 
[38;5;238m1603[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Extract OB data for confirmation checks[0m
[38;5;238m1604[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mbid_ask_ratio[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mob_data[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mbid_ask_ratio[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mob_data[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1605[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mspread_val[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mob_data[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mspread[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mob_data[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1606[0m   [38;5;238mâ”‚[0m 
[38;5;238m1607[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m === 5. Log Current State ===[0m
[38;5;238m1608[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Prepare formatted strings for logging[0m
[38;5;238m1609[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mvolume_ratio[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mvol_atr_data[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mvolume_ratio[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1610[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mvolume_spike[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mvolume_ratio[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mvolume_ratio[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;255;255;255mVOLUME_SPIKE_THRESHOLD[0m
[38;5;238m1611[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242matr_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_atr[0m[38;2;189;147;249m:.5f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m'[0m
[38;5;238m1612[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mvol_ratio_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mvolume_ratio[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mvolume_ratio[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m'[0m
[38;5;238m1613[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mvol_spike_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mvolume_spike[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mvolume_ratio[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m'[0m
[38;5;238m1614[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mbid_ask_ratio_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mbid_ask_ratio[0m[38;2;189;147;249m:.3f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mbid_ask_ratio[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m'[0m
[38;5;238m1615[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mspread_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mspread_val[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mspread_val[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m'[0m
[38;5;238m1616[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mpnl_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242munrealized_pnl_usdt[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mpnl_percentage[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m%)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m!=[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_NONE[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m'[0m
[38;5;238m1617[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mts_status_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mActivated=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mtrailing_stop_activated[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Price=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_trailing_stop_price[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242menable_ts[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mDisabled[0m[38;2;241;250;140m'[0m
[38;5;238m1618[0m   [38;5;238mâ”‚[0m 
[38;5;238m1619[0m   [38;5;238mâ”‚[0m 
[38;5;238m1620[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mState | Current Market Price: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_market_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log the latest price fetched[0m
[38;5;238m1621[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mState | Candle Close: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mlast_candle_close[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, ATR([0m[38;2;248;248;242m{[0m[38;2;248;248;242matr_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): [0m[38;2;248;248;242m{[0m[38;2;248;248;242matr_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1622[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mState | Volume: Ratio=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mvol_ratio_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Spike=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mvol_spike_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (Thr=[0m[38;2;248;248;242m{[0m[38;2;255;255;255mVOLUME_SPIKE_THRESHOLD[0m[38;2;189;147;249m:.1f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) | Conf Req: [0m[38;2;248;248;242m{[0m[38;2;255;255;255mREQUIRE_VOLUME_SPIKE_FOR_ENTRY[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1623[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mState | OrderBook(D[0m[38;2;248;248;242m{[0m[38;2;255;255;255mORDER_BOOK_DEPTH[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Ratio=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mbid_ask_ratio_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Spread=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mspread_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m | Conf Req OB: [0m[38;2;248;248;242m{[0m[38;2;255;255;255mFETCH_ORDER_BOOK_PER_CYCLE[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1624[0m   [38;5;238mâ”‚[0m 
[38;5;238m1625[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log indicator values for the selected strategy[0m
[38;5;238m1626[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;255;255mSTRATEGY_NAME[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mDUAL_SUPERTREND[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m
[38;5;238m1627[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mprimary_trend_up[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_candle[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mtrend[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m
[38;5;238m1628[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mprimary_long_signal[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_candle[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mst_long[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m
[38;5;238m1629[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mprimary_short_signal[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_candle[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mst_short[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m
[38;5;238m1630[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mconfirm_trend_up[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_candle[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mconfirm_trend[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m
[38;5;238m1631[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mState | Strategy ([0m[38;2;248;248;242m{[0m[38;2;255;255;255mSTRATEGY_NAME[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) | ST([0m[38;2;248;248;242m{[0m[38;2;248;248;242mst_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m,[0m[38;2;248;248;242m{[0m[38;2;248;248;242mst_mult[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): [0m[38;2;248;248;242m{[0m[38;2;241;250;140m'[0m[38;2;241;250;140mUp[0m[38;2;241;250;140m'[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mprimary_trend_up[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mDown[0m[38;2;241;250;140m'[0m[38;2;248;248;242m}[0m[38;2;241;250;140m ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mlast_candle[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140msupertrend[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1632[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mState | Strategy ([0m[38;2;248;248;242m{[0m[38;2;255;255;255mSTRATEGY_NAME[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) | ConfirmST([0m[38;2;248;248;242m{[0m[38;2;248;248;242mcf_st_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m,[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcf_st_mult[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): [0m[38;2;248;248;242m{[0m[38;2;241;250;140m'[0m[38;2;241;250;140mUp[0m[38;2;241;250;140m'[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mconfirm_trend_up[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mDown[0m[38;2;241;250;140m'[0m[38;2;248;248;242m}[0m[38;2;241;250;140m ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mlast_candle[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mconfirm_supertrend[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1633[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mState | Strategy ([0m[38;2;248;248;242m{[0m[38;2;255;255;255mSTRATEGY_NAME[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) | Signals (Last Candle): PrimaryFlip=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mprimary_long_signal[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mprimary_short_signal[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Long=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mprimary_long_signal[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Short=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mprimary_short_signal[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1634[0m   [38;5;238mâ”‚[0m 
[38;5;238m1635[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melif[0m[38;2;248;248;242m [0m[38;2;255;255;255mSTRATEGY_NAME[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mSTOCHRSI_MOMENTUM[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m
[38;5;238m1636[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlast_k[0m[38;2;248;248;242m, [0m[38;2;248;248;242mlast_d[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_candle[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mstochrsi_k[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;248;248;242m, [0m[38;2;248;248;242mlast_candle[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mstochrsi_d[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m
[38;5;238m1637[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlast_mom[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_candle[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mmomentum[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m
[38;5;238m1638[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mState | Strategy ([0m[38;2;248;248;242m{[0m[38;2;255;255;255mSTRATEGY_NAME[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) | StochRSI([0m[38;2;248;248;242m{[0m[38;2;248;248;242mrsi_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m,[0m[38;2;248;248;242m{[0m[38;2;248;248;242mstoch_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m,[0m[38;2;248;248;242m{[0m[38;2;248;248;242mk_period[0m[38;2;248;248;242m}[0m[38;2;241;250;140m,[0m[38;2;248;248;242m{[0m[38;2;248;248;242md_period[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): K=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlast_k[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, D=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlast_d[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (OB=[0m[38;2;248;248;242m{[0m[38;2;255;255;255mSTOCHRSI_OVERBOUGHT[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, OS=[0m[38;2;248;248;242m{[0m[38;2;255;255;255mSTOCHRSI_OVERSOLD[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1639[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mState | Strategy ([0m[38;2;248;248;242m{[0m[38;2;255;255;255mSTRATEGY_NAME[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) | Momentum([0m[38;2;248;248;242m{[0m[38;2;248;248;242mmom_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): [0m[38;2;248;248;242m{[0m[38;2;248;248;242mlast_mom[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1640[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mState | Strategy ([0m[38;2;248;248;242m{[0m[38;2;255;255;255mSTRATEGY_NAME[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) | Signals (Last Candle): Long Check=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mprimary_long_signal_check[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Short Check=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mprimary_short_signal_check[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1641[0m   [38;5;238mâ”‚[0m 
[38;5;238m1642[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melif[0m[38;2;248;248;242m [0m[38;2;255;255;255mSTRATEGY_NAME[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mEHLERS_FISHER[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m
[38;5;238m1643[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlast_fisher[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_candle[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mehlers_fisher[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m
[38;5;238m1644[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlast_signal[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_candle[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mehlers_signal[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m
[38;5;238m1645[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mState | Strategy ([0m[38;2;248;248;242m{[0m[38;2;255;255;255mSTRATEGY_NAME[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) | EhlersFisher([0m[38;2;248;248;242m{[0m[38;2;248;248;242mehlers_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m,[0m[38;2;248;248;242m{[0m[38;2;248;248;242mehlers_signal_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Fisher=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlast_fisher[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Signal=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlast_signal[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1646[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mState | Strategy ([0m[38;2;248;248;242m{[0m[38;2;255;255;255mSTRATEGY_NAME[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) | Signals (Last Candle): Long Check=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mprimary_long_signal_check[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Short Check=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mprimary_short_signal_check[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1647[0m   [38;5;238mâ”‚[0m 
[38;5;238m1648[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mState | Position: Side=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Qty=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mposition_qty[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Entry=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mentry_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, PNL=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mpnl_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1649[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mState | Trailing Stop ([0m[38;2;248;248;242m{[0m[38;2;241;250;140m'[0m[38;2;241;250;140mEnabled[0m[38;2;241;250;140m'[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242menable_ts[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mDisabled[0m[38;2;241;250;140m'[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): [0m[38;2;248;248;242m{[0m[38;2;248;248;242mts_status_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (Act Thr=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mts_activation_profit_pct[0m[38;2;189;147;249m:.1f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m%, Dist=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mts_distance_pct[0m[38;2;189;147;249m:.1f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m%)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1650[0m   [38;5;238mâ”‚[0m 
[38;5;238m1651[0m   [38;5;238mâ”‚[0m 
[38;5;238m1652[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Validate Current Market Price for Exits/Entries ---[0m
[38;5;238m1653[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_market_price[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_market_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_QTY_EPSILON[0m[38;2;248;248;242m:[0m
[38;5;238m1654[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: Current market price is invalid. Cannot check SL/TP/TS or place new orders this cycle.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1655[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;98;114;164m#[0m[38;2;98;114;164m No action can be taken if we don't have a reliable current price.[0m
[38;5;238m1656[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;255;121;198mreturn[0m
[38;5;238m1657[0m   [38;5;238mâ”‚[0m 
[38;5;238m1658[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m === 6. Check Stop-Loss / Take-Profit / Trailing Stop (Loop-based - HIGH RISK) ===[0m
[38;5;238m1659[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m !!! THIS IS UNSAFE. IT CHECKS AGAINST THE LATEST FETCHED PRICE, NOT REAL-TIME !!![0m
[38;5;238m1660[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mexit_reason[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Store the reason for exiting[0m
[38;5;238m1661[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mts_triggered[0m[38;2;248;248;242m, [0m[38;2;248;248;242msl_triggered[0m[38;2;248;248;242m, [0m[38;2;248;248;242mtp_triggered[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m[38;2;248;248;242m, [0m[38;2;189;147;249mFalse[0m[38;2;248;248;242m, [0m[38;2;189;147;249mFalse[0m
[38;5;238m1662[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mfixed_stop_price[0m[38;2;248;248;242m, [0m[38;2;248;248;242mfixed_profit_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m, [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m For fixed SL/TP reference[0m
[38;5;238m1663[0m   [38;5;238mâ”‚[0m 
[38;5;238m1664[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m!=[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_NONE[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_QTY_EPSILON[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_QTY_EPSILON[0m[38;2;248;248;242m:[0m
[38;5;238m1665[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m!!! Trade Logic: Checking active position SL/TP/TS based on LATEST FETCHED PRICE (LOOP CHECK - UNSAFE FOR SCALPING) !!![0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1666[0m   [38;5;238mâ”‚[0m 
[38;5;238m1667[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Calculate Fixed SL/TP based on Entry Price and ATR[0m
[38;5;238m1668[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242msl_distance_fixed[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;248;248;242msl_atr_mult[0m
[38;5;238m1669[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mtp_distance_fixed[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;248;248;242mtp_atr_mult[0m
[38;5;238m1670[0m   [38;5;238mâ”‚[0m 
[38;5;238m1671[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_LONG[0m[38;2;248;248;242m:[0m
[38;5;238m1672[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mfixed_stop_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m-[0m[38;2;248;248;242m [0m[38;2;248;248;242msl_distance_fixed[0m
[38;5;238m1673[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mfixed_profit_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m+[0m[38;2;248;248;242m [0m[38;2;248;248;242mtp_distance_fixed[0m
[38;5;238m1674[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mExit Check (Long): Entry=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mentry_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Current=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_market_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Fixed SL=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mfixed_stop_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Fixed TP=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mfixed_profit_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1675[0m   [38;5;238mâ”‚[0m 
[38;5;238m1676[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Trailing Stop Logic (Long) ---[0m
[38;5;238m1677[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242menable_ts[0m[38;2;248;248;242m:[0m
[38;5;238m1678[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Activate TS if PNL % meets threshold and TS not already activated[0m
[38;5;238m1679[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mtrailing_stop_activated[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mpnl_percentage[0m[38;2;248;248;242m [0m[38;2;255;121;198m>=[0m[38;2;248;248;242m [0m[38;2;248;248;242mts_activation_profit_pct[0m[38;2;248;248;242m:[0m
[38;5;238m1680[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Set initial trailing stop price[0m
[38;5;238m1681[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;248;248;242minitial_ts_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_market_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;189;147;249m1[0m[38;2;248;248;242m [0m[38;2;255;121;198m-[0m[38;2;248;248;242m [0m[38;2;248;248;242mts_distance_pct[0m[38;2;248;248;242m [0m[38;2;255;121;198m/[0m[38;2;248;248;242m [0m[38;2;189;147;249m100[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m
[38;5;238m1682[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;248;248;242mcurrent_trailing_stop_price[0m[38;2;248;248;242m[[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;139;233;253mmax[0m[38;2;248;248;242m([0m[38;2;248;248;242mfixed_stop_price[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242minitial_ts_price[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m TS never below initial fixed SL[0m
[38;5;238m1683[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;248;248;242mtrailing_stop_activated[0m[38;2;248;248;242m[[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m
[38;5;238m1684[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrailing Stop: ACTIVATED for Long position. Initial TS price: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_trailing_stop_price[0m[38;2;248;248;242m[[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m][0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1685[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;255;121;198m.[0m[38;2;80;250;123msplit[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140m/[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m[[0m[38;2;189;147;249m0[0m[38;2;248;248;242m][0m[38;2;248;248;242m}[0m[38;2;241;250;140m] TS Activated (Long). Initial TS: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_trailing_stop_price[0m[38;2;248;248;242m[[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m][0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1686[0m   [38;5;238mâ”‚[0m 
[38;5;238m1687[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m If TS is activated, update the stop price[0m
[38;5;238m1688[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mtrailing_stop_activated[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m1689[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Calculate the potential new stop price based on current market price[0m
[38;5;238m1690[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;248;248;242mpotential_new_ts[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_market_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;189;147;249m1[0m[38;2;248;248;242m [0m[38;2;255;121;198m-[0m[38;2;248;248;242m [0m[38;2;248;248;242mts_distance_pct[0m[38;2;248;248;242m [0m[38;2;255;121;198m/[0m[38;2;248;248;242m [0m[38;2;189;147;249m100[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m
[38;5;238m1691[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m The new trailing stop is the maximum of the old one and the potential new one[0m
[38;5;238m1692[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;248;248;242mupdated_ts_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;139;233;253mmax[0m[38;2;248;248;242m([0m[38;2;248;248;242mcurrent_trailing_stop_price[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mpotential_new_ts[0m[38;2;248;248;242m)[0m
[38;5;238m1693[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Ensure updated TS is not below fixed SL[0m
[38;5;238m1694[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;248;248;242mupdated_ts_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;139;233;253mmax[0m[38;2;248;248;242m([0m[38;2;248;248;242mupdated_ts_price[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mfixed_stop_price[0m[38;2;248;248;242m)[0m
[38;5;238m1695[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;248;248;242mcurrent_trailing_stop_price[0m[38;2;248;248;242m[[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mupdated_ts_price[0m
[38;5;238m1696[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrailing Stop (Long): Updated TS price to [0m[38;2;248;248;242m{[0m[38;2;248;248;242mupdated_ts_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (Current Market Price: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_market_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1697[0m   [38;5;238mâ”‚[0m 
[38;5;238m1698[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Check if current price has crossed the trailing stop price[0m
[38;5;238m1699[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_market_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_trailing_stop_price[0m[38;2;248;248;242m[[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m][0m[38;2;248;248;242m:[0m
[38;5;238m1700[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                            [0m[38;2;248;248;242mts_triggered[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m
[38;5;238m1701[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                            [0m[38;2;248;248;242mexit_reason[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTS Loop @ [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_market_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (Trailing Stop ~[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_trailing_stop_price[0m[38;2;248;248;242m[[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m][0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m
[38;5;238m1702[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m*** TRADE EXIT (LOOP CHECK): TRAILING STOP TRIGGERED! ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mexit_reason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Closing [0m[38;2;248;248;242m{[0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. ***[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1703[0m   [38;5;238mâ”‚[0m 
[38;5;238m1704[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Check Fixed SL/TP (only if TS is not enabled OR not yet activated/triggered) ---[0m
[38;5;238m1705[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242menable_ts[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mtrailing_stop_activated[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m1706[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_market_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;248;248;242mfixed_stop_price[0m[38;2;248;248;242m:[0m
[38;5;238m1707[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;248;248;242msl_triggered[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m
[38;5;238m1708[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;248;248;242mexit_reason[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSL Loop @ [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_market_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (Target ~[0m[38;2;248;248;242m{[0m[38;2;248;248;242mfixed_stop_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m
[38;5;238m1709[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m*** TRADE EXIT (LOOP CHECK): STOP-LOSS TRIGGERED! ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mexit_reason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Closing [0m[38;2;248;248;242m{[0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. ***[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1710[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;255;121;198melif[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_market_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m>=[0m[38;2;248;248;242m [0m[38;2;248;248;242mfixed_profit_price[0m[38;2;248;248;242m:[0m
[38;5;238m1711[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;248;248;242mtp_triggered[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m
[38;5;238m1712[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;248;248;242mexit_reason[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTP Loop @ [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_market_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (Target ~[0m[38;2;248;248;242m{[0m[38;2;248;248;242mfixed_profit_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m
[38;5;238m1713[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123msuccess[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m*** TRADE EXIT (LOOP CHECK): TAKE-PROFIT TRIGGERED! ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mexit_reason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Closing [0m[38;2;248;248;242m{[0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. ***[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1714[0m   [38;5;238mâ”‚[0m 
[38;5;238m1715[0m   [38;5;238mâ”‚[0m 
[38;5;238m1716[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198melif[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_SHORT[0m[38;2;248;248;242m:[0m
[38;5;238m1717[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mfixed_stop_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m+[0m[38;2;248;248;242m [0m[38;2;248;248;242msl_distance_fixed[0m
[38;5;238m1718[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mfixed_profit_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m-[0m[38;2;248;248;242m [0m[38;2;248;248;242mtp_distance_fixed[0m
[38;5;238m1719[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mExit Check (Short): Entry=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mentry_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Current=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_market_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Fixed SL=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mfixed_stop_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Fixed TP=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mfixed_profit_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1720[0m   [38;5;238mâ”‚[0m 
[38;5;238m1721[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Trailing Stop Logic (Short) ---[0m
[38;5;238m1722[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242menable_ts[0m[38;2;248;248;242m:[0m
[38;5;238m1723[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Activate TS if PNL % meets threshold and TS not already activated[0m
[38;5;238m1724[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Note: For short, profit is typically negative PNL (e.g., -20% means +20% profit)[0m
[38;5;238m1725[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m We check if unrealized PNL USDT is positive AND PNL% is <= -ts_activation_profit_pct[0m
[38;5;238m1726[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Or simpler: PNL percentage is positive and >= activation threshold (absolute value)[0m
[38;5;238m1727[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mtrailing_stop_activated[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mpnl_percentage[0m[38;2;248;248;242m [0m[38;2;255;121;198m>=[0m[38;2;248;248;242m [0m[38;2;248;248;242mts_activation_profit_pct[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m PNL % is typically positive for profit[0m
[38;5;238m1728[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                         [0m[38;2;248;248;242minitial_ts_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_market_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;189;147;249m1[0m[38;2;248;248;242m [0m[38;2;255;121;198m+[0m[38;2;248;248;242m [0m[38;2;248;248;242mts_distance_pct[0m[38;2;248;248;242m [0m[38;2;255;121;198m/[0m[38;2;248;248;242m [0m[38;2;189;147;249m100[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m
[38;5;238m1729[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                         [0m[38;2;248;248;242mcurrent_trailing_stop_price[0m[38;2;248;248;242m[[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;139;233;253mmin[0m[38;2;248;248;242m([0m[38;2;248;248;242mfixed_stop_price[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242minitial_ts_price[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m TS never above initial fixed SL[0m
[38;5;238m1730[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                         [0m[38;2;248;248;242mtrailing_stop_activated[0m[38;2;248;248;242m[[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m
[38;5;238m1731[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                         [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrailing Stop: ACTIVATED for Short position. Initial TS price: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_trailing_stop_price[0m[38;2;248;248;242m[[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m][0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1732[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                         [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;255;121;198m.[0m[38;2;80;250;123msplit[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140m/[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m[[0m[38;2;189;147;249m0[0m[38;2;248;248;242m][0m[38;2;248;248;242m}[0m[38;2;241;250;140m] TS Activated (Short). Initial TS: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_trailing_stop_price[0m[38;2;248;248;242m[[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m][0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1733[0m   [38;5;238mâ”‚[0m 
[38;5;238m1734[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m If TS is activated, update the stop price[0m
[38;5;238m1735[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mtrailing_stop_activated[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m1736[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Calculate the potential new stop price[0m
[38;5;238m1737[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;248;248;242mpotential_new_ts[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_market_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;189;147;249m1[0m[38;2;248;248;242m [0m[38;2;255;121;198m+[0m[38;2;248;248;242m [0m[38;2;248;248;242mts_distance_pct[0m[38;2;248;248;242m [0m[38;2;255;121;198m/[0m[38;2;248;248;242m [0m[38;2;189;147;249m100[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m
[38;5;238m1738[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m The new trailing stop is the minimum of the old one and the potential new one[0m
[38;5;238m1739[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;248;248;242mupdated_ts_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;139;233;253mmin[0m[38;2;248;248;242m([0m[38;2;248;248;242mcurrent_trailing_stop_price[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140minf[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mpotential_new_ts[0m[38;2;248;248;242m)[0m
[38;5;238m1740[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                         [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Ensure updated TS is not above fixed SL[0m
[38;5;238m1741[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;248;248;242mupdated_ts_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;139;233;253mmin[0m[38;2;248;248;242m([0m[38;2;248;248;242mupdated_ts_price[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mfixed_stop_price[0m[38;2;248;248;242m)[0m
[38;5;238m1742[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;248;248;242mcurrent_trailing_stop_price[0m[38;2;248;248;242m[[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mupdated_ts_price[0m
[38;5;238m1743[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrailing Stop (Short): Updated TS price to [0m[38;2;248;248;242m{[0m[38;2;248;248;242mupdated_ts_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (Current Market Price: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_market_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1744[0m   [38;5;238mâ”‚[0m 
[38;5;238m1745[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Check if current price has crossed the trailing stop price[0m
[38;5;238m1746[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_market_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m>=[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_trailing_stop_price[0m[38;2;248;248;242m[[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m][0m[38;2;248;248;242m:[0m
[38;5;238m1747[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                            [0m[38;2;248;248;242mts_triggered[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m
[38;5;238m1748[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                            [0m[38;2;248;248;242mexit_reason[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTS Loop @ [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_market_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (Trailing Stop ~[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_trailing_stop_price[0m[38;2;248;248;242m[[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m][0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m
[38;5;238m1749[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m*** TRADE EXIT (LOOP CHECK): TRAILING STOP TRIGGERED! ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mexit_reason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Closing [0m[38;2;248;248;242m{[0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. ***[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1750[0m   [38;5;238mâ”‚[0m 
[38;5;238m1751[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Check Fixed SL/TP (only if TS is not enabled OR not yet activated/triggered) ---[0m
[38;5;238m1752[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242menable_ts[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mtrailing_stop_activated[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m1753[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                     [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_market_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m>=[0m[38;2;248;248;242m [0m[38;2;248;248;242mfixed_stop_price[0m[38;2;248;248;242m:[0m
[38;5;238m1754[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                         [0m[38;2;248;248;242msl_triggered[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m
[38;5;238m1755[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                         [0m[38;2;248;248;242mexit_reason[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSL Loop @ [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_market_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (Target ~[0m[38;2;248;248;242m{[0m[38;2;248;248;242mfixed_stop_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m
[38;5;238m1756[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                         [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m*** TRADE EXIT (LOOP CHECK): STOP-LOSS TRIGGERED! ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mexit_reason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Closing [0m[38;2;248;248;242m{[0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. ***[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1757[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                     [0m[38;2;255;121;198melif[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_market_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;248;248;242mfixed_profit_price[0m[38;2;248;248;242m:[0m
[38;5;238m1758[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                         [0m[38;2;248;248;242mtp_triggered[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m
[38;5;238m1759[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                         [0m[38;2;248;248;242mexit_reason[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTP Loop @ [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_market_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (Target ~[0m[38;2;248;248;242m{[0m[38;2;248;248;242mfixed_profit_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m
[38;5;238m1760[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                         [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123msuccess[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m*** TRADE EXIT (LOOP CHECK): TAKE-PROFIT TRIGGERED! ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mexit_reason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Closing [0m[38;2;248;248;242m{[0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. ***[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1761[0m   [38;5;238mâ”‚[0m 
[38;5;238m1762[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Execute Close if any Exit Triggered ---[0m
[38;5;238m1763[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mts_triggered[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242msl_triggered[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mtp_triggered[0m[38;2;248;248;242m:[0m
[38;5;238m1764[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m!!! THIS EXIT TRIGGER IS BASED ON DELAYED CHECK - ACTUAL FILL PRICE MAY BE SIGNIFICANTLY WORSE !!![0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1765[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mclose_result[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mclose_position[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mreason[0m[38;2;255;121;198m=[0m[38;2;248;248;242mexit_reason[0m[38;2;255;121;198m.[0m[38;2;80;250;123msplit[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m [0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m[[0m[38;2;189;147;249m0[0m[38;2;248;248;242m][0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Use first word as reason (SL, TP, TS)[0m
[38;5;238m1766[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mclose_result[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242maction_taken_this_cycle[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m
[38;5;238m1767[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Exit logic for this cycle after attempting close. Prevents entry immediately after exit.[0m
[38;5;238m1768[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;255;121;198mreturn[0m
[38;5;238m1769[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1770[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: Position SL/TP/TS not triggered based on latest fetched price (Loop Check).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1771[0m   [38;5;238mâ”‚[0m 
[38;5;238m1772[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melif[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m!=[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_NONE[0m[38;2;248;248;242m:[0m
[38;5;238m1773[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log if position exists but SL/TP check couldn't run (e.g., bad entry price or ATR)[0m
[38;5;238m1774[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: Position ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) exists but loop-based SL/TP/TS check skipped (Entry=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mentry_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, ATR=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Current Price=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_market_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1775[0m   [38;5;238mâ”‚[0m 
[38;5;238m1776[0m   [38;5;238mâ”‚[0m 
[38;5;238m1777[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m === 7. Check for Entry Signals ===[0m
[38;5;238m1778[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Only proceed if no Exit was triggered above AND we have a valid entry price estimate[0m
[38;5;238m1779[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242maction_taken_this_cycle[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price_for_size_calc[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price_for_size_calc[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_QTY_EPSILON[0m[38;2;248;248;242m:[0m
[38;5;238m1780[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: Checking entry signals...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1781[0m   [38;5;238mâ”‚[0m 
[38;5;238m1782[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Define Confirmation Conditions ---[0m
[38;5;238m1783[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Order Book Confirmation (only if required and data is available)[0m
[38;5;238m1784[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mob_check_required[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;255;255;255mFETCH_ORDER_BOOK_PER_CYCLE[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m If True, we need OB data every time[0m
[38;5;238m1785[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mob_available[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mob_data[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mbid_ask_ratio[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1786[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mpasses_long_ob[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mob_check_required[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242mob_available[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mbid_ask_ratio[0m[38;2;248;248;242m [0m[38;2;255;121;198m>=[0m[38;2;248;248;242m [0m[38;2;255;255;255mORDER_BOOK_RATIO_THRESHOLD_LONG[0m[38;2;248;248;242m)[0m
[38;5;238m1787[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mpasses_short_ob[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mob_check_required[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242mob_available[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mbid_ask_ratio[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;255;255;255mORDER_BOOK_RATIO_THRESHOLD_SHORT[0m[38;2;248;248;242m)[0m
[38;5;238m1788[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mob_log_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRatio=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mbid_ask_ratio_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (LongThr=[0m[38;2;248;248;242m{[0m[38;2;255;255;255mORDER_BOOK_RATIO_THRESHOLD_LONG[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, ShortThr=[0m[38;2;248;248;242m{[0m[38;2;255;255;255mORDER_BOOK_RATIO_THRESHOLD_SHORT[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Required=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mob_check_required[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m
[38;5;238m1789[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mConfirmation | Order Book: Long OK=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mpasses_long_ob[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Short OK=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mpasses_short_ob[0m[38;2;248;248;242m}[0m[38;2;241;250;140m [[0m[38;2;248;248;242m{[0m[38;2;248;248;242mob_log_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m][0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1790[0m   [38;5;238mâ”‚[0m 
[38;5;238m1791[0m   [38;5;238mâ”‚[0m 
[38;5;238m1792[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Volume Confirmation (only if required and data is available)[0m
[38;5;238m1793[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mvolume_check_required[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;255;255;255mREQUIRE_VOLUME_SPIKE_FOR_ENTRY[0m
[38;5;238m1794[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mvolume_available[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mvolume_ratio[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Need ratio to check spike[0m
[38;5;238m1795[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mpasses_volume[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mvolume_check_required[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242mvolume_available[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mvolume_spike[0m[38;2;248;248;242m)[0m
[38;5;238m1796[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mvol_log_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRatio=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mvol_ratio_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Spike=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mvol_spike_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (Required=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mvolume_check_required[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m
[38;5;238m1797[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mConfirmation | Volume: OK=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mpasses_volume[0m[38;2;248;248;242m}[0m[38;2;241;250;140m [[0m[38;2;248;248;242m{[0m[38;2;248;248;242mvol_log_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m][0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1798[0m   [38;5;238mâ”‚[0m 
[38;5;238m1799[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Determine Primary Strategy Signal (based on last candle data) ---[0m
[38;5;238m1800[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mstrategy_long_signal[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m
[38;5;238m1801[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mstrategy_short_signal[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m
[38;5;238m1802[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mstrategy_details_log[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m"[0m
[38;5;238m1803[0m   [38;5;238mâ”‚[0m 
[38;5;238m1804[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;255;255mSTRATEGY_NAME[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mDUAL_SUPERTREND[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m
[38;5;238m1805[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mprimary_long_signal[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_candle[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mst_long[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m
[38;5;238m1806[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mprimary_short_signal[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_candle[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mst_short[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m
[38;5;238m1807[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mconfirm_trend_up[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_candle[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mconfirm_trend[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m
[38;5;238m1808[0m   [38;5;238mâ”‚[0m 
[38;5;238m1809[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mstrategy_long_signal[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mprimary_long_signal[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mconfirm_trend_up[0m
[38;5;238m1810[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mstrategy_short_signal[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mprimary_short_signal[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mconfirm_trend_up[0m
[38;5;238m1811[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mstrategy_details_log[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPrimaryFlip=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mprimary_long_signal[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mprimary_short_signal[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, ConfirmTrendUp=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mconfirm_trend_up[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m
[38;5;238m1812[0m   [38;5;238mâ”‚[0m 
[38;5;238m1813[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198melif[0m[38;2;248;248;242m [0m[38;2;255;255;255mSTRATEGY_NAME[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mSTOCHRSI_MOMENTUM[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m
[38;5;238m1814[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mlast_k[0m[38;2;248;248;242m, [0m[38;2;248;248;242mlast_d[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_candle[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mstochrsi_k[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;248;248;242m, [0m[38;2;248;248;242mlast_candle[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mstochrsi_d[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m
[38;5;238m1815[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mprev_k[0m[38;2;248;248;242m, [0m[38;2;248;248;242mprev_d[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mstochrsi_k[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m2[0m[38;2;248;248;242m][0m[38;2;248;248;242m, [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mstochrsi_d[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m2[0m[38;2;248;248;242m][0m
[38;5;238m1816[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mlast_mom[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_candle[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mmomentum[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m
[38;5;238m1817[0m   [38;5;238mâ”‚[0m 
[38;5;238m1818[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Strategy Long: K cross above D AND K/D < Oversold AND Momentum > 0[0m
[38;5;238m1819[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mstrategy_long_signal[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m
[38;5;238m1820[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                     [0m[38;2;248;248;242mprev_k[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;248;248;242mprev_d[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_k[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_d[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m
[38;5;238m1821[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                     [0m[38;2;248;248;242mlast_k[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;255;255;255mSTOCHRSI_OVERSOLD[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_d[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;255;255;255mSTOCHRSI_OVERSOLD[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m
[38;5;238m1822[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                     [0m[38;2;248;248;242mlast_mom[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_QTY_EPSILON[0m
[38;5;238m1823[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242m)[0m
[38;5;238m1824[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Strategy Short: K cross below D AND K/D > Overbought AND Momentum < 0[0m
[38;5;238m1825[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mstrategy_short_signal[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m
[38;5;238m1826[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                     [0m[38;2;248;248;242mprev_k[0m[38;2;248;248;242m [0m[38;2;255;121;198m>=[0m[38;2;248;248;242m [0m[38;2;248;248;242mprev_d[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_k[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_d[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m
[38;5;238m1827[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                     [0m[38;2;248;248;242mlast_k[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;255;255;255mSTOCHRSI_OVERBOUGHT[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_d[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;255;255;255mSTOCHRSI_OVERBOUGHT[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m
[38;5;238m1828[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                     [0m[38;2;248;248;242mlast_mom[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;255;121;198m-[0m[38;2;255;255;255mPOSITION_QTY_EPSILON[0m
[38;5;238m1829[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242m)[0m
[38;5;238m1830[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mstrategy_details_log[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mK Cross D: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mlast_k[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_d[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, K/D < OS([0m[38;2;248;248;242m{[0m[38;2;255;255;255mSTOCHRSI_OVERSOLD[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): [0m[38;2;248;248;242m{[0m[38;2;248;248;242mlast_k[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;255;255;255mSTOCHRSI_OVERSOLD[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_d[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;255;255;255mSTOCHRSI_OVERSOLD[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Mom > 0: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mlast_mom[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_QTY_EPSILON[0m[38;2;248;248;242m}[0m[38;2;241;250;140m | [0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;248;248;242m\[0m
[38;5;238m1831[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                                        [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mK Cross D: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mlast_k[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_d[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, K/D > OB([0m[38;2;248;248;242m{[0m[38;2;255;255;255mSTOCHRSI_OVERBOUGHT[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): [0m[38;2;248;248;242m{[0m[38;2;248;248;242mlast_k[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;255;255;255mSTOCHRSI_OVERBOUGHT[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_d[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;255;255;255mSTOCHRSI_OVERBOUGHT[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Mom < 0: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mlast_mom[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;255;121;198m-[0m[38;2;255;255;255mPOSITION_QTY_EPSILON[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m
[38;5;238m1832[0m   [38;5;238mâ”‚[0m 
[38;5;238m1833[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198melif[0m[38;2;248;248;242m [0m[38;2;255;255;255mSTRATEGY_NAME[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mEHLERS_FISHER[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m
[38;5;238m1834[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mlast_fisher[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_candle[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mehlers_fisher[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m
[38;5;238m1835[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mlast_signal[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_candle[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mehlers_signal[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m
[38;5;238m1836[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mprev_fisher[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mehlers_fisher[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m2[0m[38;2;248;248;242m][0m
[38;5;238m1837[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mprev_signal[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mehlers_signal[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m2[0m[38;2;248;248;242m][0m
[38;5;238m1838[0m   [38;5;238mâ”‚[0m 
[38;5;238m1839[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Strategy Long: Fisher crosses above Signal line[0m
[38;5;238m1840[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mstrategy_long_signal[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242mprev_fisher[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;248;248;242mprev_signal[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_fisher[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_signal[0m[38;2;248;248;242m)[0m
[38;5;238m1841[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Strategy Short: Fisher crosses below Signal line[0m
[38;5;238m1842[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mstrategy_short_signal[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242mprev_fisher[0m[38;2;248;248;242m [0m[38;2;255;121;198m>=[0m[38;2;248;248;242m [0m[38;2;248;248;242mprev_signal[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_fisher[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_signal[0m[38;2;248;248;242m)[0m
[38;5;238m1843[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mstrategy_details_log[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mFisher Cross Signal: Long=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mstrategy_long_signal[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Short=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mstrategy_short_signal[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m
[38;5;238m1844[0m   [38;5;238mâ”‚[0m 
[38;5;238m1845[0m   [38;5;238mâ”‚[0m 
[38;5;238m1846[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mStrategy Signal Check ([0m[38;2;248;248;242m{[0m[38;2;255;255;255mSTRATEGY_NAME[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Long=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mstrategy_long_signal[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Short=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mstrategy_short_signal[0m[38;2;248;248;242m}[0m[38;2;241;250;140m | Details: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mstrategy_details_log[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1847[0m   [38;5;238mâ”‚[0m 
[38;5;238m1848[0m   [38;5;238mâ”‚[0m 
[38;5;238m1849[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Combine Strategy Signal with Confirmations ---[0m
[38;5;238m1850[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242menter_long[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m
[38;5;238m1851[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m!=[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_LONG[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Not already Long[0m
[38;5;238m1852[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mstrategy_long_signal[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Strategy gives Long signal[0m
[38;5;238m1853[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mpasses_long_ob[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m                      [0m[38;2;98;114;164m#[0m[38;2;98;114;164m OB confirmation met (or not required)[0m
[38;5;238m1854[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mpasses_volume[0m[38;2;248;248;242m                           [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Volume confirmation met (or not required)[0m
[38;5;238m1855[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242m)[0m
[38;5;238m1856[0m   [38;5;238mâ”‚[0m 
[38;5;238m1857[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242menter_short[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m
[38;5;238m1858[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m!=[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_SHORT[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Not already Short[0m
[38;5;238m1859[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mstrategy_short_signal[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m               [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Strategy gives Short signal[0m
[38;5;238m1860[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mpasses_short_ob[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m                     [0m[38;2;98;114;164m#[0m[38;2;98;114;164m OB confirmation met (or not required)[0m
[38;5;238m1861[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mpasses_volume[0m[38;2;248;248;242m                           [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Volume confirmation met (or not required)[0m
[38;5;238m1862[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242m)[0m
[38;5;238m1863[0m   [38;5;238mâ”‚[0m 
[38;5;238m1864[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log the final entry conditions evaluation[0m
[38;5;238m1865[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mFinal Entry Evaluation (Long): Not Long ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m!=[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_LONG[0m[38;2;248;248;242m}[0m[38;2;241;250;140m), Strategy Long ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mstrategy_long_signal[0m[38;2;248;248;242m}[0m[38;2;241;250;140m), OB OK ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mpasses_long_ob[0m[38;2;248;248;242m}[0m[38;2;241;250;140m), Volume OK ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mpasses_volume[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) => Enter Long = [0m[38;2;248;248;242m{[0m[38;2;248;248;242menter_long[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1866[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mFinal Entry Evaluation (Short): Not Short ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m!=[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_SHORT[0m[38;2;248;248;242m}[0m[38;2;241;250;140m), Strategy Short ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mstrategy_short_signal[0m[38;2;248;248;242m}[0m[38;2;241;250;140m), OB OK ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mpasses_short_ob[0m[38;2;248;248;242m}[0m[38;2;241;250;140m), Volume OK ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mpasses_volume[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) => Enter Short = [0m[38;2;248;248;242m{[0m[38;2;248;248;242menter_short[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1867[0m   [38;5;238mâ”‚[0m 
[38;5;238m1868[0m   [38;5;238mâ”‚[0m 
[38;5;238m1869[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m === 8. Execute Entry / Reversal Actions ===[0m
[38;5;238m1870[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Need current_atr and entry_price_for_size_calc for placing orders[0m
[38;5;238m1871[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mcan_place_order[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_QTY_EPSILON[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m
[38;5;238m1872[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                               [0m[38;2;248;248;242mentry_price_for_size_calc[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price_for_size_calc[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_QTY_EPSILON[0m[38;2;248;248;242m)[0m
[38;5;238m1873[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mcan_place_order[0m[38;2;248;248;242m:[0m
[38;5;238m1874[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: Cannot place order due to invalid ATR or entry price estimate. Skipping entries.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1875[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242menter_long[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Disable entry flags[0m
[38;5;238m1876[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242menter_short[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m
[38;5;238m1877[0m   [38;5;238mâ”‚[0m 
[38;5;238m1878[0m   [38;5;238mâ”‚[0m 
[38;5;238m1879[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242menter_long[0m[38;2;248;248;242m:[0m
[38;5;238m1880[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123msuccess[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m*** TRADE SIGNAL: CONFIRMED LONG ENTRY SIGNAL for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m ***[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1881[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_SHORT[0m[38;2;248;248;242m:[0m
[38;5;238m1882[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Reversal: Close Short, then Enter Long ---[0m
[38;5;238m1883[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Action: LONG signal received while SHORT. Attempting REVERSAL.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1884[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal Step 1: Closing existing SHORT position...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1885[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mclose_result[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mclose_position[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mreason[0m[38;2;255;121;198m=[0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal to Long[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1886[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242maction_taken_this_cycle[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m
[38;5;238m1887[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mclose_result[0m[38;2;248;248;242m:[0m
[38;5;238m1888[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal Step 1: Close SHORT order placed. Waiting [0m[38;2;248;248;242m{[0m[38;2;255;255;255mPOST_CLOSE_DELAY_SECONDS[0m[38;2;248;248;242m}[0m[38;2;241;250;140ms...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1889[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;248;248;242mtime[0m[38;2;255;121;198m.[0m[38;2;80;250;123msleep[0m[38;2;248;248;242m([0m[38;2;255;255;255mPOST_CLOSE_DELAY_SECONDS[0m[38;2;248;248;242m)[0m
[38;5;238m1890[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal Step 2: Re-checking position status after close attempt...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1891[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;248;248;242mcurrent_pos_after_close[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mget_current_position[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m)[0m
[38;5;238m1892[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_pos_after_close[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_pos_after_close[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mside[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_NONE[0m[38;2;248;248;242m:[0m
[38;5;238m1893[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123msuccess[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal Step 2: Confirmed SHORT position closed.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1894[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal Step 3: Proceeding with LONG entry.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1895[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                            [0m[38;2;80;250;123mplace_risked_market_order[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mSIDE_BUY[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mrisk_pct[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msl_atr_mult[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mtp_atr_mult[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mleverage[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mmax_order_cap[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mmargin_buffer[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price_for_size_calc[0m[38;2;248;248;242m)[0m
[38;5;238m1896[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1897[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal Step 2: Failed to confirm SHORT position closure ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_pos_after_close[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mside[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Skipping LONG entry.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1898[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1899[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                         [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal Step 1: Failed to place order to close SHORT position. Skipping LONG entry.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1900[0m   [38;5;238mâ”‚[0m 
[38;5;238m1901[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198melif[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_NONE[0m[38;2;248;248;242m:[0m
[38;5;238m1902[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- New Entry: Enter Long ---[0m
[38;5;238m1903[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Action: Entering NEW LONG position.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1904[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mplace_result[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mplace_risked_market_order[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mSIDE_BUY[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mrisk_pct[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msl_atr_mult[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mtp_atr_mult[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mleverage[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mmax_order_cap[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mmargin_buffer[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price_for_size_calc[0m[38;2;248;248;242m)[0m
[38;5;238m1905[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mplace_result[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242maction_taken_this_cycle[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m
[38;5;238m1906[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1907[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                     [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Action: Signal LONG ignored (already long).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1908[0m   [38;5;238mâ”‚[0m 
[38;5;238m1909[0m   [38;5;238mâ”‚[0m 
[38;5;238m1910[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198melif[0m[38;2;248;248;242m [0m[38;2;248;248;242menter_short[0m[38;2;248;248;242m:[0m
[38;5;238m1911[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123msuccess[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m*** TRADE SIGNAL: CONFIRMED SHORT ENTRY SIGNAL for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m ***[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1912[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_LONG[0m[38;2;248;248;242m:[0m
[38;5;238m1913[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Reversal: Close Long, then Enter Short ---[0m
[38;5;238m1914[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Action: SHORT signal received while LONG. Attempting REVERSAL.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1915[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal Step 1: Closing existing LONG position...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1916[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mclose_result[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mclose_position[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mreason[0m[38;2;255;121;198m=[0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal to Short[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1917[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242maction_taken_this_cycle[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m
[38;5;238m1918[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mclose_result[0m[38;2;248;248;242m:[0m
[38;5;238m1919[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal Step 1: Close LONG order placed. Waiting [0m[38;2;248;248;242m{[0m[38;2;255;255;255mPOST_CLOSE_DELAY_SECONDS[0m[38;2;248;248;242m}[0m[38;2;241;250;140ms...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1920[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;248;248;242mtime[0m[38;2;255;121;198m.[0m[38;2;80;250;123msleep[0m[38;2;248;248;242m([0m[38;2;255;255;255mPOST_CLOSE_DELAY_SECONDS[0m[38;2;248;248;242m)[0m
[38;5;238m1921[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal Step 2: Re-checking position status after close attempt...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1922[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;248;248;242mcurrent_pos_after_close[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mget_current_position[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m)[0m
[38;5;238m1923[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_pos_after_close[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_pos_after_close[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mside[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_NONE[0m[38;2;248;248;242m:[0m
[38;5;238m1924[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123msuccess[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal Step 2: Confirmed LONG position closed.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1925[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal Step 3: Proceeding with SHORT entry.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1926[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                            [0m[38;2;80;250;123mplace_risked_market_order[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mSIDE_SELL[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mrisk_pct[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msl_atr_mult[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mtp_atr_mult[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mleverage[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mmax_order_cap[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mmargin_buffer[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price_for_size_calc[0m[38;2;248;248;242m)[0m
[38;5;238m1927[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1928[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal Step 2: Failed to confirm LONG position closure ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_pos_after_close[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mside[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Skipping SHORT entry.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1929[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1930[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal Step 1: Failed to place order to close LONG position. Skipping SHORT entry.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1931[0m   [38;5;238mâ”‚[0m 
[38;5;238m1932[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198melif[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_NONE[0m[38;2;248;248;242m:[0m
[38;5;238m1933[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- New Entry: Enter Short ---[0m
[38;5;238m1934[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Action: Entering NEW SHORT position.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1935[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mplace_result[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mplace_risked_market_order[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mSIDE_SELL[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mrisk_pct[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msl_atr_mult[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mtp_atr_mult[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mleverage[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mmax_order_cap[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mmargin_buffer[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price_for_size_calc[0m[38;2;248;248;242m)[0m
[38;5;238m1936[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mplace_result[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242maction_taken_this_cycle[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m
[38;5;238m1937[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1938[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Action: Signal SHORT ignored (already short).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1939[0m   [38;5;238mâ”‚[0m 
[38;5;238m1940[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1941[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m No entry signal this cycle[0m
[38;5;238m1942[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242maction_taken_this_cycle[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Only log 'no signal' if no other action (like SL/TP/TS close) happened[0m
[38;5;238m1943[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_NONE[0m[38;2;248;248;242m:[0m
[38;5;238m1944[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: No confirmed entry signal and no active position. Holding cash.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1945[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1946[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                     [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: Holding [0m[38;2;248;248;242m{[0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m position. No new signal or loop-based exit triggered this cycle.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1947[0m   [38;5;238mâ”‚[0m 
[38;5;238m1948[0m   [38;5;238mâ”‚[0m 
[38;5;238m1949[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1950[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: CRITICAL UNEXPECTED ERROR during cycle execution for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1951[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m1952[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;255;121;198m.[0m[38;2;80;250;123msplit[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140m/[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m[[0m[38;2;189;147;249m0[0m[38;2;248;248;242m][0m[38;2;248;248;242m}[0m[38;2;241;250;140m] CRITICAL ERROR in trade_logic: [0m[38;2;248;248;242m{[0m[38;2;139;233;253mtype[0m[38;2;248;248;242m([0m[38;2;248;248;242me[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;248;248;242m__name__[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Check logs![0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1953[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mfinally[0m[38;2;248;248;242m:[0m
[38;5;238m1954[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m========== Cycle Check End: [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m ==========[0m[38;2;255;121;198m\n[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1955[0m   [38;5;238mâ”‚[0m 
[38;5;238m1956[0m   [38;5;238mâ”‚[0m 
[38;5;238m1957[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Graceful Shutdown ---[0m
[38;5;238m1958[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123mgraceful_shutdown[0m[38;2;248;248;242m([0m[3;38;2;255;184;108mexchange[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[38;2;248;248;242mccxt[0m[38;2;255;121;198m.[0m[38;2;248;248;242mExchange[0m[38;2;248;248;242m][0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108msymbol[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m][0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;248;248;242m->[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m:[0m
[38;5;238m1959[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m
[38;5;238m1960[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Attempts to close any open position for the given symbol before exiting.[0m
[38;5;238m1961[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Sends SMS alerts about the shutdown process.[0m
[38;5;238m1962[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    [0m[38;2;98;114;164m"""[0m
[38;5;238m1963[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mShutdown requested. Initiating graceful exit sequence...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1964[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;255;121;198m.[0m[38;2;80;250;123msplit[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140m/[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m[[0m[38;2;189;147;249m0[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mBot[0m[38;2;241;250;140m"[0m
[38;5;238m1965[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] Shutdown requested. Attempting to close open position if any.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1966[0m   [38;5;238mâ”‚[0m 
[38;5;238m1967[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m:[0m
[38;5;238m1968[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mGraceful Shutdown: Exchange not initialized or symbol not set. Cannot check or close position.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1969[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m
[38;5;238m1970[0m   [38;5;238mâ”‚[0m 
[38;5;238m1971[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m1972[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mGraceful Shutdown: Checking for active position for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1973[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mposition[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mget_current_position[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Use the updated function[0m
[38;5;238m1974[0m   [38;5;238mâ”‚[0m 
[38;5;238m1975[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mside[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m!=[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_NONE[0m[38;2;248;248;242m:[0m
[38;5;238m1976[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mpos_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mside[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m
[38;5;238m1977[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mpos_qty[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;139;233;253mabs[0m[38;2;248;248;242m([0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mposition[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140minfo[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140msize[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mcontracts[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m1978[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mGraceful Shutdown: Active [0m[38;2;248;248;242m{[0m[38;2;248;248;242mpos_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m position found ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mpos_qty[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Attempting to close...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1979[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Pass the freshly checked 'position' dict to the close function[0m
[38;5;238m1980[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mclose_result[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mclose_position[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mreason[0m[38;2;255;121;198m=[0m[38;2;241;250;140m"[0m[38;2;241;250;140mShutdown[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1981[0m   [38;5;238mâ”‚[0m 
[38;5;238m1982[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mclose_result[0m[38;2;248;248;242m:[0m
[38;5;238m1983[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mGraceful Shutdown: Close order placed. Waiting briefly for exchange processing...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1984[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mtime[0m[38;2;255;121;198m.[0m[38;2;80;250;123msleep[0m[38;2;248;248;242m([0m[38;2;255;255;255mPOST_CLOSE_DELAY_SECONDS[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;189;147;249m2[0m[38;2;248;248;242m)[0m
[38;5;238m1985[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mGraceful Shutdown: Performing final position check...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1986[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mfinal_pos_check[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mget_current_position[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m)[0m
[38;5;238m1987[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mfinal_pos_check[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mfinal_pos_check[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mside[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_NONE[0m[38;2;248;248;242m:[0m
[38;5;238m1988[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                     [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123msuccess[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mGraceful Shutdown: Position successfully confirmed closed.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1989[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                     [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] Position confirmed CLOSED during shutdown.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1990[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1991[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                     [0m[38;2;248;248;242mfinal_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mfinal_pos_check[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mside[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m1992[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                     [0m[38;2;248;248;242mfinal_qty[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;139;233;253mabs[0m[38;2;248;248;242m([0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mfinal_pos_check[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140minfo[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140msize[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mfinal_pos_check[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mcontracts[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mfinal_pos_check[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m
[38;5;238m1993[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                     [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mGraceful Shutdown: FAILED TO CONFIRM position closure after attempting close. Final check showed: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Qty: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_qty[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. MANUAL CHECK REQUIRED.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1994[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                     [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ERROR: Failed to confirm position closure on shutdown! Final state: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m Qty=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_qty[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. MANUAL CHECK REQUIRED.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1995[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1996[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mGraceful Shutdown: Failed to place the close order for the active position. MANUAL INTERVENTION REQUIRED.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1997[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ERROR: Failed to PLACE close order during shutdown. MANUAL CHECK REQUIRED.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1998[0m   [38;5;238mâ”‚[0m 
[38;5;238m1999[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m2000[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mGraceful Shutdown: No active position found for [0m[38;2;189;147;249m{[0m[38;2;189;147;249msymbol[0m[38;2;189;147;249m}[0m[38;2;241;250;140m. No close action needed.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2001[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] No active position found during shutdown.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2002[0m   [38;5;238mâ”‚[0m 
[38;5;238m2003[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m2004[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mGraceful Shutdown: An error occurred during the shutdown process: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2005[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m2006[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] Error during graceful shutdown sequence: [0m[38;2;248;248;242m{[0m[38;2;139;233;253mtype[0m[38;2;248;248;242m([0m[38;2;248;248;242me[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;248;248;242m__name__[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Check logs.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2007[0m   [38;5;238mâ”‚[0m 
[38;5;238m2008[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m--- Scalping Bot Shutdown Complete ---[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2009[0m   [38;5;238mâ”‚[0m 
[38;5;238m2010[0m   [38;5;238mâ”‚[0m 
[38;5;238m2011[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Main Execution ---[0m
[38;5;238m2012[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123mmain[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;248;248;242m->[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m:[0m
[38;5;238m2013[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m
[38;5;238m2014[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Main function to initialize the exchange connection, set up parameters,[0m
[38;5;238m2015[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    and run the main trading loop. Handles initialization errors and graceful shutdown.[0m
[38;5;238m2016[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    [0m[38;2;98;114;164m"""[0m
[38;5;238m2017[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mbot_start_time_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mtime[0m[38;2;255;121;198m.[0m[38;2;80;250;123mstrftime[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;189;147;249m%Y[0m[38;2;241;250;140m-[0m[38;2;189;147;249m%m[0m[38;2;241;250;140m-[0m[38;2;189;147;249m%d[0m[38;2;241;250;140m [0m[38;2;189;147;249m%H[0m[38;2;241;250;140m:[0m[38;2;189;147;249m%M[0m[38;2;241;250;140m:[0m[38;2;189;147;249m%S[0m[38;2;241;250;140m [0m[38;2;189;147;249m%Z[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m2018[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m--- Bybit Scalping Bot Initializing v1.6.0 ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mbot_start_time_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) ---[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2019[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m--- !!! LIVE FUTURES SCALPING MODE - EXTREME RISK INVOLVED !!! ---[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2020[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m--- ENSURE ALL PARAMETERS IN .env ARE CORRECTLY SET & TESTED ---[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2021[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m--- *** CRITICAL WARNING: LOOP-BASED SL/TP/TS IS ACTIVE - UNSAFE & INACCURATE FOR LIVE SCALPING *** ---[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2022[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m--- *** YOU MUST IMPLEMENT EXCHANGE-NATIVE CONDITIONAL ORDERS FOR SAFE OPERATION *** ---[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2023[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;255;255mENABLE_TRAILING_STOP[0m[38;2;248;248;242m:[0m
[38;5;238m2024[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m--- !!! WARNING: Trailing Stop enabled. This uses the unsafe loop-based check. !!! ---[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2025[0m   [38;5;238mâ”‚[0m 
[38;5;238m2026[0m   [38;5;238mâ”‚[0m 
[38;5;238m2027[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[38;2;248;248;242mccxt[0m[38;2;255;121;198m.[0m[38;2;248;248;242mExchange[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m2028[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m2029[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mBot[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Default for SMS before symbol is known[0m
[38;5;238m2030[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mrun_bot[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mbool[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m
[38;5;238m2031[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mcycle_count[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m
[38;5;238m2032[0m   [38;5;238mâ”‚[0m 
[38;5;238m2033[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m2034[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m === Initialize Exchange ===[0m
[38;5;238m2035[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123minitialize_exchange[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m
[38;5;238m2036[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m:[0m
[38;5;238m2037[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mBot exiting due to exchange initialization failure.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2038[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m
[38;5;238m2039[0m   [38;5;238mâ”‚[0m 
[38;5;238m2040[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m === Setup Trading Symbol and Leverage ===[0m
[38;5;238m2041[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m2042[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mraw_symbol_input[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;139;233;253minput[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mEnter trading symbol (e.g., BTC/USDT:USDT) or press Enter for default [[0m[38;2;248;248;242m{[0m[38;2;255;255;255mDEFAULT_SYMBOL[0m[38;2;248;248;242m}[0m[38;2;241;250;140m]: [0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mstrip[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m
[38;5;238m2043[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242msymbol_to_validate[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mraw_symbol_input[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;255;255;255mDEFAULT_SYMBOL[0m
[38;5;238m2044[0m   [38;5;238mâ”‚[0m 
[38;5;238m2045[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mValidating symbol: [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol_to_validate[0m[38;2;248;248;242m}[0m[38;2;241;250;140m...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2046[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mmarket[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mmarket[0m[38;2;248;248;242m([0m[38;2;248;248;242msymbol_to_validate[0m[38;2;248;248;242m)[0m
[38;5;238m2047[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mmarket[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140msymbol[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Use the CCXT canonical symbol format[0m
[38;5;238m2048[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;255;121;198m.[0m[38;2;80;250;123msplit[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140m/[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m[[0m[38;2;189;147;249m0[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m For SMS[0m
[38;5;238m2049[0m   [38;5;238mâ”‚[0m 
[38;5;238m2050[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mmarket[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mcontract[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mmarket[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mspot[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m2051[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mConfiguration Error: Symbol '[0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m' is not a valid SWAP or FUTURES market on [0m[38;2;248;248;242m{[0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;248;248;242mid[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Type: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mtype[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2052[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[ScalpBot] CRITICAL: Symbol [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m is not a contract market. Exiting.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2053[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mreturn[0m
[38;5;238m2054[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSuccessfully validated symbol: [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (Type: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mtype[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2055[0m   [38;5;238mâ”‚[0m 
[38;5;238m2056[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;80;250;123mset_leverage[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mDEFAULT_LEVERAGE[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m2057[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLeverage setup failed for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m after retries. Cannot proceed safely. Exiting.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2058[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] CRITICAL: Leverage setup FAILED for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Exiting.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2059[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mreturn[0m
[38;5;238m2060[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLeverage confirmed/set to [0m[38;2;248;248;242m{[0m[38;2;255;255;255mDEFAULT_LEVERAGE[0m[38;2;248;248;242m}[0m[38;2;241;250;140mx for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2061[0m   [38;5;238mâ”‚[0m 
[38;5;238m2062[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mBadSymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mKeyError[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m2063[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mConfiguration Error: Invalid or unsupported symbol '[0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol_to_validate[0m[38;2;248;248;242m}[0m[38;2;241;250;140m'. Error: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2064[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[ScalpBot] CRITICAL: Invalid symbol '[0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol_to_validate[0m[38;2;248;248;242m}[0m[38;2;241;250;140m'. Exiting.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2065[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m
[38;5;238m2066[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m2067[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mConfiguration Error: Unexpected error during symbol/leverage setup: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2068[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m2069[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m[ScalpBot] CRITICAL: Symbol/Leverage setup failed unexpectedly. Exiting.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2070[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m
[38;5;238m2071[0m   [38;5;238mâ”‚[0m 
[38;5;238m2072[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Initialize global TS state for the chosen symbol[0m
[38;5;238m2073[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;255;255mENABLE_TRAILING_STOP[0m[38;2;248;248;242m:[0m
[38;5;238m2074[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mtrailing_stop_activated[0m[38;2;248;248;242m[[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m
[38;5;238m2075[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mcurrent_trailing_stop_price[0m[38;2;248;248;242m[[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m
[38;5;238m2076[0m   [38;5;238mâ”‚[0m 
[38;5;238m2077[0m   [38;5;238mâ”‚[0m 
[38;5;238m2078[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m === Log Configuration Summary ===[0m
[38;5;238m2079[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m--- Scalping Bot Configuration Summary ---[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2080[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrading Pair: [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2081[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTimeframe: [0m[38;2;248;248;242m{[0m[38;2;255;255;255mDEFAULT_INTERVAL[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2082[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLeverage: [0m[38;2;248;248;242m{[0m[38;2;255;255;255mDEFAULT_LEVERAGE[0m[38;2;248;248;242m}[0m[38;2;241;250;140mx[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2083[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mStrategy Selected: [0m[38;2;248;248;242m{[0m[38;2;255;255;255mSTRATEGY_NAME[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2084[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;255;255mSTRATEGY_NAME[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mDUAL_SUPERTREND[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m
[38;5;238m2085[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m  Primary ST: Length=[0m[38;2;248;248;242m{[0m[38;2;255;255;255mDEFAULT_ST_ATR_LENGTH[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Multiplier=[0m[38;2;248;248;242m{[0m[38;2;255;255;255mDEFAULT_ST_MULTIPLIER[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2086[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m  Confirm ST: Length=[0m[38;2;248;248;242m{[0m[38;2;255;255;255mCONFIRM_ST_ATR_LENGTH[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Multiplier=[0m[38;2;248;248;242m{[0m[38;2;255;255;255mCONFIRM_ST_MULTIPLIER[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2087[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melif[0m[38;2;248;248;242m [0m[38;2;255;255;255mSTRATEGY_NAME[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mSTOCHRSI_MOMENTUM[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m
[38;5;238m2088[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m  StochRSI: RSI=[0m[38;2;248;248;242m{[0m[38;2;255;255;255mSTOCHRSI_RSI_LENGTH[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Stoch=[0m[38;2;248;248;242m{[0m[38;2;255;255;255mSTOCHRSI_STOCH_LENGTH[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, K=[0m[38;2;248;248;242m{[0m[38;2;255;255;255mSTOCHRSI_K_PERIOD[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, D=[0m[38;2;248;248;242m{[0m[38;2;255;255;255mSTOCHRSI_D_PERIOD[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (OB=[0m[38;2;248;248;242m{[0m[38;2;255;255;255mSTOCHRSI_OVERBOUGHT[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, OS=[0m[38;2;248;248;242m{[0m[38;2;255;255;255mSTOCHRSI_OVERSOLD[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2089[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m  Momentum: Length=[0m[38;2;248;248;242m{[0m[38;2;255;255;255mMOMENTUM_LENGTH[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2090[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melif[0m[38;2;248;248;242m [0m[38;2;255;255;255mSTRATEGY_NAME[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mEHLERS_FISHER[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m
[38;5;238m2091[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m  Fisher: Length=[0m[38;2;248;248;242m{[0m[38;2;255;255;255mEHLERS_FISHER_LENGTH[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Signal=[0m[38;2;248;248;242m{[0m[38;2;255;255;255mEHLERS_FISHER_SIGNAL_LENGTH[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2092[0m   [38;5;238mâ”‚[0m 
[38;5;238m2093[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRisk Per Trade: [0m[38;2;248;248;242m{[0m[38;2;255;255;255mRISK_PER_TRADE_PERCENTAGE[0m[38;2;189;147;249m:.3%[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2094[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mMax Position Value (Cap): [0m[38;2;248;248;242m{[0m[38;2;255;255;255mMAX_ORDER_USDT_AMOUNT[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2095[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mInitial SL Calculation: [0m[38;2;248;248;242m{[0m[38;2;255;255;255mATR_STOP_LOSS_MULTIPLIER[0m[38;2;248;248;242m}[0m[38;2;241;250;140m * ATR([0m[38;2;248;248;242m{[0m[38;2;255;255;255mATR_CALCULATION_PERIOD[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2096[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mFixed TP Calculation: [0m[38;2;248;248;242m{[0m[38;2;255;255;255mATR_TAKE_PROFIT_MULTIPLIER[0m[38;2;248;248;242m}[0m[38;2;241;250;140m * ATR([0m[38;2;248;248;242m{[0m[38;2;255;255;255mATR_CALCULATION_PERIOD[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) (Loop Check - Unsafe)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2097[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrailing Stop Enabled: [0m[38;2;248;248;242m{[0m[38;2;255;255;255mENABLE_TRAILING_STOP[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2098[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;255;255mENABLE_TRAILING_STOP[0m[38;2;248;248;242m:[0m
[38;5;238m2099[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m  TS Activation Profit: [0m[38;2;248;248;242m{[0m[38;2;255;255;255mTS_ACTIVATION_PROFIT_PERCENT[0m[38;2;189;147;249m:.1f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m%[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2100[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m  TS Trail Distance: [0m[38;2;248;248;242m{[0m[38;2;255;255;255mTS_DISTANCE_PERCENT[0m[38;2;189;147;249m:.1f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m%[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2101[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m!!! WARNING: Trailing Stop uses UNSAFE loop check !!![0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2102[0m   [38;5;238mâ”‚[0m 
[38;5;238m2103[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mVolume Analysis: MA=[0m[38;2;248;248;242m{[0m[38;2;255;255;255mVOLUME_MA_PERIOD[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Spike > [0m[38;2;248;248;242m{[0m[38;2;255;255;255mVOLUME_SPIKE_THRESHOLD[0m[38;2;248;248;242m}[0m[38;2;241;250;140mx MA (Required for Entry: [0m[38;2;248;248;242m{[0m[38;2;255;255;255mREQUIRE_VOLUME_SPIKE_FOR_ENTRY[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2104[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mOrder Book Analysis: Depth=[0m[38;2;248;248;242m{[0m[38;2;255;255;255mORDER_BOOK_DEPTH[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Long Ratio >= [0m[38;2;248;248;242m{[0m[38;2;255;255;255mORDER_BOOK_RATIO_THRESHOLD_LONG[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Short Ratio <= [0m[38;2;248;248;242m{[0m[38;2;255;255;255mORDER_BOOK_RATIO_THRESHOLD_SHORT[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2105[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mFetch Order Book Every Cycle: [0m[38;2;248;248;242m{[0m[38;2;255;255;255mFETCH_ORDER_BOOK_PER_CYCLE[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2106[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mMargin Check Buffer: [0m[38;2;248;248;242m{[0m[38;2;255;255;255mREQUIRED_MARGIN_BUFFER[0m[38;2;189;147;249m:.1%[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (Requires [0m[38;2;248;248;242m{[0m[38;2;248;248;242m([0m[38;2;255;255;255mREQUIRED_MARGIN_BUFFER[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m)[0m[38;2;255;121;198m*[0m[38;2;189;147;249m100[0m[38;2;189;147;249m:.1f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m% extra free margin)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2107[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mCheck Interval (Sleep): [0m[38;2;248;248;242m{[0m[38;2;255;255;255mDEFAULT_SLEEP_SECONDS[0m[38;2;248;248;242m}[0m[38;2;241;250;140m seconds[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2108[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSMS Alerts Enabled: [0m[38;2;248;248;242m{[0m[38;2;255;255;255mENABLE_SMS_ALERTS[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Recipient: [0m[38;2;248;248;242m{[0m[38;2;241;250;140m'[0m[38;2;241;250;140mSet[0m[38;2;241;250;140m'[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;255;255mSMS_RECIPIENT_NUMBER[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mNot Set[0m[38;2;241;250;140m'[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Timeout: [0m[38;2;248;248;242m{[0m[38;2;255;255;255mSMS_TIMEOUT_SECONDS[0m[38;2;248;248;242m}[0m[38;2;241;250;140ms[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2109[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mACTION REQUIRED: Review this configuration carefully. Does it align with your strategy and risk tolerance?[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2110[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mRISK WARNING: Loop-based SL/TP/TS check is ACTIVE, INACCURATE & UNSAFE for live scalping.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2111[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mIMPLEMENT EXCHANGE-NATIVE CONDITIONAL ORDERS FOR SAFE OPERATION.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2112[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mCurrent Logging Level: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetLevelName[0m[38;2;248;248;242m([0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;248;248;242mlevel[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2113[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m------------------------------------------[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2114[0m   [38;5;238mâ”‚[0m 
[38;5;238m2115[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Send startup confirmation SMS[0m
[38;5;238m2116[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] Configured for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m ([0m[38;2;248;248;242m{[0m[38;2;255;255;255mDEFAULT_INTERVAL[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, [0m[38;2;248;248;242m{[0m[38;2;255;255;255mDEFAULT_LEVERAGE[0m[38;2;248;248;242m}[0m[38;2;241;250;140mx). Strategy: [0m[38;2;248;248;242m{[0m[38;2;255;255;255mSTRATEGY_NAME[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Loop-based SL/TP/TS ACTIVE (HIGH RISK). Starting main loop.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2117[0m   [38;5;238mâ”‚[0m 
[38;5;238m2118[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m === Main Trading Loop ===[0m
[38;5;238m2119[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mwhile[0m[38;2;248;248;242m [0m[38;2;248;248;242mrun_bot[0m[38;2;248;248;242m:[0m
[38;5;238m2120[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mcycle_start_time[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mtime[0m[38;2;255;121;198m.[0m[38;2;80;250;123mmonotonic[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m
[38;5;238m2121[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mcycle_count[0m[38;2;248;248;242m [0m[38;2;255;121;198m+=[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m
[38;5;238m2122[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m--- Cycle [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcycle_count[0m[38;2;248;248;242m}[0m[38;2;241;250;140m Start: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mtime[0m[38;2;255;121;198m.[0m[38;2;80;250;123mstrftime[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;189;147;249m%Y[0m[38;2;241;250;140m-[0m[38;2;189;147;249m%m[0m[38;2;241;250;140m-[0m[38;2;189;147;249m%d[0m[38;2;241;250;140m [0m[38;2;189;147;249m%H[0m[38;2;241;250;140m:[0m[38;2;189;147;249m%M[0m[38;2;241;250;140m:[0m[38;2;189;147;249m%S[0m[38;2;241;250;140m [0m[38;2;189;147;249m%Z[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m ---[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2123[0m   [38;5;238mâ”‚[0m 
[38;5;238m2124[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m2125[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m 1. Fetch Fresh Market Data (OHLCV)[0m
[38;5;238m2126[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Determine required data length based on longest indicator period + buffer[0m
[38;5;238m2127[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mdata_limit[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;139;233;253mmax[0m[38;2;248;248;242m([0m
[38;5;238m2128[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;189;147;249m100[0m[38;2;248;248;242m,[0m
[38;5;238m2129[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;255;255;255mDEFAULT_ST_ATR_LENGTH[0m[38;2;255;121;198m*[0m[38;2;189;147;249m2[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mCONFIRM_ST_ATR_LENGTH[0m[38;2;255;121;198m*[0m[38;2;189;147;249m2[0m[38;2;248;248;242m,[0m
[38;5;238m2130[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;255;255;255mSTOCHRSI_RSI_LENGTH[0m[38;2;255;121;198m*[0m[38;2;189;147;249m2[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mSTOCHRSI_STOCH_LENGTH[0m[38;2;255;121;198m*[0m[38;2;189;147;249m2[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mSTOCHRSI_K_PERIOD[0m[38;2;255;121;198m*[0m[38;2;189;147;249m2[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mSTOCHRSI_D_PERIOD[0m[38;2;255;121;198m*[0m[38;2;189;147;249m2[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mMOMENTUM_LENGTH[0m[38;2;255;121;198m*[0m[38;2;189;147;249m2[0m[38;2;248;248;242m,[0m
[38;5;238m2131[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;255;255;255mEHLERS_FISHER_LENGTH[0m[38;2;255;121;198m*[0m[38;2;189;147;249m2[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mEHLERS_FISHER_SIGNAL_LENGTH[0m[38;2;255;121;198m*[0m[38;2;189;147;249m2[0m[38;2;248;248;242m,[0m
[38;5;238m2132[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;255;255;255mATR_CALCULATION_PERIOD[0m[38;2;255;121;198m*[0m[38;2;189;147;249m2[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mVOLUME_MA_PERIOD[0m[38;2;255;121;198m*[0m[38;2;189;147;249m2[0m
[38;5;238m2133[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m+[0m[38;2;248;248;242m [0m[38;2;255;255;255mAPI_FETCH_LIMIT_BUFFER[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Add buffer[0m
[38;5;238m2134[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mdf_market[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mget_market_data[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mDEFAULT_INTERVAL[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mlimit[0m[38;2;255;121;198m=[0m[38;2;248;248;242mdata_limit[0m[38;2;248;248;242m)[0m
[38;5;238m2135[0m   [38;5;238mâ”‚[0m 
[38;5;238m2136[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m 2. Execute Trading Logic (only if OHLCV data is valid)[0m
[38;5;238m2137[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf_market[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf_market[0m[38;2;255;121;198m.[0m[38;2;248;248;242mempty[0m[38;2;248;248;242m:[0m
[38;5;238m2138[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Pass a copy of the dataframe to prevent accidental modification across cycles[0m
[38;5;238m2139[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;80;250;123mtrade_logic[0m[38;2;248;248;242m([0m
[38;5;238m2140[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[3;38;2;255;184;108mexchange[0m[38;2;255;121;198m=[0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108msymbol[0m[38;2;255;121;198m=[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mdf[0m[38;2;255;121;198m=[0m[38;2;248;248;242mdf_market[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcopy[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m,[0m
[38;5;238m2141[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Supertrend params[0m
[38;5;238m2142[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[3;38;2;255;184;108mst_len[0m[38;2;255;121;198m=[0m[38;2;255;255;255mDEFAULT_ST_ATR_LENGTH[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mst_mult[0m[38;2;255;121;198m=[0m[38;2;255;255;255mDEFAULT_ST_MULTIPLIER[0m[38;2;248;248;242m,[0m
[38;5;238m2143[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[3;38;2;255;184;108mcf_st_len[0m[38;2;255;121;198m=[0m[38;2;255;255;255mCONFIRM_ST_ATR_LENGTH[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mcf_st_mult[0m[38;2;255;121;198m=[0m[38;2;255;255;255mCONFIRM_ST_MULTIPLIER[0m[38;2;248;248;242m,[0m
[38;5;238m2144[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m StochRSI + Momentum params[0m
[38;5;238m2145[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[3;38;2;255;184;108mrsi_len[0m[38;2;255;121;198m=[0m[38;2;255;255;255mSTOCHRSI_RSI_LENGTH[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mstoch_len[0m[38;2;255;121;198m=[0m[38;2;255;255;255mSTOCHRSI_STOCH_LENGTH[0m[38;2;248;248;242m,[0m
[38;5;238m2146[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[3;38;2;255;184;108mk_period[0m[38;2;255;121;198m=[0m[38;2;255;255;255mSTOCHRSI_K_PERIOD[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108md_period[0m[38;2;255;121;198m=[0m[38;2;255;255;255mSTOCHRSI_D_PERIOD[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mmom_len[0m[38;2;255;121;198m=[0m[38;2;255;255;255mMOMENTUM_LENGTH[0m[38;2;248;248;242m,[0m
[38;5;238m2147[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Ehlers Fisher params[0m
[38;5;238m2148[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[3;38;2;255;184;108mehlers_len[0m[38;2;255;121;198m=[0m[38;2;255;255;255mEHLERS_FISHER_LENGTH[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mehlers_signal_len[0m[38;2;255;121;198m=[0m[38;2;255;255;255mEHLERS_FISHER_SIGNAL_LENGTH[0m[38;2;248;248;242m,[0m
[38;5;238m2149[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Common params[0m
[38;5;238m2150[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[3;38;2;255;184;108matr_len[0m[38;2;255;121;198m=[0m[38;2;255;255;255mATR_CALCULATION_PERIOD[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mvol_ma_len[0m[38;2;255;121;198m=[0m[38;2;255;255;255mVOLUME_MA_PERIOD[0m[38;2;248;248;242m,[0m
[38;5;238m2151[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[3;38;2;255;184;108mrisk_pct[0m[38;2;255;121;198m=[0m[38;2;255;255;255mRISK_PER_TRADE_PERCENTAGE[0m[38;2;248;248;242m,[0m
[38;5;238m2152[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[3;38;2;255;184;108msl_atr_mult[0m[38;2;255;121;198m=[0m[38;2;255;255;255mATR_STOP_LOSS_MULTIPLIER[0m[38;2;248;248;242m,[0m
[38;5;238m2153[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[3;38;2;255;184;108mtp_atr_mult[0m[38;2;255;121;198m=[0m[38;2;255;255;255mATR_TAKE_PROFIT_MULTIPLIER[0m[38;2;248;248;242m,[0m
[38;5;238m2154[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[3;38;2;255;184;108mleverage[0m[38;2;255;121;198m=[0m[38;2;255;255;255mDEFAULT_LEVERAGE[0m[38;2;248;248;242m,[0m
[38;5;238m2155[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[3;38;2;255;184;108mmax_order_cap[0m[38;2;255;121;198m=[0m[38;2;255;255;255mMAX_ORDER_USDT_AMOUNT[0m[38;2;248;248;242m,[0m
[38;5;238m2156[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[3;38;2;255;184;108mmargin_buffer[0m[38;2;255;121;198m=[0m[38;2;255;255;255mREQUIRED_MARGIN_BUFFER[0m[38;2;248;248;242m,[0m
[38;5;238m2157[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m TS params[0m
[38;5;238m2158[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[3;38;2;255;184;108menable_ts[0m[38;2;255;121;198m=[0m[38;2;255;255;255mENABLE_TRAILING_STOP[0m[38;2;248;248;242m,[0m
[38;5;238m2159[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[3;38;2;255;184;108mts_activation_profit_pct[0m[38;2;255;121;198m=[0m[38;2;255;255;255mTS_ACTIVATION_PROFIT_PERCENT[0m[38;2;248;248;242m,[0m
[38;5;238m2160[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[3;38;2;255;184;108mts_distance_pct[0m[38;2;255;121;198m=[0m[38;2;255;255;255mTS_DISTANCE_PERCENT[0m
[38;5;238m2161[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242m)[0m
[38;5;238m2162[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m2163[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mMain Loop (Cycle [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcycle_count[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): No valid market data received for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Skipping trade logic for this cycle.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2164[0m   [38;5;238mâ”‚[0m 
[38;5;238m2165[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Main Loop Exception Handling ---[0m
[38;5;238m2166[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mRateLimitExceeded[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m2167[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRATE LIMIT EXCEEDED (Cycle [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcycle_count[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Sleeping for [0m[38;2;248;248;242m{[0m[38;2;255;255;255mDEFAULT_SLEEP_SECONDS[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;189;147;249m5[0m[38;2;248;248;242m}[0m[38;2;241;250;140m seconds...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2168[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] WARNING: Rate limit exceeded! Check API usage/frequency.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2169[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mtime[0m[38;2;255;121;198m.[0m[38;2;80;250;123msleep[0m[38;2;248;248;242m([0m[38;2;255;255;255mDEFAULT_SLEEP_SECONDS[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;189;147;249m5[0m[38;2;248;248;242m)[0m
[38;5;238m2170[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mNetworkError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m2171[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mNetwork error in main loop (Cycle [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcycle_count[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Will retry next cycle.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2172[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mExchangeNotAvailable[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m2173[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mExchange not available (Cycle [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcycle_count[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Sleeping for [0m[38;2;248;248;242m{[0m[38;2;255;255;255mDEFAULT_SLEEP_SECONDS[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;189;147;249m10[0m[38;2;248;248;242m}[0m[38;2;241;250;140m seconds...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2174[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ERROR: Exchange unavailable! ([0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2175[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mtime[0m[38;2;255;121;198m.[0m[38;2;80;250;123msleep[0m[38;2;248;248;242m([0m[38;2;255;255;255mDEFAULT_SLEEP_SECONDS[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;189;147;249m10[0m[38;2;248;248;242m)[0m
[38;5;238m2176[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mAuthenticationError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m2177[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mAuthentication Error encountered in main loop (Cycle [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcycle_count[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. API keys may be invalid or permissions revoked. Stopping bot.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2178[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] CRITICAL: Authentication Error! Bot stopping NOW.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2179[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mrun_bot[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m
[38;5;238m2180[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mExchangeError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m2181[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mUnhandled Exchange error in main loop (Cycle [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcycle_count[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2182[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m2183[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ERROR: Unhandled Exchange error: [0m[38;2;248;248;242m{[0m[38;2;139;233;253mtype[0m[38;2;248;248;242m([0m[38;2;248;248;242me[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;248;248;242m__name__[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Check logs.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2184[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m2185[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mexception[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m!!! UNEXPECTED CRITICAL ERROR in main loop (Cycle [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcycle_count[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m !!![0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2186[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] CRITICAL UNEXPECTED ERROR in main loop: [0m[38;2;248;248;242m{[0m[38;2;139;233;253mtype[0m[38;2;248;248;242m([0m[38;2;248;248;242me[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;248;248;242m__name__[0m[38;2;248;248;242m}[0m[38;2;241;250;140m! Bot stopping NOW.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2187[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mStopping bot due to unexpected critical error.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2188[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mrun_bot[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m
[38;5;238m2189[0m   [38;5;238mâ”‚[0m 
[38;5;238m2190[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Cycle Delay ---[0m
[38;5;238m2191[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mrun_bot[0m[38;2;248;248;242m:[0m
[38;5;238m2192[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mcycle_end_time[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mtime[0m[38;2;255;121;198m.[0m[38;2;80;250;123mmonotonic[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m
[38;5;238m2193[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242melapsed_time[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mcycle_end_time[0m[38;2;248;248;242m [0m[38;2;255;121;198m-[0m[38;2;248;248;242m [0m[38;2;248;248;242mcycle_start_time[0m
[38;5;238m2194[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242msleep_duration[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;139;233;253mmax[0m[38;2;248;248;242m([0m[38;2;189;147;249m0[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mDEFAULT_SLEEP_SECONDS[0m[38;2;248;248;242m [0m[38;2;255;121;198m-[0m[38;2;248;248;242m [0m[38;2;248;248;242melapsed_time[0m[38;2;248;248;242m)[0m
[38;5;238m2195[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mCycle [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcycle_count[0m[38;2;248;248;242m}[0m[38;2;241;250;140m execution time: [0m[38;2;248;248;242m{[0m[38;2;248;248;242melapsed_time[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140ms. Sleeping for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msleep_duration[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140ms.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2196[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242msleep_duration[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m:[0m
[38;5;238m2197[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mtime[0m[38;2;255;121;198m.[0m[38;2;80;250;123msleep[0m[38;2;248;248;242m([0m[38;2;248;248;242msleep_duration[0m[38;2;248;248;242m)[0m
[38;5;238m2198[0m   [38;5;238mâ”‚[0m 
[38;5;238m2199[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mKeyboardInterrupt[0m[38;2;248;248;242m:[0m
[38;5;238m2200[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mShutdown requested via KeyboardInterrupt (Ctrl+C).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2201[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mrun_bot[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m
[38;5;238m2202[0m   [38;5;238mâ”‚[0m 
[38;5;238m2203[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mfinally[0m[38;2;248;248;242m:[0m
[38;5;238m2204[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m--- Initiating Scalping Bot Shutdown Sequence ---[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2205[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Pass exchange and validated symbol if available[0m
[38;5;238m2206[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123mgraceful_shutdown[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m)[0m
[38;5;238m2207[0m   [38;5;238mâ”‚[0m 
[38;5;238m2208[0m   [38;5;238mâ”‚[0m 
[38;5;238m2209[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Script Entry Point ---[0m
[38;5;238m2210[0m   [38;5;238mâ”‚[0m [38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242m__name__[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140m__main__[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m
[38;5;238m2211[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;139;233;253mprint[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m--- Bybit USDT Futures Scalping Bot v1.6.0 ---[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2212[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;139;233;253mprint[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mINFO: Loading configuration from .env file.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2213[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;139;233;253mprint[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mINFO: Ensure API keys (BYBIT_API_KEY, BYBIT_API_SECRET) are set in .env.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2214[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;139;233;253mprint[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mINFO: For SMS alerts, set ENABLE_SMS_ALERTS=true and SMS_RECIPIENT_NUMBER in .env.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2215[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;139;233;253mprint[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mINFO: SMS requires Termux environment with Termux:API installed ('pkg install termux-api') and SMS permission granted.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2216[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;139;233;253mprint[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[93mWARNING: LIVE TRADING IS ACTIVE BY DEFAULT. USE EXTREME CAUTION.[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[0m[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2217[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;139;233;253mprint[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[91m[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[1mCRITICAL: LOOP-BASED SL/TP/TS IS ACTIVE - HIGHLY INACCURATE & UNSAFE FOR LIVE SCALPING.[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[0m[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2218[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;139;233;253mprint[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[91m[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[1mCRITICAL: IMPLEMENT EXCHANGE-NATIVE CONDITIONAL ORDERS FOR SAFE OPERATION.[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[0m[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2219[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;139;233;253mprint[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mINFO: Initial logging level set to: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetLevelName[0m[38;2;248;248;242m([0m[38;2;255;255;255mLOGGING_LEVEL[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m2220[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;139;233;253mprint[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m-[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;189;147;249m40[0m[38;2;248;248;242m)[0m
[38;5;238m2221[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Start the main execution function[0m
[38;5;238m2222[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;80;250;123mmain[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m
[38;5;238mâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[0m
[38;5;238mâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[0m
       [38;5;238mâ”‚ [0mFile: [1mscalp_v1.py[0m
       [38;5;238mâ”‚ [0mSize: [1m113.5 KB[0m
[38;5;238mâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[0m
[38;5;238m   1[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m!/usr/bin/env python[0m
[38;5;238m   2[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m -*- coding: utf-8 -*-[0m
[38;5;238m   3[0m   [38;5;238mâ”‚[0m 
[38;5;238m   4[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m"""[0m
[38;5;238m   5[0m   [38;5;238mâ”‚[0m [38;2;98;114;164mHigh-Frequency Trading Bot (Scalping) for Bybit USDT Futures[0m
[38;5;238m   6[0m   [38;5;238mâ”‚[0m [38;2;98;114;164mVersion: 1.5.1 (Enhanced Readability, Robustness, Type Hinting)[0m
[38;5;238m   7[0m   [38;5;238mâ”‚[0m 
[38;5;238m   8[0m   [38;5;238mâ”‚[0m [38;2;98;114;164mFeatures:[0m
[38;5;238m   9[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- Dual Supertrend strategy with confirmation.[0m
[38;5;238m  10[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- ATR for volatility measurement and Stop-Loss/Take-Profit calculation.[0m
[38;5;238m  11[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- Volume spike analysis (optional confirmation).[0m
[38;5;238m  12[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- Order book pressure analysis (optional confirmation, optimized fetching).[0m
[38;5;238m  13[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- Risk-based position sizing with margin checks.[0m
[38;5;238m  14[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- Termux SMS alerts for critical events.[0m
[38;5;238m  15[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- Robust error handling and logging with color support.[0m
[38;5;238m  16[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- Graceful shutdown on KeyboardInterrupt with position closing attempt.[0m
[38;5;238m  17[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- Stricter position detection logic (targeting Bybit V5 API, checks 'side').[0m
[38;5;238m  18[0m   [38;5;238mâ”‚[0m 
[38;5;238m  19[0m   [38;5;238mâ”‚[0m [38;2;98;114;164mDisclaimer:[0m
[38;5;238m  20[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- **EXTREME RISK**: This software is for educational purposes ONLY. Scalping bots are[0m
[38;5;238m  21[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m  extremely high-risk due to market noise, latency, slippage, fees, and the[0m
[38;5;238m  22[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m  critical need for precise, low-latency execution. Use at your own absolute risk.[0m
[38;5;238m  23[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- **CRITICAL SL/TP LIMITATION (LOOP-BASED CHECK)**: The Stop-Loss/Take-Profit mechanism[0m
[38;5;238m  24[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m  in this version uses a loop-based check *after* the candle closes. This is[0m
[38;5;238m  25[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m  **HIGHLY INACCURATE AND UNSAFE** for live scalping. Price can move significantly[0m
[38;5;238m  26[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m  beyond calculated levels before the bot reacts in the next cycle. For real[0m
[38;5;238m  27[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m  scalping, you **MUST** implement exchange-native conditional orders[0m
[38;5;238m  28[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m  (e.g., stopMarket, takeProfitMarket using `exchange.create_order` with appropriate[0m
[38;5;238m  29[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m  `stopLossPrice` / `takeProfitPrice` params) placed *immediately* after entry[0m
[38;5;238m  30[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m  confirmation, ideally based on the actual fill price.[0m
[38;5;238m  31[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- Parameter Sensitivity: Bot performance is highly dependent on parameter tuning.[0m
[38;5;238m  32[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m  Requires significant backtesting and forward testing. Defaults are illustrative.[0m
[38;5;238m  33[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- API Rate Limits: Frequent API calls can hit exchange rate limits. Monitor usage.[0m
[38;5;238m  34[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- Slippage: Market orders used for entry/exit are prone to slippage, especially[0m
[38;5;238m  35[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m  during volatile periods.[0m
[38;5;238m  36[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- Test Thoroughly: **DO NOT RUN LIVE WITHOUT EXTENSIVE TESTNET/DEMO TESTING.**[0m
[38;5;238m  37[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- Termux Dependency: SMS alerts require running within Termux on Android with[0m
[38;5;238m  38[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m  Termux:API installed (`pkg install termux-api`) and configured (SMS permissions).[0m
[38;5;238m  39[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- API Changes: Exchange APIs (like Bybit V3 vs V5) can change. This code targets[0m
[38;5;238m  40[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m  structures observed in V5 via CCXT, but updates may be needed.[0m
[38;5;238m  41[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m"""[0m
[38;5;238m  42[0m   [38;5;238mâ”‚[0m 
[38;5;238m  43[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m Standard Library Imports[0m
[38;5;238m  44[0m   [38;5;238mâ”‚[0m [38;2;255;121;198mimport[0m[38;2;248;248;242m [0m[38;2;248;248;242mlogging[0m
[38;5;238m  45[0m   [38;5;238mâ”‚[0m [38;2;255;121;198mimport[0m[38;2;248;248;242m [0m[38;2;248;248;242mos[0m
[38;5;238m  46[0m   [38;5;238mâ”‚[0m [38;2;255;121;198mimport[0m[38;2;248;248;242m [0m[38;2;248;248;242msys[0m
[38;5;238m  47[0m   [38;5;238mâ”‚[0m [38;2;255;121;198mimport[0m[38;2;248;248;242m [0m[38;2;248;248;242mtime[0m
[38;5;238m  48[0m   [38;5;238mâ”‚[0m [38;2;255;121;198mimport[0m[38;2;248;248;242m [0m[38;2;248;248;242mtraceback[0m
[38;5;238m  49[0m   [38;5;238mâ”‚[0m [38;2;255;121;198mimport[0m[38;2;248;248;242m [0m[38;2;248;248;242msubprocess[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m For Termux API calls[0m
[38;5;238m  50[0m   [38;5;238mâ”‚[0m [38;2;255;121;198mfrom[0m[38;2;248;248;242m [0m[38;2;248;248;242mtyping[0m[38;2;248;248;242m [0m[38;2;255;121;198mimport[0m[38;2;248;248;242m [0m[38;2;248;248;242mDict[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mAny[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mTuple[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mList[0m
[38;5;238m  51[0m   [38;5;238mâ”‚[0m 
[38;5;238m  52[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m Third-party Libraries[0m
[38;5;238m  53[0m   [38;5;238mâ”‚[0m [38;2;255;121;198mimport[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m
[38;5;238m  54[0m   [38;5;238mâ”‚[0m [38;2;255;121;198mimport[0m[38;2;248;248;242m [0m[38;2;248;248;242mpandas[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m
[38;5;238m  55[0m   [38;5;238mâ”‚[0m [38;2;255;121;198mfrom[0m[38;2;248;248;242m [0m[38;2;248;248;242mdotenv[0m[38;2;248;248;242m [0m[38;2;255;121;198mimport[0m[38;2;248;248;242m [0m[38;2;248;248;242mload_dotenv[0m
[38;5;238m  56[0m   [38;5;238mâ”‚[0m 
[38;5;238m  57[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Configuration Loading ---[0m
[38;5;238m  58[0m   [38;5;238mâ”‚[0m [38;2;80;250;123mload_dotenv[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Load variables from .env file into environment variables[0m
[38;5;238m  59[0m   [38;5;238mâ”‚[0m 
[38;5;238m  60[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Constants ---[0m
[38;5;238m  61[0m   [38;5;238mâ”‚[0m 
[38;5;238m  62[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- API Credentials (Required in .env) ---[0m
[38;5;238m  63[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mBYBIT_API_KEY[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mBYBIT_API_KEY[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m  64[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mBYBIT_API_SECRET[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mBYBIT_API_SECRET[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m  65[0m   [38;5;238mâ”‚[0m 
[38;5;238m  66[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Trading Parameters (Set Defaults, Override in .env) ---[0m
[38;5;238m  67[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mDEFAULT_SYMBOL[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mSYMBOL[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mBTC/USDT:USDT[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m CCXT unified symbol format[0m
[38;5;238m  68[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mDEFAULT_INTERVAL[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mINTERVAL[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140m1m[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Timeframe (e.g., '1m', '5m')[0m
[38;5;238m  69[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mDEFAULT_LEVERAGE[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mLEVERAGE[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m10[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Desired leverage[0m
[38;5;238m  70[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mDEFAULT_SLEEP_SECONDS[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mSLEEP_SECONDS[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m10[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Pause between cycles[0m
[38;5;238m  71[0m   [38;5;238mâ”‚[0m 
[38;5;238m  72[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Risk Management (CRITICAL - TUNE CAREFULLY!) ---[0m
[38;5;238m  73[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mRISK_PER_TRADE_PERCENTAGE[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mRISK_PER_TRADE_PERCENTAGE[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m005[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m 0.5% risk per trade based on equity[0m
[38;5;238m  74[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mATR_STOP_LOSS_MULTIPLIER[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mATR_STOP_LOSS_MULTIPLIER[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m[38;2;189;147;249m.[0m[38;2;189;147;249m5[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Multiplier for ATR to set SL distance[0m
[38;5;238m  75[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mATR_TAKE_PROFIT_MULTIPLIER[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mATR_TAKE_PROFIT_MULTIPLIER[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m2[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Multiplier for ATR to set TP distance[0m
[38;5;238m  76[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mMAX_ORDER_USDT_AMOUNT[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mMAX_ORDER_USDT_AMOUNT[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m500[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Maximum position size in USDT value[0m
[38;5;238m  77[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mREQUIRED_MARGIN_BUFFER[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mREQUIRED_MARGIN_BUFFER[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m[38;2;189;147;249m.[0m[38;2;189;147;249m05[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Margin check buffer (e.g., 1.05 = requires 5% extra free margin)[0m
[38;5;238m  78[0m   [38;5;238mâ”‚[0m 
[38;5;238m  79[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Supertrend Indicator Parameters ---[0m
[38;5;238m  80[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mDEFAULT_ST_ATR_LENGTH[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mST_ATR_LENGTH[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m7[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Primary Supertrend ATR period[0m
[38;5;238m  81[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mDEFAULT_ST_MULTIPLIER[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mST_MULTIPLIER[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m2[0m[38;2;189;147;249m.[0m[38;2;189;147;249m5[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Primary Supertrend ATR multiplier[0m
[38;5;238m  82[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mCONFIRM_ST_ATR_LENGTH[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mCONFIRM_ST_ATR_LENGTH[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m5[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Confirmation Supertrend ATR period[0m
[38;5;238m  83[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mCONFIRM_ST_MULTIPLIER[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mCONFIRM_ST_MULTIPLIER[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m2[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Confirmation Supertrend ATR multiplier[0m
[38;5;238m  84[0m   [38;5;238mâ”‚[0m 
[38;5;238m  85[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Volume Analysis Parameters ---[0m
[38;5;238m  86[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mVOLUME_MA_PERIOD[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mVOLUME_MA_PERIOD[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m20[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Moving average period for volume[0m
[38;5;238m  87[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mVOLUME_SPIKE_THRESHOLD[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mVOLUME_SPIKE_THRESHOLD[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m[38;2;189;147;249m.[0m[38;2;189;147;249m5[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Volume must be > this * MA for a spike[0m
[38;5;238m  88[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mREQUIRE_VOLUME_SPIKE_FOR_ENTRY[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mbool[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mREQUIRE_VOLUME_SPIKE_FOR_ENTRY[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mtrue[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mlower[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mtrue[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Require volume spike for entry signal[0m
[38;5;238m  89[0m   [38;5;238mâ”‚[0m 
[38;5;238m  90[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Order Book Analysis Parameters ---[0m
[38;5;238m  91[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mORDER_BOOK_DEPTH[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mORDER_BOOK_DEPTH[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m10[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Levels of bids/asks to analyze[0m
[38;5;238m  92[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mORDER_BOOK_RATIO_THRESHOLD_LONG[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mORDER_BOOK_RATIO_THRESHOLD_LONG[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m[38;2;189;147;249m.[0m[38;2;189;147;249m2[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Bid/Ask volume ratio must be >= this for long confirmation[0m
[38;5;238m  93[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mORDER_BOOK_RATIO_THRESHOLD_SHORT[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mORDER_BOOK_RATIO_THRESHOLD_SHORT[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m8[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Bid/Ask volume ratio must be <= this for short confirmation[0m
[38;5;238m  94[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mFETCH_ORDER_BOOK_PER_CYCLE[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mbool[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mFETCH_ORDER_BOOK_PER_CYCLE[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mfalse[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mlower[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mtrue[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Fetch OB every cycle (costly) or only on potential signals[0m
[38;5;238m  95[0m   [38;5;238mâ”‚[0m 
[38;5;238m  96[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- ATR Calculation Parameter (for SL/TP) ---[0m
[38;5;238m  97[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mATR_CALCULATION_PERIOD[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mATR_CALCULATION_PERIOD[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m14[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m ATR period used specifically for SL/TP calculation[0m
[38;5;238m  98[0m   [38;5;238mâ”‚[0m 
[38;5;238m  99[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Termux SMS Alert Configuration (Set in .env) ---[0m
[38;5;238m 100[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mENABLE_SMS_ALERTS[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mbool[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mENABLE_SMS_ALERTS[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mfalse[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mlower[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mtrue[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Master switch for SMS alerts[0m
[38;5;238m 101[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mSMS_RECIPIENT_NUMBER[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mSMS_RECIPIENT_NUMBER[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Phone number to send alerts to[0m
[38;5;238m 102[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mSMS_TIMEOUT_SECONDS[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mSMS_TIMEOUT_SECONDS[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m30[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Timeout for the termux-sms-send command[0m
[38;5;238m 103[0m   [38;5;238mâ”‚[0m 
[38;5;238m 104[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- CCXT / API Parameters ---[0m
[38;5;238m 105[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mDEFAULT_RECV_WINDOW[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249m10000[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m API receive window (milliseconds)[0m
[38;5;238m 106[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mORDER_BOOK_FETCH_LIMIT[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;139;233;253mmax[0m[38;2;248;248;242m([0m[38;2;189;147;249m25[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mORDER_BOOK_DEPTH[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m How many OB levels to fetch (API often requires min 25/50/100)[0m
[38;5;238m 107[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mSHALLOW_OB_FETCH_DEPTH[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249m5[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Depth for quick best bid/ask fetch for entry price estimate[0m
[38;5;238m 108[0m   [38;5;238mâ”‚[0m 
[38;5;238m 109[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Internal Constants ---[0m
[38;5;238m 110[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mSIDE_BUY[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mbuy[0m[38;2;241;250;140m"[0m
[38;5;238m 111[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mSIDE_SELL[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140msell[0m[38;2;241;250;140m"[0m
[38;5;238m 112[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mPOSITION_SIDE_LONG[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mLong[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Internal representation for long position[0m
[38;5;238m 113[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mPOSITION_SIDE_SHORT[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mShort[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Internal representation for short position[0m
[38;5;238m 114[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mPOSITION_SIDE_NONE[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mNone[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Internal representation for no position[0m
[38;5;238m 115[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mUSDT_SYMBOL[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mUSDT[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Base currency symbol for balance checks[0m
[38;5;238m 116[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mRETRY_COUNT[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249m3[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Number of retries for certain API calls (e.g., leverage setting)[0m
[38;5;238m 117[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mRETRY_DELAY_SECONDS[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Delay between retries[0m
[38;5;238m 118[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mAPI_FETCH_LIMIT_BUFFER[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249m5[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Fetch slightly more OHLCV data than strictly needed for indicator calculation buffer[0m
[38;5;238m 119[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mPOSITION_QTY_EPSILON[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249m1e-9[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Small value for floating point comparisons (e.g., checking if quantity is effectively zero)[0m
[38;5;238m 120[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mPOST_CLOSE_DELAY_SECONDS[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249m2[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Brief delay after closing a position before potentially opening a new one[0m
[38;5;238m 121[0m   [38;5;238mâ”‚[0m 
[38;5;238m 122[0m   [38;5;238mâ”‚[0m 
[38;5;238m 123[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Logger Setup ---[0m
[38;5;238m 124[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m ---> SET TO DEBUG FOR DETAILED TROUBLESHOOTING <---[0m
[38;5;238m 125[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m ---> REMEMBER TO SET BACK TO INFO FOR NORMAL OPERATION <---[0m
[38;5;238m 126[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mLOGGING_LEVEL[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;255;255;255mINFO[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Default level[0m
[38;5;238m 127[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m LOGGING_LEVEL = logging.DEBUG # Uncomment for verbose debugging[0m
[38;5;238m 128[0m   [38;5;238mâ”‚[0m [38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123mbasicConfig[0m[38;2;248;248;242m([0m
[38;5;238m 129[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mlevel[0m[38;2;255;121;198m=[0m[38;2;255;255;255mLOGGING_LEVEL[0m[38;2;248;248;242m,[0m
[38;5;238m 130[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mformat[0m[38;2;255;121;198m=[0m[38;2;241;250;140m"[0m[38;2;189;147;249m%([0m[38;2;255;255;255masctime[0m[38;2;189;147;249m)s[0m[38;2;241;250;140m [[0m[38;2;189;147;249m%([0m[38;2;255;255;255mlevelname[0m[38;2;189;147;249m)s[0m[38;2;241;250;140m] [0m[38;2;189;147;249m%([0m[38;2;255;255;255mmessage[0m[38;2;189;147;249m)s[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m
[38;5;238m 131[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mdatefmt[0m[38;2;255;121;198m=[0m[38;2;241;250;140m"[0m[38;2;189;147;249m%Y[0m[38;2;241;250;140m-[0m[38;2;189;147;249m%m[0m[38;2;241;250;140m-[0m[38;2;189;147;249m%d[0m[38;2;241;250;140m [0m[38;2;189;147;249m%H[0m[38;2;241;250;140m:[0m[38;2;189;147;249m%M[0m[38;2;241;250;140m:[0m[38;2;189;147;249m%S[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m
[38;5;238m 132[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mhandlers[0m[38;2;255;121;198m=[0m[38;2;248;248;242m[[0m
[38;5;238m 133[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m logging.FileHandler("scalp_bot.log"), # Optional: Log to file[0m
[38;5;238m 134[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123mStreamHandler[0m[38;2;248;248;242m([0m[38;2;248;248;242msys[0m[38;2;255;121;198m.[0m[38;2;248;248;242mstdout[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log to console[0m
[38;5;238m 135[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242m][0m
[38;5;238m 136[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m)[0m
[38;5;238m 137[0m   [38;5;238mâ”‚[0m [38;2;248;248;242mlogger[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;248;248;242mLogger[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetLogger[0m[38;2;248;248;242m([0m[38;2;248;248;242m__name__[0m[38;2;248;248;242m)[0m
[38;5;238m 138[0m   [38;5;238mâ”‚[0m 
[38;5;238m 139[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m Custom SUCCESS level and color formatting[0m
[38;5;238m 140[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mSUCCESS_LEVEL[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249m25[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Between INFO and WARNING[0m
[38;5;238m 141[0m   [38;5;238mâ”‚[0m [38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123maddLevelName[0m[38;2;248;248;242m([0m[38;2;255;255;255mSUCCESS_LEVEL[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mSUCCESS[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 142[0m   [38;5;238mâ”‚[0m 
[38;5;238m 143[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123mlog_success[0m[38;2;248;248;242m([0m[3;38;2;255;184;108mself[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mmessage[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[3;38;2;255;184;108margs[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;121;198m**[0m[3;38;2;255;184;108mkwargs[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 144[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m[38;2;98;114;164mAdds a 'success' log level method to the Logger class.[0m[38;2;98;114;164m"""[0m
[38;5;238m 145[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;189;147;249mself[0m[38;2;255;121;198m.[0m[38;2;80;250;123misEnabledFor[0m[38;2;248;248;242m([0m[38;2;255;255;255mSUCCESS_LEVEL[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 146[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m pylint: disable=protected-access[0m
[38;5;238m 147[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;189;147;249mself[0m[38;2;255;121;198m.[0m[38;2;80;250;123m_log[0m[38;2;248;248;242m([0m[38;2;255;255;255mSUCCESS_LEVEL[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mmessage[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242margs[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;121;198m**[0m[38;2;248;248;242mkwargs[0m[38;2;248;248;242m)[0m
[38;5;238m 148[0m   [38;5;238mâ”‚[0m 
[38;5;238m 149[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m Bind the new method to the Logger class[0m
[38;5;238m 150[0m   [38;5;238mâ”‚[0m [38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;248;248;242mLogger[0m[38;2;255;121;198m.[0m[38;2;248;248;242msuccess[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlog_success[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m type: ignore[0m
[38;5;238m 151[0m   [38;5;238mâ”‚[0m 
[38;5;238m 152[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m ANSI escape codes for colored logging output (adjust based on terminal support)[0m
[38;5;238m 153[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m Check if the output stream is a TTY (terminal) before adding colors[0m
[38;5;238m 154[0m   [38;5;238mâ”‚[0m [38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242msys[0m[38;2;255;121;198m.[0m[38;2;248;248;242mstdout[0m[38;2;255;121;198m.[0m[38;2;80;250;123misatty[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 155[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123maddLevelName[0m[38;2;248;248;242m([0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;255;255;255mDEBUG[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[90m[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetLevelName[0m[38;2;248;248;242m([0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;255;255;255mDEBUG[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[0m[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Gray[0m
[38;5;238m 156[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123maddLevelName[0m[38;2;248;248;242m([0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;255;255;255mINFO[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[96m[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetLevelName[0m[38;2;248;248;242m([0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;255;255;255mINFO[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[0m[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Cyan[0m
[38;5;238m 157[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123maddLevelName[0m[38;2;248;248;242m([0m[38;2;255;255;255mSUCCESS_LEVEL[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[92m[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetLevelName[0m[38;2;248;248;242m([0m[38;2;255;255;255mSUCCESS_LEVEL[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[0m[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Green[0m
[38;5;238m 158[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123maddLevelName[0m[38;2;248;248;242m([0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;255;255;255mWARNING[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[93m[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetLevelName[0m[38;2;248;248;242m([0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;255;255;255mWARNING[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[0m[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Yellow[0m
[38;5;238m 159[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123maddLevelName[0m[38;2;248;248;242m([0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;255;255;255mERROR[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[91m[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetLevelName[0m[38;2;248;248;242m([0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;255;255;255mERROR[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[0m[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Red[0m
[38;5;238m 160[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123maddLevelName[0m[38;2;248;248;242m([0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;255;255;255mCRITICAL[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[91m[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[1m[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetLevelName[0m[38;2;248;248;242m([0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;255;255;255mCRITICAL[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[0m[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Bold Red[0m
[38;5;238m 161[0m   [38;5;238mâ”‚[0m 
[38;5;238m 162[0m   [38;5;238mâ”‚[0m 
[38;5;238m 163[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Termux SMS Alert Function ---[0m
[38;5;238m 164[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;255;184;108mmessage[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;248;248;242m->[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mbool[0m[38;2;248;248;242m:[0m
[38;5;238m 165[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 166[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Sends an SMS alert using the 'termux-sms-send' command via subprocess.[0m
[38;5;238m 167[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Requires Termux and Termux:API with SMS permissions granted.[0m
[38;5;238m 168[0m   [38;5;238mâ”‚[0m 
[38;5;238m 169[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Args:[0m
[38;5;238m 170[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        message (str): The text message content to send.[0m
[38;5;238m 171[0m   [38;5;238mâ”‚[0m 
[38;5;238m 172[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Returns:[0m
[38;5;238m 173[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        bool: True if the command executed successfully (return code 0),[0m
[38;5;238m 174[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m              False otherwise (config disabled, missing number, command error, timeout).[0m
[38;5;238m 175[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m              Note: True only means the command ran successfully, not guaranteed SMS delivery.[0m
[38;5;238m 176[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 177[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;255;255;255mENABLE_SMS_ALERTS[0m[38;2;248;248;242m:[0m
[38;5;238m 178[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mSMS alerts disabled via configuration.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 179[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m
[38;5;238m 180[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;255;255;255mSMS_RECIPIENT_NUMBER[0m[38;2;248;248;242m:[0m
[38;5;238m 181[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mSMS alerts enabled, but SMS_RECIPIENT_NUMBER not set in .env file.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 182[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m
[38;5;238m 183[0m   [38;5;238mâ”‚[0m 
[38;5;238m 184[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m 185[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Command arguments: send SMS (-n recipient_number) with the message content[0m
[38;5;238m 186[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m No complex shell injection risk here with direct message content, shlex not strictly needed[0m
[38;5;238m 187[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mcommand[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mList[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mtermux-sms-send[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140m-n[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mSMS_RECIPIENT_NUMBER[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mmessage[0m[38;2;248;248;242m][0m
[38;5;238m 188[0m   [38;5;238mâ”‚[0m 
[38;5;238m 189[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mAttempting to send SMS alert to [0m[38;2;248;248;242m{[0m[38;2;255;255;255mSMS_RECIPIENT_NUMBER[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (Timeout: [0m[38;2;248;248;242m{[0m[38;2;255;255;255mSMS_TIMEOUT_SECONDS[0m[38;2;248;248;242m}[0m[38;2;241;250;140ms)...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 190[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mExecuting command: [0m[38;2;248;248;242m{[0m[38;2;241;250;140m'[0m[38;2;241;250;140m [0m[38;2;241;250;140m'[0m[38;2;255;121;198m.[0m[38;2;80;250;123mjoin[0m[38;2;248;248;242m([0m[38;2;248;248;242mcommand[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log the command for debugging[0m
[38;5;238m 191[0m   [38;5;238mâ”‚[0m 
[38;5;238m 192[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mresult[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242msubprocess[0m[38;2;255;121;198m.[0m[38;2;80;250;123mrun[0m[38;2;248;248;242m([0m
[38;5;238m 193[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mcommand[0m[38;2;248;248;242m,[0m
[38;5;238m 194[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mcapture_output[0m[38;2;255;121;198m=[0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Capture stdout/stderr[0m
[38;5;238m 195[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mtext[0m[38;2;255;121;198m=[0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Decode stdout/stderr as text[0m
[38;5;238m 196[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mcheck[0m[38;2;255;121;198m=[0m[38;2;189;147;249mFalse[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Do not raise exception on non-zero exit, check manually[0m
[38;5;238m 197[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mtimeout[0m[38;2;255;121;198m=[0m[38;2;255;255;255mSMS_TIMEOUT_SECONDS[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Set a timeout for the command[0m
[38;5;238m 198[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242m)[0m
[38;5;238m 199[0m   [38;5;238mâ”‚[0m 
[38;5;238m 200[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mresult[0m[38;2;255;121;198m.[0m[38;2;248;248;242mreturncode[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m:[0m
[38;5;238m 201[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123msuccess[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTermux API command for SMS to [0m[38;2;248;248;242m{[0m[38;2;255;255;255mSMS_RECIPIENT_NUMBER[0m[38;2;248;248;242m}[0m[38;2;241;250;140m executed successfully.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 202[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m
[38;5;238m 203[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m 204[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log detailed error information if the command failed[0m
[38;5;238m 205[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTermux API command 'termux-sms-send' failed. Return code: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mresult[0m[38;2;255;121;198m.[0m[38;2;248;248;242mreturncode[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 206[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mresult[0m[38;2;255;121;198m.[0m[38;2;248;248;242mstderr[0m[38;2;248;248;242m:[0m
[38;5;238m 207[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTermux API Stderr: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mresult[0m[38;2;255;121;198m.[0m[38;2;248;248;242mstderr[0m[38;2;255;121;198m.[0m[38;2;80;250;123mstrip[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 208[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mresult[0m[38;2;255;121;198m.[0m[38;2;248;248;242mstdout[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Sometimes error info might be on stdout[0m
[38;5;238m 209[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTermux API Stdout: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mresult[0m[38;2;255;121;198m.[0m[38;2;248;248;242mstdout[0m[38;2;255;121;198m.[0m[38;2;80;250;123mstrip[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 210[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mPotential issues: SMS permissions not granted in Android settings for Termux:API, [0m[38;2;241;250;140m"[0m
[38;5;238m 211[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                         [0m[38;2;241;250;140m"[0m[38;2;241;250;140mTermux:API app not running or installed, incorrect recipient number format, [0m[38;2;241;250;140m"[0m
[38;5;238m 212[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                         [0m[38;2;241;250;140m"[0m[38;2;241;250;140mAndroid battery optimization interfering with Termux.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 213[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m
[38;5;238m 214[0m   [38;5;238mâ”‚[0m 
[38;5;238m 215[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mFileNotFoundError[0m[38;2;248;248;242m:[0m
[38;5;238m 216[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mFailed to send SMS: 'termux-sms-send' command not found. [0m[38;2;241;250;140m"[0m
[38;5;238m 217[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                     [0m[38;2;241;250;140m"[0m[38;2;241;250;140mEnsure Termux:API package is installed (`pkg install termux-api`) and the Termux:API app is running.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 218[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m
[38;5;238m 219[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242msubprocess[0m[38;2;248;248;242m.[0m[38;2;248;248;242mTimeoutExpired[0m[38;2;248;248;242m:[0m
[38;5;238m 220[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mFailed to send SMS: 'termux-sms-send' command timed out after [0m[38;2;248;248;242m{[0m[38;2;255;255;255mSMS_TIMEOUT_SECONDS[0m[38;2;248;248;242m}[0m[38;2;241;250;140m seconds. [0m[38;2;241;250;140m"[0m
[38;5;238m 221[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                     [0m[38;2;241;250;140m"[0m[38;2;241;250;140mCheck Termux:API service status, permissions, and Android battery optimization settings.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 222[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m
[38;5;238m 223[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 224[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mAn unexpected error occurred while sending SMS via Termux API: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 225[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log full traceback for unexpected errors[0m
[38;5;238m 226[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m
[38;5;238m 227[0m   [38;5;238mâ”‚[0m 
[38;5;238m 228[0m   [38;5;238mâ”‚[0m 
[38;5;238m 229[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Exchange Initialization ---[0m
[38;5;238m 230[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123minitialize_exchange[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;248;248;242m->[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[38;2;248;248;242mccxt[0m[38;2;255;121;198m.[0m[38;2;248;248;242mExchange[0m[38;2;248;248;242m][0m[38;2;248;248;242m:[0m
[38;5;238m 231[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 232[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Initializes and returns the CCXT Bybit exchange instance.[0m
[38;5;238m 233[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Performs connectivity/authentication checks and sends SMS alerts.[0m
[38;5;238m 234[0m   [38;5;238mâ”‚[0m 
[38;5;238m 235[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Returns:[0m
[38;5;238m 236[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        Optional[ccxt.Exchange]: Initialized exchange object or None on failure.[0m
[38;5;238m 237[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 238[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mInitializing CCXT Bybit connection...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 239[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;255;255;255mBYBIT_API_KEY[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;255;255;255mBYBIT_API_SECRET[0m[38;2;248;248;242m:[0m
[38;5;238m 240[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mCRITICAL: BYBIT_API_KEY and/or BYBIT_API_SECRET missing in .env file.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 241[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m[ScalpBot] CRITICAL: API keys missing in .env. Bot stopped.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 242[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 243[0m   [38;5;238mâ”‚[0m 
[38;5;238m 244[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m 245[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;255;121;198m.[0m[38;2;80;250;123mbybit[0m[38;2;248;248;242m([0m
[38;5;238m 246[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242m{[0m
[38;5;238m 247[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;241;250;140m"[0m[38;2;241;250;140mapiKey[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;255;255;255mBYBIT_API_KEY[0m[38;2;248;248;242m,[0m
[38;5;238m 248[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;241;250;140m"[0m[38;2;241;250;140msecret[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;255;255;255mBYBIT_API_SECRET[0m[38;2;248;248;242m,[0m
[38;5;238m 249[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;241;250;140m"[0m[38;2;241;250;140menableRateLimit[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Enable CCXT's built-in rate limiter[0m
[38;5;238m 250[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;241;250;140m"[0m[38;2;241;250;140moptions[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m
[38;5;238m 251[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;241;250;140m"[0m[38;2;241;250;140mdefaultType[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mlinear[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Crucial: Use 'linear' for USDT Perpetual, 'inverse' for inverse contracts[0m
[38;5;238m 252[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;241;250;140m"[0m[38;2;241;250;140mrecvWindow[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;255;255;255mDEFAULT_RECV_WINDOW[0m[38;2;248;248;242m,[0m
[38;5;238m 253[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m 'adjustForTimeDifference': True, # Consider if clock skew issues arise[0m
[38;5;238m 254[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m 'verbose': True, # Uncomment for extremely detailed API request/response logging[0m
[38;5;238m 255[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242m}[0m[38;2;248;248;242m,[0m
[38;5;238m 256[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242m}[0m
[38;5;238m 257[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242m)[0m
[38;5;238m 258[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Test connection and authentication by fetching markets and balance[0m
[38;5;238m 259[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mLoading markets...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 260[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mload_markets[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m
[38;5;238m 261[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mFetching balance (tests authentication)...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 262[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mfetch_balance[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Throws AuthenticationError on bad keys[0m
[38;5;238m 263[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mCCXT Bybit Session Initialized (LIVE FUTURES SCALPING MODE - EXTREME CAUTION!).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 264[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m[ScalpBot] Initialized successfully and authenticated.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 265[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m
[38;5;238m 266[0m   [38;5;238mâ”‚[0m 
[38;5;238m 267[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mAuthenticationError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 268[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mAuthentication failed: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Check API key/secret and ensure IP whitelist (if used) is correct and API permissions are sufficient.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 269[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[ScalpBot] CRITICAL: Authentication FAILED: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Bot stopped.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 270[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mNetworkError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 271[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mNetwork error during initialization: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Check internet connection and Bybit status.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 272[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[ScalpBot] CRITICAL: Network Error on Init: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Bot stopped.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 273[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mExchangeError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 274[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mExchange error during initialization: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Check Bybit status page or API documentation for details.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 275[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[ScalpBot] CRITICAL: Exchange Error on Init: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Bot stopped.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 276[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 277[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mFailed to initialize exchange due to an unexpected error: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 278[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m 279[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[ScalpBot] CRITICAL: Unexpected Init Error: [0m[38;2;248;248;242m{[0m[38;2;139;233;253mtype[0m[38;2;248;248;242m([0m[38;2;248;248;242me[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;248;248;242m__name__[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Bot stopped.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 280[0m   [38;5;238mâ”‚[0m 
[38;5;238m 281[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 282[0m   [38;5;238mâ”‚[0m 
[38;5;238m 283[0m   [38;5;238mâ”‚[0m 
[38;5;238m 284[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Indicator Calculation ---[0m
[38;5;238m 285[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123mcalculate_supertrend[0m[38;2;248;248;242m([0m
[38;5;238m 286[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mdf[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;248;248;242mDataFrame[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mlength[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mmultiplier[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mprefix[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140m"[0m
[38;5;238m 287[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;248;248;242m->[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;248;248;242mDataFrame[0m[38;2;248;248;242m:[0m
[38;5;238m 288[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 289[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Calculates the Supertrend indicator using the pandas_ta library.[0m
[38;5;238m 290[0m   [38;5;238mâ”‚[0m 
[38;5;238m 291[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Args:[0m
[38;5;238m 292[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        df (pd.DataFrame): Input DataFrame with 'high', 'low', 'close' columns.[0m
[38;5;238m 293[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        length (int): The ATR lookback period for Supertrend.[0m
[38;5;238m 294[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        multiplier (float): The ATR multiplier for Supertrend.[0m
[38;5;238m 295[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        prefix (str): Optional prefix for the generated columns (e.g., "confirm_").[0m
[38;5;238m 296[0m   [38;5;238mâ”‚[0m 
[38;5;238m 297[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Returns:[0m
[38;5;238m 298[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        pd.DataFrame: DataFrame with added Supertrend columns:[0m
[38;5;238m 299[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m                      '{prefix}supertrend' (the Supertrend line value),[0m
[38;5;238m 300[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m                      '{prefix}trend' (boolean, True if trend is up),[0m
[38;5;238m 301[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m                      '{prefix}st_long' (boolean, True on the candle the trend flipped UP),[0m
[38;5;238m 302[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m                      '{prefix}st_short' (boolean, True on the candle the trend flipped DOWN).[0m
[38;5;238m 303[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m                      Returns original DataFrame with NA columns if calculation fails.[0m
[38;5;238m 304[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 305[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mprefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mprefix[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140m"[0m
[38;5;238m 306[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Define the target column names we want to keep[0m
[38;5;238m 307[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mtarget_cols[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m[[0m
[38;5;238m 308[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140msupertrend[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m
[38;5;238m 309[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140mtrend[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m
[38;5;238m 310[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140mst_long[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m
[38;5;238m 311[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140mst_short[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m
[38;5;238m 312[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242m][0m
[38;5;238m 313[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Define the raw column names expected from pandas_ta based on its naming convention[0m
[38;5;238m 314[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mst_col_name[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSUPERT_[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlength[0m[38;2;248;248;242m}[0m[38;2;241;250;140m_[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmultiplier[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Supertrend line value[0m
[38;5;238m 315[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mst_trend_col[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSUPERTd_[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlength[0m[38;2;248;248;242m}[0m[38;2;241;250;140m_[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmultiplier[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Trend direction (-1 down, 1 up)[0m
[38;5;238m 316[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mst_long_col[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSUPERTl_[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlength[0m[38;2;248;248;242m}[0m[38;2;241;250;140m_[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmultiplier[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Lower band value (used when trend is up)[0m
[38;5;238m 317[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mst_short_col[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSUPERTs_[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlength[0m[38;2;248;248;242m}[0m[38;2;241;250;140m_[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmultiplier[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;98;114;164m#[0m[38;2;98;114;164m Upper band value (used when trend is down)[0m
[38;5;238m 318[0m   [38;5;238mâ”‚[0m 
[38;5;238m 319[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Input validation[0m
[38;5;238m 320[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mrequired_input_cols[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mhigh[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mlow[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mclose[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m
[38;5;238m 321[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mempty[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;139;233;253mall[0m[38;2;248;248;242m([0m[38;2;248;248;242mc[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mcolumns[0m[38;2;248;248;242m [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mc[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mrequired_input_cols[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 322[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140mSupertrend): Input DataFrame is missing required columns [0m[38;2;248;248;242m{[0m[38;2;248;248;242mrequired_input_cols[0m[38;2;248;248;242m}[0m[38;2;241;250;140m or is empty.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 323[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mcol[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mtarget_cols[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mcol[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;255;255;255mNA[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Add NA columns if they don't exist[0m
[38;5;238m 324[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m
[38;5;238m 325[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;139;233;253mlen[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;248;248;242mlength[0m[38;2;248;248;242m:[0m
[38;5;238m 326[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140mSupertrend): DataFrame length ([0m[38;2;248;248;242m{[0m[38;2;139;233;253mlen[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) is less than ST period ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mlength[0m[38;2;248;248;242m}[0m[38;2;241;250;140m).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 327[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mcol[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mtarget_cols[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mcol[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;255;255;255mNA[0m
[38;5;238m 328[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m
[38;5;238m 329[0m   [38;5;238mâ”‚[0m 
[38;5;238m 330[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m 331[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Calculate Supertrend using pandas_ta, appending results to the DataFrame[0m
[38;5;238m 332[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mta[0m[38;2;255;121;198m.[0m[38;2;80;250;123msupertrend[0m[38;2;248;248;242m([0m[3;38;2;255;184;108mlength[0m[38;2;255;121;198m=[0m[38;2;248;248;242mlength[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mmultiplier[0m[38;2;255;121;198m=[0m[38;2;248;248;242mmultiplier[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mappend[0m[38;2;255;121;198m=[0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m)[0m
[38;5;238m 333[0m   [38;5;238mâ”‚[0m 
[38;5;238m 334[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Verify that the expected raw columns were created[0m
[38;5;238m 335[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mst_col_name[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mcolumns[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mst_trend_col[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mcolumns[0m[38;2;248;248;242m:[0m
[38;5;238m 336[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;255;121;198mraise[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mKeyError[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mpandas_ta failed to create expected raw columns: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mst_col_name[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, [0m[38;2;248;248;242m{[0m[38;2;248;248;242mst_trend_col[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 337[0m   [38;5;238mâ”‚[0m 
[38;5;238m 338[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Process and Rename Columns ---[0m
[38;5;238m 339[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m 1. Rename the main Supertrend value column[0m
[38;5;238m 340[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140msupertrend[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mst_col_name[0m[38;2;248;248;242m][0m
[38;5;238m 341[0m   [38;5;238mâ”‚[0m 
[38;5;238m 342[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m 2. Create a boolean trend column (True if trend is up)[0m
[38;5;238m 343[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140mtrend[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mst_trend_col[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m
[38;5;238m 344[0m   [38;5;238mâ”‚[0m 
[38;5;238m 345[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m 3. Calculate flip signals: Signal is True *only* on the candle where the flip occurs[0m
[38;5;238m 346[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mprev_trend_direction[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mst_trend_col[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;80;250;123mshift[0m[38;2;248;248;242m([0m[38;2;189;147;249m1[0m[38;2;248;248;242m)[0m
[38;5;238m 347[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Long signal: Previous was down (-1) and current is up (1)[0m
[38;5;238m 348[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140mst_long[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242mprev_trend_direction[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m&[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mst_trend_col[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m[38;2;248;248;242m)[0m
[38;5;238m 349[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Short signal: Previous was up (1) and current is down (-1)[0m
[38;5;238m 350[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140mst_short[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242mprev_trend_direction[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m&[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mst_trend_col[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m)[0m
[38;5;238m 351[0m   [38;5;238mâ”‚[0m 
[38;5;238m 352[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Clean up intermediate pandas_ta columns ---[0m
[38;5;238m 353[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Identify all columns starting with 'SUPERT_' that are NOT our target columns[0m
[38;5;238m 354[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mcols_to_drop[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m[[0m[38;2;248;248;242mc[0m[38;2;248;248;242m [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mc[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mcolumns[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mc[0m[38;2;255;121;198m.[0m[38;2;80;250;123mstartswith[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mSUPERT_[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mc[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mtarget_cols[0m[38;2;248;248;242m][0m
[38;5;238m 355[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Also explicitly add the raw trend direction and band value columns if they exist[0m
[38;5;238m 356[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mcols_to_drop[0m[38;2;255;121;198m.[0m[38;2;80;250;123mextend[0m[38;2;248;248;242m([0m[38;2;248;248;242m[[0m[38;2;248;248;242mst_trend_col[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mst_long_col[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mst_short_col[0m[38;2;248;248;242m][0m[38;2;248;248;242m)[0m
[38;5;238m 357[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Use set to avoid duplicates if target_cols somehow overlapped with raw names, drop safely[0m
[38;5;238m 358[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdrop[0m[38;2;248;248;242m([0m[3;38;2;255;184;108mcolumns[0m[38;2;255;121;198m=[0m[3;38;2;102;217;239mlist[0m[38;2;248;248;242m([0m[3;38;2;102;217;239mset[0m[38;2;248;248;242m([0m[38;2;248;248;242mcols_to_drop[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108merrors[0m[38;2;255;121;198m=[0m[38;2;241;250;140m'[0m[38;2;241;250;140mignore[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108minplace[0m[38;2;255;121;198m=[0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m)[0m
[38;5;238m 359[0m   [38;5;238mâ”‚[0m 
[38;5;238m 360[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log the result of the last candle[0m
[38;5;238m 361[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlast_trend_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mUp[0m[38;2;241;250;140m'[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m'[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140mtrend[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mDown[0m[38;2;241;250;140m'[0m
[38;5;238m 362[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc: Calculated [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140mSupertrend([0m[38;2;248;248;242m{[0m[38;2;248;248;242mlength[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, [0m[38;2;248;248;242m{[0m[38;2;248;248;242mmultiplier[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). [0m[38;2;241;250;140m"[0m
[38;5;238m 363[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                     [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLast trend: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mlast_trend_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Last value: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m'[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140msupertrend[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 364[0m   [38;5;238mâ”‚[0m 
[38;5;238m 365[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 366[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc: Error calculating [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140mSupertrend([0m[38;2;248;248;242m{[0m[38;2;248;248;242mlength[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, [0m[38;2;248;248;242m{[0m[38;2;248;248;242mmultiplier[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 367[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m 368[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Ensure target columns exist with NA values on error[0m
[38;5;238m 369[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mcol[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mtarget_cols[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mcol[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;255;255;255mNA[0m
[38;5;238m 370[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m
[38;5;238m 371[0m   [38;5;238mâ”‚[0m 
[38;5;238m 372[0m   [38;5;238mâ”‚[0m 
[38;5;238m 373[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Volume and ATR Analysis ---[0m
[38;5;238m 374[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123manalyze_volume_atr[0m[38;2;248;248;242m([0m
[38;5;238m 375[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mdf[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;248;248;242mDataFrame[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108matr_len[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mvol_ma_len[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m
[38;5;238m 376[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;248;248;242m->[0m[38;2;248;248;242m [0m[38;2;248;248;242mDict[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m, [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m][0m[38;2;248;248;242m:[0m
[38;5;238m 377[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 378[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Calculates ATR, Volume Moving Average, and checks for volume spikes relative to the MA.[0m
[38;5;238m 379[0m   [38;5;238mâ”‚[0m 
[38;5;238m 380[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Args:[0m
[38;5;238m 381[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        df (pd.DataFrame): Input DataFrame with 'high', 'low', 'close', 'volume'.[0m
[38;5;238m 382[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        atr_len (int): Lookback period for ATR calculation.[0m
[38;5;238m 383[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        vol_ma_len (int): Lookback period for Volume Moving Average.[0m
[38;5;238m 384[0m   [38;5;238mâ”‚[0m 
[38;5;238m 385[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Returns:[0m
[38;5;238m 386[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        Dict[str, Optional[float]]: Dictionary containing 'atr', 'volume_ma',[0m
[38;5;238m 387[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m                                     'last_volume', 'volume_ratio'. Values are[0m
[38;5;238m 388[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m                                     None if calculation fails or data is insufficient.[0m
[38;5;238m 389[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 390[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mDict[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m, [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m
[38;5;238m 391[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;241;250;140m"[0m[38;2;241;250;140matr[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mvolume_ma[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mlast_volume[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mvolume_ratio[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 392[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242m}[0m
[38;5;238m 393[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mrequired_cols[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mhigh[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mlow[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mclose[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mvolume[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m
[38;5;238m 394[0m   [38;5;238mâ”‚[0m 
[38;5;238m 395[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Input validation[0m
[38;5;238m 396[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mempty[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;139;233;253mall[0m[38;2;248;248;242m([0m[38;2;248;248;242mc[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mcolumns[0m[38;2;248;248;242m [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mc[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mrequired_cols[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 397[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc (Vol/ATR): Input DataFrame is missing required columns [0m[38;2;248;248;242m{[0m[38;2;248;248;242mrequired_cols[0m[38;2;248;248;242m}[0m[38;2;241;250;140m or is empty.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 398[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m
[38;5;238m 399[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mmin_len[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;139;233;253mmax[0m[38;2;248;248;242m([0m[38;2;248;248;242matr_len[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mvol_ma_len[0m[38;2;248;248;242m)[0m
[38;5;238m 400[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;139;233;253mlen[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;248;248;242mmin_len[0m[38;2;248;248;242m:[0m
[38;5;238m 401[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc (Vol/ATR): DataFrame length ([0m[38;2;248;248;242m{[0m[38;2;139;233;253mlen[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) is less than required ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mmin_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) for ATR([0m[38;2;248;248;242m{[0m[38;2;248;248;242matr_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)/VolMA([0m[38;2;248;248;242m{[0m[38;2;248;248;242mvol_ma_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 402[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m
[38;5;238m 403[0m   [38;5;238mâ”‚[0m 
[38;5;238m 404[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m 405[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Calculate ATR using pandas_ta[0m
[38;5;238m 406[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242matr_col[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mATRr_[0m[38;2;248;248;242m{[0m[38;2;248;248;242matr_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m pandas_ta default name for ATR[0m
[38;5;238m 407[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mta[0m[38;2;255;121;198m.[0m[38;2;80;250;123matr[0m[38;2;248;248;242m([0m[3;38;2;255;184;108mlength[0m[38;2;255;121;198m=[0m[38;2;248;248;242matr_len[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mappend[0m[38;2;255;121;198m=[0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m)[0m
[38;5;238m 408[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242matr_col[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mcolumns[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;80;250;123mnotna[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242matr_col[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 409[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140matr[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242matr_col[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m
[38;5;238m 410[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m 411[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc: Failed to calculate valid ATR([0m[38;2;248;248;242m{[0m[38;2;248;248;242matr_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Check input data.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 412[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Clean up ATR column[0m
[38;5;238m 413[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdrop[0m[38;2;248;248;242m([0m[3;38;2;255;184;108mcolumns[0m[38;2;255;121;198m=[0m[38;2;248;248;242m[[0m[38;2;248;248;242matr_col[0m[38;2;248;248;242m][0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108merrors[0m[38;2;255;121;198m=[0m[38;2;241;250;140m'[0m[38;2;241;250;140mignore[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108minplace[0m[38;2;255;121;198m=[0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m)[0m
[38;5;238m 414[0m   [38;5;238mâ”‚[0m 
[38;5;238m 415[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Calculate Volume Moving Average[0m
[38;5;238m 416[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mvolume_ma_col[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mvolume_ma[0m[38;2;241;250;140m'[0m
[38;5;238m 417[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Use min_periods to get MA sooner, but it might be less stable initially[0m
[38;5;238m 418[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mvolume_ma_col[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mvolume[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;80;250;123mrolling[0m[38;2;248;248;242m([0m[3;38;2;255;184;108mwindow[0m[38;2;255;121;198m=[0m[38;2;248;248;242mvol_ma_len[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mmin_periods[0m[38;2;255;121;198m=[0m[38;2;139;233;253mmax[0m[38;2;248;248;242m([0m[38;2;189;147;249m1[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mvol_ma_len[0m[38;2;248;248;242m [0m[38;2;255;121;198m/[0m[38;2;255;121;198m/[0m[38;2;248;248;242m [0m[38;2;189;147;249m2[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mmean[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m
[38;5;238m 419[0m   [38;5;238mâ”‚[0m 
[38;5;238m 420[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;80;250;123mnotna[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mvolume_ma_col[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 421[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mvolume_ma[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mvolume_ma_col[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m
[38;5;238m 422[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mlast_volume[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mvolume[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Get the volume of the last candle[0m
[38;5;238m 423[0m   [38;5;238mâ”‚[0m 
[38;5;238m 424[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Calculate Volume Ratio (Last Volume / Volume MA)[0m
[38;5;238m 425[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Check if MA is not None and significantly greater than zero before dividing[0m
[38;5;238m 426[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mvolume_ma[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mvolume_ma[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_QTY_EPSILON[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mlast_volume[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m:[0m
[38;5;238m 427[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mvolume_ratio[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mlast_volume[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m/[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mvolume_ma[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m
[38;5;238m 428[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m 429[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mvolume_ratio[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Avoid division by zero or near-zero MA[0m
[38;5;238m 430[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc: Volume ratio calculation skipped (LastVol=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mlast_volume[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;248;248;242m}[0m[38;2;241;250;140m, VolMA=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mvolume_ma[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 431[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m 432[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc: Failed to calculate valid Volume MA([0m[38;2;248;248;242m{[0m[38;2;248;248;242mvol_ma_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Check input data.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 433[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Clean up Volume MA column[0m
[38;5;238m 434[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdrop[0m[38;2;248;248;242m([0m[3;38;2;255;184;108mcolumns[0m[38;2;255;121;198m=[0m[38;2;248;248;242m[[0m[38;2;248;248;242mvolume_ma_col[0m[38;2;248;248;242m][0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108merrors[0m[38;2;255;121;198m=[0m[38;2;241;250;140m'[0m[38;2;241;250;140mignore[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108minplace[0m[38;2;255;121;198m=[0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m)[0m
[38;5;238m 435[0m   [38;5;238mâ”‚[0m 
[38;5;238m 436[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log results using safe formatting for potentially None values[0m
[38;5;238m 437[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242matr_val[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140matr[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m 438[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242matr_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242matr_val[0m[38;2;189;147;249m:.5f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242matr_val[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m'[0m
[38;5;238m 439[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlast_vol_val[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mlast_volume[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m 440[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mvol_ma_val[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mvolume_ma[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m 441[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mvol_ratio_val[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mvolume_ratio[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m 442[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlast_vol_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlast_vol_val[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_vol_val[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m'[0m
[38;5;238m 443[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mvol_ma_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mvol_ma_val[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mvol_ma_val[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m'[0m
[38;5;238m 444[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mvol_ratio_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mvol_ratio_val[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mvol_ratio_val[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m'[0m
[38;5;238m 445[0m   [38;5;238mâ”‚[0m 
[38;5;238m 446[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc: ATR([0m[38;2;248;248;242m{[0m[38;2;248;248;242matr_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) = [0m[38;2;248;248;242m{[0m[38;2;248;248;242matr_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 447[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc: Volume Analysis: Last=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlast_vol_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, MA([0m[38;2;248;248;242m{[0m[38;2;248;248;242mvol_ma_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mvol_ma_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Ratio=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mvol_ratio_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 448[0m   [38;5;238mâ”‚[0m 
[38;5;238m 449[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 450[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc: Error during Volume/ATR analysis: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 451[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m 452[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242mkey[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mkey[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m}[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Reset results to None on error[0m
[38;5;238m 453[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m
[38;5;238m 454[0m   [38;5;238mâ”‚[0m 
[38;5;238m 455[0m   [38;5;238mâ”‚[0m 
[38;5;238m 456[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Order Book Analysis ---[0m
[38;5;238m 457[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123manalyze_order_book[0m[38;2;248;248;242m([0m
[38;5;238m 458[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mexchange[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;255;121;198m.[0m[38;2;248;248;242mExchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108msymbol[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mdepth[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mfetch_limit[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m
[38;5;238m 459[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;248;248;242m->[0m[38;2;248;248;242m [0m[38;2;248;248;242mDict[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m, [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m][0m[38;2;248;248;242m:[0m
[38;5;238m 460[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 461[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Fetches the L2 order book and analyzes bid/ask pressure (cumulative volume ratio)[0m
[38;5;238m 462[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    and spread within the specified depth.[0m
[38;5;238m 463[0m   [38;5;238mâ”‚[0m 
[38;5;238m 464[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Args:[0m
[38;5;238m 465[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        exchange (ccxt.Exchange): Initialized CCXT exchange object.[0m
[38;5;238m 466[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        symbol (str): The market symbol (e.g., 'BTC/USDT:USDT').[0m
[38;5;238m 467[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        depth (int): How many price levels deep to calculate cumulative volume for the ratio.[0m
[38;5;238m 468[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        fetch_limit (int): How many levels to request from the API (must be >= depth,[0m
[38;5;238m 469[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m                           and often subject to API minimums like 25, 50, or 100).[0m
[38;5;238m 470[0m   [38;5;238mâ”‚[0m 
[38;5;238m 471[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Returns:[0m
[38;5;238m 472[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        Dict[str, Optional[float]]: Dictionary with 'bid_ask_ratio', 'spread',[0m
[38;5;238m 473[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m                                     'best_bid', 'best_ask'. Values are None on failure.[0m
[38;5;238m 474[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 475[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mDict[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m, [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m
[38;5;238m 476[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;241;250;140m"[0m[38;2;241;250;140mbid_ask_ratio[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mspread[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mbest_bid[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mbest_ask[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 477[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242m}[0m
[38;5;238m 478[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mOrder Book: Fetching L2 for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (Analyze Depth: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mdepth[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, API Fetch Limit: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfetch_limit[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 479[0m   [38;5;238mâ”‚[0m 
[38;5;238m 480[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Check if the exchange instance supports fetching L2 order book[0m
[38;5;238m 481[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;248;248;242mhas[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mfetchL2OrderBook[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 482[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mOrder Book: Exchange '[0m[38;2;248;248;242m{[0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;248;248;242mid[0m[38;2;248;248;242m}[0m[38;2;241;250;140m' does not support fetchL2OrderBook method. Skipping analysis.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 483[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m
[38;5;238m 484[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m 485[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Fetch the order book data[0m
[38;5;238m 486[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242morder_book[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mfetch_l2_order_book[0m[38;2;248;248;242m([0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mlimit[0m[38;2;255;121;198m=[0m[38;2;248;248;242mfetch_limit[0m[38;2;248;248;242m)[0m
[38;5;238m 487[0m   [38;5;238mâ”‚[0m 
[38;5;238m 488[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Validate the structure of the returned order book data[0m
[38;5;238m 489[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242morder_book[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;139;233;253misinstance[0m[38;2;248;248;242m([0m[38;2;248;248;242morder_book[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mbids[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mlist[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;139;233;253misinstance[0m[38;2;248;248;242m([0m[38;2;248;248;242morder_book[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140masks[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mlist[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 490[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mOrder Book: Incomplete or invalid data structure received for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. OB: [0m[38;2;248;248;242m{[0m[38;2;248;248;242morder_book[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 491[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m
[38;5;238m 492[0m   [38;5;238mâ”‚[0m 
[38;5;238m 493[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mbids[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mList[0m[38;2;248;248;242m[[0m[38;2;248;248;242mList[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242morder_book[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mbids[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m List of [price, amount][0m
[38;5;238m 494[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242masks[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mList[0m[38;2;248;248;242m[[0m[38;2;248;248;242mList[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242morder_book[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140masks[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m List of [price, amount][0m
[38;5;238m 495[0m   [38;5;238mâ”‚[0m 
[38;5;238m 496[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Get best bid/ask and calculate spread[0m
[38;5;238m 497[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mbest_bid[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mbids[0m[38;2;248;248;242m[[0m[38;2;189;147;249m0[0m[38;2;248;248;242m][0m[38;2;248;248;242m[[0m[38;2;189;147;249m0[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mbids[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;139;233;253mlen[0m[38;2;248;248;242m([0m[38;2;248;248;242mbids[0m[38;2;248;248;242m[[0m[38;2;189;147;249m0[0m[38;2;248;248;242m][0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m
[38;5;238m 498[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mbest_ask[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242masks[0m[38;2;248;248;242m[[0m[38;2;189;147;249m0[0m[38;2;248;248;242m][0m[38;2;248;248;242m[[0m[38;2;189;147;249m0[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242masks[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;139;233;253mlen[0m[38;2;248;248;242m([0m[38;2;248;248;242masks[0m[38;2;248;248;242m[[0m[38;2;189;147;249m0[0m[38;2;248;248;242m][0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m
[38;5;238m 499[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mbest_bid[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mbest_bid[0m
[38;5;238m 500[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mbest_ask[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mbest_ask[0m
[38;5;238m 501[0m   [38;5;238mâ”‚[0m 
[38;5;238m 502[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mspread[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 503[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mbest_bid[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mbest_ask[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m:[0m
[38;5;238m 504[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mspread[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mbest_ask[0m[38;2;248;248;242m [0m[38;2;255;121;198m-[0m[38;2;248;248;242m [0m[38;2;248;248;242mbest_bid[0m
[38;5;238m 505[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mspread[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mspread[0m
[38;5;238m 506[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mOrder Book: Best Bid=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mbest_bid[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Best Ask=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mbest_ask[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Spread=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mspread[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 507[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m 508[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log even if spread calculation isn't possible (e.g., one side is empty)[0m
[38;5;238m 509[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mOrder Book: Best Bid=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mbest_bid[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Best Ask=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mbest_ask[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (Spread calculation requires both > 0)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 510[0m   [38;5;238mâ”‚[0m 
[38;5;238m 511[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Calculate cumulative volume within the specified analysis depth[0m
[38;5;238m 512[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Sum the 'amount' (index 1) for the top 'depth' levels[0m
[38;5;238m 513[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mbid_volume_sum[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;139;233;253msum[0m[38;2;248;248;242m([0m[38;2;248;248;242mbid[0m[38;2;248;248;242m[[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mbid[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mbids[0m[38;2;248;248;242m[[0m[38;2;248;248;242m:[0m[38;2;248;248;242mdepth[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;139;233;253mlen[0m[38;2;248;248;242m([0m[38;2;248;248;242mbid[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;139;233;253misinstance[0m[38;2;248;248;242m([0m[38;2;248;248;242mbid[0m[38;2;248;248;242m[[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m 514[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mask_volume_sum[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;139;233;253msum[0m[38;2;248;248;242m([0m[38;2;248;248;242mask[0m[38;2;248;248;242m[[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mask[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242masks[0m[38;2;248;248;242m[[0m[38;2;248;248;242m:[0m[38;2;248;248;242mdepth[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;139;233;253mlen[0m[38;2;248;248;242m([0m[38;2;248;248;242mask[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;139;233;253misinstance[0m[38;2;248;248;242m([0m[38;2;248;248;242mask[0m[38;2;248;248;242m[[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m 515[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mOrder Book: Analysis (Depth [0m[38;2;248;248;242m{[0m[38;2;248;248;242mdepth[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Total Bid Vol=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mbid_volume_sum[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Total Ask Vol=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mask_volume_sum[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 516[0m   [38;5;238mâ”‚[0m 
[38;5;238m 517[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Calculate Bid/Ask Ratio (Total Bid Volume / Total Ask Volume)[0m
[38;5;238m 518[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mbid_ask_ratio[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 519[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Check if ask volume is significantly greater than zero to avoid division issues[0m
[38;5;238m 520[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mask_volume_sum[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_QTY_EPSILON[0m[38;2;248;248;242m:[0m
[38;5;238m 521[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mbid_ask_ratio[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mbid_volume_sum[0m[38;2;248;248;242m [0m[38;2;255;121;198m/[0m[38;2;248;248;242m [0m[38;2;248;248;242mask_volume_sum[0m
[38;5;238m 522[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mbid_ask_ratio[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mbid_ask_ratio[0m
[38;5;238m 523[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mOrder Book: Bid/Ask Ratio (Depth [0m[38;2;248;248;242m{[0m[38;2;248;248;242mdepth[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) = [0m[38;2;248;248;242m{[0m[38;2;248;248;242mbid_ask_ratio[0m[38;2;189;147;249m:.3f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 524[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m 525[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mOrder Book: Bid/Ask Ratio calculation skipped (Ask volume at depth [0m[38;2;248;248;242m{[0m[38;2;248;248;242mdepth[0m[38;2;248;248;242m}[0m[38;2;241;250;140m is zero or negligible)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 526[0m   [38;5;238mâ”‚[0m 
[38;5;238m 527[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mNetworkError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 528[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mOrder Book: Network error fetching order book for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 529[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mExchangeError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 530[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mOrder Book: Exchange error fetching order book for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 531[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mIndexError[0m[38;2;248;248;242m:[0m
[38;5;238m 532[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mOrder Book: Index error processing bids/asks for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Data might be malformed or empty. Bids: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mbids[0m[38;2;248;248;242m[[0m[38;2;248;248;242m:[0m[38;2;189;147;249m2[0m[38;2;248;248;242m][0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Asks: [0m[38;2;248;248;242m{[0m[38;2;248;248;242masks[0m[38;2;248;248;242m[[0m[38;2;248;248;242m:[0m[38;2;189;147;249m2[0m[38;2;248;248;242m][0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 533[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 534[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mOrder Book: Unexpected error analyzing order book for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 535[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m 536[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Reset results to None on unexpected error[0m
[38;5;238m 537[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242mkey[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mkey[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m}[0m
[38;5;238m 538[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m
[38;5;238m 539[0m   [38;5;238mâ”‚[0m 
[38;5;238m 540[0m   [38;5;238mâ”‚[0m 
[38;5;238m 541[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Data Fetching ---[0m
[38;5;238m 542[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123mget_market_data[0m[38;2;248;248;242m([0m
[38;5;238m 543[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mexchange[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;255;121;198m.[0m[38;2;248;248;242mExchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108msymbol[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108minterval[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mlimit[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249m100[0m
[38;5;238m 544[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;248;248;242m->[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;248;248;242mDataFrame[0m[38;2;248;248;242m][0m[38;2;248;248;242m:[0m
[38;5;238m 545[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 546[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Fetches OHLCV (Open, High, Low, Close, Volume) data from the exchange.[0m
[38;5;238m 547[0m   [38;5;238mâ”‚[0m 
[38;5;238m 548[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Args:[0m
[38;5;238m 549[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        exchange (ccxt.Exchange): Initialized CCXT exchange object.[0m
[38;5;238m 550[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        symbol (str): Market symbol (e.g., 'BTC/USDT:USDT').[0m
[38;5;238m 551[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        interval (str): Timeframe interval (e.g., '1m', '5m', '1h').[0m
[38;5;238m 552[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        limit (int): Number of candles to fetch.[0m
[38;5;238m 553[0m   [38;5;238mâ”‚[0m 
[38;5;238m 554[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Returns:[0m
[38;5;238m 555[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        Optional[pd.DataFrame]: DataFrame with OHLCV data, indexed by timestamp (UTC),[0m
[38;5;238m 556[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m                                 or None if fetching fails or data is invalid.[0m
[38;5;238m 557[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 558[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;248;248;242mhas[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mfetchOHLCV[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 559[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mData Fetch: Exchange '[0m[38;2;248;248;242m{[0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;248;248;242mid[0m[38;2;248;248;242m}[0m[38;2;241;250;140m' does not support fetchOHLCV method.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 560[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 561[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m 562[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mData Fetch: Fetching [0m[38;2;248;248;242m{[0m[38;2;248;248;242mlimit[0m[38;2;248;248;242m}[0m[38;2;241;250;140m OHLCV candles for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (Timeframe: [0m[38;2;248;248;242m{[0m[38;2;248;248;242minterval[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 563[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Fetch data: Returns a list of lists [timestamp, open, high, low, close, volume][0m
[38;5;238m 564[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mohlcv[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mList[0m[38;2;248;248;242m[[0m[38;2;248;248;242mList[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mfetch_ohlcv[0m[38;2;248;248;242m([0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mtimeframe[0m[38;2;255;121;198m=[0m[38;2;248;248;242minterval[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mlimit[0m[38;2;255;121;198m=[0m[38;2;248;248;242mlimit[0m[38;2;248;248;242m)[0m
[38;5;238m 565[0m   [38;5;238mâ”‚[0m 
[38;5;238m 566[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mohlcv[0m[38;2;248;248;242m:[0m
[38;5;238m 567[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mData Fetch: No OHLCV data returned from exchange for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m ([0m[38;2;248;248;242m{[0m[38;2;248;248;242minterval[0m[38;2;248;248;242m}[0m[38;2;241;250;140m).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 568[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 569[0m   [38;5;238mâ”‚[0m 
[38;5;238m 570[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Convert to pandas DataFrame[0m
[38;5;238m 571[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;80;250;123mDataFrame[0m[38;2;248;248;242m([0m[38;2;248;248;242mohlcv[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mcolumns[0m[38;2;255;121;198m=[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mtimestamp[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mopen[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mhigh[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mlow[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mclose[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mvolume[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m)[0m
[38;5;238m 572[0m   [38;5;238mâ”‚[0m 
[38;5;238m 573[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Convert timestamp to datetime objects (UTC) and set as index[0m
[38;5;238m 574[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mtimestamp[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;80;250;123mto_datetime[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mtimestamp[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108munit[0m[38;2;255;121;198m=[0m[38;2;241;250;140m"[0m[38;2;241;250;140mms[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mutc[0m[38;2;255;121;198m=[0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m)[0m
[38;5;238m 575[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;80;250;123mset_index[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mtimestamp[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108minplace[0m[38;2;255;121;198m=[0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m)[0m
[38;5;238m 576[0m   [38;5;238mâ”‚[0m 
[38;5;238m 577[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Basic data validation: Check for NaN values[0m
[38;5;238m 578[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;80;250;123misnull[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;248;248;242mvalues[0m[38;2;255;121;198m.[0m[38;2;80;250;123many[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 579[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mnan_counts[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;80;250;123misnull[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123msum[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m
[38;5;238m 580[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mData Fetch: Fetched OHLCV data contains NaN values. Counts:[0m[38;2;255;121;198m\n[0m[38;2;248;248;242m{[0m[38;2;248;248;242mnan_counts[0m[38;2;248;248;242m[[0m[38;2;248;248;242mnan_counts[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m][0m[38;2;248;248;242m}[0m[38;2;255;121;198m\n[0m[38;2;241;250;140mAttempting forward fill...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 581[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Simple imputation: Forward fill NaNs. More sophisticated methods could be used.[0m
[38;5;238m 582[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;80;250;123mffill[0m[38;2;248;248;242m([0m[3;38;2;255;184;108minplace[0m[38;2;255;121;198m=[0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m)[0m
[38;5;238m 583[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Check again after filling - if NaNs remain (e.g., at the very beginning), data is unusable[0m
[38;5;238m 584[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;80;250;123misnull[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;248;248;242mvalues[0m[38;2;255;121;198m.[0m[38;2;80;250;123many[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 585[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mData Fetch: NaN values remain after forward fill. Cannot proceed with this data batch.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 586[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 587[0m   [38;5;238mâ”‚[0m 
[38;5;238m 588[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mData Fetch: Successfully fetched and processed [0m[38;2;248;248;242m{[0m[38;2;139;233;253mlen[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m OHLCV candles for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 589[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m
[38;5;238m 590[0m   [38;5;238mâ”‚[0m 
[38;5;238m 591[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mNetworkError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 592[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mData Fetch: Network error fetching OHLCV for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 593[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mExchangeError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 594[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mData Fetch: Exchange error fetching OHLCV for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 595[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 596[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mData Fetch: Unexpected error fetching market data for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 597[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m 598[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 599[0m   [38;5;238mâ”‚[0m 
[38;5;238m 600[0m   [38;5;238mâ”‚[0m 
[38;5;238m 601[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Position & Order Management (REVISED - v1.5.1) ---[0m
[38;5;238m 602[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123mget_current_position[0m[38;2;248;248;242m([0m[3;38;2;255;184;108mexchange[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;255;121;198m.[0m[38;2;248;248;242mExchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108msymbol[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;248;248;242m->[0m[38;2;248;248;242m [0m[38;2;248;248;242mDict[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m, [0m[38;2;248;248;242mAny[0m[38;2;248;248;242m][0m[38;2;248;248;242m:[0m
[38;5;238m 603[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 604[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Fetches the current position details for a given symbol, focusing on[0m
[38;5;238m 605[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Bybit V5 API structure via CCXT for robustness against zero-size entries[0m
[38;5;238m 606[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    and using the 'side' field for direction. Assumes One-Way mode.[0m
[38;5;238m 607[0m   [38;5;238mâ”‚[0m 
[38;5;238m 608[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Args:[0m
[38;5;238m 609[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        exchange (ccxt.Exchange): Initialized CCXT exchange object.[0m
[38;5;238m 610[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        symbol (str): Market symbol in CCXT unified format (e.g., 'BTC/USDT:USDT').[0m
[38;5;238m 611[0m   [38;5;238mâ”‚[0m 
[38;5;238m 612[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Returns:[0m
[38;5;238m 613[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        Dict[str, Any]: {'side': POSITION_SIDE_*, 'qty': float, 'entry_price': float}.[0m
[38;5;238m 614[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m                        Defaults to side=NONE, qty=0.0, entry_price=0.0 if no *actual*[0m
[38;5;238m 615[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m                        position (size > epsilon and valid side 'Buy'/'Sell') exists[0m
[38;5;238m 616[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m                        for the specified symbol in One-Way mode.[0m
[38;5;238m 617[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 618[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Default return value indicating no active position[0m
[38;5;238m 619[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mdefault_pos[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mDict[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m, [0m[38;2;248;248;242mAny[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;241;250;140m'[0m[38;2;241;250;140mside[0m[38;2;241;250;140m'[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_NONE[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mqty[0m[38;2;241;250;140m'[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mentry_price[0m[38;2;241;250;140m'[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m}[0m
[38;5;238m 620[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mccxt_unified_symbol[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m
[38;5;238m 621[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mmarket_id[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 622[0m   [38;5;238mâ”‚[0m 
[38;5;238m 623[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Get the exchange-specific market ID for comparison[0m
[38;5;238m 624[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m 625[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mmarket[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mmarket[0m[38;2;248;248;242m([0m[38;2;248;248;242mccxt_unified_symbol[0m[38;2;248;248;242m)[0m
[38;5;238m 626[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mmarket_id[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mmarket[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mid[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m The ID used by the exchange (e.g., 'BTCUSDT')[0m
[38;5;238m 627[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Check: Fetching position for CCXT symbol '[0m[38;2;248;248;242m{[0m[38;2;248;248;242mccxt_unified_symbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m' (Target Exchange Market ID: '[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_id[0m[38;2;248;248;242m}[0m[38;2;241;250;140m')...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 628[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mBadSymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mKeyError[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 629[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Check: Failed to get market info/ID for '[0m[38;2;248;248;242m{[0m[38;2;248;248;242mccxt_unified_symbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m': [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 630[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mdefault_pos[0m
[38;5;238m 631[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Catch other potential errors during market lookup[0m
[38;5;238m 632[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Check: Unexpected error getting market info for '[0m[38;2;248;248;242m{[0m[38;2;248;248;242mccxt_unified_symbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m': [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 633[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m 634[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mdefault_pos[0m
[38;5;238m 635[0m   [38;5;238mâ”‚[0m 
[38;5;238m 636[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m 637[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Check if the exchange supports fetching positions[0m
[38;5;238m 638[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;248;248;242mhas[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mfetchPositions[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 639[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Check: Exchange '[0m[38;2;248;248;242m{[0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;248;248;242mid[0m[38;2;248;248;242m}[0m[38;2;241;250;140m' does not support fetchPositions. Cannot reliably get position status.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 640[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Attempting fetchBalance might give clues, but it's less direct. Sticking to fetchPositions.[0m
[38;5;238m 641[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mdefault_pos[0m
[38;5;238m 642[0m   [38;5;238mâ”‚[0m 
[38;5;238m 643[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Fetch positions - Bybit V5 often requires 'category' for linear/inverse[0m
[38;5;238m 644[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mparams[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m
[38;5;238m 645[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mmarket[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mlinear[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 646[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mparams[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;241;250;140m'[0m[38;2;241;250;140mcategory[0m[38;2;241;250;140m'[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mlinear[0m[38;2;241;250;140m'[0m[38;2;248;248;242m}[0m
[38;5;238m 647[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melif[0m[38;2;248;248;242m [0m[38;2;248;248;242mmarket[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140minverse[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 648[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mparams[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;241;250;140m'[0m[38;2;241;250;140mcategory[0m[38;2;241;250;140m'[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140minverse[0m[38;2;241;250;140m'[0m[38;2;248;248;242m}[0m
[38;5;238m 649[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m If type isn't clear, fetching without category might work or fail depending on exchange default[0m
[38;5;238m 650[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Check: Calling fetchPositions with params: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mparams[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 651[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mfetched_positions[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mfetch_positions[0m[38;2;248;248;242m([0m[3;38;2;255;184;108msymbols[0m[38;2;255;121;198m=[0m[38;2;248;248;242m[[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m][0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mparams[0m[38;2;255;121;198m=[0m[38;2;248;248;242mparams[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Fetch potentially for multiple symbols if needed, or just one[0m
[38;5;238m 652[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Note: Some CCXT versions/exchanges might return positions for *all* symbols if `symbols` arg is omitted or ignored.[0m
[38;5;238m 653[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m We must filter carefully.[0m
[38;5;238m 654[0m   [38;5;238mâ”‚[0m 
[38;5;238m 655[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Check: Raw data from fetch_positions (filtered for symbol '[0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m'):[0m[38;2;255;121;198m\n[0m[38;2;248;248;242m{[0m[38;2;248;248;242mfetched_positions[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 656[0m   [38;5;238mâ”‚[0m 
[38;5;238m 657[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Iterate through the potentially filtered list of positions returned by CCXT[0m
[38;5;238m 658[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mpos[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mfetched_positions[0m[38;2;248;248;242m:[0m
[38;5;238m 659[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Check: Evaluating raw position entry: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mpos[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 660[0m   [38;5;238mâ”‚[0m 
[38;5;238m 661[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- 1. Symbol Check ---[0m
[38;5;238m 662[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m CCXT aims to return the unified symbol, but check info.symbol for the raw ID as backup/confirmation[0m
[38;5;238m 663[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mpos_symbol_unified[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140msymbol[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m CCXT unified symbol (e.g., BTC/USDT:USDT)[0m
[38;5;238m 664[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mpos_symbol_raw[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140minfo[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140msymbol[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Raw exchange symbol ID (e.g., BTCUSDT)[0m
[38;5;238m 665[0m   [38;5;238mâ”‚[0m 
[38;5;238m 666[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Match against the target market ID obtained earlier[0m
[38;5;238m 667[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mpos_symbol_raw[0m[38;2;248;248;242m [0m[38;2;255;121;198m!=[0m[38;2;248;248;242m [0m[38;2;248;248;242mmarket_id[0m[38;2;248;248;242m:[0m
[38;5;238m 668[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSkipping position entry: Symbol mismatch (Got Raw ID '[0m[38;2;248;248;242m{[0m[38;2;248;248;242mpos_symbol_raw[0m[38;2;248;248;242m}[0m[38;2;241;250;140m', Unified '[0m[38;2;248;248;242m{[0m[38;2;248;248;242mpos_symbol_unified[0m[38;2;248;248;242m}[0m[38;2;241;250;140m', Expected Target ID '[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_id[0m[38;2;248;248;242m}[0m[38;2;241;250;140m')[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 669[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mcontinue[0m
[38;5;238m 670[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSymbol '[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_id[0m[38;2;248;248;242m}[0m[38;2;241;250;140m' matches target.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 671[0m   [38;5;238mâ”‚[0m 
[38;5;238m 672[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- 2. Position Mode Check (Assume One-Way) ---[0m
[38;5;238m 673[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Bybit V5 uses `positionIdx`: 0 for One-Way, 1 for Buy Hedge, 2 for Sell Hedge[0m
[38;5;238m 674[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mposition_idx[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140minfo[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mpositionIdx[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Default to 0 (One-Way) if not present[0m
[38;5;238m 675[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition_idx[0m[38;2;248;248;242m [0m[38;2;255;121;198m!=[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Strict check for One-Way mode[0m
[38;5;238m 676[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSkipping position entry: Position Index is [0m[38;2;248;248;242m{[0m[38;2;248;248;242mposition_idx[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (Expected 0 for One-Way Mode). This bot only supports One-Way mode.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 677[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mcontinue[0m
[38;5;238m 678[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Index is [0m[38;2;248;248;242m{[0m[38;2;248;248;242mposition_idx[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (OK for One-Way Mode).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 679[0m   [38;5;238mâ”‚[0m 
[38;5;238m 680[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- 3. Strict Side Check (Using Bybit V5 'side' from 'info') ---[0m
[38;5;238m 681[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m This is crucial for V5. 'side' indicates the position direction ('Buy', 'Sell') or 'None' if flat.[0m
[38;5;238m 682[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mpos_side_v5[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140minfo[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mside[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mNone[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Expected: 'Buy', 'Sell', or 'None'[0m
[38;5;238m 683[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRaw position side from info.side: '[0m[38;2;248;248;242m{[0m[38;2;248;248;242mpos_side_v5[0m[38;2;248;248;242m}[0m[38;2;241;250;140m'[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 684[0m   [38;5;238mâ”‚[0m 
[38;5;238m 685[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mdetermined_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_NONE[0m
[38;5;238m 686[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mpos_side_v5[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mBuy[0m[38;2;241;250;140m'[0m[38;2;248;248;242m:[0m
[38;5;238m 687[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mdetermined_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_LONG[0m
[38;5;238m 688[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198melif[0m[38;2;248;248;242m [0m[38;2;248;248;242mpos_side_v5[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mSell[0m[38;2;241;250;140m'[0m[38;2;248;248;242m:[0m
[38;5;238m 689[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mdetermined_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_SHORT[0m
[38;5;238m 690[0m   [38;5;238mâ”‚[0m 
[38;5;238m 691[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m *** IMPORTANT: If the API explicitly reports side as 'None', treat as no position, regardless of size ***[0m
[38;5;238m 692[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m This handles cases where residual dust might remain but the exchange considers the position closed.[0m
[38;5;238m 693[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mdetermined_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_NONE[0m[38;2;248;248;242m:[0m
[38;5;238m 694[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSkipping position entry: Side reported by API is '[0m[38;2;248;248;242m{[0m[38;2;248;248;242mpos_side_v5[0m[38;2;248;248;242m}[0m[38;2;241;250;140m'. Not considering it an active directional position.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 695[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mcontinue[0m
[38;5;238m 696[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSide '[0m[38;2;248;248;242m{[0m[38;2;248;248;242mpos_side_v5[0m[38;2;248;248;242m}[0m[38;2;241;250;140m' determined as [0m[38;2;248;248;242m{[0m[38;2;248;248;242mdetermined_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 697[0m   [38;5;238mâ”‚[0m 
[38;5;238m 698[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- 4. Check Position Size (Using Bybit V5 'size' from 'info') ---[0m
[38;5;238m 699[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Use 'size' from raw info preferentially for Bybit V5 as it reflects the actual contract quantity.[0m
[38;5;238m 700[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242msize_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140minfo[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140msize[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m 701[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Fallback to CCXT unified 'contracts' field if 'info.size' is missing (less likely for V5)[0m
[38;5;238m 702[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242msize_str[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242msize_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m
[38;5;238m 703[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242msize_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mcontracts[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m CCXT unified field name for quantity[0m
[38;5;238m 704[0m   [38;5;238mâ”‚[0m 
[38;5;238m 705[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242msize_str[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242msize_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Check again after fallback[0m
[38;5;238m 706[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSkipping position entry: Could not find a valid quantity string in 'info.size' or 'contracts'. Data: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mpos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140minfo[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 707[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mcontinue[0m
[38;5;238m 708[0m   [38;5;238mâ”‚[0m 
[38;5;238m 709[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- 5. Parse and Validate Size ---[0m
[38;5;238m 710[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m 711[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242msize[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242msize_str[0m[38;2;248;248;242m)[0m
[38;5;238m 712[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mParsed quantity: [0m[38;2;248;248;242m{[0m[38;2;248;248;242msize[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (from string: '[0m[38;2;248;248;242m{[0m[38;2;248;248;242msize_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m')[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 713[0m   [38;5;238mâ”‚[0m 
[38;5;238m 714[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Final Check: Is the size significantly non-zero? ---[0m
[38;5;238m 715[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;139;233;253mabs[0m[38;2;248;248;242m([0m[38;2;248;248;242msize[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_QTY_EPSILON[0m[38;2;248;248;242m:[0m
[38;5;238m 716[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m We have found an active position with a valid side ('Buy' or 'Sell') and a non-negligible size![0m
[38;5;238m 717[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mentry_price_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mentryPrice[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m CCXT unified field[0m
[38;5;238m 718[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Fallback to raw Bybit V5 'avgPrice' if unified 'entryPrice' is missing or invalid[0m
[38;5;238m 719[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price_str[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mentry_price_str[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m:[0m
[38;5;238m 720[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;248;248;242mentry_price_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140minfo[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mavgPrice[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Raw field often more reliable[0m
[38;5;238m 721[0m   [38;5;238mâ”‚[0m 
[38;5;238m 722[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mentry_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m
[38;5;238m 723[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price_str[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m!=[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m
[38;5;238m 724[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                         [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m 725[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                            [0m[38;2;248;248;242mentry_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mentry_price_str[0m[38;2;248;248;242m)[0m
[38;5;238m 726[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                         [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[3;38;2;102;217;239mValueError[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mTypeError[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 727[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mCould not parse entry price string: '[0m[38;2;248;248;242m{[0m[38;2;248;248;242mentry_price_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m'. Defaulting to 0.0.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 728[0m   [38;5;238mâ”‚[0m 
[38;5;238m 729[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mqty_abs[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;139;233;253mabs[0m[38;2;248;248;242m([0m[38;2;248;248;242msize[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Return the absolute quantity[0m
[38;5;238m 730[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log exactly what is being returned[0m
[38;5;238m 731[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Check: Found ACTIVE position: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mdetermined_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m [0m[38;2;248;248;242m{[0m[38;2;248;248;242mqty_abs[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m [0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_id[0m[38;2;248;248;242m}[0m[38;2;241;250;140m @ Entry=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mentry_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 732[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;241;250;140m'[0m[38;2;241;250;140mside[0m[38;2;241;250;140m'[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mdetermined_side[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mqty[0m[38;2;241;250;140m'[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mqty_abs[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mentry_price[0m[38;2;241;250;140m'[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price[0m[38;2;248;248;242m}[0m
[38;5;238m 733[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m 734[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Size is zero or negligible, even though side was 'Buy' or 'Sell' (possible API state inconsistency or dust)[0m
[38;5;238m 735[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSkipping position entry: Position size [0m[38;2;248;248;242m{[0m[38;2;248;248;242msize[0m[38;2;248;248;242m}[0m[38;2;241;250;140m is <= epsilon [0m[38;2;248;248;242m{[0m[38;2;255;255;255mPOSITION_QTY_EPSILON[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, despite side being '[0m[38;2;248;248;242m{[0m[38;2;248;248;242mpos_side_v5[0m[38;2;248;248;242m}[0m[38;2;241;250;140m'. Treating as effectively closed.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 736[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;255;121;198mcontinue[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Move to the next entry in fetched_positions[0m
[38;5;238m 737[0m   [38;5;238mâ”‚[0m 
[38;5;238m 738[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[3;38;2;102;217;239mValueError[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mTypeError[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 739[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Check: Error parsing size/quantity for [0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_id[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Size string: '[0m[38;2;248;248;242m{[0m[38;2;248;248;242msize_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m', Error: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Data: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mpos[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 740[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mcontinue[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Move to the next entry[0m
[38;5;238m 741[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m End of loop through fetched_positions[0m
[38;5;238m 742[0m   [38;5;238mâ”‚[0m 
[38;5;238m 743[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m If the loop completes without returning, no active position was found for the target symbol/mode[0m
[38;5;238m 744[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Check: No active position found for [0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_id[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (One-Way Mode) after checking [0m[38;2;248;248;242m{[0m[38;2;139;233;253mlen[0m[38;2;248;248;242m([0m[38;2;248;248;242mfetched_positions[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m entries returned by fetch_positions.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 745[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mdefault_pos[0m
[38;5;238m 746[0m   [38;5;238mâ”‚[0m 
[38;5;238m 747[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Error Handling for fetch_positions call ---[0m
[38;5;238m 748[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mNetworkError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 749[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Check: Network error during fetch_positions for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 750[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mExchangeError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 751[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Check: Exchange error during fetch_positions for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 752[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 753[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Check: Unexpected error during position check for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 754[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m 755[0m   [38;5;238mâ”‚[0m 
[38;5;238m 756[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Return default (no position) if any error occurred during the process[0m
[38;5;238m 757[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Check: Returning default (No Position) due to error or no active position found for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 758[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mdefault_pos[0m
[38;5;238m 759[0m   [38;5;238mâ”‚[0m 
[38;5;238m 760[0m   [38;5;238mâ”‚[0m 
[38;5;238m 761[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Leverage Setting ---[0m
[38;5;238m 762[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123mset_leverage[0m[38;2;248;248;242m([0m[3;38;2;255;184;108mexchange[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;255;121;198m.[0m[38;2;248;248;242mExchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108msymbol[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mleverage[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;248;248;242m->[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mbool[0m[38;2;248;248;242m:[0m
[38;5;238m 763[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 764[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Sets the leverage for a given futures symbol with retries and checks.[0m
[38;5;238m 765[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Verifies that the symbol is a contract market first.[0m
[38;5;238m 766[0m   [38;5;238mâ”‚[0m 
[38;5;238m 767[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Args:[0m
[38;5;238m 768[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        exchange (ccxt.Exchange): Initialized CCXT exchange object.[0m
[38;5;238m 769[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        symbol (str): Market symbol in CCXT unified format.[0m
[38;5;238m 770[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        leverage (int): Desired leverage level (e.g., 10 for 10x).[0m
[38;5;238m 771[0m   [38;5;238mâ”‚[0m 
[38;5;238m 772[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Returns:[0m
[38;5;238m 773[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        bool: True if leverage is successfully set (or was already correct), False otherwise.[0m
[38;5;238m 774[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 775[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLeverage Setting: Attempting to set [0m[38;2;248;248;242m{[0m[38;2;248;248;242mleverage[0m[38;2;248;248;242m}[0m[38;2;241;250;140mx leverage for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 776[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m 777[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mmarket[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mmarket[0m[38;2;248;248;242m([0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m)[0m
[38;5;238m 778[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Market Type Check ---[0m
[38;5;238m 779[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Ensure it's a futures/swap market where leverage is applicable[0m
[38;5;238m 780[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m CCXT market structure flags: 'swap', 'future', 'option'. 'contract' is a general flag.[0m
[38;5;238m 781[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mmarket[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mcontract[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mmarket[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mspot[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 782[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLeverage Setting: Cannot set leverage for non-contract market: [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Market type: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mtype[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 783[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m
[38;5;238m 784[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mMarket info for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: Type=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mtype[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Contract=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mcontract[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 785[0m   [38;5;238mâ”‚[0m 
[38;5;238m 786[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mBadSymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mKeyError[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 787[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLeverage Setting: Failed to get market info for symbol '[0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m': [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 788[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m
[38;5;238m 789[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 790[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLeverage Setting: Unexpected error getting market info for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 791[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m 792[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m
[38;5;238m 793[0m   [38;5;238mâ”‚[0m 
[38;5;238m 794[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Attempt to Set Leverage with Retries ---[0m
[38;5;238m 795[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mattempt[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;139;233;253mrange[0m[38;2;248;248;242m([0m[38;2;255;255;255mRETRY_COUNT[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 796[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m 797[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Use the unified set_leverage method[0m
[38;5;238m 798[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Note: Some exchanges might require additional params (e.g., marginMode: isolated/cross)[0m
[38;5;238m 799[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Bybit usually defaults based on account settings or previous settings for the symbol.[0m
[38;5;238m 800[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLeverage Setting: Calling exchange.set_leverage([0m[38;2;248;248;242m{[0m[38;2;248;248;242mleverage[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, '[0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m') (Attempt [0m[38;2;248;248;242m{[0m[38;2;248;248;242mattempt[0m[38;2;255;121;198m+[0m[38;2;189;147;249m1[0m[38;2;248;248;242m}[0m[38;2;241;250;140m/[0m[38;2;248;248;242m{[0m[38;2;255;255;255mRETRY_COUNT[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 801[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mresponse[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mset_leverage[0m[38;2;248;248;242m([0m[3;38;2;255;184;108mleverage[0m[38;2;255;121;198m=[0m[38;2;248;248;242mleverage[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108msymbol[0m[38;2;255;121;198m=[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Named args for clarity[0m
[38;5;238m 802[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Response format varies by exchange, log it for info[0m
[38;5;238m 803[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123msuccess[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLeverage Setting: Successfully set leverage to [0m[38;2;248;248;242m{[0m[38;2;248;248;242mleverage[0m[38;2;248;248;242m}[0m[38;2;241;250;140mx for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Response: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mresponse[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 804[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m
[38;5;238m 805[0m   [38;5;238mâ”‚[0m 
[38;5;238m 806[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mExchangeError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 807[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Check for common messages indicating leverage is already set or no change needed[0m
[38;5;238m 808[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242merror_msg_lower[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m([0m[38;2;248;248;242me[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mlower[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m
[38;5;238m 809[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Add more variations if needed based on observed Bybit error messages[0m
[38;5;238m 810[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mleverage not modified[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242merror_msg_lower[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242m\[0m
[38;5;238m 811[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m               [0m[38;2;241;250;140m"[0m[38;2;241;250;140msame leverage[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242merror_msg_lower[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242m\[0m
[38;5;238m 812[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m               [0m[38;2;241;250;140m"[0m[38;2;241;250;140mleverage is not changed[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242merror_msg_lower[0m[38;2;248;248;242m:[0m
[38;5;238m 813[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLeverage Setting: Leverage for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m already set to [0m[38;2;248;248;242m{[0m[38;2;248;248;242mleverage[0m[38;2;248;248;242m}[0m[38;2;241;250;140mx (Confirmed by exchange message).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 814[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m
[38;5;238m 815[0m   [38;5;238mâ”‚[0m 
[38;5;238m 816[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log other exchange errors and retry if attempts remain[0m
[38;5;238m 817[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLeverage Setting: Exchange error on attempt [0m[38;2;248;248;242m{[0m[38;2;248;248;242mattempt[0m[38;2;255;121;198m+[0m[38;2;189;147;249m1[0m[38;2;248;248;242m}[0m[38;2;241;250;140m/[0m[38;2;248;248;242m{[0m[38;2;255;255;255mRETRY_COUNT[0m[38;2;248;248;242m}[0m[38;2;241;250;140m for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 818[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mattempt[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;255;255;255mRETRY_COUNT[0m[38;2;248;248;242m [0m[38;2;255;121;198m-[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m[38;2;248;248;242m:[0m
[38;5;238m 819[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRetrying leverage setting after [0m[38;2;248;248;242m{[0m[38;2;255;255;255mRETRY_DELAY_SECONDS[0m[38;2;248;248;242m}[0m[38;2;241;250;140ms...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 820[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mtime[0m[38;2;255;121;198m.[0m[38;2;80;250;123msleep[0m[38;2;248;248;242m([0m[38;2;255;255;255mRETRY_DELAY_SECONDS[0m[38;2;248;248;242m)[0m
[38;5;238m 821[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m 822[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLeverage Setting: Failed to set leverage for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m after [0m[38;2;248;248;242m{[0m[38;2;255;255;255mRETRY_COUNT[0m[38;2;248;248;242m}[0m[38;2;241;250;140m attempts due to exchange error: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 823[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Optionally send SMS on final failure[0m
[38;5;238m 824[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m send_sms_alert(f"[{symbol.split('/')[0]}] CRITICAL: Leverage set FAILED for {symbol} after retries: {e}")[0m
[38;5;238m 825[0m   [38;5;238mâ”‚[0m 
[38;5;238m 826[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mNetworkError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 827[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLeverage Setting: Network error on attempt [0m[38;2;248;248;242m{[0m[38;2;248;248;242mattempt[0m[38;2;255;121;198m+[0m[38;2;189;147;249m1[0m[38;2;248;248;242m}[0m[38;2;241;250;140m/[0m[38;2;248;248;242m{[0m[38;2;255;255;255mRETRY_COUNT[0m[38;2;248;248;242m}[0m[38;2;241;250;140m for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 828[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mattempt[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;255;255;255mRETRY_COUNT[0m[38;2;248;248;242m [0m[38;2;255;121;198m-[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m[38;2;248;248;242m:[0m
[38;5;238m 829[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mtime[0m[38;2;255;121;198m.[0m[38;2;80;250;123msleep[0m[38;2;248;248;242m([0m[38;2;255;255;255mRETRY_DELAY_SECONDS[0m[38;2;248;248;242m)[0m
[38;5;238m 830[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m 831[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLeverage Setting: Failed to set leverage for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m after [0m[38;2;248;248;242m{[0m[38;2;255;255;255mRETRY_COUNT[0m[38;2;248;248;242m}[0m[38;2;241;250;140m attempts due to network errors.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 832[0m   [38;5;238mâ”‚[0m 
[38;5;238m 833[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 834[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Catch any other unexpected exceptions during the process[0m
[38;5;238m 835[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLeverage Setting: Unexpected error on attempt [0m[38;2;248;248;242m{[0m[38;2;248;248;242mattempt[0m[38;2;255;121;198m+[0m[38;2;189;147;249m1[0m[38;2;248;248;242m}[0m[38;2;241;250;140m for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 836[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m 837[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Exit immediately on unexpected errors[0m
[38;5;238m 838[0m   [38;5;238mâ”‚[0m 
[38;5;238m 839[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m If loop finishes without returning True, it failed[0m
[38;5;238m 840[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m
[38;5;238m 841[0m   [38;5;238mâ”‚[0m 
[38;5;238m 842[0m   [38;5;238mâ”‚[0m 
[38;5;238m 843[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Close Position ---[0m
[38;5;238m 844[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123mclose_position[0m[38;2;248;248;242m([0m
[38;5;238m 845[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mexchange[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;255;121;198m.[0m[38;2;248;248;242mExchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108msymbol[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mposition_to_close[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mDict[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m, [0m[38;2;248;248;242mAny[0m[38;2;248;248;242m][0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mreason[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mSignal[0m[38;2;241;250;140m"[0m
[38;5;238m 846[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;248;248;242m->[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[38;2;248;248;242mDict[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m, [0m[38;2;248;248;242mAny[0m[38;2;248;248;242m][0m[38;2;248;248;242m][0m[38;2;248;248;242m:[0m
[38;5;238m 847[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 848[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Closes the specified active position using a market order with reduce_only=True.[0m
[38;5;238m 849[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Includes a pre-close position re-validation step to mitigate race conditions.[0m
[38;5;238m 850[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Sends SMS alerts on success or failure.[0m
[38;5;238m 851[0m   [38;5;238mâ”‚[0m 
[38;5;238m 852[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Args:[0m
[38;5;238m 853[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        exchange (ccxt.Exchange): Initialized CCXT exchange object.[0m
[38;5;238m 854[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        symbol (str): Market symbol (e.g., 'BTC/USDT:USDT').[0m
[38;5;238m 855[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        position_to_close (Dict[str, Any]): The position dictionary (containing at least[0m
[38;5;238m 856[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m                                             'side' and 'qty') as identified *before*[0m
[38;5;238m 857[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m                                             calling this function. Used for initial info.[0m
[38;5;238m 858[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        reason (str): Reason for closing (e.g., "SL", "TP", "Reversal", "Shutdown").[0m
[38;5;238m 859[0m   [38;5;238mâ”‚[0m 
[38;5;238m 860[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Returns:[0m
[38;5;238m 861[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        Optional[Dict[str, Any]]: The CCXT order dictionary if the close order was[0m
[38;5;238m 862[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m                                  successfully placed, None otherwise.[0m
[38;5;238m 863[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 864[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242minitial_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition_to_close[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mside[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_NONE[0m[38;2;248;248;242m)[0m
[38;5;238m 865[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242minitial_qty[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition_to_close[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mqty[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m
[38;5;238m 866[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;255;121;198m.[0m[38;2;80;250;123msplit[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140m/[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m[[0m[38;2;189;147;249m0[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m For concise SMS alerts (e.g., "BTC")[0m
[38;5;238m 867[0m   [38;5;238mâ”‚[0m 
[38;5;238m 868[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mClose Position: Initiated for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Reason: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mreason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Initial state: [0m[38;2;248;248;242m{[0m[38;2;248;248;242minitial_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m Qty=[0m[38;2;248;248;242m{[0m[38;2;248;248;242minitial_qty[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 869[0m   [38;5;238mâ”‚[0m 
[38;5;238m 870[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m ** Crucial Pre-Close Re-validation Step **[0m
[38;5;238m 871[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Fetch the position state *again* immediately before attempting to close.[0m
[38;5;238m 872[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m This helps prevent errors if the position was closed manually or by another[0m
[38;5;238m 873[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m process between the main logic check and this function call.[0m
[38;5;238m 874[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mClose Position: Re-validating current position state for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 875[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlive_position[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mget_current_position[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m)[0m
[38;5;238m 876[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlive_position_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlive_position[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mside[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m 877[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlive_amount_to_close[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlive_position[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mqty[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m
[38;5;238m 878[0m   [38;5;238mâ”‚[0m 
[38;5;238m 879[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Check if the live position still exists and matches the expected side (loosely)[0m
[38;5;238m 880[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mlive_position_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_NONE[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mlive_amount_to_close[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_QTY_EPSILON[0m[38;2;248;248;242m:[0m
[38;5;238m 881[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mClose Position: Re-validation shows NO active position for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (Live Side: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mlive_position_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Qty: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mlive_amount_to_close[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Aborting close attempt.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 882[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m If the initial state *thought* there was a position, log that discrepancy[0m
[38;5;238m 883[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242minitial_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m!=[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_NONE[0m[38;2;248;248;242m:[0m
[38;5;238m 884[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mClose Position: Discrepancy detected. Initial check showed [0m[38;2;248;248;242m{[0m[38;2;248;248;242minitial_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, but live check shows none.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 885[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 886[0m   [38;5;238mâ”‚[0m 
[38;5;238m 887[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Optional: Check if the live side matches the initial side (can be skipped if just closing whatever is there)[0m
[38;5;238m 888[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m if live_position_side != initial_side:[0m
[38;5;238m 889[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m     logger.warning(f"Close Position: Re-validation shows position side ({live_position_side}) differs from initial ({initial_side}). Closing the live position anyway.")[0m
[38;5;238m 890[0m   [38;5;238mâ”‚[0m 
[38;5;238m 891[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Use the freshly validated quantity and determine the closing side[0m
[38;5;238m 892[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mside_to_execute_close[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;255;255;255mSIDE_SELL[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mlive_position_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_LONG[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;255;255;255mSIDE_BUY[0m
[38;5;238m 893[0m   [38;5;238mâ”‚[0m 
[38;5;238m 894[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m 895[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Format the amount to the exchange's required precision[0m
[38;5;238m 896[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mamount_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mamount_to_precision[0m[38;2;248;248;242m([0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mlive_amount_to_close[0m[38;2;248;248;242m)[0m
[38;5;238m 897[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mamount_float[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mamount_str[0m[38;2;248;248;242m)[0m
[38;5;238m 898[0m   [38;5;238mâ”‚[0m 
[38;5;238m 899[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Final check on the amount after precision formatting[0m
[38;5;238m 900[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mamount_float[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_QTY_EPSILON[0m[38;2;248;248;242m:[0m
[38;5;238m 901[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mClose Position: Calculated closing amount after precision ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mamount_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) is zero or negligible. Aborting.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 902[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 903[0m   [38;5;238mâ”‚[0m 
[38;5;238m 904[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mClose Position: Attempting to CLOSE [0m[38;2;248;248;242m{[0m[38;2;248;248;242mlive_position_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m position ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mreason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): [0m[38;2;241;250;140m"[0m
[38;5;238m 905[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                       [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mExecuting [0m[38;2;248;248;242m{[0m[38;2;248;248;242mside_to_execute_close[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m MARKET order for [0m[38;2;248;248;242m{[0m[38;2;248;248;242mamount_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m [0m[38;2;241;250;140m"[0m
[38;5;238m 906[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                       [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mwith params [0m[38;2;255;121;198m{{[0m[38;2;241;250;140m'reduce_only': True[0m[38;2;255;121;198m}}[0m[38;2;241;250;140m...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 907[0m   [38;5;238mâ”‚[0m 
[38;5;238m 908[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Execute the Closing Market Order ---[0m
[38;5;238m 909[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mparams[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;241;250;140m'[0m[38;2;241;250;140mreduce_only[0m[38;2;241;250;140m'[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m}[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Ensure this order only closes/reduces the position[0m
[38;5;238m 910[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242morder[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcreate_market_order[0m[38;2;248;248;242m([0m
[38;5;238m 911[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108msymbol[0m[38;2;255;121;198m=[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m
[38;5;238m 912[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mside[0m[38;2;255;121;198m=[0m[38;2;248;248;242mside_to_execute_close[0m[38;2;248;248;242m,[0m
[38;5;238m 913[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mamount[0m[38;2;255;121;198m=[0m[38;2;248;248;242mamount_float[0m[38;2;248;248;242m,[0m
[38;5;238m 914[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mparams[0m[38;2;255;121;198m=[0m[38;2;248;248;242mparams[0m
[38;5;238m 915[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242m)[0m
[38;5;238m 916[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Post-Order Placement ---[0m
[38;5;238m 917[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log success and key order details[0m
[38;5;238m 918[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mfill_price_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242morder[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140maverage[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242morder[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140maverage[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mMarket (Check Fills)[0m[38;2;241;250;140m"[0m
[38;5;238m 919[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mfilled_qty_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242morder[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mfilled[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242morder[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mfilled[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140m?[0m[38;2;241;250;140m"[0m
[38;5;238m 920[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242morder_id_short[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m([0m[38;2;248;248;242morder[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mid[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m6[0m[38;2;248;248;242m:[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Get last 6 chars of ID for brevity[0m
[38;5;238m 921[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mcost_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242morder[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mcost[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242morder[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mcost[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Cost in quote currency (USDT)[0m
[38;5;238m 922[0m   [38;5;238mâ”‚[0m 
[38;5;238m 923[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123msuccess[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mClose Position: CLOSE Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mreason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) placed successfully for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. [0m[38;2;241;250;140m"[0m
[38;5;238m 924[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                       [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mQty Filled: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfilled_qty_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m/[0m[38;2;248;248;242m{[0m[38;2;248;248;242mamount_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Avg Fill ~[0m[38;2;248;248;242m{[0m[38;2;248;248;242mfill_price_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Cost: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcost_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT. ID:...[0m[38;2;248;248;242m{[0m[38;2;248;248;242morder_id_short[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 925[0m   [38;5;238mâ”‚[0m 
[38;5;238m 926[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Send SMS Alert on successful order placement[0m
[38;5;238m 927[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242msms_msg[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] Closed [0m[38;2;248;248;242m{[0m[38;2;248;248;242mlive_position_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m [0m[38;2;248;248;242m{[0m[38;2;248;248;242mamount_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m @ ~[0m[38;2;248;248;242m{[0m[38;2;248;248;242mfill_price_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mreason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). [0m[38;2;241;250;140m"[0m
[38;5;238m 928[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                   [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mID:...[0m[38;2;248;248;242m{[0m[38;2;248;248;242morder_id_short[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 929[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[38;2;248;248;242msms_msg[0m[38;2;248;248;242m)[0m
[38;5;238m 930[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242morder[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Return the order details dictionary[0m
[38;5;238m 931[0m   [38;5;238mâ”‚[0m 
[38;5;238m 932[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Error Handling for Order Creation ---[0m
[38;5;238m 933[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mInsufficientFunds[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 934[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m This *shouldn't* happen often with reduce_only, but possible in weird margin scenarios[0m
[38;5;238m 935[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mClose Position ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mreason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Insufficient funds error during close attempt: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 936[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ERROR Closing ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mreason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Insufficient funds! Check margin.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 937[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mNetworkError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 938[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mClose Position ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mreason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Network error placing close order: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 939[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m SMS might fail here too if network is down[0m
[38;5;238m 940[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mExchangeError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 941[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log the specific error message from the exchange (e.g., "position is zero", etc.)[0m
[38;5;238m 942[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mClose Position ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mreason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Exchange error placing close order: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 943[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Check for specific common errors if needed (e.g., position already closed)[0m
[38;5;238m 944[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m if "order would not reduce position size" in str(e).lower():[0m
[38;5;238m 945[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m     logger.warning(f"Close Position ({reason}): Exchange indicates order would not reduce size. Position likely already closed or closing.")[0m
[38;5;238m 946[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m     return None # Treat as potentially already closed[0m
[38;5;238m 947[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ERROR Closing ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mreason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Exchange error ([0m[38;2;248;248;242m{[0m[38;2;139;233;253mtype[0m[38;2;248;248;242m([0m[38;2;248;248;242me[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;248;248;242m__name__[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Check logs.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 948[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mValueError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 949[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Catch potential errors from amount_to_precision or float conversion[0m
[38;5;238m 950[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mClose Position ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mreason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Value error during amount processing (Qty: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mlive_amount_to_close[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 951[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 952[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mClose Position ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mreason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Unexpected error placing close order: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 953[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m 954[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ERROR Closing ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mreason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Unexpected error ([0m[38;2;248;248;242m{[0m[38;2;139;233;253mtype[0m[38;2;248;248;242m([0m[38;2;248;248;242me[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;248;248;242m__name__[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Check logs.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 955[0m   [38;5;238mâ”‚[0m 
[38;5;238m 956[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Return None if any exception occurred during order placement[0m
[38;5;238m 957[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 958[0m   [38;5;238mâ”‚[0m 
[38;5;238m 959[0m   [38;5;238mâ”‚[0m 
[38;5;238m 960[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Risk Calculation ---[0m
[38;5;238m 961[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123mcalculate_position_size[0m[38;2;248;248;242m([0m
[38;5;238m 962[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mequity[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mrisk_per_trade_pct[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mentry_price[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mstop_loss_price[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m
[38;5;238m 963[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mleverage[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108msymbol[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mexchange[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;255;121;198m.[0m[38;2;248;248;242mExchange[0m
[38;5;238m 964[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;248;248;242m->[0m[38;2;248;248;242m [0m[38;2;248;248;242mTuple[0m[38;2;248;248;242m[[0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m, [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m][0m[38;2;248;248;242m:[0m
[38;5;238m 965[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 966[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Calculates position size (quantity) based on risk percentage, entry/SL prices,[0m
[38;5;238m 967[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    and estimates the required initial margin (without buffer).[0m
[38;5;238m 968[0m   [38;5;238mâ”‚[0m 
[38;5;238m 969[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Args:[0m
[38;5;238m 970[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        equity (float): Current account equity (or relevant balance) in USDT.[0m
[38;5;238m 971[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        risk_per_trade_pct (float): Desired risk percentage (e.g., 0.01 for 1%).[0m
[38;5;238m 972[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        entry_price (float): Estimated entry price.[0m
[38;5;238m 973[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        stop_loss_price (float): Calculated stop-loss price.[0m
[38;5;238m 974[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        leverage (int): Leverage used for the symbol.[0m
[38;5;238m 975[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        symbol (str): Market symbol (used for precision).[0m
[38;5;238m 976[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        exchange (ccxt.Exchange): CCXT exchange instance (used for precision).[0m
[38;5;238m 977[0m   [38;5;238mâ”‚[0m 
[38;5;238m 978[0m   [38;5;238mâ”‚[0m 
[38;5;238m 979[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Returns:[0m
[38;5;238m 980[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        Tuple[Optional[float], Optional[float]]: (quantity, required_margin_estimate)[0m
[38;5;238m 981[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m           - quantity (float): The calculated position size in base currency (e.g., BTC).[0m
[38;5;238m 982[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m           - required_margin_estimate (float): Estimated USDT margin needed for the position.[0m
[38;5;238m 983[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m           Returns (None, None) if calculation is invalid or results in zero/negative size.[0m
[38;5;238m 984[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 985[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRisk Calc Input: Equity=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mequity[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Risk%=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mrisk_per_trade_pct[0m[38;2;189;147;249m:.3%[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, [0m[38;2;241;250;140m"[0m
[38;5;238m 986[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mEntry=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mentry_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, SL=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mstop_loss_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Lev=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mleverage[0m[38;2;248;248;242m}[0m[38;2;241;250;140mx, Symbol=[0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 987[0m   [38;5;238mâ”‚[0m 
[38;5;238m 988[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Input Validation ---[0m
[38;5;238m 989[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242mentry_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mstop_loss_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 990[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mRisk Calc: Invalid entry or stop-loss price (must be > 0).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 991[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m, [0m[38;2;189;147;249mNone[0m
[38;5;238m 992[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mprice_difference_per_unit[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;139;233;253mabs[0m[38;2;248;248;242m([0m[38;2;248;248;242mentry_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m-[0m[38;2;248;248;242m [0m[38;2;248;248;242mstop_loss_price[0m[38;2;248;248;242m)[0m
[38;5;238m 993[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mprice_difference_per_unit[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_QTY_EPSILON[0m[38;2;248;248;242m:[0m
[38;5;238m 994[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRisk Calc: Entry ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mentry_price[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) and stop-loss ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mstop_loss_price[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) prices are too close or identical. Cannot calculate size.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 995[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m, [0m[38;2;189;147;249mNone[0m
[38;5;238m 996[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;248;248;242mrisk_per_trade_pct[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m[38;2;248;248;242m:[0m
[38;5;238m 997[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRisk Calc: Invalid risk_per_trade_pct: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mrisk_per_trade_pct[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Must be between 0 and 1 (exclusive).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 998[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m, [0m[38;2;189;147;249mNone[0m
[38;5;238m 999[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mequity[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m:[0m
[38;5;238m1000[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRisk Calc: Invalid equity (<= 0): [0m[38;2;248;248;242m{[0m[38;2;248;248;242mequity[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1001[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m, [0m[38;2;189;147;249mNone[0m
[38;5;238m1002[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mleverage[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m:[0m
[38;5;238m1003[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRisk Calc: Invalid leverage (<= 0): [0m[38;2;248;248;242m{[0m[38;2;248;248;242mleverage[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1004[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m, [0m[38;2;189;147;249mNone[0m
[38;5;238m1005[0m   [38;5;238mâ”‚[0m 
[38;5;238m1006[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Calculation ---[0m
[38;5;238m1007[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m 1. Calculate Risk Amount in USDT[0m
[38;5;238m1008[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mrisk_amount_usdt[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mequity[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;248;248;242mrisk_per_trade_pct[0m
[38;5;238m1009[0m   [38;5;238mâ”‚[0m 
[38;5;238m1010[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m 2. Calculate Position Size (Quantity)[0m
[38;5;238m1011[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Quantity = Risk Amount / (Price difference per unit)[0m
[38;5;238m1012[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mquantity[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mrisk_amount_usdt[0m[38;2;248;248;242m [0m[38;2;255;121;198m/[0m[38;2;248;248;242m [0m[38;2;248;248;242mprice_difference_per_unit[0m
[38;5;238m1013[0m   [38;5;238mâ”‚[0m 
[38;5;238m1014[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Apply exchange precision to the calculated quantity *early*[0m
[38;5;238m1015[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m1016[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mquantity_precise_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mamount_to_precision[0m[38;2;248;248;242m([0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mquantity[0m[38;2;248;248;242m)[0m
[38;5;238m1017[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mquantity_precise[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mquantity_precise_str[0m[38;2;248;248;242m)[0m
[38;5;238m1018[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRisk Calc: Raw Qty=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mquantity[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Precise Qty=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mquantity_precise_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1019[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mquantity[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mquantity_precise[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Use the precise quantity for further calculations[0m
[38;5;238m1020[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1021[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRisk Calc: Could not apply precision to quantity [0m[38;2;248;248;242m{[0m[38;2;248;248;242mquantity[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Using raw value. Error: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1022[0m   [38;5;238mâ”‚[0m 
[38;5;238m1023[0m   [38;5;238mâ”‚[0m 
[38;5;238m1024[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m 3. Check if calculated quantity is valid[0m
[38;5;238m1025[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mquantity[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_QTY_EPSILON[0m[38;2;248;248;242m:[0m
[38;5;238m1026[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRisk Calc: Calculated quantity ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mquantity[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) is zero or negligible based on risk parameters. [0m[38;2;241;250;140m"[0m
[38;5;238m1027[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                       [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRiskAmt=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mrisk_amount_usdt[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, PriceDiff=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mprice_difference_per_unit[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1028[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m, [0m[38;2;189;147;249mNone[0m
[38;5;238m1029[0m   [38;5;238mâ”‚[0m 
[38;5;238m1030[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m 4. Estimate Position Value and Required Margin (Initial Margin)[0m
[38;5;238m1031[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mposition_value_usdt[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mquantity[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price[0m
[38;5;238m1032[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Required Margin = Position Value / Leverage[0m
[38;5;238m1033[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mrequired_margin_estimate[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition_value_usdt[0m[38;2;248;248;242m [0m[38;2;255;121;198m/[0m[38;2;248;248;242m [0m[38;2;248;248;242mleverage[0m
[38;5;238m1034[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Note: This is the *initial* margin estimate. Actual margin requirements might[0m
[38;5;238m1035[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m include fees, funding rates, and vary slightly based on exact fill price.[0m
[38;5;238m1036[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m The margin *buffer* check happens later using free balance.[0m
[38;5;238m1037[0m   [38;5;238mâ”‚[0m 
[38;5;238m1038[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRisk Calc Output: RiskAmt=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mrisk_amount_usdt[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, PriceDiff=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mprice_difference_per_unit[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m [0m[38;2;241;250;140m"[0m
[38;5;238m1039[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m=> PreciseQty=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mquantity[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, EstPosValue=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mposition_value_usdt[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, EstMarginBase=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mrequired_margin_estimate[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1040[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mquantity[0m[38;2;248;248;242m, [0m[38;2;248;248;242mrequired_margin_estimate[0m
[38;5;238m1041[0m   [38;5;238mâ”‚[0m 
[38;5;238m1042[0m   [38;5;238mâ”‚[0m 
[38;5;238m1043[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Place Order ---[0m
[38;5;238m1044[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123mplace_risked_market_order[0m[38;2;248;248;242m([0m
[38;5;238m1045[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mexchange[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;255;121;198m.[0m[38;2;248;248;242mExchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108msymbol[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mside[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m,[0m
[38;5;238m1046[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mrisk_percentage[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mcurrent_atr[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108msl_atr_multiplier[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m
[38;5;238m1047[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mleverage[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mmax_order_cap_usdt[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mmargin_check_buffer[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m
[38;5;238m1048[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;248;248;242m->[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[38;2;248;248;242mDict[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m, [0m[38;2;248;248;242mAny[0m[38;2;248;248;242m][0m[38;2;248;248;242m][0m[38;2;248;248;242m:[0m
[38;5;238m1049[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m
[38;5;238m1050[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Calculates position size based on risk & ATR SL, checks balance, limits, and margin,[0m
[38;5;238m1051[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    then places a market order if all checks pass. Sends SMS alerts.[0m
[38;5;238m1052[0m   [38;5;238mâ”‚[0m 
[38;5;238m1053[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Args:[0m
[38;5;238m1054[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        exchange (ccxt.Exchange): Initialized CCXT exchange object.[0m
[38;5;238m1055[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        symbol (str): Market symbol (e.g., 'BTC/USDT:USDT').[0m
[38;5;238m1056[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        side (str): 'buy' or 'sell'.[0m
[38;5;238m1057[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        risk_percentage (float): Risk per trade as a decimal (e.g., 0.01 for 1%).[0m
[38;5;238m1058[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        current_atr (Optional[float]): The current ATR value for SL calculation.[0m
[38;5;238m1059[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        sl_atr_multiplier (float): Multiplier for ATR to determine SL distance.[0m
[38;5;238m1060[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        leverage (int): Leverage confirmed for the symbol.[0m
[38;5;238m1061[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        max_order_cap_usdt (float): Maximum allowed position size in USDT value.[0m
[38;5;238m1062[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        margin_check_buffer (float): Buffer multiplier for checking available margin (e.g., 1.05 for 5% buffer).[0m
[38;5;238m1063[0m   [38;5;238mâ”‚[0m 
[38;5;238m1064[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Returns:[0m
[38;5;238m1065[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        Optional[Dict[str, Any]]: The CCXT order dictionary if the order was successfully placed, None otherwise.[0m
[38;5;238m1066[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    [0m[38;2;98;114;164m"""[0m
[38;5;238m1067[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;255;121;198m.[0m[38;2;80;250;123msplit[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140m/[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m[[0m[38;2;189;147;249m0[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m For concise SMS alerts[0m
[38;5;238m1068[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Initiating [0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m market order placement for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1069[0m   [38;5;238mâ”‚[0m 
[38;5;238m1070[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Pre-computation Checks ---[0m
[38;5;238m1071[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m:[0m
[38;5;238m1072[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Invalid ATR value ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) provided for SL calculation. Cannot place order.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1073[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ORDER FAIL ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Invalid ATR provided.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1074[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1075[0m   [38;5;238mâ”‚[0m 
[38;5;238m1076[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mentry_price_estimate[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1077[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mstop_loss_price[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1078[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mfinal_quantity[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1079[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m"[0m
[38;5;238m1080[0m   [38;5;238mâ”‚[0m 
[38;5;238m1081[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m1082[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- 1. Get Balance, Market Info, and Limits ---[0m
[38;5;238m1083[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Fetching balance and market details...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1084[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mbalance[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mfetch_balance[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m
[38;5;238m1085[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mmarket[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mmarket[0m[38;2;248;248;242m([0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m)[0m
[38;5;238m1086[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlimits[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mmarket[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mlimits[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m)[0m
[38;5;238m1087[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mamount_limits[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlimits[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mamount[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m)[0m
[38;5;238m1088[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mprice_limits[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlimits[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mprice[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m)[0m
[38;5;238m1089[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mmin_qty[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mamount_limits[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mmin[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m1090[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mmax_qty[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mamount_limits[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mmax[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m1091[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mqty_precision[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mmarket[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mprecision[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mamount[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Number of decimal places for quantity[0m
[38;5;238m1092[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mprice_precision[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mmarket[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mprecision[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mprice[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Number of decimal places for price[0m
[38;5;238m1093[0m   [38;5;238mâ”‚[0m 
[38;5;238m1094[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Get available equity/free balance in USDT[0m
[38;5;238m1095[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242musdt_balance[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mbalance[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;255;255;255mUSDT_SYMBOL[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m)[0m
[38;5;238m1096[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242musdt_total[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242musdt_balance[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mtotal[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Total equity[0m
[38;5;238m1097[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242musdt_free[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242musdt_balance[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mfree[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Free margin available[0m
[38;5;238m1098[0m   [38;5;238mâ”‚[0m 
[38;5;238m1099[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Use total equity for risk calculation, but free margin for placement check[0m
[38;5;238m1100[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Fallback logic if 'total' is None or zero[0m
[38;5;238m1101[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242musdt_total[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242musdt_total[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m:[0m
[38;5;238m1102[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: USDT 'total' balance is [0m[38;2;248;248;242m{[0m[38;2;248;248;242musdt_total[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Using 'free' balance ([0m[38;2;248;248;242m{[0m[38;2;248;248;242musdt_free[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) for equity calculation.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1103[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242musdt_equity[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242musdt_free[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242musdt_free[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m
[38;5;238m1104[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1105[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242musdt_equity[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242musdt_total[0m
[38;5;238m1106[0m   [38;5;238mâ”‚[0m 
[38;5;238m1107[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242musdt_equity[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242musdt_equity[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m:[0m
[38;5;238m1108[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Cannot determine valid account equity (USDT total/free is zero, negative, or None).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1109[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ORDER FAIL ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Zero/Invalid equity.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1110[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1111[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242musdt_free[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242musdt_free[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Free margin must be available[0m
[38;5;238m1112[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Invalid free margin (USDT free is [0m[38;2;248;248;242m{[0m[38;2;248;248;242musdt_free[0m[38;2;248;248;242m}[0m[38;2;241;250;140m).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1113[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ORDER FAIL ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Invalid free margin.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1114[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1115[0m   [38;5;238mâ”‚[0m 
[38;5;238m1116[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Account Balance -> Equity=[0m[38;2;248;248;242m{[0m[38;2;248;248;242musdt_equity[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT, Free Margin=[0m[38;2;248;248;242m{[0m[38;2;248;248;242musdt_free[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1117[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Market Limits -> MinQty=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmin_qty[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, MaxQty=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmax_qty[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, QtyPrec=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mqty_precision[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, PricePrec=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mprice_precision[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1118[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Market Price Limits -> MinPrice=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mprice_limits[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mmin[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, MaxPrice=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mprice_limits[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mmax[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1119[0m   [38;5;238mâ”‚[0m 
[38;5;238m1120[0m   [38;5;238mâ”‚[0m 
[38;5;238m1121[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- 2. Estimate Entry Price ---[0m
[38;5;238m1122[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Use a shallow order book fetch for a slightly more realistic entry price estimate than ticker 'last'[0m
[38;5;238m1123[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Fetching shallow OB (depth [0m[38;2;248;248;242m{[0m[38;2;255;255;255mSHALLOW_OB_FETCH_DEPTH[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) for entry price estimate...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1124[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mob_data[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123manalyze_order_book[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mSHALLOW_OB_FETCH_DEPTH[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mSHALLOW_OB_FETCH_DEPTH[0m[38;2;248;248;242m)[0m
[38;5;238m1125[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mbest_ask[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mob_data[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mbest_ask[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1126[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mbest_bid[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mob_data[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mbest_bid[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1127[0m   [38;5;238mâ”‚[0m 
[38;5;238m1128[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mside[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;255;255mSIDE_BUY[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mbest_ask[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mbest_ask[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m:[0m
[38;5;238m1129[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mentry_price_estimate[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mbest_ask[0m
[38;5;238m1130[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Using best ASK [0m[38;2;248;248;242m{[0m[38;2;248;248;242mentry_price_estimate[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m from shallow OB as BUY entry estimate.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1131[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melif[0m[38;2;248;248;242m [0m[38;2;248;248;242mside[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;255;255mSIDE_SELL[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mbest_bid[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mbest_bid[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m:[0m
[38;5;238m1132[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mentry_price_estimate[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mbest_bid[0m
[38;5;238m1133[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Using best BID [0m[38;2;248;248;242m{[0m[38;2;248;248;242mentry_price_estimate[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m from shallow OB as SELL entry estimate.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1134[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1135[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Fallback to ticker 'last' price if OB fetch fails or returns invalid prices[0m
[38;5;238m1136[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Shallow OB fetch failed or returned invalid bid/ask. Falling back to ticker 'last' price for entry estimate.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1137[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m1138[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mticker[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mfetch_ticker[0m[38;2;248;248;242m([0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m)[0m
[38;5;238m1139[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mentry_price_estimate[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mticker[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mlast[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m1140[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price_estimate[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Using ticker 'last' price [0m[38;2;248;248;242m{[0m[38;2;248;248;242mentry_price_estimate[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m as entry estimate.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1141[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242mticker_err[0m[38;2;248;248;242m:[0m
[38;5;238m1142[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Failed to fetch ticker price as fallback: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mticker_err[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1143[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mentry_price_estimate[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Ensure it's None if ticker fails too[0m
[38;5;238m1144[0m   [38;5;238mâ”‚[0m 
[38;5;238m1145[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Validate the estimated entry price[0m
[38;5;238m1146[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price_estimate[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price_estimate[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m:[0m
[38;5;238m1147[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Could not determine a valid entry price estimate (Estimate: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mentry_price_estimate[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Cannot place order.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1148[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ORDER FAIL ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): No valid entry price estimate.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1149[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1150[0m   [38;5;238mâ”‚[0m 
[38;5;238m1151[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- 3. Calculate Stop Loss Price ---[0m
[38;5;238m1152[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mstop_loss_distance[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;248;248;242msl_atr_multiplier[0m
[38;5;238m1153[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mside[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;255;255mSIDE_BUY[0m[38;2;248;248;242m:[0m
[38;5;238m1154[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mstop_loss_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price_estimate[0m[38;2;248;248;242m [0m[38;2;255;121;198m-[0m[38;2;248;248;242m [0m[38;2;248;248;242mstop_loss_distance[0m
[38;5;238m1155[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m SIDE_SELL[0m
[38;5;238m1156[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mstop_loss_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price_estimate[0m[38;2;248;248;242m [0m[38;2;255;121;198m+[0m[38;2;248;248;242m [0m[38;2;248;248;242mstop_loss_distance[0m
[38;5;238m1157[0m   [38;5;238mâ”‚[0m 
[38;5;238m1158[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Ensure SL price is positive and respects exchange minimum price limit[0m
[38;5;238m1159[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mmin_price_limit[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mprice_limits[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mmin[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m1160[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mmin_price_limit[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mstop_loss_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;248;248;242mmin_price_limit[0m[38;2;248;248;242m:[0m
[38;5;238m1161[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Calculated SL price [0m[38;2;248;248;242m{[0m[38;2;248;248;242mstop_loss_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m is below minimum limit [0m[38;2;248;248;242m{[0m[38;2;248;248;242mmin_price_limit[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Adjusting SL to minimum limit.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1162[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mstop_loss_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mmin_price_limit[0m
[38;5;238m1163[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melif[0m[38;2;248;248;242m [0m[38;2;248;248;242mstop_loss_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m:[0m
[38;5;238m1164[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Calculated SL price [0m[38;2;248;248;242m{[0m[38;2;248;248;242mstop_loss_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m is zero or negative. Adjusting SL to a small positive value (e.g., min price limit or tiny fraction).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1165[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Adjust to min price limit if available, otherwise a very small number might be risky.[0m
[38;5;238m1166[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;98;114;164m#[0m[38;2;98;114;164m For simplicity, let's prevent order if SL becomes invalid. A better approach might use a fixed % SL as fallback.[0m
[38;5;238m1167[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mmin_price_limit[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m:[0m
[38;5;238m1168[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mstop_loss_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mmin_price_limit[0m
[38;5;238m1169[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1170[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Calculated SL price is invalid ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mstop_loss_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) and no minimum price limit found. Cannot place order.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1171[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ORDER FAIL ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Invalid SL price calc.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1172[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1173[0m   [38;5;238mâ”‚[0m 
[38;5;238m1174[0m   [38;5;238mâ”‚[0m 
[38;5;238m1175[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Apply exchange price precision to the calculated SL price[0m
[38;5;238m1176[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m1177[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mstop_loss_price_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mprice_to_precision[0m[38;2;248;248;242m([0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mstop_loss_price[0m[38;2;248;248;242m)[0m
[38;5;238m1178[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mstop_loss_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mstop_loss_price_str[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Convert back to float after formatting[0m
[38;5;238m1179[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Calculated SL -> EntryEst=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mentry_price_estimate[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, [0m[38;2;241;250;140m"[0m
[38;5;238m1180[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mATR([0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_atr[0m[38;2;189;147;249m:.5f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) * [0m[38;2;248;248;242m{[0m[38;2;248;248;242msl_atr_multiplier[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (Dist=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mstop_loss_distance[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) => SL Price ~[0m[38;2;248;248;242m{[0m[38;2;248;248;242mstop_loss_price_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1181[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1182[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Error applying precision to SL price [0m[38;2;248;248;242m{[0m[38;2;248;248;242mstop_loss_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Aborting.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1183[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1184[0m   [38;5;238mâ”‚[0m 
[38;5;238m1185[0m   [38;5;238mâ”‚[0m 
[38;5;238m1186[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- 4. Calculate Position Size and Estimate Initial Margin ---[0m
[38;5;238m1187[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mcalculated_quantity[0m[38;2;248;248;242m, [0m[38;2;248;248;242mrequired_margin_estimate[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mcalculate_position_size[0m[38;2;248;248;242m([0m
[38;5;238m1188[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mequity[0m[38;2;255;121;198m=[0m[38;2;248;248;242musdt_equity[0m[38;2;248;248;242m,[0m
[38;5;238m1189[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mrisk_per_trade_pct[0m[38;2;255;121;198m=[0m[38;2;248;248;242mrisk_percentage[0m[38;2;248;248;242m,[0m
[38;5;238m1190[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mentry_price[0m[38;2;255;121;198m=[0m[38;2;248;248;242mentry_price_estimate[0m[38;2;248;248;242m,[0m
[38;5;238m1191[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mstop_loss_price[0m[38;2;255;121;198m=[0m[38;2;248;248;242mstop_loss_price[0m[38;2;248;248;242m,[0m
[38;5;238m1192[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mleverage[0m[38;2;255;121;198m=[0m[38;2;248;248;242mleverage[0m[38;2;248;248;242m,[0m
[38;5;238m1193[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108msymbol[0m[38;2;255;121;198m=[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m
[38;5;238m1194[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mexchange[0m[38;2;255;121;198m=[0m[38;2;248;248;242mexchange[0m
[38;5;238m1195[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242m)[0m
[38;5;238m1196[0m   [38;5;238mâ”‚[0m 
[38;5;238m1197[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mcalculated_quantity[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mrequired_margin_estimate[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m:[0m
[38;5;238m1198[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Failed to calculate valid position size/margin based on risk parameters. Check logs from calculate_position_size.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1199[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ORDER FAIL ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Risk calculation failed.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1200[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1201[0m   [38;5;238mâ”‚[0m 
[38;5;238m1202[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mfinal_quantity[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mcalculated_quantity[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Start with the risk-calculated quantity[0m
[38;5;238m1203[0m   [38;5;238mâ”‚[0m 
[38;5;238m1204[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- 5. Apply Max Order Cap (USDT Value) ---[0m
[38;5;238m1205[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242morder_value_usdt[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mfinal_quantity[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price_estimate[0m
[38;5;238m1206[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242morder_value_usdt[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;248;248;242mmax_order_cap_usdt[0m[38;2;248;248;242m:[0m
[38;5;238m1207[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Initial risk-based order value [0m[38;2;248;248;242m{[0m[38;2;248;248;242morder_value_usdt[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT exceeds MAX Cap [0m[38;2;248;248;242m{[0m[38;2;248;248;242mmax_order_cap_usdt[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT. Capping quantity.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1208[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mfinal_quantity[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mmax_order_cap_usdt[0m[38;2;248;248;242m [0m[38;2;255;121;198m/[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price_estimate[0m
[38;5;238m1209[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Recalculate estimated margin based on the capped quantity[0m
[38;5;238m1210[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mrequired_margin_estimate[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242mmax_order_cap_usdt[0m[38;2;248;248;242m [0m[38;2;255;121;198m/[0m[38;2;248;248;242m [0m[38;2;248;248;242mleverage[0m[38;2;248;248;242m)[0m
[38;5;238m1211[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Quantity capped to ~[0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_quantity[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m based on Max Cap. New Est. Margin ~[0m[38;2;248;248;242m{[0m[38;2;248;248;242mrequired_margin_estimate[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1212[0m   [38;5;238mâ”‚[0m 
[38;5;238m1213[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- 6. Apply Exchange Precision and Check Min/Max Quantity Limits ---[0m
[38;5;238m1214[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m1215[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mamount_to_precision[0m[38;2;248;248;242m([0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mfinal_quantity[0m[38;2;248;248;242m)[0m
[38;5;238m1216[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mfinal_quantity[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m)[0m
[38;5;238m1217[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Quantity after precision: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1218[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1219[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Error applying precision to final quantity [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_quantity[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Aborting.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1220[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1221[0m   [38;5;238mâ”‚[0m 
[38;5;238m1222[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Check if final quantity is effectively zero after precision[0m
[38;5;238m1223[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mfinal_quantity[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_QTY_EPSILON[0m[38;2;248;248;242m:[0m
[38;5;238m1224[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Final quantity [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m is zero or negligible after risk calc/capping/precision. Cannot place order.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1225[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m No order to place[0m
[38;5;238m1226[0m   [38;5;238mâ”‚[0m 
[38;5;238m1227[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Check against Min/Max quantity limits from the exchange[0m
[38;5;238m1228[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mmin_qty[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mfinal_quantity[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;248;248;242mmin_qty[0m[38;2;248;248;242m:[0m
[38;5;238m1229[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Final Qty [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m is LESS than exchange minimum quantity [0m[38;2;248;248;242m{[0m[38;2;248;248;242mmin_qty[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Skipping order.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1230[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Optionally, could place the minimum qty order, but that deviates from risk calc. Skipping is safer.[0m
[38;5;238m1231[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ORDER FAIL ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Qty [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m < Min [0m[38;2;248;248;242m{[0m[38;2;248;248;242mmin_qty[0m[38;2;248;248;242m}[0m[38;2;241;250;140m.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1232[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1233[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mmax_qty[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mfinal_quantity[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;248;248;242mmax_qty[0m[38;2;248;248;242m:[0m
[38;5;238m1234[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Final Qty [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m is GREATER than exchange maximum quantity [0m[38;2;248;248;242m{[0m[38;2;248;248;242mmax_qty[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Capping to max qty.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1235[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mfinal_quantity[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mmax_qty[0m
[38;5;238m1236[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Re-apply precision after capping to max_qty[0m
[38;5;238m1237[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m1238[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mamount_to_precision[0m[38;2;248;248;242m([0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mfinal_quantity[0m[38;2;248;248;242m)[0m
[38;5;238m1239[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mfinal_quantity[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m)[0m
[38;5;238m1240[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Recalculate estimated margin based on max quantity[0m
[38;5;238m1241[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mrequired_margin_estimate[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242m([0m[38;2;248;248;242mfinal_quantity[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price_estimate[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m/[0m[38;2;248;248;242m [0m[38;2;248;248;242mleverage[0m[38;2;248;248;242m)[0m
[38;5;238m1242[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Quantity capped to exchange max: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. New Est. Margin ~[0m[38;2;248;248;242m{[0m[38;2;248;248;242mrequired_margin_estimate[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1243[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1244[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Error applying precision after capping to max qty [0m[38;2;248;248;242m{[0m[38;2;248;248;242mmax_qty[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Aborting.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1245[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1246[0m   [38;5;238mâ”‚[0m 
[38;5;238m1247[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Re-calculate final estimated position value and margin after all adjustments[0m
[38;5;238m1248[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mfinal_pos_value[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mfinal_quantity[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price_estimate[0m
[38;5;238m1249[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mfinal_req_margin[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mfinal_pos_value[0m[38;2;248;248;242m [0m[38;2;255;121;198m/[0m[38;2;248;248;242m [0m[38;2;248;248;242mleverage[0m
[38;5;238m1250[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Final Order Details -> Qty=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, [0m[38;2;241;250;140m"[0m
[38;5;238m1251[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mEst. Value=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_pos_value[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT, [0m[38;2;241;250;140m"[0m
[38;5;238m1252[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mEst. Req. Margin=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_req_margin[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1253[0m   [38;5;238mâ”‚[0m 
[38;5;238m1254[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- 7. Check Available Margin (using Free Balance and Buffer) ---[0m
[38;5;238m1255[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mrequired_margin_with_buffer[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mfinal_req_margin[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;248;248;242mmargin_check_buffer[0m
[38;5;238m1256[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242musdt_free[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;248;248;242mrequired_margin_with_buffer[0m[38;2;248;248;242m:[0m
[38;5;238m1257[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Insufficient FREE margin. [0m[38;2;241;250;140m"[0m
[38;5;238m1258[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                         [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRequires ~[0m[38;2;248;248;242m{[0m[38;2;248;248;242mrequired_margin_with_buffer[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT [0m[38;2;241;250;140m"[0m
[38;5;238m1259[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                         [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m(Base: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_req_margin[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Buffer: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mmargin_check_buffer[0m[38;2;189;147;249m:.1%[0m[38;2;248;248;242m}[0m[38;2;241;250;140m), [0m[38;2;241;250;140m"[0m
[38;5;238m1260[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                         [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mAvailable Free: [0m[38;2;248;248;242m{[0m[38;2;248;248;242musdt_free[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1261[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ORDER FAIL ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Insufficient Free Margin (Need ~[0m[38;2;248;248;242m{[0m[38;2;248;248;242mrequired_margin_with_buffer[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Have [0m[38;2;248;248;242m{[0m[38;2;248;248;242musdt_free[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1262[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1263[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1264[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Margin check passed. Required w/ Buffer: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mrequired_margin_with_buffer[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT <= Available Free: [0m[38;2;248;248;242m{[0m[38;2;248;248;242musdt_free[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1265[0m   [38;5;238mâ”‚[0m 
[38;5;238m1266[0m   [38;5;238mâ”‚[0m 
[38;5;238m1267[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- 8. Place the Market Order ---[0m
[38;5;238m1268[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m*** Placing [0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m MARKET ORDER: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m ***[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1269[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Ensure no extra params interfere with basic market order unless intended[0m
[38;5;238m1270[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mparams[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Start fresh, add specific params if needed (e.g., timeInForce)[0m
[38;5;238m1271[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242morder[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcreate_market_order[0m[38;2;248;248;242m([0m
[38;5;238m1272[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108msymbol[0m[38;2;255;121;198m=[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m
[38;5;238m1273[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mside[0m[38;2;255;121;198m=[0m[38;2;248;248;242mside[0m[38;2;248;248;242m,[0m
[38;5;238m1274[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mamount[0m[38;2;255;121;198m=[0m[38;2;248;248;242mfinal_quantity[0m[38;2;248;248;242m,[0m
[38;5;238m1275[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mparams[0m[38;2;255;121;198m=[0m[38;2;248;248;242mparams[0m
[38;5;238m1276[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242m)[0m
[38;5;238m1277[0m   [38;5;238mâ”‚[0m 
[38;5;238m1278[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- 9. Post-Order Handling & Logging ---[0m
[38;5;238m1279[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Extract details from the returned order object (structure varies slightly by exchange/ccxt version)[0m
[38;5;238m1280[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mfilled_qty[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242morder[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mfilled[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Amount actually filled[0m
[38;5;238m1281[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mavg_fill_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242morder[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140maverage[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Average price if filled[0m
[38;5;238m1282[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242morder_id[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242morder[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mid[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m1283[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242morder_status[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242morder[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mstatus[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m1284[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242morder_cost[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242morder[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mcost[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Cost in quote currency (USDT)[0m
[38;5;238m1285[0m   [38;5;238mâ”‚[0m 
[38;5;238m1286[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mfill_price_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mavg_fill_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mavg_fill_price[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m"[0m
[38;5;238m1287[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mfilled_qty_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mfilled_qty[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mfilled_qty[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140m?[0m[38;2;241;250;140m"[0m
[38;5;238m1288[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242morder_id_short[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m([0m[38;2;248;248;242morder_id[0m[38;2;248;248;242m)[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m6[0m[38;2;248;248;242m:[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Last 6 chars for brevity[0m
[38;5;238m1289[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mcost_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242morder_cost[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242morder_cost[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m"[0m
[38;5;238m1290[0m   [38;5;238mâ”‚[0m 
[38;5;238m1291[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123msuccess[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m Market Order Placed Successfully! [0m[38;2;241;250;140m"[0m
[38;5;238m1292[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                       [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mID:...[0m[38;2;248;248;242m{[0m[38;2;248;248;242morder_id_short[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Status: [0m[38;2;248;248;242m{[0m[38;2;248;248;242morder_status[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, [0m[38;2;241;250;140m"[0m
[38;5;238m1293[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                       [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mFilled Qty: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfilled_qty_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m/[0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, [0m[38;2;241;250;140m"[0m
[38;5;238m1294[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                       [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mAvg Fill Price: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfill_price_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Cost: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcost_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1295[0m   [38;5;238mâ”‚[0m 
[38;5;238m1296[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Send SMS Alert for successful entry[0m
[38;5;238m1297[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242msms_msg[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ENTER [0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m @ ~[0m[38;2;248;248;242m{[0m[38;2;248;248;242mfill_price_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. [0m[38;2;241;250;140m"[0m
[38;5;238m1298[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                   [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSL ~[0m[38;2;248;248;242m{[0m[38;2;248;248;242mstop_loss_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. ID:...[0m[38;2;248;248;242m{[0m[38;2;248;248;242morder_id_short[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Include calculated SL for reference[0m
[38;5;238m1299[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[38;2;248;248;242msms_msg[0m[38;2;248;248;242m)[0m
[38;5;238m1300[0m   [38;5;238mâ”‚[0m 
[38;5;238m1301[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- !!! CRITICAL SCALPING TODO !!! ---[0m
[38;5;238m1302[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m The calculated SL/TP based on estimated entry is NOT sufficient.[0m
[38;5;238m1303[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m You MUST place exchange-native SL/TP orders *after* this market order fills,[0m
[38;5;238m1304[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m using the actual `avg_fill_price` and `filled_qty`.[0m
[38;5;238m1305[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!![0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1306[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m!!! ACTION REQUIRED: Loop-based SL/TP is active for position ID ...[0m[38;2;248;248;242m{[0m[38;2;248;248;242morder_id_short[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. !!![0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1307[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m!!! This is UNSAFE. Implement exchange-native SL/TP orders based on fill price [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfill_price_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m !!![0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1308[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!![0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1309[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Example (Conceptual - Requires specific CCXT implementation for conditional orders):[0m
[38;5;238m1310[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m if avg_fill_price and filled_qty > 0:[0m
[38;5;238m1311[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m     actual_sl_price = avg_fill_price - stop_loss_distance # Recalculate based on fill[0m
[38;5;238m1312[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m     actual_tp_price = avg_fill_price + tp_distance # Recalculate based on fill[0m
[38;5;238m1313[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m     exchange.create_order(symbol, 'stopMarket', 'sell' if side == 'buy' else 'buy', filled_qty, params={'stopPrice': actual_sl_price, 'reduce_only': True})[0m
[38;5;238m1314[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m     exchange.create_order(symbol, 'takeProfitMarket', 'sell' if side == 'buy' else 'buy', filled_qty, params={'stopPrice': actual_tp_price, 'reduce_only': True})[0m
[38;5;238m1315[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m ---------------------------------------[0m
[38;5;238m1316[0m   [38;5;238mâ”‚[0m 
[38;5;238m1317[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242morder[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Return the order dictionary[0m
[38;5;238m1318[0m   [38;5;238mâ”‚[0m 
[38;5;238m1319[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Exception Handling for Order Placement Process ---[0m
[38;5;238m1320[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mInsufficientFunds[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1321[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m This might occur if free margin calculation was slightly off or fees pushed it over[0m
[38;5;238m1322[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Insufficient funds error during order placement: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1323[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ORDER FAIL ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Insufficient funds reported by exchange![0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1324[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mNetworkError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1325[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Network error during order placement: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1326[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m SMS might fail too[0m
[38;5;238m1327[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mExchangeError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1328[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log specific exchange errors (e.g., margin checks, order validation)[0m
[38;5;238m1329[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Exchange error during order placement: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1330[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ORDER FAIL ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Exchange error ([0m[38;2;248;248;242m{[0m[38;2;139;233;253mtype[0m[38;2;248;248;242m([0m[38;2;248;248;242me[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;248;248;242m__name__[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Check logs.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1331[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mValueError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1332[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Catch potential errors from precision formatting or float conversions[0m
[38;5;238m1333[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Value error during price/amount processing: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1334[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1335[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Unexpected critical error during order placement logic: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1336[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m1337[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ORDER FAIL ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Unexpected error ([0m[38;2;248;248;242m{[0m[38;2;139;233;253mtype[0m[38;2;248;248;242m([0m[38;2;248;248;242me[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;248;248;242m__name__[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Check logs.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1338[0m   [38;5;238mâ”‚[0m 
[38;5;238m1339[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Return None if any exception occurred during the process[0m
[38;5;238m1340[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1341[0m   [38;5;238mâ”‚[0m 
[38;5;238m1342[0m   [38;5;238mâ”‚[0m 
[38;5;238m1343[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Trading Logic ---[0m
[38;5;238m1344[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123mtrade_logic[0m[38;2;248;248;242m([0m
[38;5;238m1345[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mexchange[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;255;121;198m.[0m[38;2;248;248;242mExchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108msymbol[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mdf[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;248;248;242mDataFrame[0m[38;2;248;248;242m,[0m
[38;5;238m1346[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mst_len[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mst_mult[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mcf_st_len[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mcf_st_mult[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m
[38;5;238m1347[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108matr_len[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mvol_ma_len[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m
[38;5;238m1348[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mrisk_pct[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108msl_atr_mult[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mtp_atr_mult[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mleverage[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m
[38;5;238m1349[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mmax_order_cap[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mmargin_buffer[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m
[38;5;238m1350[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;248;248;242m->[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m:[0m
[38;5;238m1351[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m
[38;5;238m1352[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Executes the main trading logic for a single cycle.[0m
[38;5;238m1353[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    1. Calculates indicators (Supertrends, ATR, Volume).[0m
[38;5;238m1354[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    2. Analyzes Order Book (conditionally).[0m
[38;5;238m1355[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    3. Gets current position status.[0m
[38;5;238m1356[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    4. Logs current market state.[0m
[38;5;238m1357[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    5. Checks loop-based Stop-Loss / Take-Profit (UNSAFE FOR LIVE SCALPING).[0m
[38;5;238m1358[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    6. Checks for entry signals based on dual Supertrend and optional confirmations.[0m
[38;5;238m1359[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    7. Executes entry or exit actions (closing existing position if reversing).[0m
[38;5;238m1360[0m   [38;5;238mâ”‚[0m 
[38;5;238m1361[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    *** WARNING: Contains loop-based SL/TP check which is unsuitable for live scalping. ***[0m
[38;5;238m1362[0m   [38;5;238mâ”‚[0m 
[38;5;238m1363[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Args:[0m
[38;5;238m1364[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        exchange (ccxt.Exchange): Initialized CCXT exchange instance.[0m
[38;5;238m1365[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        symbol (str): Trading symbol (e.g., 'BTC/USDT:USDT').[0m
[38;5;238m1366[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        df (pd.DataFrame): DataFrame with fresh OHLCV data.[0m
[38;5;238m1367[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        st_len, st_mult: Primary Supertrend parameters.[0m
[38;5;238m1368[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        cf_st_len, cf_st_mult: Confirmation Supertrend parameters.[0m
[38;5;238m1369[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        atr_len: ATR period for SL/TP calculation.[0m
[38;5;238m1370[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        vol_ma_len: Volume MA period.[0m
[38;5;238m1371[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        risk_pct: Risk per trade percentage.[0m
[38;5;238m1372[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        sl_atr_mult, tp_atr_mult: ATR multipliers for SL/TP.[0m
[38;5;238m1373[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        leverage: Confirmed leverage for the symbol.[0m
[38;5;238m1374[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        max_order_cap: Max USDT order value cap.[0m
[38;5;238m1375[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        margin_buffer: Buffer for margin check before placing order.[0m
[38;5;238m1376[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    [0m[38;2;98;114;164m"""[0m
[38;5;238m1377[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mcycle_time_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mindex[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;80;250;123mstrftime[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;189;147;249m%Y[0m[38;2;241;250;140m-[0m[38;2;189;147;249m%m[0m[38;2;241;250;140m-[0m[38;2;189;147;249m%d[0m[38;2;241;250;140m [0m[38;2;189;147;249m%H[0m[38;2;241;250;140m:[0m[38;2;189;147;249m%M[0m[38;2;241;250;140m:[0m[38;2;189;147;249m%S[0m[38;2;241;250;140m [0m[38;2;189;147;249m%Z[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mempty[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m"[0m
[38;5;238m1378[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m========== New Check Cycle: [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m | Candle Time: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcycle_time_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m ==========[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1379[0m   [38;5;238mâ”‚[0m 
[38;5;238m1380[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Data Validation ---[0m
[38;5;238m1381[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Ensure sufficient data rows for the longest indicator lookback period + buffer[0m
[38;5;238m1382[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mrequired_rows[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;139;233;253mmax[0m[38;2;248;248;242m([0m[38;2;248;248;242mst_len[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mcf_st_len[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242matr_len[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mvol_ma_len[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m+[0m[38;2;248;248;242m [0m[38;2;189;147;249m5[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Add a small buffer[0m
[38;5;238m1383[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;139;233;253mlen[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;248;248;242mrequired_rows[0m[38;2;248;248;242m:[0m
[38;5;238m1384[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: Insufficient data ([0m[38;2;248;248;242m{[0m[38;2;139;233;253mlen[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m}[0m[38;2;241;250;140m rows, [0m[38;2;241;250;140m"[0m
[38;5;238m1385[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                       [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mneed at least [0m[38;2;248;248;242m{[0m[38;2;248;248;242mrequired_rows[0m[38;2;248;248;242m}[0m[38;2;241;250;140m for indicators). Skipping logic cycle.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1386[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m
[38;5;238m1387[0m   [38;5;238mâ”‚[0m 
[38;5;238m1388[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Initialize variables[0m
[38;5;238m1389[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mob_data[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[38;2;248;248;242mDict[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m, [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m][0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1390[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1391[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242maction_taken_this_cycle[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mbool[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Flag to track if an order was placed/closed[0m
[38;5;238m1392[0m   [38;5;238mâ”‚[0m 
[38;5;238m1393[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m1394[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m === 1. Calculate Indicators ===[0m
[38;5;238m1395[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: Calculating technical indicators...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1396[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Calculate Primary Supertrend[0m
[38;5;238m1397[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mcalculate_supertrend[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mst_len[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mst_mult[0m[38;2;248;248;242m)[0m
[38;5;238m1398[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Calculate Confirmation Supertrend[0m
[38;5;238m1399[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mcalculate_supertrend[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mcf_st_len[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mcf_st_mult[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mprefix[0m[38;2;255;121;198m=[0m[38;2;241;250;140m"[0m[38;2;241;250;140mconfirm_[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1400[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Calculate ATR (for SL/TP) and Volume metrics[0m
[38;5;238m1401[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mvol_atr_data[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123manalyze_volume_atr[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242matr_len[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mvol_ma_len[0m[38;2;248;248;242m)[0m
[38;5;238m1402[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mvol_atr_data[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140matr[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1403[0m   [38;5;238mâ”‚[0m 
[38;5;238m1404[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Validate Indicator Results ---[0m
[38;5;238m1405[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Check if essential columns exist and the last row has valid values[0m
[38;5;238m1406[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mrequired_indicator_cols[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mclose[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140msupertrend[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mtrend[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mst_long[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mst_short[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m
[38;5;238m1407[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                                   [0m[38;2;241;250;140m'[0m[38;2;241;250;140mconfirm_supertrend[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mconfirm_trend[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m
[38;5;238m1408[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;139;233;253mall[0m[38;2;248;248;242m([0m[38;2;248;248;242mcol[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mcolumns[0m[38;2;248;248;242m [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mcol[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mrequired_indicator_cols[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m1409[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: One or more required indicator columns missing after calculation. Skipping cycle.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1410[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;255;121;198mreturn[0m
[38;5;238m1411[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m[38;2;248;248;242m[[0m[38;2;248;248;242mrequired_indicator_cols[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;80;250;123misnull[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123many[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m1412[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: Indicator calculation resulted in NA values for the latest candle. Skipping cycle.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1413[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mNA Values in last row:[0m[38;2;255;121;198m\n[0m[38;2;248;248;242m{[0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m[38;2;248;248;242m[[0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;80;250;123misnull[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m][0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1414[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;255;121;198mreturn[0m
[38;5;238m1415[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Validate ATR specifically, as it's crucial for risk management[0m
[38;5;238m1416[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m:[0m
[38;5;238m1417[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: Invalid ATR ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) calculated. Cannot determine SL/TP. Skipping cycle.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1418[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;255;121;198mreturn[0m
[38;5;238m1419[0m   [38;5;238mâ”‚[0m 
[38;5;238m1420[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m === Extract Data from the Last Closed Candle ===[0m
[38;5;238m1421[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlast_candle[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m
[38;5;238m1422[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mcurrent_price[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_candle[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mclose[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Price at the close of the last candle[0m
[38;5;238m1423[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mprimary_st_val[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_candle[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140msupertrend[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m
[38;5;238m1424[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mprimary_trend_up[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mbool[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_candle[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mtrend[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m
[38;5;238m1425[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mprimary_long_signal[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mbool[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_candle[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mst_long[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Primary ST flipped Long THIS candle[0m
[38;5;238m1426[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mprimary_short_signal[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mbool[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_candle[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mst_short[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Primary ST flipped Short THIS candle[0m
[38;5;238m1427[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mconfirm_st_val[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_candle[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mconfirm_supertrend[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m
[38;5;238m1428[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mconfirm_trend_up[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mbool[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_candle[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mconfirm_trend[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Current state of Confirmation ST trend[0m
[38;5;238m1429[0m   [38;5;238mâ”‚[0m 
[38;5;238m1430[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m === 2. Analyze Order Book (Conditionally) ===[0m
[38;5;238m1431[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Fetch OB if configured to do so every cycle OR if a primary signal just occurred (potential entry)[0m
[38;5;238m1432[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;255;255mFETCH_ORDER_BOOK_PER_CYCLE[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mprimary_long_signal[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mprimary_short_signal[0m[38;2;248;248;242m:[0m
[38;5;238m1433[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: Fetching and analyzing order book...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1434[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mob_data[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123manalyze_order_book[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mORDER_BOOK_DEPTH[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mORDER_BOOK_FETCH_LIMIT[0m[38;2;248;248;242m)[0m
[38;5;238m1435[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1436[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: Order book fetch skipped (FETCH_PER_CYCLE=False and no primary signal generated this candle).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1437[0m   [38;5;238mâ”‚[0m 
[38;5;238m1438[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m === 3. Get Current Position Status ===[0m
[38;5;238m1439[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m This fetches the live position state from the exchange[0m
[38;5;238m1440[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mposition[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mget_current_position[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m)[0m
[38;5;238m1441[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mside[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m
[38;5;238m1442[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mposition_qty[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mqty[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m
[38;5;238m1443[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mentry_price[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mentry_price[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m
[38;5;238m1444[0m   [38;5;238mâ”‚[0m 
[38;5;238m1445[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m === 4. Log Current State ===[0m
[38;5;238m1446[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Prepare formatted strings for logging, handling None values[0m
[38;5;238m1447[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mvolume_ratio[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mvol_atr_data[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mvolume_ratio[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1448[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mvolume_spike[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mvolume_ratio[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mvolume_ratio[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;255;255;255mVOLUME_SPIKE_THRESHOLD[0m
[38;5;238m1449[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mbid_ask_ratio[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mob_data[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mbid_ask_ratio[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mob_data[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1450[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mspread_val[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mob_data[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mspread[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mob_data[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1451[0m   [38;5;238mâ”‚[0m 
[38;5;238m1452[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242matr_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_atr[0m[38;2;189;147;249m:.5f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m
[38;5;238m1453[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mvol_ratio_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mvolume_ratio[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mvolume_ratio[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m'[0m
[38;5;238m1454[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mvol_spike_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mvolume_spike[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mvolume_ratio[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m'[0m
[38;5;238m1455[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mbid_ask_ratio_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mbid_ask_ratio[0m[38;2;189;147;249m:.3f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mbid_ask_ratio[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m'[0m
[38;5;238m1456[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mspread_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mspread_val[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mspread_val[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m'[0m
[38;5;238m1457[0m   [38;5;238mâ”‚[0m 
[38;5;238m1458[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mState | Price: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, ATR([0m[38;2;248;248;242m{[0m[38;2;248;248;242matr_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): [0m[38;2;248;248;242m{[0m[38;2;248;248;242matr_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1459[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mState | Volume: Ratio=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mvol_ratio_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Spike=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mvol_spike_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (Thr=[0m[38;2;248;248;242m{[0m[38;2;255;255;255mVOLUME_SPIKE_THRESHOLD[0m[38;2;189;147;249m:.1f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1460[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mState | ST([0m[38;2;248;248;242m{[0m[38;2;248;248;242mst_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m,[0m[38;2;248;248;242m{[0m[38;2;248;248;242mst_mult[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): [0m[38;2;248;248;242m{[0m[38;2;241;250;140m'[0m[38;2;241;250;140mUp[0m[38;2;241;250;140m'[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mprimary_trend_up[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mDown[0m[38;2;241;250;140m'[0m[38;2;248;248;242m}[0m[38;2;241;250;140m ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mprimary_st_val[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) | Signal: [0m[38;2;248;248;242m{[0m[38;2;241;250;140m'[0m[38;2;241;250;140mLONG[0m[38;2;241;250;140m'[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mprimary_long_signal[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mSHORT[0m[38;2;241;250;140m'[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mprimary_short_signal[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mNone[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1461[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mState | ConfirmST([0m[38;2;248;248;242m{[0m[38;2;248;248;242mcf_st_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m,[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcf_st_mult[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): [0m[38;2;248;248;242m{[0m[38;2;241;250;140m'[0m[38;2;241;250;140mUp[0m[38;2;241;250;140m'[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mconfirm_trend_up[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mDown[0m[38;2;241;250;140m'[0m[38;2;248;248;242m}[0m[38;2;241;250;140m ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mconfirm_st_val[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1462[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mState | OrderBook(D[0m[38;2;248;248;242m{[0m[38;2;255;255;255mORDER_BOOK_DEPTH[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Ratio=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mbid_ask_ratio_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Spread=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mspread_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1463[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mState | Position: Side=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Qty=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mposition_qty[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Entry=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mentry_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1464[0m   [38;5;238mâ”‚[0m 
[38;5;238m1465[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m === 5. Check Stop-Loss / Take-Profit (Loop-based - HIGH RISK / INACCURATE) ===[0m
[38;5;238m1466[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m !!! THIS IS THE DANGEROUS PART. IT ONLY CHECKS BASED ON THE 'current_price' (last close) !!![0m
[38;5;238m1467[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m !!! Real price could have moved significantly past SL/TP intra-candle or since close. !!![0m
[38;5;238m1468[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m!=[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_NONE[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m:[0m
[38;5;238m1469[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m!!! Trade Logic: Checking active position SL/TP based on LAST CLOSED PRICE (LOOP CHECK - UNSAFE FOR SCALPING) !!![0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1470[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242msl_triggered[0m[38;2;248;248;242m, [0m[38;2;248;248;242mtp_triggered[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m[38;2;248;248;242m, [0m[38;2;189;147;249mFalse[0m
[38;5;238m1471[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mstop_price[0m[38;2;248;248;242m, [0m[38;2;248;248;242mprofit_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m, [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m
[38;5;238m1472[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242msl_distance[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;248;248;242msl_atr_mult[0m
[38;5;238m1473[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mtp_distance[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;248;248;242mtp_atr_mult[0m
[38;5;238m1474[0m   [38;5;238mâ”‚[0m 
[38;5;238m1475[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_LONG[0m[38;2;248;248;242m:[0m
[38;5;238m1476[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mstop_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m-[0m[38;2;248;248;242m [0m[38;2;248;248;242msl_distance[0m
[38;5;238m1477[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mprofit_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m+[0m[38;2;248;248;242m [0m[38;2;248;248;242mtp_distance[0m
[38;5;238m1478[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSL/TP Check (Long): Entry=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mentry_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, CurrentClose=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Target SL=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mstop_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Target TP=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mprofit_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1479[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;248;248;242mstop_price[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242msl_triggered[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m
[38;5;238m1480[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m>=[0m[38;2;248;248;242m [0m[38;2;248;248;242mprofit_price[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mtp_triggered[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m
[38;5;238m1481[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198melif[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_SHORT[0m[38;2;248;248;242m:[0m
[38;5;238m1482[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mstop_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m+[0m[38;2;248;248;242m [0m[38;2;248;248;242msl_distance[0m
[38;5;238m1483[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mprofit_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m-[0m[38;2;248;248;242m [0m[38;2;248;248;242mtp_distance[0m
[38;5;238m1484[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSL/TP Check (Short): Entry=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mentry_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, CurrentClose=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Target SL=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mstop_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Target TP=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mprofit_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1485[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m>=[0m[38;2;248;248;242m [0m[38;2;248;248;242mstop_price[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242msl_triggered[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m
[38;5;238m1486[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;248;248;242mprofit_price[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mtp_triggered[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m
[38;5;238m1487[0m   [38;5;238mâ”‚[0m 
[38;5;238m1488[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Execute Close if SL/TP Triggered by this Inaccurate Loop Check ---[0m
[38;5;238m1489[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242msl_triggered[0m[38;2;248;248;242m:[0m
[38;5;238m1490[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mreason[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSL Loop @ [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (Target ~[0m[38;2;248;248;242m{[0m[38;2;248;248;242mstop_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m
[38;5;238m1491[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m*** TRADE EXIT (LOOP CHECK): STOP-LOSS TRIGGERED! ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mreason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Closing [0m[38;2;248;248;242m{[0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. ***[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1492[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m!!! THIS SL TRIGGER IS BASED ON DELAYED CHECK - ACTUAL LOSS MAY BE SIGNIFICANTLY HIGHER !!![0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1493[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Pass the 'position' dict we got at the start of the cycle for info, but close_position re-validates[0m
[38;5;238m1494[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mclose_result[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mclose_position[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mreason[0m[38;2;255;121;198m=[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSL (Loop Check)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1495[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mclose_result[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242maction_taken_this_cycle[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m
[38;5;238m1496[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Exit logic for this cycle after attempting close, regardless of success[0m
[38;5;238m1497[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m because the condition was met. Prevents trying to enter immediately after SL.[0m
[38;5;238m1498[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mreturn[0m
[38;5;238m1499[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198melif[0m[38;2;248;248;242m [0m[38;2;248;248;242mtp_triggered[0m[38;2;248;248;242m:[0m
[38;5;238m1500[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mreason[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTP Loop @ [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (Target ~[0m[38;2;248;248;242m{[0m[38;2;248;248;242mprofit_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m
[38;5;238m1501[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123msuccess[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m*** TRADE EXIT (LOOP CHECK): TAKE-PROFIT TRIGGERED! ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mreason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Closing [0m[38;2;248;248;242m{[0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. ***[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1502[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m!!! TAKE PROFIT VIA LOOP CHECK MAY MISS BETTER FILLS OR EXPERIENCE SLIPPAGE !!![0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1503[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mclose_result[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mclose_position[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mreason[0m[38;2;255;121;198m=[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTP (Loop Check)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1504[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mclose_result[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242maction_taken_this_cycle[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m
[38;5;238m1505[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Exit logic for this cycle after attempting close[0m
[38;5;238m1506[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mreturn[0m
[38;5;238m1507[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1508[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: Position SL/TP not triggered based on last close price (Loop Check).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1509[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melif[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m!=[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_NONE[0m[38;2;248;248;242m:[0m
[38;5;238m1510[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log if position exists but SL/TP check couldn't run (e.g., bad entry price or ATR)[0m
[38;5;238m1511[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: Position ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) exists but loop-based SL/TP check skipped (Entry=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mentry_price[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, ATR=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m}[0m[38;2;241;250;140m).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1512[0m   [38;5;238mâ”‚[0m 
[38;5;238m1513[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m === 6. Check for Entry Signals ===[0m
[38;5;238m1514[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Only proceed if no SL/TP exit was triggered above[0m
[38;5;238m1515[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: Checking entry signals...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1516[0m   [38;5;238mâ”‚[0m 
[38;5;238m1517[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Define Confirmation Conditions ---[0m
[38;5;238m1518[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Order Book Confirmation (only if required and data is available)[0m
[38;5;238m1519[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mob_check_required[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;255;255;255mFETCH_ORDER_BOOK_PER_CYCLE[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m If True, we need OB data every time[0m
[38;5;238m1520[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mob_available[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mob_data[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mbid_ask_ratio[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1521[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mpasses_long_ob[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mob_check_required[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242mob_available[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mbid_ask_ratio[0m[38;2;248;248;242m [0m[38;2;255;121;198m>=[0m[38;2;248;248;242m [0m[38;2;255;255;255mORDER_BOOK_RATIO_THRESHOLD_LONG[0m[38;2;248;248;242m)[0m
[38;5;238m1522[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mpasses_short_ob[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mob_check_required[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242mob_available[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mbid_ask_ratio[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;255;255;255mORDER_BOOK_RATIO_THRESHOLD_SHORT[0m[38;2;248;248;242m)[0m
[38;5;238m1523[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mob_log_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRatio=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mbid_ask_ratio_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (LongThr=[0m[38;2;248;248;242m{[0m[38;2;255;255;255mORDER_BOOK_RATIO_THRESHOLD_LONG[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, ShortThr=[0m[38;2;248;248;242m{[0m[38;2;255;255;255mORDER_BOOK_RATIO_THRESHOLD_SHORT[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Required=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mob_check_required[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m
[38;5;238m1524[0m   [38;5;238mâ”‚[0m 
[38;5;238m1525[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Volume Confirmation (only if required and data is available)[0m
[38;5;238m1526[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mvolume_check_required[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;255;255;255mREQUIRE_VOLUME_SPIKE_FOR_ENTRY[0m
[38;5;238m1527[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mvolume_available[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mvolume_ratio[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Need ratio to check spike[0m
[38;5;238m1528[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mpasses_volume[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mvolume_check_required[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242mvolume_available[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mvolume_spike[0m[38;2;248;248;242m)[0m
[38;5;238m1529[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mvol_log_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRatio=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mvol_ratio_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Spike=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mvol_spike_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (Required=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mvolume_check_required[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m
[38;5;238m1530[0m   [38;5;238mâ”‚[0m 
[38;5;238m1531[0m   [38;5;238mâ”‚[0m 
[38;5;238m1532[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Long Entry Condition ---[0m
[38;5;238m1533[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242menter_long[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m
[38;5;238m1534[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m!=[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_LONG[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Prevent adding to existing long[0m
[38;5;238m1535[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mprimary_long_signal[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m                 [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Primary ST must have flipped Long THIS candle[0m
[38;5;238m1536[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mconfirm_trend_up[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m                    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Confirmation ST trend must be Up (agreement)[0m
[38;5;238m1537[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mpasses_long_ob[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m                      [0m[38;2;98;114;164m#[0m[38;2;98;114;164m OB condition met (or not required)[0m
[38;5;238m1538[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mpasses_volume[0m[38;2;248;248;242m                           [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Volume condition met (or not required)[0m
[38;5;238m1539[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242m)[0m
[38;5;238m1540[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mEntry Check (Long): PrimaryFlip=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mprimary_long_signal[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, ConfirmTrendUp=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mconfirm_trend_up[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, [0m[38;2;241;250;140m"[0m
[38;5;238m1541[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                     [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mOB OK=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mpasses_long_ob[0m[38;2;248;248;242m}[0m[38;2;241;250;140m [[0m[38;2;248;248;242m{[0m[38;2;248;248;242mob_log_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m], Vol OK=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mpasses_volume[0m[38;2;248;248;242m}[0m[38;2;241;250;140m [[0m[38;2;248;248;242m{[0m[38;2;248;248;242mvol_log_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] [0m[38;2;241;250;140m"[0m
[38;5;238m1542[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                     [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m=> Enter Long = [0m[38;2;248;248;242m{[0m[38;2;248;248;242menter_long[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1543[0m   [38;5;238mâ”‚[0m 
[38;5;238m1544[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Short Entry Condition ---[0m
[38;5;238m1545[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242menter_short[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m
[38;5;238m1546[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m!=[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_SHORT[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Prevent adding to existing short[0m
[38;5;238m1547[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mprimary_short_signal[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m                 [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Primary ST must have flipped Short THIS candle[0m
[38;5;238m1548[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mconfirm_trend_up[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m                 [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Confirmation ST trend must be Down (agreement)[0m
[38;5;238m1549[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mpasses_short_ob[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m                      [0m[38;2;98;114;164m#[0m[38;2;98;114;164m OB condition met (or not required)[0m
[38;5;238m1550[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mpasses_volume[0m[38;2;248;248;242m                            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Volume condition met (or not required)[0m
[38;5;238m1551[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242m)[0m
[38;5;238m1552[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mEntry Check (Short): PrimaryFlip=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mprimary_short_signal[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, ConfirmTrendDown=[0m[38;2;248;248;242m{[0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mconfirm_trend_up[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, [0m[38;2;241;250;140m"[0m
[38;5;238m1553[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                      [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mOB OK=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mpasses_short_ob[0m[38;2;248;248;242m}[0m[38;2;241;250;140m [[0m[38;2;248;248;242m{[0m[38;2;248;248;242mob_log_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m], Vol OK=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mpasses_volume[0m[38;2;248;248;242m}[0m[38;2;241;250;140m [[0m[38;2;248;248;242m{[0m[38;2;248;248;242mvol_log_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] [0m[38;2;241;250;140m"[0m
[38;5;238m1554[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                      [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m=> Enter Short = [0m[38;2;248;248;242m{[0m[38;2;248;248;242menter_short[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1555[0m   [38;5;238mâ”‚[0m 
[38;5;238m1556[0m   [38;5;238mâ”‚[0m 
[38;5;238m1557[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m === 7. Execute Entry / Reversal Actions ===[0m
[38;5;238m1558[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242menter_long[0m[38;2;248;248;242m:[0m
[38;5;238m1559[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123msuccess[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m*** TRADE SIGNAL: CONFIRMED LONG ENTRY SIGNAL for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m at ~[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m ***[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1560[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_SHORT[0m[38;2;248;248;242m:[0m
[38;5;238m1561[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Reversal: Close Short, then Enter Long ---[0m
[38;5;238m1562[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Action: LONG signal received while SHORT. Attempting REVERSAL.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1563[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m 1. Close the existing short position[0m
[38;5;238m1564[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal Step 1: Closing existing SHORT position...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1565[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mclose_result[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mclose_position[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mreason[0m[38;2;255;121;198m=[0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal to Long[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1566[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242maction_taken_this_cycle[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Attempted an action[0m
[38;5;238m1567[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mclose_result[0m[38;2;248;248;242m:[0m
[38;5;238m1568[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal Step 1: Close SHORT order placed. Waiting [0m[38;2;248;248;242m{[0m[38;2;255;255;255mPOST_CLOSE_DELAY_SECONDS[0m[38;2;248;248;242m}[0m[38;2;241;250;140ms...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1569[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mtime[0m[38;2;255;121;198m.[0m[38;2;80;250;123msleep[0m[38;2;248;248;242m([0m[38;2;255;255;255mPOST_CLOSE_DELAY_SECONDS[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Allow time for closure to process/API update[0m
[38;5;238m1570[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m 2. Re-check position state AFTER attempting close[0m
[38;5;238m1571[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal Step 2: Re-checking position status after close attempt...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1572[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mcurrent_pos_after_close[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mget_current_position[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m)[0m
[38;5;238m1573[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_pos_after_close[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mside[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_NONE[0m[38;2;248;248;242m:[0m
[38;5;238m1574[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123msuccess[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal Step 2: Confirmed SHORT position closed.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1575[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m 3. Enter the new long position[0m
[38;5;238m1576[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal Step 3: Proceeding with LONG entry.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1577[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;80;250;123mplace_risked_market_order[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mSIDE_BUY[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mrisk_pct[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msl_atr_mult[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mleverage[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mmax_order_cap[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mmargin_buffer[0m[38;2;248;248;242m)[0m
[38;5;238m1578[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1579[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal Step 2: Failed to confirm SHORT position closure after reversal signal (Still showing: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_pos_after_close[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mside[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Skipping LONG entry.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1580[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1581[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                     [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal Step 1: Failed to place order to close SHORT position. Skipping LONG entry.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1582[0m   [38;5;238mâ”‚[0m 
[38;5;238m1583[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198melif[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_NONE[0m[38;2;248;248;242m:[0m
[38;5;238m1584[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- New Entry: Enter Long ---[0m
[38;5;238m1585[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Action: Entering NEW LONG position.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1586[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mplace_result[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mplace_risked_market_order[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mSIDE_BUY[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mrisk_pct[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msl_atr_mult[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mleverage[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mmax_order_cap[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mmargin_buffer[0m[38;2;248;248;242m)[0m
[38;5;238m1587[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mplace_result[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242maction_taken_this_cycle[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m
[38;5;238m1588[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1589[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Should not happen if enter_long condition is correct, but as a safeguard:[0m
[38;5;238m1590[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Action: Signal LONG ignored (already long? Check logic).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1591[0m   [38;5;238mâ”‚[0m 
[38;5;238m1592[0m   [38;5;238mâ”‚[0m 
[38;5;238m1593[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melif[0m[38;2;248;248;242m [0m[38;2;248;248;242menter_short[0m[38;2;248;248;242m:[0m
[38;5;238m1594[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123msuccess[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m*** TRADE SIGNAL: CONFIRMED SHORT ENTRY SIGNAL for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m at ~[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m ***[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1595[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_LONG[0m[38;2;248;248;242m:[0m
[38;5;238m1596[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Reversal: Close Long, then Enter Short ---[0m
[38;5;238m1597[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Action: SHORT signal received while LONG. Attempting REVERSAL.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1598[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m 1. Close the existing long position[0m
[38;5;238m1599[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal Step 1: Closing existing LONG position...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1600[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mclose_result[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mclose_position[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mreason[0m[38;2;255;121;198m=[0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal to Short[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1601[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242maction_taken_this_cycle[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Attempted an action[0m
[38;5;238m1602[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mclose_result[0m[38;2;248;248;242m:[0m
[38;5;238m1603[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal Step 1: Close LONG order placed. Waiting [0m[38;2;248;248;242m{[0m[38;2;255;255;255mPOST_CLOSE_DELAY_SECONDS[0m[38;2;248;248;242m}[0m[38;2;241;250;140ms...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1604[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mtime[0m[38;2;255;121;198m.[0m[38;2;80;250;123msleep[0m[38;2;248;248;242m([0m[38;2;255;255;255mPOST_CLOSE_DELAY_SECONDS[0m[38;2;248;248;242m)[0m
[38;5;238m1605[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m 2. Re-check position state AFTER attempting close[0m
[38;5;238m1606[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal Step 2: Re-checking position status after close attempt...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1607[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mcurrent_pos_after_close[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mget_current_position[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m)[0m
[38;5;238m1608[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_pos_after_close[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mside[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_NONE[0m[38;2;248;248;242m:[0m
[38;5;238m1609[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123msuccess[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal Step 2: Confirmed LONG position closed.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1610[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m 3. Enter the new short position[0m
[38;5;238m1611[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal Step 3: Proceeding with SHORT entry.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1612[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;80;250;123mplace_risked_market_order[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mSIDE_SELL[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mrisk_pct[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msl_atr_mult[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mleverage[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mmax_order_cap[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mmargin_buffer[0m[38;2;248;248;242m)[0m
[38;5;238m1613[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1614[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal Step 2: Failed to confirm LONG position closure after reversal signal (Still showing: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_pos_after_close[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mside[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Skipping SHORT entry.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1615[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1616[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal Step 1: Failed to place order to close LONG position. Skipping SHORT entry.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1617[0m   [38;5;238mâ”‚[0m 
[38;5;238m1618[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198melif[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_NONE[0m[38;2;248;248;242m:[0m
[38;5;238m1619[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- New Entry: Enter Short ---[0m
[38;5;238m1620[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Action: Entering NEW SHORT position.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1621[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mplace_result[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mplace_risked_market_order[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mSIDE_SELL[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mrisk_pct[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msl_atr_mult[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mleverage[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mmax_order_cap[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mmargin_buffer[0m[38;2;248;248;242m)[0m
[38;5;238m1622[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mplace_result[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242maction_taken_this_cycle[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m
[38;5;238m1623[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1624[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Safeguard[0m
[38;5;238m1625[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Action: Signal SHORT ignored (already short? Check logic).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1626[0m   [38;5;238mâ”‚[0m 
[38;5;238m1627[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1628[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m No entry signal this cycle[0m
[38;5;238m1629[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242maction_taken_this_cycle[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Only log 'no signal' if no other action (like SL/TP close) happened[0m
[38;5;238m1630[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_NONE[0m[38;2;248;248;242m:[0m
[38;5;238m1631[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: No confirmed entry signal and no active position. Holding cash.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1632[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1633[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                     [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: Holding [0m[38;2;248;248;242m{[0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m position. No new entry or exit signal this cycle.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1634[0m   [38;5;238mâ”‚[0m 
[38;5;238m1635[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1636[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Catch-all for unexpected errors within the main logic block[0m
[38;5;238m1637[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: CRITICAL UNEXPECTED ERROR during cycle execution for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1638[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m1639[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Consider sending an SMS alert for critical logic failures[0m
[38;5;238m1640[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;255;121;198m.[0m[38;2;80;250;123msplit[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140m/[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m[[0m[38;2;189;147;249m0[0m[38;2;248;248;242m][0m[38;2;248;248;242m}[0m[38;2;241;250;140m] CRITICAL ERROR in trade_logic: [0m[38;2;248;248;242m{[0m[38;2;139;233;253mtype[0m[38;2;248;248;242m([0m[38;2;248;248;242me[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;248;248;242m__name__[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Check logs![0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1641[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mfinally[0m[38;2;248;248;242m:[0m
[38;5;238m1642[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log end of cycle regardless of outcome[0m
[38;5;238m1643[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m========== Cycle Check End: [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m ==========[0m[38;2;255;121;198m\n[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1644[0m   [38;5;238mâ”‚[0m 
[38;5;238m1645[0m   [38;5;238mâ”‚[0m 
[38;5;238m1646[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Graceful Shutdown ---[0m
[38;5;238m1647[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123mgraceful_shutdown[0m[38;2;248;248;242m([0m[3;38;2;255;184;108mexchange[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[38;2;248;248;242mccxt[0m[38;2;255;121;198m.[0m[38;2;248;248;242mExchange[0m[38;2;248;248;242m][0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108msymbol[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m][0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;248;248;242m->[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m:[0m
[38;5;238m1648[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m
[38;5;238m1649[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Attempts to close any open position for the given symbol before exiting.[0m
[38;5;238m1650[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Sends SMS alerts about the shutdown process.[0m
[38;5;238m1651[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    [0m[38;2;98;114;164m"""[0m
[38;5;238m1652[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mShutdown requested. Initiating graceful exit sequence...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1653[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;255;121;198m.[0m[38;2;80;250;123msplit[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140m/[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m[[0m[38;2;189;147;249m0[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mBot[0m[38;2;241;250;140m"[0m
[38;5;238m1654[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] Shutdown requested. Attempting to close open position if any.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1655[0m   [38;5;238mâ”‚[0m 
[38;5;238m1656[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m:[0m
[38;5;238m1657[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mGraceful Shutdown: Exchange not initialized or symbol not set. Cannot check or close position.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1658[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m
[38;5;238m1659[0m   [38;5;238mâ”‚[0m 
[38;5;238m1660[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m1661[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mGraceful Shutdown: Checking for active position for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1662[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Use the robust position check function[0m
[38;5;238m1663[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mposition[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mget_current_position[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m)[0m
[38;5;238m1664[0m   [38;5;238mâ”‚[0m 
[38;5;238m1665[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mside[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m!=[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_NONE[0m[38;2;248;248;242m:[0m
[38;5;238m1666[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mpos_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mside[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m
[38;5;238m1667[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mpos_qty[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mqty[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m
[38;5;238m1668[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mGraceful Shutdown: Active [0m[38;2;248;248;242m{[0m[38;2;248;248;242mpos_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m position found ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mpos_qty[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Attempting to close...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1669[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Pass the freshly checked 'position' dict to the close function[0m
[38;5;238m1670[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mclose_result[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mclose_position[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mreason[0m[38;2;255;121;198m=[0m[38;2;241;250;140m"[0m[38;2;241;250;140mShutdown[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1671[0m   [38;5;238mâ”‚[0m 
[38;5;238m1672[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mclose_result[0m[38;2;248;248;242m:[0m
[38;5;238m1673[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mGraceful Shutdown: Close order placed. Waiting briefly for exchange processing...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1674[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Wait a bit longer on shutdown to increase chance of confirmation[0m
[38;5;238m1675[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mtime[0m[38;2;255;121;198m.[0m[38;2;80;250;123msleep[0m[38;2;248;248;242m([0m[38;2;255;255;255mPOST_CLOSE_DELAY_SECONDS[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;189;147;249m2[0m[38;2;248;248;242m)[0m
[38;5;238m1676[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Final Confirmation Check ---[0m
[38;5;238m1677[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mGraceful Shutdown: Performing final position check...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1678[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mfinal_pos_check[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mget_current_position[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m)[0m
[38;5;238m1679[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mfinal_pos_check[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mfinal_pos_check[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mside[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_NONE[0m[38;2;248;248;242m:[0m
[38;5;238m1680[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                     [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123msuccess[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mGraceful Shutdown: Position successfully confirmed closed.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1681[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                     [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] Position confirmed CLOSED during shutdown.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1682[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1683[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                     [0m[38;2;248;248;242mfinal_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mfinal_pos_check[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mside[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m1684[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                     [0m[38;2;248;248;242mfinal_qty[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mfinal_pos_check[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mqty[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m
[38;5;238m1685[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                     [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mGraceful Shutdown: FAILED TO CONFIRM position closure after attempting close. Final check showed: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Qty: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_qty[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1686[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                     [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ERROR: Failed to confirm position closure on shutdown! Final state: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m Qty=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_qty[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. MANUAL CHECK REQUIRED.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1687[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1688[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;98;114;164m#[0m[38;2;98;114;164m close_position failed to even place the order[0m
[38;5;238m1689[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mGraceful Shutdown: Failed to place the close order for the active position. MANUAL INTERVENTION REQUIRED.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1690[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ERROR: Failed to PLACE close order during shutdown. MANUAL CHECK REQUIRED.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1691[0m   [38;5;238mâ”‚[0m 
[38;5;238m1692[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1693[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m No active position found during the check[0m
[38;5;238m1694[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mGraceful Shutdown: No active position found for [0m[38;2;189;147;249m{[0m[38;2;189;147;249msymbol[0m[38;2;189;147;249m}[0m[38;2;241;250;140m. No close action needed.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1695[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] No active position found during shutdown.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1696[0m   [38;5;238mâ”‚[0m 
[38;5;238m1697[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1698[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Catch errors during the shutdown process itself (e.g., API errors during final checks)[0m
[38;5;238m1699[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mGraceful Shutdown: An error occurred during the shutdown process: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1700[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m1701[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] Error during graceful shutdown sequence: [0m[38;2;248;248;242m{[0m[38;2;139;233;253mtype[0m[38;2;248;248;242m([0m[38;2;248;248;242me[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;248;248;242m__name__[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Check logs.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1702[0m   [38;5;238mâ”‚[0m 
[38;5;238m1703[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mGraceful Shutdown sequence finished.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1704[0m   [38;5;238mâ”‚[0m 
[38;5;238m1705[0m   [38;5;238mâ”‚[0m 
[38;5;238m1706[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Main Execution ---[0m
[38;5;238m1707[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123mmain[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;248;248;242m->[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m:[0m
[38;5;238m1708[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m
[38;5;238m1709[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Main function to initialize the exchange connection, set up parameters,[0m
[38;5;238m1710[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    and run the main trading loop. Handles initialization errors and graceful shutdown.[0m
[38;5;238m1711[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    [0m[38;2;98;114;164m"""[0m
[38;5;238m1712[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mbot_start_time_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mtime[0m[38;2;255;121;198m.[0m[38;2;80;250;123mstrftime[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;189;147;249m%Y[0m[38;2;241;250;140m-[0m[38;2;189;147;249m%m[0m[38;2;241;250;140m-[0m[38;2;189;147;249m%d[0m[38;2;241;250;140m [0m[38;2;189;147;249m%H[0m[38;2;241;250;140m:[0m[38;2;189;147;249m%M[0m[38;2;241;250;140m:[0m[38;2;189;147;249m%S[0m[38;2;241;250;140m [0m[38;2;189;147;249m%Z[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m1713[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m--- Bybit Scalping Bot Initializing v1.5.1 ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mbot_start_time_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) ---[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1714[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m--- !!! LIVE FUTURES SCALPING MODE - EXTREME RISK INVOLVED !!! ---[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1715[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m--- ENSURE ALL PARAMETERS IN .env ARE CORRECTLY SET & TESTED ---[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1716[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m--- *** CRITICAL WARNING: LOOP-BASED SL/TP IS ACTIVE - UNSAFE & INACCURATE FOR LIVE SCALPING *** ---[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1717[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m--- *** YOU MUST IMPLEMENT EXCHANGE-NATIVE CONDITIONAL ORDERS FOR SAFE SL/TP MANAGEMENT *** ---[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1718[0m   [38;5;238mâ”‚[0m 
[38;5;238m1719[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[38;2;248;248;242mccxt[0m[38;2;255;121;198m.[0m[38;2;248;248;242mExchange[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1720[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Will hold the validated symbol[0m
[38;5;238m1721[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mrun_bot[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mbool[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Flag to control the main loop[0m
[38;5;238m1722[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mcycle_count[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m
[38;5;238m1723[0m   [38;5;238mâ”‚[0m 
[38;5;238m1724[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m1725[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m === Initialize Exchange ===[0m
[38;5;238m1726[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123minitialize_exchange[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m
[38;5;238m1727[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m:[0m
[38;5;238m1728[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mBot exiting due to exchange initialization failure.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1729[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m SMS alert already sent by initialize_exchange on failure[0m
[38;5;238m1730[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Stop execution[0m
[38;5;238m1731[0m   [38;5;238mâ”‚[0m 
[38;5;238m1732[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m === Setup Trading Symbol and Leverage ===[0m
[38;5;238m1733[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Prompt user or use default, then validate[0m
[38;5;238m1734[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m1735[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mraw_symbol_input[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;139;233;253minput[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mEnter trading symbol (e.g., BTC/USDT:USDT) or press Enter for default [[0m[38;2;248;248;242m{[0m[38;2;255;255;255mDEFAULT_SYMBOL[0m[38;2;248;248;242m}[0m[38;2;241;250;140m]: [0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mstrip[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m
[38;5;238m1736[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242msymbol_to_validate[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mraw_symbol_input[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;255;255;255mDEFAULT_SYMBOL[0m
[38;5;238m1737[0m   [38;5;238mâ”‚[0m 
[38;5;238m1738[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mValidating symbol: [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol_to_validate[0m[38;2;248;248;242m}[0m[38;2;241;250;140m...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1739[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mmarket[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mmarket[0m[38;2;248;248;242m([0m[38;2;248;248;242msymbol_to_validate[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Throws BadSymbol if invalid[0m
[38;5;238m1740[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mmarket[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140msymbol[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Use the CCXT canonical symbol format[0m
[38;5;238m1741[0m   [38;5;238mâ”‚[0m 
[38;5;238m1742[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Verify it's a contract market (swap/future)[0m
[38;5;238m1743[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mmarket[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mcontract[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mmarket[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mspot[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Double check it's not spot[0m
[38;5;238m1744[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mConfiguration Error: Symbol '[0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m' is not a valid SWAP or FUTURES market on [0m[38;2;248;248;242m{[0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;248;248;242mid[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Type: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mtype[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1745[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[ScalpBot] CRITICAL: Symbol [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m is not a contract market. Exiting.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1746[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mreturn[0m
[38;5;238m1747[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSuccessfully validated symbol: [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (Type: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mtype[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1748[0m   [38;5;238mâ”‚[0m 
[38;5;238m1749[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Set leverage for the validated symbol[0m
[38;5;238m1750[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;80;250;123mset_leverage[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mDEFAULT_LEVERAGE[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m1751[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLeverage setup failed for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m after retries. Cannot proceed safely. Exiting.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1752[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m SMS alert potentially sent by set_leverage on final failure[0m
[38;5;238m1753[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;255;121;198m.[0m[38;2;80;250;123msplit[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140m/[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m[[0m[38;2;189;147;249m0[0m[38;2;248;248;242m][0m[38;2;248;248;242m}[0m[38;2;241;250;140m] CRITICAL: Leverage setup FAILED for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Exiting.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1754[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mreturn[0m
[38;5;238m1755[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLeverage confirmed/set to [0m[38;2;248;248;242m{[0m[38;2;255;255;255mDEFAULT_LEVERAGE[0m[38;2;248;248;242m}[0m[38;2;241;250;140mx for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1756[0m   [38;5;238mâ”‚[0m 
[38;5;238m1757[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mBadSymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mKeyError[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1758[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mConfiguration Error: Invalid or unsupported symbol '[0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol_to_validate[0m[38;2;248;248;242m}[0m[38;2;241;250;140m'. Error: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1759[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[ScalpBot] CRITICAL: Invalid symbol '[0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol_to_validate[0m[38;2;248;248;242m}[0m[38;2;241;250;140m'. Exiting.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1760[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m
[38;5;238m1761[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1762[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mConfiguration Error: Unexpected error during symbol/leverage setup: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1763[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m1764[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m[ScalpBot] CRITICAL: Symbol/Leverage setup failed unexpectedly. Exiting.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1765[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m
[38;5;238m1766[0m   [38;5;238mâ”‚[0m 
[38;5;238m1767[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m === Log Configuration Summary ===[0m
[38;5;238m1768[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m--- Scalping Bot Configuration Summary ---[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1769[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrading Pair: [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1770[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTimeframe: [0m[38;2;248;248;242m{[0m[38;2;255;255;255mDEFAULT_INTERVAL[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1771[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLeverage: [0m[38;2;248;248;242m{[0m[38;2;255;255;255mDEFAULT_LEVERAGE[0m[38;2;248;248;242m}[0m[38;2;241;250;140mx[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1772[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRisk Per Trade: [0m[38;2;248;248;242m{[0m[38;2;255;255;255mRISK_PER_TRADE_PERCENTAGE[0m[38;2;189;147;249m:.3%[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1773[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mMax Position Value (Cap): [0m[38;2;248;248;242m{[0m[38;2;255;255;255mMAX_ORDER_USDT_AMOUNT[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1774[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSL Calculation: [0m[38;2;248;248;242m{[0m[38;2;255;255;255mATR_STOP_LOSS_MULTIPLIER[0m[38;2;248;248;242m}[0m[38;2;241;250;140m * ATR([0m[38;2;248;248;242m{[0m[38;2;255;255;255mATR_CALCULATION_PERIOD[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1775[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTP Calculation: [0m[38;2;248;248;242m{[0m[38;2;255;255;255mATR_TAKE_PROFIT_MULTIPLIER[0m[38;2;248;248;242m}[0m[38;2;241;250;140m * ATR([0m[38;2;248;248;242m{[0m[38;2;255;255;255mATR_CALCULATION_PERIOD[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) (Loop Check - Unsafe)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1776[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPrimary Supertrend: Length=[0m[38;2;248;248;242m{[0m[38;2;255;255;255mDEFAULT_ST_ATR_LENGTH[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Multiplier=[0m[38;2;248;248;242m{[0m[38;2;255;255;255mDEFAULT_ST_MULTIPLIER[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1777[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mConfirmation Supertrend: Length=[0m[38;2;248;248;242m{[0m[38;2;255;255;255mCONFIRM_ST_ATR_LENGTH[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Multiplier=[0m[38;2;248;248;242m{[0m[38;2;255;255;255mCONFIRM_ST_MULTIPLIER[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1778[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mVolume Analysis: MA=[0m[38;2;248;248;242m{[0m[38;2;255;255;255mVOLUME_MA_PERIOD[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Spike > [0m[38;2;248;248;242m{[0m[38;2;255;255;255mVOLUME_SPIKE_THRESHOLD[0m[38;2;248;248;242m}[0m[38;2;241;250;140mx MA (Required for Entry: [0m[38;2;248;248;242m{[0m[38;2;255;255;255mREQUIRE_VOLUME_SPIKE_FOR_ENTRY[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1779[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mOrder Book Analysis: Depth=[0m[38;2;248;248;242m{[0m[38;2;255;255;255mORDER_BOOK_DEPTH[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Long Ratio >= [0m[38;2;248;248;242m{[0m[38;2;255;255;255mORDER_BOOK_RATIO_THRESHOLD_LONG[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Short Ratio <= [0m[38;2;248;248;242m{[0m[38;2;255;255;255mORDER_BOOK_RATIO_THRESHOLD_SHORT[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1780[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mFetch Order Book Every Cycle: [0m[38;2;248;248;242m{[0m[38;2;255;255;255mFETCH_ORDER_BOOK_PER_CYCLE[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1781[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mMargin Check Buffer: [0m[38;2;248;248;242m{[0m[38;2;255;255;255mREQUIRED_MARGIN_BUFFER[0m[38;2;189;147;249m:.1%[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (Requires [0m[38;2;248;248;242m{[0m[38;2;248;248;242m([0m[38;2;255;255;255mREQUIRED_MARGIN_BUFFER[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m)[0m[38;2;255;121;198m*[0m[38;2;189;147;249m100[0m[38;2;189;147;249m:.1f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m% extra free margin)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1782[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mCheck Interval (Sleep): [0m[38;2;248;248;242m{[0m[38;2;255;255;255mDEFAULT_SLEEP_SECONDS[0m[38;2;248;248;242m}[0m[38;2;241;250;140m seconds[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1783[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSMS Alerts Enabled: [0m[38;2;248;248;242m{[0m[38;2;255;255;255mENABLE_SMS_ALERTS[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Recipient: [0m[38;2;248;248;242m{[0m[38;2;241;250;140m'[0m[38;2;241;250;140mSet[0m[38;2;241;250;140m'[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;255;255mSMS_RECIPIENT_NUMBER[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mNot Set[0m[38;2;241;250;140m'[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Timeout: [0m[38;2;248;248;242m{[0m[38;2;255;255;255mSMS_TIMEOUT_SECONDS[0m[38;2;248;248;242m}[0m[38;2;241;250;140ms[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1784[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mACTION REQUIRED: Review this configuration carefully. Does it align with your strategy and risk tolerance?[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1785[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mRISK WARNING: Loop-based SL/TP check is ACTIVE, INACCURATE & UNSAFE for live scalping.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1786[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mCurrent Logging Level: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetLevelName[0m[38;2;248;248;242m([0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;248;248;242mlevel[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1787[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m------------------------------------------[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1788[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Send startup confirmation SMS[0m
[38;5;238m1789[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;255;121;198m.[0m[38;2;80;250;123msplit[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140m/[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m[[0m[38;2;189;147;249m0[0m[38;2;248;248;242m][0m
[38;5;238m1790[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[ScalpBot] Configured for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m ([0m[38;2;248;248;242m{[0m[38;2;255;255;255mDEFAULT_INTERVAL[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, [0m[38;2;248;248;242m{[0m[38;2;255;255;255mDEFAULT_LEVERAGE[0m[38;2;248;248;242m}[0m[38;2;241;250;140mx). Loop-based SL/TP ACTIVE (HIGH RISK). Starting main loop.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1791[0m   [38;5;238mâ”‚[0m 
[38;5;238m1792[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m === Main Trading Loop ===[0m
[38;5;238m1793[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mwhile[0m[38;2;248;248;242m [0m[38;2;248;248;242mrun_bot[0m[38;2;248;248;242m:[0m
[38;5;238m1794[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mcycle_start_time[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mtime[0m[38;2;255;121;198m.[0m[38;2;80;250;123mmonotonic[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Use monotonic clock for interval timing[0m
[38;5;238m1795[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mcycle_count[0m[38;2;248;248;242m [0m[38;2;255;121;198m+=[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m
[38;5;238m1796[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m--- Cycle [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcycle_count[0m[38;2;248;248;242m}[0m[38;2;241;250;140m Start: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mtime[0m[38;2;255;121;198m.[0m[38;2;80;250;123mstrftime[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;189;147;249m%Y[0m[38;2;241;250;140m-[0m[38;2;189;147;249m%m[0m[38;2;241;250;140m-[0m[38;2;189;147;249m%d[0m[38;2;241;250;140m [0m[38;2;189;147;249m%H[0m[38;2;241;250;140m:[0m[38;2;189;147;249m%M[0m[38;2;241;250;140m:[0m[38;2;189;147;249m%S[0m[38;2;241;250;140m [0m[38;2;189;147;249m%Z[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m ---[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1797[0m   [38;5;238mâ”‚[0m 
[38;5;238m1798[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m1799[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m 1. Fetch Fresh Market Data[0m
[38;5;238m1800[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Determine required data length based on longest indicator period + buffer[0m
[38;5;238m1801[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mdata_limit[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;139;233;253mmax[0m[38;2;248;248;242m([0m[38;2;189;147;249m100[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mDEFAULT_ST_ATR_LENGTH[0m[38;2;255;121;198m*[0m[38;2;189;147;249m2[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mCONFIRM_ST_ATR_LENGTH[0m[38;2;255;121;198m*[0m[38;2;189;147;249m2[0m[38;2;248;248;242m,[0m
[38;5;238m1802[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                                 [0m[38;2;255;255;255mATR_CALCULATION_PERIOD[0m[38;2;255;121;198m*[0m[38;2;189;147;249m2[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mVOLUME_MA_PERIOD[0m[38;2;255;121;198m*[0m[38;2;189;147;249m2[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m+[0m[38;2;248;248;242m [0m[38;2;255;255;255mAPI_FETCH_LIMIT_BUFFER[0m
[38;5;238m1803[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mdf_market[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mget_market_data[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mDEFAULT_INTERVAL[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mlimit[0m[38;2;255;121;198m=[0m[38;2;248;248;242mdata_limit[0m[38;2;248;248;242m)[0m
[38;5;238m1804[0m   [38;5;238mâ”‚[0m 
[38;5;238m1805[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m 2. Execute Trading Logic (only if data is valid)[0m
[38;5;238m1806[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf_market[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf_market[0m[38;2;255;121;198m.[0m[38;2;248;248;242mempty[0m[38;2;248;248;242m:[0m
[38;5;238m1807[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Pass a copy of the dataframe to prevent accidental modification across cycles[0m
[38;5;238m1808[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;80;250;123mtrade_logic[0m[38;2;248;248;242m([0m
[38;5;238m1809[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[3;38;2;255;184;108mexchange[0m[38;2;255;121;198m=[0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108msymbol[0m[38;2;255;121;198m=[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mdf[0m[38;2;255;121;198m=[0m[38;2;248;248;242mdf_market[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcopy[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m,[0m
[38;5;238m1810[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[3;38;2;255;184;108mst_len[0m[38;2;255;121;198m=[0m[38;2;255;255;255mDEFAULT_ST_ATR_LENGTH[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mst_mult[0m[38;2;255;121;198m=[0m[38;2;255;255;255mDEFAULT_ST_MULTIPLIER[0m[38;2;248;248;242m,[0m
[38;5;238m1811[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[3;38;2;255;184;108mcf_st_len[0m[38;2;255;121;198m=[0m[38;2;255;255;255mCONFIRM_ST_ATR_LENGTH[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mcf_st_mult[0m[38;2;255;121;198m=[0m[38;2;255;255;255mCONFIRM_ST_MULTIPLIER[0m[38;2;248;248;242m,[0m
[38;5;238m1812[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[3;38;2;255;184;108matr_len[0m[38;2;255;121;198m=[0m[38;2;255;255;255mATR_CALCULATION_PERIOD[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mvol_ma_len[0m[38;2;255;121;198m=[0m[38;2;255;255;255mVOLUME_MA_PERIOD[0m[38;2;248;248;242m,[0m
[38;5;238m1813[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[3;38;2;255;184;108mrisk_pct[0m[38;2;255;121;198m=[0m[38;2;255;255;255mRISK_PER_TRADE_PERCENTAGE[0m[38;2;248;248;242m,[0m
[38;5;238m1814[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[3;38;2;255;184;108msl_atr_mult[0m[38;2;255;121;198m=[0m[38;2;255;255;255mATR_STOP_LOSS_MULTIPLIER[0m[38;2;248;248;242m,[0m
[38;5;238m1815[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[3;38;2;255;184;108mtp_atr_mult[0m[38;2;255;121;198m=[0m[38;2;255;255;255mATR_TAKE_PROFIT_MULTIPLIER[0m[38;2;248;248;242m,[0m
[38;5;238m1816[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[3;38;2;255;184;108mleverage[0m[38;2;255;121;198m=[0m[38;2;255;255;255mDEFAULT_LEVERAGE[0m[38;2;248;248;242m,[0m
[38;5;238m1817[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[3;38;2;255;184;108mmax_order_cap[0m[38;2;255;121;198m=[0m[38;2;255;255;255mMAX_ORDER_USDT_AMOUNT[0m[38;2;248;248;242m,[0m
[38;5;238m1818[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[3;38;2;255;184;108mmargin_buffer[0m[38;2;255;121;198m=[0m[38;2;255;255;255mREQUIRED_MARGIN_BUFFER[0m
[38;5;238m1819[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242m)[0m
[38;5;238m1820[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1821[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log if data fetching failed in this cycle[0m
[38;5;238m1822[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mMain Loop (Cycle [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcycle_count[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): No valid market data received for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Skipping trade logic for this cycle.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1823[0m   [38;5;238mâ”‚[0m 
[38;5;238m1824[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Main Loop Exception Handling ---[0m
[38;5;238m1825[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Handle specific CCXT errors gracefully to allow continuation if possible[0m
[38;5;238m1826[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mRateLimitExceeded[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1827[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRATE LIMIT EXCEEDED (Cycle [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcycle_count[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Sleeping for [0m[38;2;248;248;242m{[0m[38;2;255;255;255mDEFAULT_SLEEP_SECONDS[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;189;147;249m5[0m[38;2;248;248;242m}[0m[38;2;241;250;140m seconds...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1828[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] WARNING: Rate limit exceeded! Check API usage/frequency.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1829[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mtime[0m[38;2;255;121;198m.[0m[38;2;80;250;123msleep[0m[38;2;248;248;242m([0m[38;2;255;255;255mDEFAULT_SLEEP_SECONDS[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;189;147;249m5[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Longer sleep after rate limit hit[0m
[38;5;238m1830[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mNetworkError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1831[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Typically recoverable, log and continue after normal delay[0m
[38;5;238m1832[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mNetwork error in main loop (Cycle [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcycle_count[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Will retry next cycle.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1833[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Let the standard sleep handle the delay[0m
[38;5;238m1834[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mExchangeNotAvailable[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1835[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Exchange might be down for maintenance, sleep longer[0m
[38;5;238m1836[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mExchange not available (Cycle [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcycle_count[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Sleeping for [0m[38;2;248;248;242m{[0m[38;2;255;255;255mDEFAULT_SLEEP_SECONDS[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;189;147;249m10[0m[38;2;248;248;242m}[0m[38;2;241;250;140m seconds...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1837[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ERROR: Exchange unavailable! ([0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1838[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mtime[0m[38;2;255;121;198m.[0m[38;2;80;250;123msleep[0m[38;2;248;248;242m([0m[38;2;255;255;255mDEFAULT_SLEEP_SECONDS[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;189;147;249m10[0m[38;2;248;248;242m)[0m
[38;5;238m1839[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mAuthenticationError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1840[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Critical: API keys likely invalid or expired. Stop the bot.[0m
[38;5;238m1841[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mAuthentication Error encountered in main loop (Cycle [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcycle_count[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. API keys may be invalid or permissions revoked. Stopping bot.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1842[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] CRITICAL: Authentication Error! Bot stopping NOW.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1843[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mrun_bot[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Stop the main loop permanently[0m
[38;5;238m1844[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mExchangeError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1845[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Catch other specific exchange errors (e.g., invalid order params, margin issues not caught earlier)[0m
[38;5;238m1846[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mUnhandled Exchange error in main loop (Cycle [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcycle_count[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1847[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log traceback for details[0m
[38;5;238m1848[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ERROR: Unhandled Exchange error: [0m[38;2;248;248;242m{[0m[38;2;139;233;253mtype[0m[38;2;248;248;242m([0m[38;2;248;248;242me[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;248;248;242m__name__[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Check logs.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1849[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Continue after normal delay, hoping it's temporary[0m
[38;5;238m1850[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1851[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Catch any other unexpected errors, log traceback, and stop the bot for safety[0m
[38;5;238m1852[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mexception[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m!!! UNEXPECTED CRITICAL ERROR in main loop (Cycle [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcycle_count[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m !!![0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Logs full traceback[0m
[38;5;238m1853[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] CRITICAL UNEXPECTED ERROR in main loop: [0m[38;2;248;248;242m{[0m[38;2;139;233;253mtype[0m[38;2;248;248;242m([0m[38;2;248;248;242me[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;248;248;242m__name__[0m[38;2;248;248;242m}[0m[38;2;241;250;140m! Bot stopping NOW.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1854[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mStopping bot due to unexpected critical error.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1855[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mrun_bot[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Stop the loop[0m
[38;5;238m1856[0m   [38;5;238mâ”‚[0m 
[38;5;238m1857[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Cycle Delay ---[0m
[38;5;238m1858[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Calculate elapsed time and sleep for the remaining duration of the interval[0m
[38;5;238m1859[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mrun_bot[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Only sleep if the bot is still supposed to be running[0m
[38;5;238m1860[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mcycle_end_time[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mtime[0m[38;2;255;121;198m.[0m[38;2;80;250;123mmonotonic[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m
[38;5;238m1861[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242melapsed_time[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mcycle_end_time[0m[38;2;248;248;242m [0m[38;2;255;121;198m-[0m[38;2;248;248;242m [0m[38;2;248;248;242mcycle_start_time[0m
[38;5;238m1862[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242msleep_duration[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;139;233;253mmax[0m[38;2;248;248;242m([0m[38;2;189;147;249m0[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mDEFAULT_SLEEP_SECONDS[0m[38;2;248;248;242m [0m[38;2;255;121;198m-[0m[38;2;248;248;242m [0m[38;2;248;248;242melapsed_time[0m[38;2;248;248;242m)[0m
[38;5;238m1863[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mCycle [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcycle_count[0m[38;2;248;248;242m}[0m[38;2;241;250;140m execution time: [0m[38;2;248;248;242m{[0m[38;2;248;248;242melapsed_time[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140ms. Sleeping for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msleep_duration[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140ms.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1864[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242msleep_duration[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m:[0m
[38;5;238m1865[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mtime[0m[38;2;255;121;198m.[0m[38;2;80;250;123msleep[0m[38;2;248;248;242m([0m[38;2;248;248;242msleep_duration[0m[38;2;248;248;242m)[0m
[38;5;238m1866[0m   [38;5;238mâ”‚[0m 
[38;5;238m1867[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mKeyboardInterrupt[0m[38;2;248;248;242m:[0m
[38;5;238m1868[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m User pressed Ctrl+C[0m
[38;5;238m1869[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mShutdown requested via KeyboardInterrupt (Ctrl+C).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1870[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mrun_bot[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Ensure loop terminates if it was somehow still running[0m
[38;5;238m1871[0m   [38;5;238mâ”‚[0m 
[38;5;238m1872[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mfinally[0m[38;2;248;248;242m:[0m
[38;5;238m1873[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Bot Shutdown Sequence ---[0m
[38;5;238m1874[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m This block executes whether the loop finished normally,[0m
[38;5;238m1875[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m was stopped by an error, or by KeyboardInterrupt.[0m
[38;5;238m1876[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m--- Initiating Scalping Bot Shutdown Sequence ---[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1877[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Attempt graceful shutdown (close position) only if exchange/symbol were initialized[0m
[38;5;238m1878[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123mgraceful_shutdown[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m)[0m
[38;5;238m1879[0m   [38;5;238mâ”‚[0m 
[38;5;238m1880[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m--- Scalping Bot Shutdown Complete ---[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1881[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mmarket_base_final[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;255;121;198m.[0m[38;2;80;250;123msplit[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140m/[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m[[0m[38;2;189;147;249m0[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mBot[0m[38;2;241;250;140m"[0m
[38;5;238m1882[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Send final shutdown message[0m
[38;5;238m1883[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base_final[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] Bot process has terminated.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1884[0m   [38;5;238mâ”‚[0m 
[38;5;238m1885[0m   [38;5;238mâ”‚[0m 
[38;5;238m1886[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Script Entry Point ---[0m
[38;5;238m1887[0m   [38;5;238mâ”‚[0m [38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242m__name__[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140m__main__[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m
[38;5;238m1888[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Print initial information to the console[0m
[38;5;238m1889[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;139;233;253mprint[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m--- Bybit USDT Futures Scalping Bot v1.5.1 ---[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1890[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;139;233;253mprint[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mINFO: Loading configuration from .env file.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1891[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;139;233;253mprint[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mINFO: Ensure API keys (BYBIT_API_KEY, BYBIT_API_SECRET) are set in .env.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1892[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;139;233;253mprint[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mINFO: For SMS alerts, set ENABLE_SMS_ALERTS=true and SMS_RECIPIENT_NUMBER in .env.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1893[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;139;233;253mprint[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mINFO: SMS requires Termux environment with Termux:API installed ('pkg install termux-api') and SMS permission granted.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1894[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;139;233;253mprint[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[93mWARNING: LIVE TRADING IS ACTIVE BY DEFAULT. USE EXTREME CAUTION.[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[0m[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1895[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;139;233;253mprint[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[91m[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[1mCRITICAL: LOOP-BASED SL/TP IS ACTIVE - HIGHLY INACCURATE & UNSAFE FOR LIVE SCALPING.[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[0m[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1896[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;139;233;253mprint[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[91m[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[1mCRITICAL: IMPLEMENT EXCHANGE-NATIVE CONDITIONAL ORDERS FOR SAFE OPERATION.[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[0m[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1897[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;139;233;253mprint[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mINFO: Initial logging level set to: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetLevelName[0m[38;2;248;248;242m([0m[38;2;255;255;255mLOGGING_LEVEL[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1898[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;139;233;253mprint[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m-[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;189;147;249m40[0m[38;2;248;248;242m)[0m
[38;5;238m1899[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Start the main execution function[0m
[38;5;238m1900[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;80;250;123mmain[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m
[38;5;238mâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[0m
[38;5;238mâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[0m
       [38;5;238mâ”‚ [0mFile: [1msv2.py[0m
       [38;5;238mâ”‚ [0mSize: [1m115.2 KB[0m
[38;5;238mâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[0m
[38;5;238m   1[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m! /usr/bin/env python[0m
[38;5;238m   2[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m -*- coding: utf-8 -*-[0m
[38;5;238m   3[0m   [38;5;238mâ”‚[0m 
[38;5;238m   4[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m"""[0m
[38;5;238m   5[0m   [38;5;238mâ”‚[0m [38;2;98;114;164mHigh-Frequency Trading Bot (Scalping) for Bybit USDT Futures[0m
[38;5;238m   6[0m   [38;5;238mâ”‚[0m [38;2;98;114;164mVersion: 2.0.0 (Enhanced Safety, Configurable Loop SL/TP)[0m
[38;5;238m   7[0m   [38;5;238mâ”‚[0m 
[38;5;238m   8[0m   [38;5;238mâ”‚[0m [38;2;98;114;164mFeatures:[0m
[38;5;238m   9[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- Dual Supertrend strategy with confirmation.[0m
[38;5;238m  10[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- ATR for volatility measurement and Stop-Loss/Take-Profit calculation.[0m
[38;5;238m  11[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- Volume spike analysis (optional confirmation).[0m
[38;5;238m  12[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- Order book pressure analysis (optional confirmation, optimized fetching).[0m
[38;5;238m  13[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- Risk-based position sizing with margin checks.[0m
[38;5;238m  14[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- Termux SMS alerts for critical events.[0m
[38;5;238m  15[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- Robust error handling and logging with color support.[0m
[38;5;238m  16[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- Graceful shutdown on KeyboardInterrupt with position closing attempt.[0m
[38;5;238m  17[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- Stricter position detection logic (targeting Bybit V5 API, checks 'side').[0m
[38;5;238m  18[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- **Configurable Loop-Based SL/TP Check (Default: OFF due to safety concerns).**[0m
[38;5;238m  19[0m   [38;5;238mâ”‚[0m 
[38;5;238m  20[0m   [38;5;238mâ”‚[0m [38;2;98;114;164mDisclaimer:[0m
[38;5;238m  21[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- **EXTREME RISK**: This software is for educational purposes ONLY. Scalping bots are[0m
[38;5;238m  22[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m  extremely high-risk due to market noise, latency, slippage, fees, and the[0m
[38;5;238m  23[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m  critical need for precise, low-latency execution. Use at your own absolute risk.[0m
[38;5;238m  24[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- **CRITICAL SL/TP LIMITATION (LOOP-BASED CHECK)**: The optional loop-based[0m
[38;5;238m  25[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m  Stop-Loss/Take-Profit mechanism checks *after* the candle closes. This is[0m
[38;5;238m  26[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m  **HIGHLY INACCURATE AND UNSAFE** for live scalping. Price can move significantly[0m
[38;5;238m  27[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m  beyond calculated levels before the bot reacts in the next cycle. For real[0m
[38;5;238m  28[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m  scalping, you **MUST** implement exchange-native conditional orders[0m
[38;5;238m  29[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m  (e.g., stopMarket, takeProfitMarket using `exchange.create_order` with appropriate[0m
[38;5;238m  30[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m  `stopLossPrice` / `takeProfitPrice` params) placed *immediately* after entry[0m
[38;5;238m  31[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m  confirmation, ideally based on the actual fill price. **This loop check is DISABLED by default.**[0m
[38;5;238m  32[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- Parameter Sensitivity: Bot performance is highly dependent on parameter tuning.[0m
[38;5;238m  33[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m  Requires significant backtesting and forward testing. Defaults are illustrative.[0m
[38;5;238m  34[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- API Rate Limits: Frequent API calls can hit exchange rate limits. Monitor usage.[0m
[38;5;238m  35[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- Slippage: Market orders used for entry/exit are prone to slippage, especially[0m
[38;5;238m  36[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m  during volatile periods.[0m
[38;5;238m  37[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- Test Thoroughly: **DO NOT RUN LIVE WITHOUT EXTENSIVE TESTNET/DEMO TESTING.**[0m
[38;5;238m  38[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- Termux Dependency: SMS alerts require running within Termux on Android with[0m
[38;5;238m  39[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m  Termux:API installed (`pkg install termux-api`) and configured (SMS permissions).[0m
[38;5;238m  40[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m- API Changes: Exchange APIs (like Bybit V3 vs V5) can change. This code targets[0m
[38;5;238m  41[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m  structures observed in V5 via CCXT, but updates may be needed.[0m
[38;5;238m  42[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m"""[0m
[38;5;238m  43[0m   [38;5;238mâ”‚[0m 
[38;5;238m  44[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m Standard Library Imports[0m
[38;5;238m  45[0m   [38;5;238mâ”‚[0m [38;2;255;121;198mimport[0m[38;2;248;248;242m [0m[38;2;248;248;242mlogging[0m
[38;5;238m  46[0m   [38;5;238mâ”‚[0m [38;2;255;121;198mimport[0m[38;2;248;248;242m [0m[38;2;248;248;242mos[0m
[38;5;238m  47[0m   [38;5;238mâ”‚[0m [38;2;255;121;198mimport[0m[38;2;248;248;242m [0m[38;2;248;248;242msys[0m
[38;5;238m  48[0m   [38;5;238mâ”‚[0m [38;2;255;121;198mimport[0m[38;2;248;248;242m [0m[38;2;248;248;242mtime[0m
[38;5;238m  49[0m   [38;5;238mâ”‚[0m [38;2;255;121;198mimport[0m[38;2;248;248;242m [0m[38;2;248;248;242mtraceback[0m
[38;5;238m  50[0m   [38;5;238mâ”‚[0m [38;2;255;121;198mimport[0m[38;2;248;248;242m [0m[38;2;248;248;242msubprocess[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m For Termux API calls[0m
[38;5;238m  51[0m   [38;5;238mâ”‚[0m [38;2;255;121;198mfrom[0m[38;2;248;248;242m [0m[38;2;248;248;242mtyping[0m[38;2;248;248;242m [0m[38;2;255;121;198mimport[0m[38;2;248;248;242m [0m[38;2;248;248;242mDict[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mAny[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mTuple[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mList[0m
[38;5;238m  52[0m   [38;5;238mâ”‚[0m 
[38;5;238m  53[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m Third-party Libraries[0m
[38;5;238m  54[0m   [38;5;238mâ”‚[0m [38;2;255;121;198mimport[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m
[38;5;238m  55[0m   [38;5;238mâ”‚[0m [38;2;255;121;198mimport[0m[38;2;248;248;242m [0m[38;2;248;248;242mpandas[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m
[38;5;238m  56[0m   [38;5;238mâ”‚[0m [38;2;255;121;198mimport[0m[38;2;248;248;242m [0m[38;2;248;248;242mpandas_ta[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242mta[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m <-- Added missing import[0m
[38;5;238m  57[0m   [38;5;238mâ”‚[0m [38;2;255;121;198mfrom[0m[38;2;248;248;242m [0m[38;2;248;248;242mdotenv[0m[38;2;248;248;242m [0m[38;2;255;121;198mimport[0m[38;2;248;248;242m [0m[38;2;248;248;242mload_dotenv[0m
[38;5;238m  58[0m   [38;5;238mâ”‚[0m 
[38;5;238m  59[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Configuration Loading ---[0m
[38;5;238m  60[0m   [38;5;238mâ”‚[0m [38;2;80;250;123mload_dotenv[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Load variables from .env file into environment variables[0m
[38;5;238m  61[0m   [38;5;238mâ”‚[0m 
[38;5;238m  62[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Constants ---[0m
[38;5;238m  63[0m   [38;5;238mâ”‚[0m 
[38;5;238m  64[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- API Credentials (Required in .env) ---[0m
[38;5;238m  65[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mBYBIT_API_KEY[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mBYBIT_API_KEY[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m  66[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mBYBIT_API_SECRET[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mBYBIT_API_SECRET[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m  67[0m   [38;5;238mâ”‚[0m 
[38;5;238m  68[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Trading Parameters (Set Defaults, Override in .env) ---[0m
[38;5;238m  69[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mDEFAULT_SYMBOL[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mSYMBOL[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mBTC/USDT:USDT[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m CCXT unified symbol format[0m
[38;5;238m  70[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mDEFAULT_INTERVAL[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mINTERVAL[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140m1m[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Timeframe (e.g., '1m', '5m')[0m
[38;5;238m  71[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mDEFAULT_LEVERAGE[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mLEVERAGE[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m10[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Desired leverage[0m
[38;5;238m  72[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mDEFAULT_SLEEP_SECONDS[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mSLEEP_SECONDS[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m10[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Pause between cycles[0m
[38;5;238m  73[0m   [38;5;238mâ”‚[0m 
[38;5;238m  74[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Risk Management (CRITICAL - TUNE CAREFULLY!) ---[0m
[38;5;238m  75[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mRISK_PER_TRADE_PERCENTAGE[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mRISK_PER_TRADE_PERCENTAGE[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m005[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m 0.5% risk per trade based on equity[0m
[38;5;238m  76[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mATR_STOP_LOSS_MULTIPLIER[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mATR_STOP_LOSS_MULTIPLIER[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m[38;2;189;147;249m.[0m[38;2;189;147;249m5[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Multiplier for ATR to set SL distance[0m
[38;5;238m  77[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mATR_TAKE_PROFIT_MULTIPLIER[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mATR_TAKE_PROFIT_MULTIPLIER[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m2[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Multiplier for ATR to set TP distance[0m
[38;5;238m  78[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mMAX_ORDER_USDT_AMOUNT[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mMAX_ORDER_USDT_AMOUNT[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m500[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Maximum position size in USDT value[0m
[38;5;238m  79[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mREQUIRED_MARGIN_BUFFER[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mREQUIRED_MARGIN_BUFFER[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m[38;2;189;147;249m.[0m[38;2;189;147;249m05[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Margin check buffer (e.g., 1.05 = requires 5% extra free margin)[0m
[38;5;238m  80[0m   [38;5;238mâ”‚[0m 
[38;5;238m  81[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Safety Feature (Loop-Based SL/TP - HIGHLY DISCOURAGED) ---[0m
[38;5;238m  82[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m *** WARNING: Setting this to True enables a DANGEROUS and INACCURATE SL/TP mechanism ***[0m
[38;5;238m  83[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m *** suitable ONLY for testing or non-latency-sensitive strategies. ***[0m
[38;5;238m  84[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m *** For real scalping, KEEP THIS FALSE and implement exchange-native conditional orders. ***[0m
[38;5;238m  85[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mENABLE_LOOP_SLTP_CHECK[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mbool[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mENABLE_LOOP_SLTP_CHECK[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mfalse[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mlower[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mtrue[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Default to False[0m
[38;5;238m  86[0m   [38;5;238mâ”‚[0m 
[38;5;238m  87[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Supertrend Indicator Parameters ---[0m
[38;5;238m  88[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mDEFAULT_ST_ATR_LENGTH[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mST_ATR_LENGTH[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m7[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Primary Supertrend ATR period[0m
[38;5;238m  89[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mDEFAULT_ST_MULTIPLIER[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mST_MULTIPLIER[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m2[0m[38;2;189;147;249m.[0m[38;2;189;147;249m5[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Primary Supertrend ATR multiplier[0m
[38;5;238m  90[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mCONFIRM_ST_ATR_LENGTH[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mCONFIRM_ST_ATR_LENGTH[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m5[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Confirmation Supertrend ATR period[0m
[38;5;238m  91[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mCONFIRM_ST_MULTIPLIER[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mCONFIRM_ST_MULTIPLIER[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m2[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Confirmation Supertrend ATR multiplier[0m
[38;5;238m  92[0m   [38;5;238mâ”‚[0m 
[38;5;238m  93[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Volume Analysis Parameters ---[0m
[38;5;238m  94[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mVOLUME_MA_PERIOD[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mVOLUME_MA_PERIOD[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m20[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Moving average period for volume[0m
[38;5;238m  95[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mVOLUME_SPIKE_THRESHOLD[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mVOLUME_SPIKE_THRESHOLD[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m[38;2;189;147;249m.[0m[38;2;189;147;249m5[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Volume must be > this * MA for a spike[0m
[38;5;238m  96[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mREQUIRE_VOLUME_SPIKE_FOR_ENTRY[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mbool[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mREQUIRE_VOLUME_SPIKE_FOR_ENTRY[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mtrue[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mlower[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mtrue[0m[38;2;241;250;140m"[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Require volume spike for entry signal[0m
[38;5;238m  97[0m   [38;5;238mâ”‚[0m 
[38;5;238m  98[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Order Book Analysis Parameters ---[0m
[38;5;238m  99[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mORDER_BOOK_DEPTH[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mORDER_BOOK_DEPTH[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m10[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Levels of bids/asks to analyze[0m
[38;5;238m 100[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mORDER_BOOK_RATIO_THRESHOLD_LONG[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mORDER_BOOK_RATIO_THRESHOLD_LONG[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m[38;2;189;147;249m.[0m[38;2;189;147;249m2[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Bid/Ask volume ratio must be >= this for long confirmation[0m
[38;5;238m 101[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mORDER_BOOK_RATIO_THRESHOLD_SHORT[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mORDER_BOOK_RATIO_THRESHOLD_SHORT[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m8[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Bid/Ask volume ratio must be <= this for short confirmation[0m
[38;5;238m 102[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mFETCH_ORDER_BOOK_PER_CYCLE[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mbool[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mFETCH_ORDER_BOOK_PER_CYCLE[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mfalse[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mlower[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mtrue[0m[38;2;241;250;140m"[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Fetch OB every cycle (costly) or only on potential signals[0m
[38;5;238m 103[0m   [38;5;238mâ”‚[0m 
[38;5;238m 104[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- ATR Calculation Parameter (for SL/TP) ---[0m
[38;5;238m 105[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mATR_CALCULATION_PERIOD[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mATR_CALCULATION_PERIOD[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m14[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m ATR period used specifically for SL/TP calculation[0m
[38;5;238m 106[0m   [38;5;238mâ”‚[0m 
[38;5;238m 107[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Termux SMS Alert Configuration (Set in .env) ---[0m
[38;5;238m 108[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mENABLE_SMS_ALERTS[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mbool[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mENABLE_SMS_ALERTS[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mfalse[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mlower[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mtrue[0m[38;2;241;250;140m"[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Master switch for SMS alerts[0m
[38;5;238m 109[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mSMS_RECIPIENT_NUMBER[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mSMS_RECIPIENT_NUMBER[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Phone number to send alerts to[0m
[38;5;238m 110[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mSMS_TIMEOUT_SECONDS[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m([0m[38;2;248;248;242mos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetenv[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mSMS_TIMEOUT_SECONDS[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m30[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Timeout for the termux-sms-send command[0m
[38;5;238m 111[0m   [38;5;238mâ”‚[0m 
[38;5;238m 112[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- CCXT / API Parameters ---[0m
[38;5;238m 113[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mDEFAULT_RECV_WINDOW[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249m10000[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m API receive window (milliseconds)[0m
[38;5;238m 114[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mORDER_BOOK_FETCH_LIMIT[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;139;233;253mmax[0m[38;2;248;248;242m([0m[38;2;189;147;249m25[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mORDER_BOOK_DEPTH[0m[38;2;248;248;242m)[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m How many OB levels to fetch (API often requires min 25/50/100)[0m
[38;5;238m 115[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mSHALLOW_OB_FETCH_DEPTH[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249m5[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Depth for quick best bid/ask fetch for entry price estimate[0m
[38;5;238m 116[0m   [38;5;238mâ”‚[0m 
[38;5;238m 117[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Internal Constants ---[0m
[38;5;238m 118[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mSIDE_BUY[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mbuy[0m[38;2;241;250;140m"[0m
[38;5;238m 119[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mSIDE_SELL[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140msell[0m[38;2;241;250;140m"[0m
[38;5;238m 120[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mPOSITION_SIDE_LONG[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mLong[0m[38;2;241;250;140m"[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Internal representation for long position[0m
[38;5;238m 121[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mPOSITION_SIDE_SHORT[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mShort[0m[38;2;241;250;140m"[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Internal representation for short position[0m
[38;5;238m 122[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mPOSITION_SIDE_NONE[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mNone[0m[38;2;241;250;140m"[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Internal representation for no position[0m
[38;5;238m 123[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mUSDT_SYMBOL[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mUSDT[0m[38;2;241;250;140m"[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Base currency symbol for balance checks[0m
[38;5;238m 124[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mRETRY_COUNT[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249m3[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Number of retries for certain API calls (e.g., leverage setting)[0m
[38;5;238m 125[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mRETRY_DELAY_SECONDS[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Delay between retries[0m
[38;5;238m 126[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mAPI_FETCH_LIMIT_BUFFER[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249m5[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Fetch slightly more OHLCV data than strictly needed for indicator calculation buffer[0m
[38;5;238m 127[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mPOSITION_QTY_EPSILON[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249m1e-9[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Small value for floating point comparisons (e.g., checking if quantity is effectively zero)[0m
[38;5;238m 128[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mPOST_CLOSE_DELAY_SECONDS[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249m2[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Brief delay after closing a position before potentially opening a new one[0m
[38;5;238m 129[0m   [38;5;238mâ”‚[0m 
[38;5;238m 130[0m   [38;5;238mâ”‚[0m 
[38;5;238m 131[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Logger Setup ---[0m
[38;5;238m 132[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m ---> SET TO DEBUG FOR DETAILED TROUBLESHOOTING <---[0m
[38;5;238m 133[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m ---> REMEMBER TO SET BACK TO INFO FOR NORMAL OPERATION <---[0m
[38;5;238m 134[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mLOGGING_LEVEL[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;255;255;255mINFO[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Default level[0m
[38;5;238m 135[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m LOGGING_LEVEL = logging.DEBUG # Uncomment for verbose debugging[0m
[38;5;238m 136[0m   [38;5;238mâ”‚[0m [38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123mbasicConfig[0m[38;2;248;248;242m([0m
[38;5;238m 137[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mlevel[0m[38;2;255;121;198m=[0m[38;2;255;255;255mLOGGING_LEVEL[0m[38;2;248;248;242m,[0m
[38;5;238m 138[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mformat[0m[38;2;255;121;198m=[0m[38;2;241;250;140m"[0m[38;2;189;147;249m%([0m[38;2;255;255;255masctime[0m[38;2;189;147;249m)s[0m[38;2;241;250;140m [[0m[38;2;189;147;249m%([0m[38;2;255;255;255mlevelname[0m[38;2;189;147;249m)s[0m[38;2;241;250;140m]  [0m[38;2;189;147;249m%([0m[38;2;255;255;255mmessage[0m[38;2;189;147;249m)s[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m
[38;5;238m 139[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mdatefmt[0m[38;2;255;121;198m=[0m[38;2;241;250;140m"[0m[38;2;189;147;249m%Y[0m[38;2;241;250;140m-[0m[38;2;189;147;249m%m[0m[38;2;241;250;140m-[0m[38;2;189;147;249m%d[0m[38;2;241;250;140m [0m[38;2;189;147;249m%H[0m[38;2;241;250;140m:[0m[38;2;189;147;249m%M[0m[38;2;241;250;140m:[0m[38;2;189;147;249m%S[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m
[38;5;238m 140[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mhandlers[0m[38;2;255;121;198m=[0m[38;2;248;248;242m[[0m
[38;5;238m 141[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m logging.FileHandler("scalp_bot.log"), # Optional: Log to file[0m
[38;5;238m 142[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123mStreamHandler[0m[38;2;248;248;242m([0m[38;2;248;248;242msys[0m[38;2;255;121;198m.[0m[38;2;248;248;242mstdout[0m[38;2;248;248;242m)[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log to console[0m
[38;5;238m 143[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242m][0m
[38;5;238m 144[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m)[0m
[38;5;238m 145[0m   [38;5;238mâ”‚[0m [38;2;248;248;242mlogger[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;248;248;242mLogger[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetLogger[0m[38;2;248;248;242m([0m[38;2;248;248;242m__name__[0m[38;2;248;248;242m)[0m
[38;5;238m 146[0m   [38;5;238mâ”‚[0m 
[38;5;238m 147[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m Custom SUCCESS level and color formatting[0m
[38;5;238m 148[0m   [38;5;238mâ”‚[0m [38;2;255;255;255mSUCCESS_LEVEL[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249m25[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Between INFO and WARNING[0m
[38;5;238m 149[0m   [38;5;238mâ”‚[0m [38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123maddLevelName[0m[38;2;248;248;242m([0m[38;2;255;255;255mSUCCESS_LEVEL[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mSUCCESS[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 150[0m   [38;5;238mâ”‚[0m 
[38;5;238m 151[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123mlog_success[0m[38;2;248;248;242m([0m[3;38;2;255;184;108mself[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mmessage[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[3;38;2;255;184;108margs[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;121;198m**[0m[3;38;2;255;184;108mkwargs[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 152[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m[38;2;98;114;164mAdds a 'success' log level method to the Logger class.[0m[38;2;98;114;164m"""[0m
[38;5;238m 153[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;189;147;249mself[0m[38;2;255;121;198m.[0m[38;2;80;250;123misEnabledFor[0m[38;2;248;248;242m([0m[38;2;255;255;255mSUCCESS_LEVEL[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 154[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m pylint: disable=protected-access[0m
[38;5;238m 155[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;189;147;249mself[0m[38;2;255;121;198m.[0m[38;2;80;250;123m_log[0m[38;2;248;248;242m([0m[38;2;255;255;255mSUCCESS_LEVEL[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mmessage[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242margs[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;121;198m**[0m[38;2;248;248;242mkwargs[0m[38;2;248;248;242m)[0m
[38;5;238m 156[0m   [38;5;238mâ”‚[0m 
[38;5;238m 157[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m Bind the new method to the Logger class[0m
[38;5;238m 158[0m   [38;5;238mâ”‚[0m [38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;248;248;242mLogger[0m[38;2;255;121;198m.[0m[38;2;248;248;242msuccess[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlog_success[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m type: ignore[0m
[38;5;238m 159[0m   [38;5;238mâ”‚[0m 
[38;5;238m 160[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m ANSI escape codes for colored logging output (adjust based on terminal support)[0m
[38;5;238m 161[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m Check if the output stream is a TTY (terminal) before adding colors[0m
[38;5;238m 162[0m   [38;5;238mâ”‚[0m [38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242msys[0m[38;2;255;121;198m.[0m[38;2;248;248;242mstdout[0m[38;2;255;121;198m.[0m[38;2;80;250;123misatty[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 163[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123maddLevelName[0m[38;2;248;248;242m([0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;255;255;255mDEBUG[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[90m[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetLevelName[0m[38;2;248;248;242m([0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;255;255;255mDEBUG[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[0m[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Gray[0m
[38;5;238m 164[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123maddLevelName[0m[38;2;248;248;242m([0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;255;255;255mINFO[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[96m[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetLevelName[0m[38;2;248;248;242m([0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;255;255;255mINFO[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[0m[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Cyan[0m
[38;5;238m 165[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123maddLevelName[0m[38;2;248;248;242m([0m[38;2;255;255;255mSUCCESS_LEVEL[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[92m[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetLevelName[0m[38;2;248;248;242m([0m[38;2;255;255;255mSUCCESS_LEVEL[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[0m[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Green[0m
[38;5;238m 166[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123maddLevelName[0m[38;2;248;248;242m([0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;255;255;255mWARNING[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[93m[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetLevelName[0m[38;2;248;248;242m([0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;255;255;255mWARNING[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[0m[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Yellow[0m
[38;5;238m 167[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123maddLevelName[0m[38;2;248;248;242m([0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;255;255;255mERROR[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[91m[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetLevelName[0m[38;2;248;248;242m([0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;255;255;255mERROR[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[0m[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Red[0m
[38;5;238m 168[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123maddLevelName[0m[38;2;248;248;242m([0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;255;255;255mCRITICAL[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[91m[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[1m[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetLevelName[0m[38;2;248;248;242m([0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;255;255;255mCRITICAL[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[0m[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Bold Red[0m
[38;5;238m 169[0m   [38;5;238mâ”‚[0m 
[38;5;238m 170[0m   [38;5;238mâ”‚[0m 
[38;5;238m 171[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Termux SMS Alert Function ---[0m
[38;5;238m 172[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;255;184;108mmessage[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;248;248;242m->[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mbool[0m[38;2;248;248;242m:[0m
[38;5;238m 173[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 174[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Sends an SMS alert using the 'termux-sms-send' command via subprocess.[0m
[38;5;238m 175[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Requires Termux and Termux:API with SMS permissions granted.[0m
[38;5;238m 176[0m   [38;5;238mâ”‚[0m 
[38;5;238m 177[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Args:[0m
[38;5;238m 178[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        message (str): The text message content to send.[0m
[38;5;238m 179[0m   [38;5;238mâ”‚[0m 
[38;5;238m 180[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Returns:[0m
[38;5;238m 181[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        bool: True if the command executed successfully (return code 0),[0m
[38;5;238m 182[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m              False otherwise (config disabled, missing number, command error, timeout).[0m
[38;5;238m 183[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m              Note: True only means the command ran successfully, not guaranteed SMS delivery.[0m
[38;5;238m 184[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 185[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;255;255;255mENABLE_SMS_ALERTS[0m[38;2;248;248;242m:[0m
[38;5;238m 186[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mSMS alerts disabled via configuration.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 187[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m
[38;5;238m 188[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;255;255;255mSMS_RECIPIENT_NUMBER[0m[38;2;248;248;242m:[0m
[38;5;238m 189[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mSMS alerts enabled, but SMS_RECIPIENT_NUMBER not set in .env file.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 190[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m
[38;5;238m 191[0m   [38;5;238mâ”‚[0m 
[38;5;238m 192[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m 193[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Command arguments: send SMS (-n recipient_number) with the message content[0m
[38;5;238m 194[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m No complex shell injection risk here with direct message content, shlex not strictly needed[0m
[38;5;238m 195[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mcommand[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mList[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mtermux-sms-send[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140m-n[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mSMS_RECIPIENT_NUMBER[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mmessage[0m[38;2;248;248;242m][0m
[38;5;238m 196[0m   [38;5;238mâ”‚[0m 
[38;5;238m 197[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mAttempting to send SMS alert to [0m[38;2;248;248;242m{[0m[38;2;255;255;255mSMS_RECIPIENT_NUMBER[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (Timeout: [0m[38;2;248;248;242m{[0m[38;2;255;255;255mSMS_TIMEOUT_SECONDS[0m[38;2;248;248;242m}[0m[38;2;241;250;140ms)...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 198[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mExecuting command: [0m[38;2;248;248;242m{[0m[38;2;241;250;140m'[0m[38;2;241;250;140m [0m[38;2;241;250;140m'[0m[38;2;255;121;198m.[0m[38;2;80;250;123mjoin[0m[38;2;248;248;242m([0m[38;2;248;248;242mcommand[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log the command for debugging[0m
[38;5;238m 199[0m   [38;5;238mâ”‚[0m 
[38;5;238m 200[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mresult[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242msubprocess[0m[38;2;255;121;198m.[0m[38;2;80;250;123mrun[0m[38;2;248;248;242m([0m
[38;5;238m 201[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mcommand[0m[38;2;248;248;242m,[0m
[38;5;238m 202[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mcapture_output[0m[38;2;255;121;198m=[0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m,[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Capture stdout/stderr[0m
[38;5;238m 203[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mtext[0m[38;2;255;121;198m=[0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m,[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Decode stdout/stderr as text[0m
[38;5;238m 204[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mcheck[0m[38;2;255;121;198m=[0m[38;2;189;147;249mFalse[0m[38;2;248;248;242m,[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Do not raise exception on non-zero exit, check manually[0m
[38;5;238m 205[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mtimeout[0m[38;2;255;121;198m=[0m[38;2;255;255;255mSMS_TIMEOUT_SECONDS[0m[38;2;248;248;242m,[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Set a timeout for the command[0m
[38;5;238m 206[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242m)[0m
[38;5;238m 207[0m   [38;5;238mâ”‚[0m 
[38;5;238m 208[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mresult[0m[38;2;255;121;198m.[0m[38;2;248;248;242mreturncode[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m:[0m
[38;5;238m 209[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123msuccess[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTermux API command for SMS to [0m[38;2;248;248;242m{[0m[38;2;255;255;255mSMS_RECIPIENT_NUMBER[0m[38;2;248;248;242m}[0m[38;2;241;250;140m executed successfully.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 210[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m
[38;5;238m 211[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m 212[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log detailed error information if the command failed[0m
[38;5;238m 213[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTermux API command 'termux-sms-send' failed. Return code: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mresult[0m[38;2;255;121;198m.[0m[38;2;248;248;242mreturncode[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 214[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mresult[0m[38;2;255;121;198m.[0m[38;2;248;248;242mstderr[0m[38;2;248;248;242m:[0m
[38;5;238m 215[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTermux API Stderr: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mresult[0m[38;2;255;121;198m.[0m[38;2;248;248;242mstderr[0m[38;2;255;121;198m.[0m[38;2;80;250;123mstrip[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 216[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mresult[0m[38;2;255;121;198m.[0m[38;2;248;248;242mstdout[0m[38;2;248;248;242m:[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Sometimes error info might be on stdout[0m
[38;5;238m 217[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTermux API Stdout: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mresult[0m[38;2;255;121;198m.[0m[38;2;248;248;242mstdout[0m[38;2;255;121;198m.[0m[38;2;80;250;123mstrip[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 218[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mPotential issues: SMS permissions not granted in Android settings for Termux:API, [0m[38;2;241;250;140m"[0m
[38;5;238m 219[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                         [0m[38;2;241;250;140m"[0m[38;2;241;250;140mTermux:API app not running or installed, incorrect recipient number format, [0m[38;2;241;250;140m"[0m
[38;5;238m 220[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                         [0m[38;2;241;250;140m"[0m[38;2;241;250;140mAndroid battery optimization interfering with Termux.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 221[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m
[38;5;238m 222[0m   [38;5;238mâ”‚[0m 
[38;5;238m 223[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mFileNotFoundError[0m[38;2;248;248;242m:[0m
[38;5;238m 224[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mFailed to send SMS: 'termux-sms-send' command not found. [0m[38;2;241;250;140m"[0m
[38;5;238m 225[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                     [0m[38;2;241;250;140m"[0m[38;2;241;250;140mEnsure Termux:API package is installed (`pkg install termux-api`) and the Termux:API app is running.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 226[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m
[38;5;238m 227[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242msubprocess[0m[38;2;248;248;242m.[0m[38;2;248;248;242mTimeoutExpired[0m[38;2;248;248;242m:[0m
[38;5;238m 228[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mFailed to send SMS: 'termux-sms-send' command timed out after [0m[38;2;248;248;242m{[0m[38;2;255;255;255mSMS_TIMEOUT_SECONDS[0m[38;2;248;248;242m}[0m[38;2;241;250;140m seconds. [0m[38;2;241;250;140m"[0m
[38;5;238m 229[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                     [0m[38;2;241;250;140m"[0m[38;2;241;250;140mCheck Termux:API service status, permissions, and Android battery optimization settings.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 230[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m
[38;5;238m 231[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 232[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mAn unexpected error occurred while sending SMS via Termux API: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 233[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log full traceback for unexpected errors[0m
[38;5;238m 234[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m
[38;5;238m 235[0m   [38;5;238mâ”‚[0m 
[38;5;238m 236[0m   [38;5;238mâ”‚[0m 
[38;5;238m 237[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Exchange Initialization ---[0m
[38;5;238m 238[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123minitialize_exchange[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;248;248;242m->[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[38;2;248;248;242mccxt[0m[38;2;255;121;198m.[0m[38;2;248;248;242mExchange[0m[38;2;248;248;242m][0m[38;2;248;248;242m:[0m
[38;5;238m 239[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 240[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Initializes and returns the CCXT Bybit exchange instance.[0m
[38;5;238m 241[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Performs connectivity/authentication checks and sends SMS alerts.[0m
[38;5;238m 242[0m   [38;5;238mâ”‚[0m 
[38;5;238m 243[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Returns:[0m
[38;5;238m 244[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        Optional[ccxt.Exchange]: Initialized exchange object or None on failure.[0m
[38;5;238m 245[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 246[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mInitializing CCXT Bybit connection...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 247[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;255;255;255mBYBIT_API_KEY[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;255;255;255mBYBIT_API_SECRET[0m[38;2;248;248;242m:[0m
[38;5;238m 248[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mCRITICAL: BYBIT_API_KEY and/or BYBIT_API_SECRET missing in .env file.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 249[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m[ScalpBot] CRITICAL: API keys missing in .env. Bot stopped.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 250[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 251[0m   [38;5;238mâ”‚[0m 
[38;5;238m 252[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m 253[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;255;121;198m.[0m[38;2;80;250;123mbybit[0m[38;2;248;248;242m([0m
[38;5;238m 254[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242m{[0m
[38;5;238m 255[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;241;250;140m"[0m[38;2;241;250;140mapiKey[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;255;255;255mBYBIT_API_KEY[0m[38;2;248;248;242m,[0m
[38;5;238m 256[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;241;250;140m"[0m[38;2;241;250;140msecret[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;255;255;255mBYBIT_API_SECRET[0m[38;2;248;248;242m,[0m
[38;5;238m 257[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;241;250;140m"[0m[38;2;241;250;140menableRateLimit[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m,[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Enable CCXT's built-in rate limiter[0m
[38;5;238m 258[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;241;250;140m"[0m[38;2;241;250;140moptions[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m
[38;5;238m 259[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;241;250;140m"[0m[38;2;241;250;140mdefaultType[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mlinear[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Crucial: Use 'linear' for USDT Perpetual, 'inverse' for inverse contracts[0m
[38;5;238m 260[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;241;250;140m"[0m[38;2;241;250;140mrecvWindow[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;255;255;255mDEFAULT_RECV_WINDOW[0m[38;2;248;248;242m,[0m
[38;5;238m 261[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m 'adjustForTimeDifference': True, # Consider if clock skew issues arise[0m
[38;5;238m 262[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m 'verbose': True, # Uncomment for extremely detailed API request/response logging[0m
[38;5;238m 263[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242m}[0m[38;2;248;248;242m,[0m
[38;5;238m 264[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242m}[0m
[38;5;238m 265[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242m)[0m
[38;5;238m 266[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Test connection and authentication by fetching markets and balance[0m
[38;5;238m 267[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mLoading markets...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 268[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mload_markets[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m
[38;5;238m 269[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mFetching balance (tests authentication)...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 270[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mfetch_balance[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Throws AuthenticationError on bad keys[0m
[38;5;238m 271[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mCCXT Bybit Session Initialized (LIVE FUTURES SCALPING MODE - EXTREME CAUTION!).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 272[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m[ScalpBot] Initialized successfully and authenticated.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 273[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m
[38;5;238m 274[0m   [38;5;238mâ”‚[0m 
[38;5;238m 275[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mAuthenticationError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 276[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mAuthentication failed: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Check API key/secret and ensure IP whitelist (if used) is correct and API permissions are sufficient.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 277[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[ScalpBot] CRITICAL: Authentication FAILED: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Bot stopped.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 278[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mNetworkError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 279[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mNetwork error during initialization: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Check internet connection and Bybit status.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 280[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[ScalpBot] CRITICAL: Network Error on Init: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Bot stopped.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 281[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mExchangeError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 282[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mExchange error during initialization: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Check Bybit status page or API documentation for details.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 283[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[ScalpBot] CRITICAL: Exchange Error on Init: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Bot stopped.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 284[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 285[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mFailed to initialize exchange due to an unexpected error: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 286[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m 287[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[ScalpBot] CRITICAL: Unexpected Init Error: [0m[38;2;248;248;242m{[0m[38;2;139;233;253mtype[0m[38;2;248;248;242m([0m[38;2;248;248;242me[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;248;248;242m__name__[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Bot stopped.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 288[0m   [38;5;238mâ”‚[0m 
[38;5;238m 289[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 290[0m   [38;5;238mâ”‚[0m 
[38;5;238m 291[0m   [38;5;238mâ”‚[0m 
[38;5;238m 292[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Indicator Calculation ---[0m
[38;5;238m 293[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123mcalculate_supertrend[0m[38;2;248;248;242m([0m
[38;5;238m 294[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mdf[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;248;248;242mDataFrame[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mlength[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mmultiplier[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mprefix[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140m"[0m
[38;5;238m 295[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;248;248;242m->[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;248;248;242mDataFrame[0m[38;2;248;248;242m:[0m
[38;5;238m 296[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 297[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Calculates the Supertrend indicator using the pandas_ta library.[0m
[38;5;238m 298[0m   [38;5;238mâ”‚[0m 
[38;5;238m 299[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Args:[0m
[38;5;238m 300[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        df (pd.DataFrame): Input DataFrame with 'high', 'low', 'close' columns.[0m
[38;5;238m 301[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        length (int): The ATR lookback period for Supertrend.[0m
[38;5;238m 302[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        multiplier (float): The ATR multiplier for Supertrend.[0m
[38;5;238m 303[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        prefix (str): Optional prefix for the generated columns (e.g., "confirm_").[0m
[38;5;238m 304[0m   [38;5;238mâ”‚[0m 
[38;5;238m 305[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Returns:[0m
[38;5;238m 306[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        pd.DataFrame: DataFrame with added Supertrend columns:[0m
[38;5;238m 307[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m                      '{prefix}supertrend' (the Supertrend line value),[0m
[38;5;238m 308[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m                      '{prefix}trend' (boolean, True if trend is up),[0m
[38;5;238m 309[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m                      '{prefix}st_long' (boolean, True on the candle the trend flipped UP),[0m
[38;5;238m 310[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m                      '{prefix}st_short' (boolean, True on the candle the trend flipped DOWN).[0m
[38;5;238m 311[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m                      Returns original DataFrame with NA columns if calculation fails.[0m
[38;5;238m 312[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 313[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mprefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mprefix[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140m"[0m
[38;5;238m 314[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Define the target column names we want to keep[0m
[38;5;238m 315[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mtarget_cols[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m[[0m
[38;5;238m 316[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140msupertrend[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m
[38;5;238m 317[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140mtrend[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m
[38;5;238m 318[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140mst_long[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m
[38;5;238m 319[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140mst_short[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m
[38;5;238m 320[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242m][0m
[38;5;238m 321[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Define the raw column names expected from pandas_ta based on its naming convention[0m
[38;5;238m 322[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mst_col_name[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSUPERT_[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlength[0m[38;2;248;248;242m}[0m[38;2;241;250;140m_[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmultiplier[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Supertrend line value[0m
[38;5;238m 323[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mst_trend_col[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSUPERTd_[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlength[0m[38;2;248;248;242m}[0m[38;2;241;250;140m_[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmultiplier[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Trend direction (-1 down, 1 up)[0m
[38;5;238m 324[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mst_long_col[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSUPERTl_[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlength[0m[38;2;248;248;242m}[0m[38;2;241;250;140m_[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmultiplier[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Lower band value (used when trend is up)[0m
[38;5;238m 325[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mst_short_col[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSUPERTs_[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlength[0m[38;2;248;248;242m}[0m[38;2;241;250;140m_[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmultiplier[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Upper band value (used when trend is down)[0m
[38;5;238m 326[0m   [38;5;238mâ”‚[0m 
[38;5;238m 327[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Input validation[0m
[38;5;238m 328[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mrequired_input_cols[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mhigh[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mlow[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mclose[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m
[38;5;238m 329[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mempty[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;139;233;253mall[0m[38;2;248;248;242m([0m[38;2;248;248;242mc[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mcolumns[0m[38;2;248;248;242m [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mc[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mrequired_input_cols[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 330[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140mSupertrend): Input DataFrame is missing required columns [0m[38;2;248;248;242m{[0m[38;2;248;248;242mrequired_input_cols[0m[38;2;248;248;242m}[0m[38;2;241;250;140m or is empty.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 331[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mcol[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mtarget_cols[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mcol[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;255;255;255mNA[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Add NA columns if they don't exist[0m
[38;5;238m 332[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m
[38;5;238m 333[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;139;233;253mlen[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;248;248;242mlength[0m[38;2;248;248;242m:[0m
[38;5;238m 334[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140mSupertrend): DataFrame length ([0m[38;2;248;248;242m{[0m[38;2;139;233;253mlen[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) is less than ST period ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mlength[0m[38;2;248;248;242m}[0m[38;2;241;250;140m).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 335[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mcol[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mtarget_cols[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mcol[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;255;255;255mNA[0m
[38;5;238m 336[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m
[38;5;238m 337[0m   [38;5;238mâ”‚[0m 
[38;5;238m 338[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m 339[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Calculate Supertrend using pandas_ta, appending results to the DataFrame[0m
[38;5;238m 340[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mta[0m[38;2;255;121;198m.[0m[38;2;80;250;123msupertrend[0m[38;2;248;248;242m([0m[3;38;2;255;184;108mlength[0m[38;2;255;121;198m=[0m[38;2;248;248;242mlength[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mmultiplier[0m[38;2;255;121;198m=[0m[38;2;248;248;242mmultiplier[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mappend[0m[38;2;255;121;198m=[0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m)[0m
[38;5;238m 341[0m   [38;5;238mâ”‚[0m 
[38;5;238m 342[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Verify that the expected raw columns were created[0m
[38;5;238m 343[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mst_col_name[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mcolumns[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mst_trend_col[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mcolumns[0m[38;2;248;248;242m:[0m
[38;5;238m 344[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;255;121;198mraise[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mKeyError[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mpandas_ta failed to create expected raw columns: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mst_col_name[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, [0m[38;2;248;248;242m{[0m[38;2;248;248;242mst_trend_col[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 345[0m   [38;5;238mâ”‚[0m 
[38;5;238m 346[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Process and Rename Columns ---[0m
[38;5;238m 347[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m 1. Rename the main Supertrend value column[0m
[38;5;238m 348[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140msupertrend[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mst_col_name[0m[38;2;248;248;242m][0m
[38;5;238m 349[0m   [38;5;238mâ”‚[0m 
[38;5;238m 350[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m 2. Create a boolean trend column (True if trend is up)[0m
[38;5;238m 351[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140mtrend[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mst_trend_col[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m
[38;5;238m 352[0m   [38;5;238mâ”‚[0m 
[38;5;238m 353[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m 3. Calculate flip signals: Signal is True *only* on the candle where the flip occurs[0m
[38;5;238m 354[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mprev_trend_direction[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mst_trend_col[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;80;250;123mshift[0m[38;2;248;248;242m([0m[38;2;189;147;249m1[0m[38;2;248;248;242m)[0m
[38;5;238m 355[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Long signal: Previous was down (-1) and current is up (1)[0m
[38;5;238m 356[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140mst_long[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242mprev_trend_direction[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m&[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mst_trend_col[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m[38;2;248;248;242m)[0m
[38;5;238m 357[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Short signal: Previous was up (1) and current is down (-1)[0m
[38;5;238m 358[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140mst_short[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242mprev_trend_direction[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m&[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mst_trend_col[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m)[0m
[38;5;238m 359[0m   [38;5;238mâ”‚[0m 
[38;5;238m 360[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Clean up intermediate pandas_ta columns ---[0m
[38;5;238m 361[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Identify all columns starting with 'SUPERT_' that are NOT our target columns[0m
[38;5;238m 362[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mcols_to_drop[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m[[0m[38;2;248;248;242mc[0m[38;2;248;248;242m [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mc[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mcolumns[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mc[0m[38;2;255;121;198m.[0m[38;2;80;250;123mstartswith[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mSUPERT_[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mc[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mtarget_cols[0m[38;2;248;248;242m][0m
[38;5;238m 363[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Also explicitly add the raw trend direction and band value columns if they exist[0m
[38;5;238m 364[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mcols_to_drop[0m[38;2;255;121;198m.[0m[38;2;80;250;123mextend[0m[38;2;248;248;242m([0m[38;2;248;248;242m[[0m[38;2;248;248;242mst_trend_col[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mst_long_col[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mst_short_col[0m[38;2;248;248;242m][0m[38;2;248;248;242m)[0m
[38;5;238m 365[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Use set to avoid duplicates if target_cols somehow overlapped with raw names, drop safely[0m
[38;5;238m 366[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdrop[0m[38;2;248;248;242m([0m[3;38;2;255;184;108mcolumns[0m[38;2;255;121;198m=[0m[3;38;2;102;217;239mlist[0m[38;2;248;248;242m([0m[3;38;2;102;217;239mset[0m[38;2;248;248;242m([0m[38;2;248;248;242mcols_to_drop[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108merrors[0m[38;2;255;121;198m=[0m[38;2;241;250;140m'[0m[38;2;241;250;140mignore[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108minplace[0m[38;2;255;121;198m=[0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m)[0m
[38;5;238m 367[0m   [38;5;238mâ”‚[0m 
[38;5;238m 368[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log the result of the last candle[0m
[38;5;238m 369[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlast_trend_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mUp[0m[38;2;241;250;140m'[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m'[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140mtrend[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mDown[0m[38;2;241;250;140m'[0m
[38;5;238m 370[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc: Calculated [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140mSupertrend([0m[38;2;248;248;242m{[0m[38;2;248;248;242mlength[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, [0m[38;2;248;248;242m{[0m[38;2;248;248;242mmultiplier[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). [0m[38;2;241;250;140m"[0m
[38;5;238m 371[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                     [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLast trend: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mlast_trend_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Last value: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m'[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140msupertrend[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 372[0m   [38;5;238mâ”‚[0m 
[38;5;238m 373[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 374[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc: Error calculating [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcol_prefix[0m[38;2;248;248;242m}[0m[38;2;241;250;140mSupertrend([0m[38;2;248;248;242m{[0m[38;2;248;248;242mlength[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, [0m[38;2;248;248;242m{[0m[38;2;248;248;242mmultiplier[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 375[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m 376[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Ensure target columns exist with NA values on error[0m
[38;5;238m 377[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mcol[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mtarget_cols[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mcol[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;255;255;255mNA[0m
[38;5;238m 378[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m
[38;5;238m 379[0m   [38;5;238mâ”‚[0m 
[38;5;238m 380[0m   [38;5;238mâ”‚[0m 
[38;5;238m 381[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Volume and ATR Analysis ---[0m
[38;5;238m 382[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123manalyze_volume_atr[0m[38;2;248;248;242m([0m
[38;5;238m 383[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mdf[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;248;248;242mDataFrame[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108matr_len[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mvol_ma_len[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m
[38;5;238m 384[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;248;248;242m->[0m[38;2;248;248;242m [0m[38;2;248;248;242mDict[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m, [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m][0m[38;2;248;248;242m:[0m
[38;5;238m 385[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 386[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Calculates ATR, Volume Moving Average, and checks for volume spikes relative to the MA.[0m
[38;5;238m 387[0m   [38;5;238mâ”‚[0m 
[38;5;238m 388[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Args:[0m
[38;5;238m 389[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        df (pd.DataFrame): Input DataFrame with 'high', 'low', 'close', 'volume'.[0m
[38;5;238m 390[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        atr_len (int): Lookback period for ATR calculation.[0m
[38;5;238m 391[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        vol_ma_len (int): Lookback period for Volume Moving Average.[0m
[38;5;238m 392[0m   [38;5;238mâ”‚[0m 
[38;5;238m 393[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Returns:[0m
[38;5;238m 394[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        Dict[str, Optional[float]]: Dictionary containing 'atr', 'volume_ma',[0m
[38;5;238m 395[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m                                     'last_volume', 'volume_ratio'. Values are[0m
[38;5;238m 396[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m                                     None if calculation fails or data is insufficient.[0m
[38;5;238m 397[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 398[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mDict[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m, [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m
[38;5;238m 399[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;241;250;140m"[0m[38;2;241;250;140matr[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mvolume_ma[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mlast_volume[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mvolume_ratio[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 400[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242m}[0m
[38;5;238m 401[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mrequired_cols[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mhigh[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mlow[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mclose[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mvolume[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m
[38;5;238m 402[0m   [38;5;238mâ”‚[0m 
[38;5;238m 403[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Input validation[0m
[38;5;238m 404[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mempty[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;139;233;253mall[0m[38;2;248;248;242m([0m[38;2;248;248;242mc[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mcolumns[0m[38;2;248;248;242m [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mc[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mrequired_cols[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 405[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc (Vol/ATR): Input DataFrame is missing required columns [0m[38;2;248;248;242m{[0m[38;2;248;248;242mrequired_cols[0m[38;2;248;248;242m}[0m[38;2;241;250;140m or is empty.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 406[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m
[38;5;238m 407[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mmin_len[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;139;233;253mmax[0m[38;2;248;248;242m([0m[38;2;248;248;242matr_len[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mvol_ma_len[0m[38;2;248;248;242m)[0m
[38;5;238m 408[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;139;233;253mlen[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;248;248;242mmin_len[0m[38;2;248;248;242m:[0m
[38;5;238m 409[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc (Vol/ATR): DataFrame length ([0m[38;2;248;248;242m{[0m[38;2;139;233;253mlen[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) is less than required ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mmin_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) for ATR([0m[38;2;248;248;242m{[0m[38;2;248;248;242matr_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)/VolMA([0m[38;2;248;248;242m{[0m[38;2;248;248;242mvol_ma_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 410[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m
[38;5;238m 411[0m   [38;5;238mâ”‚[0m 
[38;5;238m 412[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m 413[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Calculate ATR using pandas_ta[0m
[38;5;238m 414[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242matr_col[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mATRr_[0m[38;2;248;248;242m{[0m[38;2;248;248;242matr_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m pandas_ta default name for ATR[0m
[38;5;238m 415[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mta[0m[38;2;255;121;198m.[0m[38;2;80;250;123matr[0m[38;2;248;248;242m([0m[3;38;2;255;184;108mlength[0m[38;2;255;121;198m=[0m[38;2;248;248;242matr_len[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mappend[0m[38;2;255;121;198m=[0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m)[0m
[38;5;238m 416[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242matr_col[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mcolumns[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;80;250;123mnotna[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242matr_col[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 417[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140matr[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242matr_col[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m
[38;5;238m 418[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m 419[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc: Failed to calculate valid ATR([0m[38;2;248;248;242m{[0m[38;2;248;248;242matr_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Check input data.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 420[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Clean up ATR column[0m
[38;5;238m 421[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdrop[0m[38;2;248;248;242m([0m[3;38;2;255;184;108mcolumns[0m[38;2;255;121;198m=[0m[38;2;248;248;242m[[0m[38;2;248;248;242matr_col[0m[38;2;248;248;242m][0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108merrors[0m[38;2;255;121;198m=[0m[38;2;241;250;140m'[0m[38;2;241;250;140mignore[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108minplace[0m[38;2;255;121;198m=[0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m)[0m
[38;5;238m 422[0m   [38;5;238mâ”‚[0m 
[38;5;238m 423[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Calculate Volume Moving Average[0m
[38;5;238m 424[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mvolume_ma_col[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mvolume_ma[0m[38;2;241;250;140m'[0m
[38;5;238m 425[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Use min_periods to get MA sooner, but it might be less stable initially[0m
[38;5;238m 426[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mvolume_ma_col[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mvolume[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;80;250;123mrolling[0m[38;2;248;248;242m([0m[3;38;2;255;184;108mwindow[0m[38;2;255;121;198m=[0m[38;2;248;248;242mvol_ma_len[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mmin_periods[0m[38;2;255;121;198m=[0m[38;2;139;233;253mmax[0m[38;2;248;248;242m([0m[38;2;189;147;249m1[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mvol_ma_len[0m[38;2;248;248;242m [0m[38;2;255;121;198m/[0m[38;2;255;121;198m/[0m[38;2;248;248;242m [0m[38;2;189;147;249m2[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mmean[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m
[38;5;238m 427[0m   [38;5;238mâ”‚[0m 
[38;5;238m 428[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;80;250;123mnotna[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mvolume_ma_col[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 429[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mvolume_ma[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;248;248;242mvolume_ma_col[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m
[38;5;238m 430[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mlast_volume[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mvolume[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Get the volume of the last candle[0m
[38;5;238m 431[0m   [38;5;238mâ”‚[0m 
[38;5;238m 432[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Calculate Volume Ratio (Last Volume / Volume MA)[0m
[38;5;238m 433[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Check if MA is not None and significantly greater than zero before dividing[0m
[38;5;238m 434[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mvolume_ma[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mvolume_ma[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_QTY_EPSILON[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mlast_volume[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m:[0m
[38;5;238m 435[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mvolume_ratio[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mlast_volume[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m/[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mvolume_ma[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m
[38;5;238m 436[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m 437[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mvolume_ratio[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Avoid division by zero or near-zero MA[0m
[38;5;238m 438[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc: Volume ratio calculation skipped (LastVol=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mlast_volume[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;248;248;242m}[0m[38;2;241;250;140m, VolMA=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mvolume_ma[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 439[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m 440[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc: Failed to calculate valid Volume MA([0m[38;2;248;248;242m{[0m[38;2;248;248;242mvol_ma_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Check input data.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 441[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Clean up Volume MA column[0m
[38;5;238m 442[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdrop[0m[38;2;248;248;242m([0m[3;38;2;255;184;108mcolumns[0m[38;2;255;121;198m=[0m[38;2;248;248;242m[[0m[38;2;248;248;242mvolume_ma_col[0m[38;2;248;248;242m][0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108merrors[0m[38;2;255;121;198m=[0m[38;2;241;250;140m'[0m[38;2;241;250;140mignore[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108minplace[0m[38;2;255;121;198m=[0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m)[0m
[38;5;238m 443[0m   [38;5;238mâ”‚[0m 
[38;5;238m 444[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log results using safe formatting for potentially None values[0m
[38;5;238m 445[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242matr_val[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140matr[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m 446[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242matr_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242matr_val[0m[38;2;189;147;249m:.5f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242matr_val[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m'[0m
[38;5;238m 447[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlast_vol_val[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mlast_volume[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m 448[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mvol_ma_val[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mvolume_ma[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m 449[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mvol_ratio_val[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mvolume_ratio[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m 450[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlast_vol_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlast_vol_val[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_vol_val[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m'[0m
[38;5;238m 451[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mvol_ma_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mvol_ma_val[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mvol_ma_val[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m'[0m
[38;5;238m 452[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mvol_ratio_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mvol_ratio_val[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mvol_ratio_val[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m'[0m
[38;5;238m 453[0m   [38;5;238mâ”‚[0m 
[38;5;238m 454[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc: ATR([0m[38;2;248;248;242m{[0m[38;2;248;248;242matr_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) = [0m[38;2;248;248;242m{[0m[38;2;248;248;242matr_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 455[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc: Volume Analysis: Last=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mlast_vol_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, MA([0m[38;2;248;248;242m{[0m[38;2;248;248;242mvol_ma_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mvol_ma_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Ratio=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mvol_ratio_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 456[0m   [38;5;238mâ”‚[0m 
[38;5;238m 457[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 458[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mIndicator Calc: Error during Volume/ATR analysis: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 459[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m 460[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242mkey[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mkey[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m}[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Reset results to None on error[0m
[38;5;238m 461[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m
[38;5;238m 462[0m   [38;5;238mâ”‚[0m 
[38;5;238m 463[0m   [38;5;238mâ”‚[0m 
[38;5;238m 464[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Order Book Analysis ---[0m
[38;5;238m 465[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123manalyze_order_book[0m[38;2;248;248;242m([0m
[38;5;238m 466[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mexchange[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;255;121;198m.[0m[38;2;248;248;242mExchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108msymbol[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mdepth[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mfetch_limit[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m
[38;5;238m 467[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;248;248;242m->[0m[38;2;248;248;242m [0m[38;2;248;248;242mDict[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m, [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m][0m[38;2;248;248;242m:[0m
[38;5;238m 468[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 469[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Fetches the L2 order book and analyzes bid/ask pressure (cumulative volume ratio)[0m
[38;5;238m 470[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    and spread within the specified depth.[0m
[38;5;238m 471[0m   [38;5;238mâ”‚[0m 
[38;5;238m 472[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Args:[0m
[38;5;238m 473[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        exchange (ccxt.Exchange): Initialized CCXT exchange object.[0m
[38;5;238m 474[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        symbol (str): The market symbol (e.g., 'BTC/USDT:USDT').[0m
[38;5;238m 475[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        depth (int): How many price levels deep to calculate cumulative volume for the ratio.[0m
[38;5;238m 476[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        fetch_limit (int): How many levels to request from the API (must be >= depth,[0m
[38;5;238m 477[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m                           and often subject to API minimums like 25, 50, or 100).[0m
[38;5;238m 478[0m   [38;5;238mâ”‚[0m 
[38;5;238m 479[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Returns:[0m
[38;5;238m 480[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        Dict[str, Optional[float]]: Dictionary with 'bid_ask_ratio', 'spread',[0m
[38;5;238m 481[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m                                     'best_bid', 'best_ask'. Values are None on failure.[0m
[38;5;238m 482[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 483[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mDict[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m, [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m
[38;5;238m 484[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;241;250;140m"[0m[38;2;241;250;140mbid_ask_ratio[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mspread[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mbest_bid[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mbest_ask[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 485[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242m}[0m
[38;5;238m 486[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mOrder Book: Fetching L2 for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (Analyze Depth: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mdepth[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, API Fetch Limit: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfetch_limit[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 487[0m   [38;5;238mâ”‚[0m 
[38;5;238m 488[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Check if the exchange instance supports fetching L2 order book[0m
[38;5;238m 489[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;248;248;242mhas[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mfetchL2OrderBook[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 490[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mOrder Book: Exchange '[0m[38;2;248;248;242m{[0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;248;248;242mid[0m[38;2;248;248;242m}[0m[38;2;241;250;140m' does not support fetchL2OrderBook method. Skipping analysis.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 491[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m
[38;5;238m 492[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m 493[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Fetch the order book data[0m
[38;5;238m 494[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242morder_book[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mfetch_l2_order_book[0m[38;2;248;248;242m([0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mlimit[0m[38;2;255;121;198m=[0m[38;2;248;248;242mfetch_limit[0m[38;2;248;248;242m)[0m
[38;5;238m 495[0m   [38;5;238mâ”‚[0m 
[38;5;238m 496[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Validate the structure of the returned order book data[0m
[38;5;238m 497[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242morder_book[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;139;233;253misinstance[0m[38;2;248;248;242m([0m[38;2;248;248;242morder_book[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mbids[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mlist[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;139;233;253misinstance[0m[38;2;248;248;242m([0m[38;2;248;248;242morder_book[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140masks[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mlist[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 498[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mOrder Book: Incomplete or invalid data structure received for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. OB: [0m[38;2;248;248;242m{[0m[38;2;248;248;242morder_book[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 499[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m
[38;5;238m 500[0m   [38;5;238mâ”‚[0m 
[38;5;238m 501[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mbids[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mList[0m[38;2;248;248;242m[[0m[38;2;248;248;242mList[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242morder_book[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mbids[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m List of [price, amount][0m
[38;5;238m 502[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242masks[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mList[0m[38;2;248;248;242m[[0m[38;2;248;248;242mList[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242morder_book[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140masks[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m List of [price, amount][0m
[38;5;238m 503[0m   [38;5;238mâ”‚[0m 
[38;5;238m 504[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Get best bid/ask and calculate spread[0m
[38;5;238m 505[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mbest_bid[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mbids[0m[38;2;248;248;242m[[0m[38;2;189;147;249m0[0m[38;2;248;248;242m][0m[38;2;248;248;242m[[0m[38;2;189;147;249m0[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mbids[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;139;233;253mlen[0m[38;2;248;248;242m([0m[38;2;248;248;242mbids[0m[38;2;248;248;242m[[0m[38;2;189;147;249m0[0m[38;2;248;248;242m][0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m
[38;5;238m 506[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mbest_ask[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242masks[0m[38;2;248;248;242m[[0m[38;2;189;147;249m0[0m[38;2;248;248;242m][0m[38;2;248;248;242m[[0m[38;2;189;147;249m0[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242masks[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;139;233;253mlen[0m[38;2;248;248;242m([0m[38;2;248;248;242masks[0m[38;2;248;248;242m[[0m[38;2;189;147;249m0[0m[38;2;248;248;242m][0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m
[38;5;238m 507[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mbest_bid[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mbest_bid[0m
[38;5;238m 508[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mbest_ask[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mbest_ask[0m
[38;5;238m 509[0m   [38;5;238mâ”‚[0m 
[38;5;238m 510[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mspread[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 511[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mbest_bid[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mbest_ask[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m:[0m
[38;5;238m 512[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mspread[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mbest_ask[0m[38;2;248;248;242m [0m[38;2;255;121;198m-[0m[38;2;248;248;242m [0m[38;2;248;248;242mbest_bid[0m
[38;5;238m 513[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mspread[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mspread[0m
[38;5;238m 514[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mOrder Book: Best Bid=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mbest_bid[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Best Ask=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mbest_ask[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Spread=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mspread[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 515[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m 516[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log even if spread calculation isn't possible (e.g., one side is empty)[0m
[38;5;238m 517[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mOrder Book: Best Bid=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mbest_bid[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Best Ask=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mbest_ask[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (Spread calculation requires both > 0)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 518[0m   [38;5;238mâ”‚[0m 
[38;5;238m 519[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Calculate cumulative volume within the specified analysis depth[0m
[38;5;238m 520[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Sum the 'amount' (index 1) for the top 'depth' levels[0m
[38;5;238m 521[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mbid_volume_sum[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;139;233;253msum[0m[38;2;248;248;242m([0m[38;2;248;248;242mbid[0m[38;2;248;248;242m[[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mbid[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mbids[0m[38;2;248;248;242m[[0m[38;2;248;248;242m:[0m[38;2;248;248;242mdepth[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;139;233;253mlen[0m[38;2;248;248;242m([0m[38;2;248;248;242mbid[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;139;233;253misinstance[0m[38;2;248;248;242m([0m[38;2;248;248;242mbid[0m[38;2;248;248;242m[[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m 522[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mask_volume_sum[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;139;233;253msum[0m[38;2;248;248;242m([0m[38;2;248;248;242mask[0m[38;2;248;248;242m[[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mask[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242masks[0m[38;2;248;248;242m[[0m[38;2;248;248;242m:[0m[38;2;248;248;242mdepth[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;139;233;253mlen[0m[38;2;248;248;242m([0m[38;2;248;248;242mask[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;139;233;253misinstance[0m[38;2;248;248;242m([0m[38;2;248;248;242mask[0m[38;2;248;248;242m[[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m 523[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mOrder Book: Analysis (Depth [0m[38;2;248;248;242m{[0m[38;2;248;248;242mdepth[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Total Bid Vol=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mbid_volume_sum[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Total Ask Vol=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mask_volume_sum[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 524[0m   [38;5;238mâ”‚[0m 
[38;5;238m 525[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Calculate Bid/Ask Ratio (Total Bid Volume / Total Ask Volume)[0m
[38;5;238m 526[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mbid_ask_ratio[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 527[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Check if ask volume is significantly greater than zero to avoid division issues[0m
[38;5;238m 528[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mask_volume_sum[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_QTY_EPSILON[0m[38;2;248;248;242m:[0m
[38;5;238m 529[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mbid_ask_ratio[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mbid_volume_sum[0m[38;2;248;248;242m [0m[38;2;255;121;198m/[0m[38;2;248;248;242m [0m[38;2;248;248;242mask_volume_sum[0m
[38;5;238m 530[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mbid_ask_ratio[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mbid_ask_ratio[0m
[38;5;238m 531[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mOrder Book: Bid/Ask Ratio (Depth [0m[38;2;248;248;242m{[0m[38;2;248;248;242mdepth[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) = [0m[38;2;248;248;242m{[0m[38;2;248;248;242mbid_ask_ratio[0m[38;2;189;147;249m:.3f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 532[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m 533[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mOrder Book: Bid/Ask Ratio calculation skipped (Ask volume at depth [0m[38;2;248;248;242m{[0m[38;2;248;248;242mdepth[0m[38;2;248;248;242m}[0m[38;2;241;250;140m is zero or negligible)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 534[0m   [38;5;238mâ”‚[0m 
[38;5;238m 535[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mNetworkError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 536[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mOrder Book: Network error fetching order book for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 537[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mExchangeError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 538[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mOrder Book: Exchange error fetching order book for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 539[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mIndexError[0m[38;2;248;248;242m:[0m
[38;5;238m 540[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mOrder Book: Index error processing bids/asks for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Data might be malformed or empty. Bids: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mbids[0m[38;2;248;248;242m[[0m[38;2;248;248;242m:[0m[38;2;189;147;249m2[0m[38;2;248;248;242m][0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Asks: [0m[38;2;248;248;242m{[0m[38;2;248;248;242masks[0m[38;2;248;248;242m[[0m[38;2;248;248;242m:[0m[38;2;189;147;249m2[0m[38;2;248;248;242m][0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 541[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 542[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mOrder Book: Unexpected error analyzing order book for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 543[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m 544[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Reset results to None on unexpected error[0m
[38;5;238m 545[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242mkey[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mkey[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m[38;2;248;248;242m}[0m
[38;5;238m 546[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mresults[0m
[38;5;238m 547[0m   [38;5;238mâ”‚[0m 
[38;5;238m 548[0m   [38;5;238mâ”‚[0m 
[38;5;238m 549[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Data Fetching ---[0m
[38;5;238m 550[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123mget_market_data[0m[38;2;248;248;242m([0m
[38;5;238m 551[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mexchange[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;255;121;198m.[0m[38;2;248;248;242mExchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108msymbol[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108minterval[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mlimit[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249m100[0m
[38;5;238m 552[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;248;248;242m->[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;248;248;242mDataFrame[0m[38;2;248;248;242m][0m[38;2;248;248;242m:[0m
[38;5;238m 553[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 554[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Fetches OHLCV (Open, High, Low, Close, Volume) data from the exchange.[0m
[38;5;238m 555[0m   [38;5;238mâ”‚[0m 
[38;5;238m 556[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Args:[0m
[38;5;238m 557[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        exchange (ccxt.Exchange): Initialized CCXT exchange object.[0m
[38;5;238m 558[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        symbol (str): Market symbol (e.g., 'BTC/USDT:USDT').[0m
[38;5;238m 559[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        interval (str): Timeframe interval (e.g., '1m', '5m', '1h').[0m
[38;5;238m 560[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        limit (int): Number of candles to fetch.[0m
[38;5;238m 561[0m   [38;5;238mâ”‚[0m 
[38;5;238m 562[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Returns:[0m
[38;5;238m 563[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        Optional[pd.DataFrame]: DataFrame with OHLCV data, indexed by timestamp (UTC),[0m
[38;5;238m 564[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m                                 or None if fetching fails or data is invalid.[0m
[38;5;238m 565[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 566[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;248;248;242mhas[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mfetchOHLCV[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 567[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mData Fetch: Exchange '[0m[38;2;248;248;242m{[0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;248;248;242mid[0m[38;2;248;248;242m}[0m[38;2;241;250;140m' does not support fetchOHLCV method.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 568[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 569[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m 570[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mData Fetch: Fetching [0m[38;2;248;248;242m{[0m[38;2;248;248;242mlimit[0m[38;2;248;248;242m}[0m[38;2;241;250;140m OHLCV candles for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (Timeframe: [0m[38;2;248;248;242m{[0m[38;2;248;248;242minterval[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 571[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Fetch data: Returns a list of lists [timestamp, open, high, low, close, volume][0m
[38;5;238m 572[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mohlcv[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mList[0m[38;2;248;248;242m[[0m[38;2;248;248;242mList[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mfetch_ohlcv[0m[38;2;248;248;242m([0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mtimeframe[0m[38;2;255;121;198m=[0m[38;2;248;248;242minterval[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mlimit[0m[38;2;255;121;198m=[0m[38;2;248;248;242mlimit[0m[38;2;248;248;242m)[0m
[38;5;238m 573[0m   [38;5;238mâ”‚[0m 
[38;5;238m 574[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mohlcv[0m[38;2;248;248;242m:[0m
[38;5;238m 575[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mData Fetch: No OHLCV data returned from exchange for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m ([0m[38;2;248;248;242m{[0m[38;2;248;248;242minterval[0m[38;2;248;248;242m}[0m[38;2;241;250;140m).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 576[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 577[0m   [38;5;238mâ”‚[0m 
[38;5;238m 578[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Convert to pandas DataFrame[0m
[38;5;238m 579[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;80;250;123mDataFrame[0m[38;2;248;248;242m([0m[38;2;248;248;242mohlcv[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mcolumns[0m[38;2;255;121;198m=[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mtimestamp[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mopen[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mhigh[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mlow[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mclose[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mvolume[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m)[0m
[38;5;238m 580[0m   [38;5;238mâ”‚[0m 
[38;5;238m 581[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Convert timestamp to datetime objects (UTC) and set as index[0m
[38;5;238m 582[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mtimestamp[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;80;250;123mto_datetime[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mtimestamp[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108munit[0m[38;2;255;121;198m=[0m[38;2;241;250;140m"[0m[38;2;241;250;140mms[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mutc[0m[38;2;255;121;198m=[0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m)[0m
[38;5;238m 583[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;80;250;123mset_index[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mtimestamp[0m[38;2;241;250;140m"[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108minplace[0m[38;2;255;121;198m=[0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m)[0m
[38;5;238m 584[0m   [38;5;238mâ”‚[0m 
[38;5;238m 585[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Basic data validation: Check for NaN values[0m
[38;5;238m 586[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;80;250;123misnull[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;248;248;242mvalues[0m[38;2;255;121;198m.[0m[38;2;80;250;123many[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 587[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mnan_counts[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;80;250;123misnull[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123msum[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m
[38;5;238m 588[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mData Fetch: Fetched OHLCV data contains NaN values. Counts:[0m[38;2;255;121;198m\n[0m[38;2;248;248;242m{[0m[38;2;248;248;242mnan_counts[0m[38;2;248;248;242m[[0m[38;2;248;248;242mnan_counts[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m][0m[38;2;248;248;242m}[0m[38;2;255;121;198m\n[0m[38;2;241;250;140mAttempting forward fill...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 589[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Simple imputation: Forward fill NaNs. More sophisticated methods could be used.[0m
[38;5;238m 590[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;80;250;123mffill[0m[38;2;248;248;242m([0m[3;38;2;255;184;108minplace[0m[38;2;255;121;198m=[0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m)[0m
[38;5;238m 591[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Check again after filling - if NaNs remain (e.g., at the very beginning), data is unusable[0m
[38;5;238m 592[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;80;250;123misnull[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;248;248;242mvalues[0m[38;2;255;121;198m.[0m[38;2;80;250;123many[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 593[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mData Fetch: NaN values remain after forward fill. Cannot proceed with this data batch.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 594[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 595[0m   [38;5;238mâ”‚[0m 
[38;5;238m 596[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mData Fetch: Successfully fetched and processed [0m[38;2;248;248;242m{[0m[38;2;139;233;253mlen[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m OHLCV candles for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 597[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m
[38;5;238m 598[0m   [38;5;238mâ”‚[0m 
[38;5;238m 599[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mNetworkError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 600[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mData Fetch: Network error fetching OHLCV for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 601[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mExchangeError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 602[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mData Fetch: Exchange error fetching OHLCV for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 603[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 604[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mData Fetch: Unexpected error fetching market data for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 605[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m 606[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 607[0m   [38;5;238mâ”‚[0m 
[38;5;238m 608[0m   [38;5;238mâ”‚[0m 
[38;5;238m 609[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Position & Order Management (REVISED - v1.5.1) ---[0m
[38;5;238m 610[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123mget_current_position[0m[38;2;248;248;242m([0m[3;38;2;255;184;108mexchange[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;255;121;198m.[0m[38;2;248;248;242mExchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108msymbol[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;248;248;242m->[0m[38;2;248;248;242m [0m[38;2;248;248;242mDict[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m, [0m[38;2;248;248;242mAny[0m[38;2;248;248;242m][0m[38;2;248;248;242m:[0m
[38;5;238m 611[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 612[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Fetches the current position details for a given symbol, focusing on[0m
[38;5;238m 613[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Bybit V5 API structure via CCXT for robustness against zero-size entries[0m
[38;5;238m 614[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    and using the 'side' field for direction. Assumes One-Way mode.[0m
[38;5;238m 615[0m   [38;5;238mâ”‚[0m 
[38;5;238m 616[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Args:[0m
[38;5;238m 617[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        exchange (ccxt.Exchange): Initialized CCXT exchange object.[0m
[38;5;238m 618[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        symbol (str): Market symbol in CCXT unified format (e.g., 'BTC/USDT:USDT').[0m
[38;5;238m 619[0m   [38;5;238mâ”‚[0m 
[38;5;238m 620[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Returns:[0m
[38;5;238m 621[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        Dict[str, Any]: {'side': POSITION_SIDE_*, 'qty': float, 'entry_price': float}.[0m
[38;5;238m 622[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m                        Defaults to side=NONE, qty=0.0, entry_price=0.0 if no *actual*[0m
[38;5;238m 623[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m                        position (size > epsilon and valid side 'Buy'/'Sell') exists[0m
[38;5;238m 624[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m                        for the specified symbol in One-Way mode.[0m
[38;5;238m 625[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 626[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Default return value indicating no active position[0m
[38;5;238m 627[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mdefault_pos[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mDict[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m, [0m[38;2;248;248;242mAny[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;241;250;140m'[0m[38;2;241;250;140mside[0m[38;2;241;250;140m'[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_NONE[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mqty[0m[38;2;241;250;140m'[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mentry_price[0m[38;2;241;250;140m'[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m}[0m
[38;5;238m 628[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mccxt_unified_symbol[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m
[38;5;238m 629[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mmarket_id[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 630[0m   [38;5;238mâ”‚[0m 
[38;5;238m 631[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Get the exchange-specific market ID for comparison[0m
[38;5;238m 632[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m 633[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mmarket[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mmarket[0m[38;2;248;248;242m([0m[38;2;248;248;242mccxt_unified_symbol[0m[38;2;248;248;242m)[0m
[38;5;238m 634[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mmarket_id[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mmarket[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mid[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m The ID used by the exchange (e.g., 'BTCUSDT')[0m
[38;5;238m 635[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Check: Fetching position for CCXT symbol '[0m[38;2;248;248;242m{[0m[38;2;248;248;242mccxt_unified_symbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m' (Target Exchange Market ID: '[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_id[0m[38;2;248;248;242m}[0m[38;2;241;250;140m')...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 636[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mBadSymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mKeyError[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 637[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Check: Failed to get market info/ID for '[0m[38;2;248;248;242m{[0m[38;2;248;248;242mccxt_unified_symbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m': [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 638[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mdefault_pos[0m
[38;5;238m 639[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Catch other potential errors during market lookup[0m
[38;5;238m 640[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Check: Unexpected error getting market info for '[0m[38;2;248;248;242m{[0m[38;2;248;248;242mccxt_unified_symbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m': [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 641[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m 642[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mdefault_pos[0m
[38;5;238m 643[0m   [38;5;238mâ”‚[0m 
[38;5;238m 644[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m 645[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Check if the exchange supports fetching positions[0m
[38;5;238m 646[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;248;248;242mhas[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mfetchPositions[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 647[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Check: Exchange '[0m[38;2;248;248;242m{[0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;248;248;242mid[0m[38;2;248;248;242m}[0m[38;2;241;250;140m' does not support fetchPositions. Cannot reliably get position status.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 648[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Attempting fetchBalance might give clues, but it's less direct. Sticking to fetchPositions.[0m
[38;5;238m 649[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mdefault_pos[0m
[38;5;238m 650[0m   [38;5;238mâ”‚[0m 
[38;5;238m 651[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Fetch positions - Bybit V5 often requires 'category' for linear/inverse[0m
[38;5;238m 652[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mparams[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m
[38;5;238m 653[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mmarket[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mlinear[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 654[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mparams[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;241;250;140m'[0m[38;2;241;250;140mcategory[0m[38;2;241;250;140m'[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mlinear[0m[38;2;241;250;140m'[0m[38;2;248;248;242m}[0m
[38;5;238m 655[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melif[0m[38;2;248;248;242m [0m[38;2;248;248;242mmarket[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140minverse[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 656[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mparams[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;241;250;140m'[0m[38;2;241;250;140mcategory[0m[38;2;241;250;140m'[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140minverse[0m[38;2;241;250;140m'[0m[38;2;248;248;242m}[0m
[38;5;238m 657[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m If type isn't clear, fetching without category might work or fail depending on exchange default[0m
[38;5;238m 658[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Check: Calling fetchPositions with params: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mparams[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 659[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mfetched_positions[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mfetch_positions[0m[38;2;248;248;242m([0m[3;38;2;255;184;108msymbols[0m[38;2;255;121;198m=[0m[38;2;248;248;242m[[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m][0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mparams[0m[38;2;255;121;198m=[0m[38;2;248;248;242mparams[0m[38;2;248;248;242m)[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Fetch potentially for multiple symbols if needed, or just one[0m
[38;5;238m 660[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Note: Some CCXT versions/exchanges might return positions for *all* symbols if `symbols` arg is omitted or ignored.[0m
[38;5;238m 661[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m We must filter carefully.[0m
[38;5;238m 662[0m   [38;5;238mâ”‚[0m 
[38;5;238m 663[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Check: Raw data from fetch_positions (filtered for symbol '[0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m'):[0m[38;2;255;121;198m\n[0m[38;2;248;248;242m{[0m[38;2;248;248;242mfetched_positions[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 664[0m   [38;5;238mâ”‚[0m 
[38;5;238m 665[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Iterate through the potentially filtered list of positions returned by CCXT[0m
[38;5;238m 666[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mpos[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mfetched_positions[0m[38;2;248;248;242m:[0m
[38;5;238m 667[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Check: Evaluating raw position entry: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mpos[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 668[0m   [38;5;238mâ”‚[0m 
[38;5;238m 669[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- 1. Symbol Check ---[0m
[38;5;238m 670[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m CCXT aims to return the unified symbol, but check info.symbol for the raw ID as backup/confirmation[0m
[38;5;238m 671[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mpos_symbol_unified[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140msymbol[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m CCXT unified symbol (e.g., BTC/USDT:USDT)[0m
[38;5;238m 672[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mpos_symbol_raw[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140minfo[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140msymbol[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Raw exchange symbol ID (e.g., BTCUSDT)[0m
[38;5;238m 673[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Check: Raw Symbol ID='[0m[38;2;248;248;242m{[0m[38;2;248;248;242mpos_symbol_raw[0m[38;2;248;248;242m}[0m[38;2;241;250;140m', Unified Symbol='[0m[38;2;248;248;242m{[0m[38;2;248;248;242mpos_symbol_unified[0m[38;2;248;248;242m}[0m[38;2;241;250;140m'[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 674[0m   [38;5;238mâ”‚[0m 
[38;5;238m 675[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Match against the target market ID obtained earlier[0m
[38;5;238m 676[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mpos_symbol_raw[0m[38;2;248;248;242m [0m[38;2;255;121;198m!=[0m[38;2;248;248;242m [0m[38;2;248;248;242mmarket_id[0m[38;2;248;248;242m:[0m
[38;5;238m 677[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSkipping position entry: Symbol mismatch (Got Raw ID '[0m[38;2;248;248;242m{[0m[38;2;248;248;242mpos_symbol_raw[0m[38;2;248;248;242m}[0m[38;2;241;250;140m', Unified '[0m[38;2;248;248;242m{[0m[38;2;248;248;242mpos_symbol_unified[0m[38;2;248;248;242m}[0m[38;2;241;250;140m', Expected Target ID '[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_id[0m[38;2;248;248;242m}[0m[38;2;241;250;140m')[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 678[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mcontinue[0m
[38;5;238m 679[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSymbol '[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_id[0m[38;2;248;248;242m}[0m[38;2;241;250;140m' matches target.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 680[0m   [38;5;238mâ”‚[0m 
[38;5;238m 681[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- 2. Position Mode Check (Assume One-Way) ---[0m
[38;5;238m 682[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Bybit V5 uses `positionIdx`: 0 for One-Way, 1 for Buy Hedge, 2 for Sell Hedge[0m
[38;5;238m 683[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mposition_idx[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140minfo[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mpositionIdx[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Default to 0 (One-Way) if not present[0m
[38;5;238m 684[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition_idx[0m[38;2;248;248;242m [0m[38;2;255;121;198m!=[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m:[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Strict check for One-Way mode[0m
[38;5;238m 685[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSkipping position entry: Position Index is [0m[38;2;248;248;242m{[0m[38;2;248;248;242mposition_idx[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (Expected 0 for One-Way Mode). This bot only supports One-Way mode.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 686[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mcontinue[0m
[38;5;238m 687[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Index is [0m[38;2;248;248;242m{[0m[38;2;248;248;242mposition_idx[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (OK for One-Way Mode).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 688[0m   [38;5;238mâ”‚[0m 
[38;5;238m 689[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- 3. Strict Side Check (Using Bybit V5 'side' from 'info') ---[0m
[38;5;238m 690[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m This is crucial for V5. 'side' indicates the position direction ('Buy', 'Sell') or 'None' if flat.[0m
[38;5;238m 691[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mpos_side_v5[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140minfo[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mside[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mNone[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Expected: 'Buy', 'Sell', or 'None'[0m
[38;5;238m 692[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRaw position side from info.side: '[0m[38;2;248;248;242m{[0m[38;2;248;248;242mpos_side_v5[0m[38;2;248;248;242m}[0m[38;2;241;250;140m'[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 693[0m   [38;5;238mâ”‚[0m 
[38;5;238m 694[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mdetermined_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_NONE[0m
[38;5;238m 695[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mpos_side_v5[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mBuy[0m[38;2;241;250;140m'[0m[38;2;248;248;242m:[0m
[38;5;238m 696[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mdetermined_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_LONG[0m
[38;5;238m 697[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198melif[0m[38;2;248;248;242m [0m[38;2;248;248;242mpos_side_v5[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mSell[0m[38;2;241;250;140m'[0m[38;2;248;248;242m:[0m
[38;5;238m 698[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mdetermined_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_SHORT[0m
[38;5;238m 699[0m   [38;5;238mâ”‚[0m 
[38;5;238m 700[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m *** IMPORTANT: If the API explicitly reports side as 'None', treat as no position, regardless of size ***[0m
[38;5;238m 701[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m This handles cases where residual dust might remain but the exchange considers the position closed.[0m
[38;5;238m 702[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mdetermined_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_NONE[0m[38;2;248;248;242m:[0m
[38;5;238m 703[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSkipping position entry: Side reported by API is '[0m[38;2;248;248;242m{[0m[38;2;248;248;242mpos_side_v5[0m[38;2;248;248;242m}[0m[38;2;241;250;140m'. Not considering it an active directional position.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 704[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mcontinue[0m
[38;5;238m 705[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSide '[0m[38;2;248;248;242m{[0m[38;2;248;248;242mpos_side_v5[0m[38;2;248;248;242m}[0m[38;2;241;250;140m' determined as [0m[38;2;248;248;242m{[0m[38;2;248;248;242mdetermined_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 706[0m   [38;5;238mâ”‚[0m 
[38;5;238m 707[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- 4. Check Position Size (Using Bybit V5 'size' from 'info') ---[0m
[38;5;238m 708[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Use 'size' from raw info preferentially for Bybit V5 as it reflects the actual contract quantity.[0m
[38;5;238m 709[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242msize_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140minfo[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140msize[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m 710[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Fallback to CCXT unified 'contracts' field if 'info.size' is missing (less likely for V5)[0m
[38;5;238m 711[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242msize_str[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242msize_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m
[38;5;238m 712[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242msize_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mcontracts[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m CCXT unified field name for quantity[0m
[38;5;238m 713[0m   [38;5;238mâ”‚[0m 
[38;5;238m 714[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242msize_str[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242msize_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Check again after fallback[0m
[38;5;238m 715[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSkipping position entry: Could not find a valid quantity string in 'info.size' or 'contracts'. Data: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mpos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140minfo[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 716[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mcontinue[0m
[38;5;238m 717[0m   [38;5;238mâ”‚[0m 
[38;5;238m 718[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- 5. Parse and Validate Size ---[0m
[38;5;238m 719[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m 720[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242msize[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242msize_str[0m[38;2;248;248;242m)[0m
[38;5;238m 721[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mParsed quantity: [0m[38;2;248;248;242m{[0m[38;2;248;248;242msize[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (from string: '[0m[38;2;248;248;242m{[0m[38;2;248;248;242msize_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m')[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 722[0m   [38;5;238mâ”‚[0m 
[38;5;238m 723[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Final Check: Is the size significantly non-zero? ---[0m
[38;5;238m 724[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;139;233;253mabs[0m[38;2;248;248;242m([0m[38;2;248;248;242msize[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_QTY_EPSILON[0m[38;2;248;248;242m:[0m
[38;5;238m 725[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m We have found an active position with a valid side ('Buy' or 'Sell') and a non-negligible size![0m
[38;5;238m 726[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mentry_price_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mentryPrice[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m CCXT unified field[0m
[38;5;238m 727[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Fallback to raw Bybit V5 'avgPrice' if unified 'entryPrice' is missing or invalid[0m
[38;5;238m 728[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m 729[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price_str[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mentry_price_str[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m:[0m
[38;5;238m 730[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                            [0m[38;2;248;248;242mentry_price_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140minfo[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mavgPrice[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Raw field often more reliable[0m
[38;5;238m 731[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[3;38;2;102;217;239mValueError[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mTypeError[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 732[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                         [0m[38;2;248;248;242mentry_price_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mpos[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140minfo[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mavgPrice[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Fallback on conversion error[0m
[38;5;238m 733[0m   [38;5;238mâ”‚[0m 
[38;5;238m 734[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mentry_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m
[38;5;238m 735[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price_str[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m!=[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m
[38;5;238m 736[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                         [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m 737[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                             [0m[38;2;248;248;242mentry_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mentry_price_str[0m[38;2;248;248;242m)[0m
[38;5;238m 738[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                         [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[3;38;2;102;217;239mValueError[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mTypeError[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 739[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mCould not parse entry price string: '[0m[38;2;248;248;242m{[0m[38;2;248;248;242mentry_price_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m'. Defaulting to 0.0.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 740[0m   [38;5;238mâ”‚[0m 
[38;5;238m 741[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mqty_abs[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;139;233;253mabs[0m[38;2;248;248;242m([0m[38;2;248;248;242msize[0m[38;2;248;248;242m)[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Return the absolute quantity[0m
[38;5;238m 742[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log exactly what is being returned[0m
[38;5;238m 743[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Check: Found ACTIVE position: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mdetermined_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m [0m[38;2;248;248;242m{[0m[38;2;248;248;242mqty_abs[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m [0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_id[0m[38;2;248;248;242m}[0m[38;2;241;250;140m @ Entry=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mentry_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 744[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;241;250;140m'[0m[38;2;241;250;140mside[0m[38;2;241;250;140m'[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mdetermined_side[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mqty[0m[38;2;241;250;140m'[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mqty_abs[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mentry_price[0m[38;2;241;250;140m'[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price[0m[38;2;248;248;242m}[0m
[38;5;238m 745[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m 746[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Size is zero or negligible, even though side was 'Buy' or 'Sell' (possible API state inconsistency or dust)[0m
[38;5;238m 747[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSkipping position entry: Position size [0m[38;2;248;248;242m{[0m[38;2;248;248;242msize[0m[38;2;248;248;242m}[0m[38;2;241;250;140m is <= epsilon [0m[38;2;248;248;242m{[0m[38;2;255;255;255mPOSITION_QTY_EPSILON[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, despite side being '[0m[38;2;248;248;242m{[0m[38;2;248;248;242mpos_side_v5[0m[38;2;248;248;242m}[0m[38;2;241;250;140m'. Treating as effectively closed.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 748[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;255;121;198mcontinue[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Move to the next entry in fetched_positions[0m
[38;5;238m 749[0m   [38;5;238mâ”‚[0m 
[38;5;238m 750[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[3;38;2;102;217;239mValueError[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mTypeError[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 751[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Check: Error parsing size/quantity for [0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_id[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Size string: '[0m[38;2;248;248;242m{[0m[38;2;248;248;242msize_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m', Error: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Data: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mpos[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 752[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mcontinue[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Move to the next entry[0m
[38;5;238m 753[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m End of loop through fetched_positions[0m
[38;5;238m 754[0m   [38;5;238mâ”‚[0m 
[38;5;238m 755[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m If the loop completes without returning, no active position was found for the target symbol/mode[0m
[38;5;238m 756[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Check: No active position found for [0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_id[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (One-Way Mode) after checking [0m[38;2;248;248;242m{[0m[38;2;139;233;253mlen[0m[38;2;248;248;242m([0m[38;2;248;248;242mfetched_positions[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m entries returned by fetch_positions.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 757[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mdefault_pos[0m
[38;5;238m 758[0m   [38;5;238mâ”‚[0m 
[38;5;238m 759[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Error Handling for fetch_positions call ---[0m
[38;5;238m 760[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mNetworkError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 761[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Check: Network error during fetch_positions for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 762[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mExchangeError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 763[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Check: Exchange error during fetch_positions for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 764[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 765[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Check: Unexpected error during position check for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 766[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m 767[0m   [38;5;238mâ”‚[0m 
[38;5;238m 768[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Return default (no position) if any error occurred during the process[0m
[38;5;238m 769[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPosition Check: Returning default (No Position) due to error or no active position found for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 770[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mdefault_pos[0m
[38;5;238m 771[0m   [38;5;238mâ”‚[0m 
[38;5;238m 772[0m   [38;5;238mâ”‚[0m 
[38;5;238m 773[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Leverage Setting ---[0m
[38;5;238m 774[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123mset_leverage[0m[38;2;248;248;242m([0m[3;38;2;255;184;108mexchange[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;255;121;198m.[0m[38;2;248;248;242mExchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108msymbol[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mleverage[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;248;248;242m->[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mbool[0m[38;2;248;248;242m:[0m
[38;5;238m 775[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 776[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Sets the leverage for a given futures symbol with retries and checks.[0m
[38;5;238m 777[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Verifies that the symbol is a contract market first.[0m
[38;5;238m 778[0m   [38;5;238mâ”‚[0m 
[38;5;238m 779[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Args:[0m
[38;5;238m 780[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        exchange (ccxt.Exchange): Initialized CCXT exchange object.[0m
[38;5;238m 781[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        symbol (str): Market symbol in CCXT unified format.[0m
[38;5;238m 782[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        leverage (int): Desired leverage level (e.g., 10 for 10x).[0m
[38;5;238m 783[0m   [38;5;238mâ”‚[0m 
[38;5;238m 784[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Returns:[0m
[38;5;238m 785[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        bool: True if leverage is successfully set (or was already correct), False otherwise.[0m
[38;5;238m 786[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 787[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLeverage Setting: Attempting to set [0m[38;2;248;248;242m{[0m[38;2;248;248;242mleverage[0m[38;2;248;248;242m}[0m[38;2;241;250;140mx leverage for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 788[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m 789[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mmarket[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mmarket[0m[38;2;248;248;242m([0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m)[0m
[38;5;238m 790[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Market Type Check ---[0m
[38;5;238m 791[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Ensure it's a futures/swap market where leverage is applicable[0m
[38;5;238m 792[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m CCXT market structure flags: 'swap', 'future', 'option'. 'contract' is a general flag.[0m
[38;5;238m 793[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mmarket[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mcontract[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mmarket[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mspot[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 794[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLeverage Setting: Cannot set leverage for non-contract market: [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Market type: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mtype[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 795[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m
[38;5;238m 796[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mMarket info for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: Type=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mtype[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Contract=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mcontract[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 797[0m   [38;5;238mâ”‚[0m 
[38;5;238m 798[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mBadSymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mKeyError[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 799[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLeverage Setting: Failed to get market info for symbol '[0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m': [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 800[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m
[38;5;238m 801[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 802[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLeverage Setting: Unexpected error getting market info for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 803[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m 804[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m
[38;5;238m 805[0m   [38;5;238mâ”‚[0m 
[38;5;238m 806[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Attempt to Set Leverage with Retries ---[0m
[38;5;238m 807[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mattempt[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;139;233;253mrange[0m[38;2;248;248;242m([0m[38;2;255;255;255mRETRY_COUNT[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m 808[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m 809[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Use the unified set_leverage method[0m
[38;5;238m 810[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Note: Some exchanges might require additional params (e.g., marginMode: isolated/cross)[0m
[38;5;238m 811[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Bybit usually defaults based on account settings or previous settings for the symbol.[0m
[38;5;238m 812[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLeverage Setting: Calling exchange.set_leverage([0m[38;2;248;248;242m{[0m[38;2;248;248;242mleverage[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, '[0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m') (Attempt [0m[38;2;248;248;242m{[0m[38;2;248;248;242mattempt[0m[38;2;248;248;242m [0m[38;2;255;121;198m+[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m[38;2;248;248;242m}[0m[38;2;241;250;140m/[0m[38;2;248;248;242m{[0m[38;2;255;255;255mRETRY_COUNT[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 813[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mresponse[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mset_leverage[0m[38;2;248;248;242m([0m[3;38;2;255;184;108mleverage[0m[38;2;255;121;198m=[0m[38;2;248;248;242mleverage[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108msymbol[0m[38;2;255;121;198m=[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m)[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Named args for clarity[0m
[38;5;238m 814[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Response format varies by exchange, log it for info[0m
[38;5;238m 815[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123msuccess[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLeverage Setting: Successfully set leverage to [0m[38;2;248;248;242m{[0m[38;2;248;248;242mleverage[0m[38;2;248;248;242m}[0m[38;2;241;250;140mx for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Response: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mresponse[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 816[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m
[38;5;238m 817[0m   [38;5;238mâ”‚[0m 
[38;5;238m 818[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mExchangeError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 819[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Check for common messages indicating leverage is already set or no change needed[0m
[38;5;238m 820[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242merror_msg_lower[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m([0m[38;2;248;248;242me[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mlower[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m
[38;5;238m 821[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Add more variations if needed based on observed Bybit error messages[0m
[38;5;238m 822[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mleverage not modified[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242merror_msg_lower[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242m\[0m
[38;5;238m 823[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m               [0m[38;2;241;250;140m"[0m[38;2;241;250;140msame leverage[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242merror_msg_lower[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242m\[0m
[38;5;238m 824[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m               [0m[38;2;241;250;140m"[0m[38;2;241;250;140mleverage is not changed[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242merror_msg_lower[0m[38;2;248;248;242m:[0m
[38;5;238m 825[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLeverage Setting: Leverage for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m already set to [0m[38;2;248;248;242m{[0m[38;2;248;248;242mleverage[0m[38;2;248;248;242m}[0m[38;2;241;250;140mx (Confirmed by exchange message).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 826[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m
[38;5;238m 827[0m   [38;5;238mâ”‚[0m 
[38;5;238m 828[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log other exchange errors and retry if attempts remain[0m
[38;5;238m 829[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLeverage Setting: Exchange error on attempt [0m[38;2;248;248;242m{[0m[38;2;248;248;242mattempt[0m[38;2;248;248;242m [0m[38;2;255;121;198m+[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m[38;2;248;248;242m}[0m[38;2;241;250;140m/[0m[38;2;248;248;242m{[0m[38;2;255;255;255mRETRY_COUNT[0m[38;2;248;248;242m}[0m[38;2;241;250;140m for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 830[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mattempt[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;255;255;255mRETRY_COUNT[0m[38;2;248;248;242m [0m[38;2;255;121;198m-[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m[38;2;248;248;242m:[0m
[38;5;238m 831[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRetrying leverage setting after [0m[38;2;248;248;242m{[0m[38;2;255;255;255mRETRY_DELAY_SECONDS[0m[38;2;248;248;242m}[0m[38;2;241;250;140ms...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 832[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mtime[0m[38;2;255;121;198m.[0m[38;2;80;250;123msleep[0m[38;2;248;248;242m([0m[38;2;255;255;255mRETRY_DELAY_SECONDS[0m[38;2;248;248;242m)[0m
[38;5;238m 833[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m 834[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLeverage Setting: Failed to set leverage for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m after [0m[38;2;248;248;242m{[0m[38;2;255;255;255mRETRY_COUNT[0m[38;2;248;248;242m}[0m[38;2;241;250;140m attempts due to exchange error: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 835[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Optionally send SMS on final failure[0m
[38;5;238m 836[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m send_sms_alert(f"[{symbol.split('/')[0]}] CRITICAL: Leverage set FAILED for {symbol} after retries: {e}")[0m
[38;5;238m 837[0m   [38;5;238mâ”‚[0m 
[38;5;238m 838[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mNetworkError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 839[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLeverage Setting: Network error on attempt [0m[38;2;248;248;242m{[0m[38;2;248;248;242mattempt[0m[38;2;248;248;242m [0m[38;2;255;121;198m+[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m[38;2;248;248;242m}[0m[38;2;241;250;140m/[0m[38;2;248;248;242m{[0m[38;2;255;255;255mRETRY_COUNT[0m[38;2;248;248;242m}[0m[38;2;241;250;140m for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 840[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mattempt[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;255;255;255mRETRY_COUNT[0m[38;2;248;248;242m [0m[38;2;255;121;198m-[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m[38;2;248;248;242m:[0m
[38;5;238m 841[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mtime[0m[38;2;255;121;198m.[0m[38;2;80;250;123msleep[0m[38;2;248;248;242m([0m[38;2;255;255;255mRETRY_DELAY_SECONDS[0m[38;2;248;248;242m)[0m
[38;5;238m 842[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m 843[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLeverage Setting: Failed to set leverage for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m after [0m[38;2;248;248;242m{[0m[38;2;255;255;255mRETRY_COUNT[0m[38;2;248;248;242m}[0m[38;2;241;250;140m attempts due to network errors.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 844[0m   [38;5;238mâ”‚[0m 
[38;5;238m 845[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 846[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Catch any other unexpected exceptions during the process[0m
[38;5;238m 847[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLeverage Setting: Unexpected error on attempt [0m[38;2;248;248;242m{[0m[38;2;248;248;242mattempt[0m[38;2;248;248;242m [0m[38;2;255;121;198m+[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m[38;2;248;248;242m}[0m[38;2;241;250;140m for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 848[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m 849[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Exit immediately on unexpected errors[0m
[38;5;238m 850[0m   [38;5;238mâ”‚[0m 
[38;5;238m 851[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m If loop finishes without returning True, it failed[0m
[38;5;238m 852[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m
[38;5;238m 853[0m   [38;5;238mâ”‚[0m 
[38;5;238m 854[0m   [38;5;238mâ”‚[0m 
[38;5;238m 855[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Close Position ---[0m
[38;5;238m 856[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123mclose_position[0m[38;2;248;248;242m([0m
[38;5;238m 857[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mexchange[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;255;121;198m.[0m[38;2;248;248;242mExchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108msymbol[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mposition_to_close[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mDict[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m, [0m[38;2;248;248;242mAny[0m[38;2;248;248;242m][0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mreason[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mSignal[0m[38;2;241;250;140m"[0m
[38;5;238m 858[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;248;248;242m->[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[38;2;248;248;242mDict[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m, [0m[38;2;248;248;242mAny[0m[38;2;248;248;242m][0m[38;2;248;248;242m][0m[38;2;248;248;242m:[0m
[38;5;238m 859[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 860[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Closes the specified active position using a market order with reduce_only=True.[0m
[38;5;238m 861[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Includes a pre-close position re-validation step to mitigate race conditions.[0m
[38;5;238m 862[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Sends SMS alerts on success or failure.[0m
[38;5;238m 863[0m   [38;5;238mâ”‚[0m 
[38;5;238m 864[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Args:[0m
[38;5;238m 865[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        exchange (ccxt.Exchange): Initialized CCXT exchange object.[0m
[38;5;238m 866[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        symbol (str): Market symbol (e.g., 'BTC/USDT:USDT').[0m
[38;5;238m 867[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        position_to_close (Dict[str, Any]): The position dictionary (containing at least[0m
[38;5;238m 868[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m                                             'side' and 'qty') as identified *before*[0m
[38;5;238m 869[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m                                             calling this function. Used for initial info.[0m
[38;5;238m 870[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        reason (str): Reason for closing (e.g., "SL", "TP", "Reversal", "Shutdown").[0m
[38;5;238m 871[0m   [38;5;238mâ”‚[0m 
[38;5;238m 872[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Returns:[0m
[38;5;238m 873[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        Optional[Dict[str, Any]]: The CCXT order dictionary if the close order was[0m
[38;5;238m 874[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m                                  successfully placed, None otherwise.[0m
[38;5;238m 875[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 876[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242minitial_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition_to_close[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mside[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_NONE[0m[38;2;248;248;242m)[0m
[38;5;238m 877[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242minitial_qty[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition_to_close[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mqty[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m
[38;5;238m 878[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;255;121;198m.[0m[38;2;80;250;123msplit[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140m/[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m[[0m[38;2;189;147;249m0[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m For concise SMS alerts (e.g., "BTC")[0m
[38;5;238m 879[0m   [38;5;238mâ”‚[0m 
[38;5;238m 880[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mClose Position: Initiated for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Reason: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mreason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Initial state: [0m[38;2;248;248;242m{[0m[38;2;248;248;242minitial_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m Qty=[0m[38;2;248;248;242m{[0m[38;2;248;248;242minitial_qty[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 881[0m   [38;5;238mâ”‚[0m 
[38;5;238m 882[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m ** Crucial Pre-Close Re-validation Step **[0m
[38;5;238m 883[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Fetch the position state *again* immediately before attempting to close.[0m
[38;5;238m 884[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m This helps prevent errors if the position was closed manually or by another[0m
[38;5;238m 885[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m process between the main logic check and this function call.[0m
[38;5;238m 886[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mClose Position: Re-validating current position state for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 887[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlive_position[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mget_current_position[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m)[0m
[38;5;238m 888[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlive_position_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlive_position[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mside[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m 889[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlive_amount_to_close[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlive_position[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mqty[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m
[38;5;238m 890[0m   [38;5;238mâ”‚[0m 
[38;5;238m 891[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Check if the live position still exists and matches the expected side (loosely)[0m
[38;5;238m 892[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mlive_position_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_NONE[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mlive_amount_to_close[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_QTY_EPSILON[0m[38;2;248;248;242m:[0m
[38;5;238m 893[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mClose Position: Re-validation shows NO active position for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (Live Side: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mlive_position_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Qty: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mlive_amount_to_close[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Aborting close attempt.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 894[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m If the initial state *thought* there was a position, log that discrepancy[0m
[38;5;238m 895[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242minitial_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m!=[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_NONE[0m[38;2;248;248;242m:[0m
[38;5;238m 896[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mClose Position: Discrepancy detected. Initial check showed [0m[38;2;248;248;242m{[0m[38;2;248;248;242minitial_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, but live check shows none.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 897[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 898[0m   [38;5;238mâ”‚[0m 
[38;5;238m 899[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Optional: Check if the live side matches the initial side (can be skipped if just closing whatever is there)[0m
[38;5;238m 900[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m if live_position_side != initial_side:[0m
[38;5;238m 901[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m     logger.warning(f"Close Position: Re-validation shows position side ({live_position_side}) differs from initial ({initial_side}). Closing the live position anyway.")[0m
[38;5;238m 902[0m   [38;5;238mâ”‚[0m 
[38;5;238m 903[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Use the freshly validated quantity and determine the closing side[0m
[38;5;238m 904[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mside_to_execute_close[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;255;255;255mSIDE_SELL[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mlive_position_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_LONG[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;255;255;255mSIDE_BUY[0m
[38;5;238m 905[0m   [38;5;238mâ”‚[0m 
[38;5;238m 906[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m 907[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Format the amount to the exchange's required precision[0m
[38;5;238m 908[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mamount_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mamount_to_precision[0m[38;2;248;248;242m([0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mlive_amount_to_close[0m[38;2;248;248;242m)[0m
[38;5;238m 909[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mamount_float[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mamount_str[0m[38;2;248;248;242m)[0m
[38;5;238m 910[0m   [38;5;238mâ”‚[0m 
[38;5;238m 911[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Final check on the amount after precision formatting[0m
[38;5;238m 912[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mamount_float[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_QTY_EPSILON[0m[38;2;248;248;242m:[0m
[38;5;238m 913[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mClose Position: Calculated closing amount after precision ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mamount_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) is zero or negligible. Aborting.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 914[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 915[0m   [38;5;238mâ”‚[0m 
[38;5;238m 916[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mClose Position: Attempting to CLOSE [0m[38;2;248;248;242m{[0m[38;2;248;248;242mlive_position_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m position ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mreason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): [0m[38;2;241;250;140m"[0m
[38;5;238m 917[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                       [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mExecuting [0m[38;2;248;248;242m{[0m[38;2;248;248;242mside_to_execute_close[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m MARKET order for [0m[38;2;248;248;242m{[0m[38;2;248;248;242mamount_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m [0m[38;2;241;250;140m"[0m
[38;5;238m 918[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                       [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mwith params [0m[38;2;255;121;198m{{[0m[38;2;241;250;140m'reduce_only': True[0m[38;2;255;121;198m}}[0m[38;2;241;250;140m...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 919[0m   [38;5;238mâ”‚[0m 
[38;5;238m 920[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Execute the Closing Market Order ---[0m
[38;5;238m 921[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mparams[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;241;250;140m'[0m[38;2;241;250;140mreduce_only[0m[38;2;241;250;140m'[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m}[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Ensure this order only closes/reduces the position[0m
[38;5;238m 922[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242morder[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcreate_market_order[0m[38;2;248;248;242m([0m
[38;5;238m 923[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108msymbol[0m[38;2;255;121;198m=[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m
[38;5;238m 924[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mside[0m[38;2;255;121;198m=[0m[38;2;248;248;242mside_to_execute_close[0m[38;2;248;248;242m,[0m
[38;5;238m 925[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mamount[0m[38;2;255;121;198m=[0m[38;2;248;248;242mamount_float[0m[38;2;248;248;242m,[0m
[38;5;238m 926[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mparams[0m[38;2;255;121;198m=[0m[38;2;248;248;242mparams[0m
[38;5;238m 927[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242m)[0m
[38;5;238m 928[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Post-Order Placement ---[0m
[38;5;238m 929[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log success and key order details[0m
[38;5;238m 930[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mfill_price_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242morder[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140maverage[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242morder[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140maverage[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mMarket (Check Fills)[0m[38;2;241;250;140m"[0m
[38;5;238m 931[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mfilled_qty_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242morder[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mfilled[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242morder[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mfilled[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140m?[0m[38;2;241;250;140m"[0m
[38;5;238m 932[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242morder_id_short[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m([0m[38;2;248;248;242morder[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mid[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m6[0m[38;2;248;248;242m:[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Get last 6 chars of ID for brevity[0m
[38;5;238m 933[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mcost_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242morder[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mcost[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242morder[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mcost[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Cost in quote currency (USDT)[0m
[38;5;238m 934[0m   [38;5;238mâ”‚[0m 
[38;5;238m 935[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123msuccess[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mClose Position: CLOSE Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mreason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) placed successfully for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. [0m[38;2;241;250;140m"[0m
[38;5;238m 936[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                       [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mQty Filled: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfilled_qty_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m/[0m[38;2;248;248;242m{[0m[38;2;248;248;242mamount_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Avg Fill ~ [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfill_price_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Cost: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcost_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT. ID:...[0m[38;2;248;248;242m{[0m[38;2;248;248;242morder_id_short[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 937[0m   [38;5;238mâ”‚[0m 
[38;5;238m 938[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Send SMS Alert on successful order placement[0m
[38;5;238m 939[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242msms_msg[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] Closed [0m[38;2;248;248;242m{[0m[38;2;248;248;242mlive_position_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m [0m[38;2;248;248;242m{[0m[38;2;248;248;242mamount_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m @ ~[0m[38;2;248;248;242m{[0m[38;2;248;248;242mfill_price_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mreason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). [0m[38;2;241;250;140m"[0m
[38;5;238m 940[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                   [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mID:...[0m[38;2;248;248;242m{[0m[38;2;248;248;242morder_id_short[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 941[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[38;2;248;248;242msms_msg[0m[38;2;248;248;242m)[0m
[38;5;238m 942[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242morder[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Return the order details dictionary[0m
[38;5;238m 943[0m   [38;5;238mâ”‚[0m 
[38;5;238m 944[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Error Handling for Order Creation ---[0m
[38;5;238m 945[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mInsufficientFunds[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 946[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m This *shouldn't* happen often with reduce_only, but possible in weird margin scenarios[0m
[38;5;238m 947[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mClose Position ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mreason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Insufficient funds error during close attempt: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 948[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ERROR Closing ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mreason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Insufficient funds! Check margin.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 949[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mNetworkError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 950[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mClose Position ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mreason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Network error placing close order: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 951[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m SMS might fail here too if network is down[0m
[38;5;238m 952[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mExchangeError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 953[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log the specific error message from the exchange (e.g., "position is zero", etc.)[0m
[38;5;238m 954[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mClose Position ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mreason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Exchange error placing close order: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 955[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Check for specific common errors if needed (e.g., position already closed)[0m
[38;5;238m 956[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m if "order would not reduce position size" in str(e).lower():[0m
[38;5;238m 957[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m     logger.warning(f"Close Position ({reason}): Exchange indicates order would not reduce size. Position likely already closed or closing.")[0m
[38;5;238m 958[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m     return None # Treat as potentially already closed[0m
[38;5;238m 959[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ERROR Closing ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mreason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Exchange error ([0m[38;2;248;248;242m{[0m[38;2;139;233;253mtype[0m[38;2;248;248;242m([0m[38;2;248;248;242me[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;248;248;242m__name__[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Check logs.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 960[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mValueError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 961[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Catch potential errors from amount_to_precision or float conversion[0m
[38;5;238m 962[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mClose Position ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mreason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Value error during amount processing (Qty: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mlive_amount_to_close[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 963[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m 964[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mClose Position ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mreason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Unexpected error placing close order: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 965[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m 966[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ERROR Closing ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mreason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Unexpected error ([0m[38;2;248;248;242m{[0m[38;2;139;233;253mtype[0m[38;2;248;248;242m([0m[38;2;248;248;242me[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;248;248;242m__name__[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Check logs.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 967[0m   [38;5;238mâ”‚[0m 
[38;5;238m 968[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Return None if any exception occurred during order placement[0m
[38;5;238m 969[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m 970[0m   [38;5;238mâ”‚[0m 
[38;5;238m 971[0m   [38;5;238mâ”‚[0m 
[38;5;238m 972[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Risk Calculation ---[0m
[38;5;238m 973[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123mcalculate_position_size[0m[38;2;248;248;242m([0m
[38;5;238m 974[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mequity[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mrisk_per_trade_pct[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mentry_price[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mstop_loss_price[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m
[38;5;238m 975[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mleverage[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108msymbol[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mexchange[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;255;121;198m.[0m[38;2;248;248;242mExchange[0m
[38;5;238m 976[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;248;248;242m->[0m[38;2;248;248;242m [0m[38;2;248;248;242mTuple[0m[38;2;248;248;242m[[0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m, [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m][0m[38;2;248;248;242m:[0m
[38;5;238m 977[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 978[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Calculates position size (quantity) based on risk percentage, entry/SL prices,[0m
[38;5;238m 979[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    and estimates the required initial margin (without buffer).[0m
[38;5;238m 980[0m   [38;5;238mâ”‚[0m 
[38;5;238m 981[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Args:[0m
[38;5;238m 982[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        equity (float): Current account equity (or relevant balance) in USDT.[0m
[38;5;238m 983[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        risk_per_trade_pct (float): Desired risk percentage (e.g., 0.01 for 1%).[0m
[38;5;238m 984[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        entry_price (float): Estimated entry price.[0m
[38;5;238m 985[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        stop_loss_price (float): Calculated stop-loss price.[0m
[38;5;238m 986[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        leverage (int): Leverage used for the symbol.[0m
[38;5;238m 987[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        symbol (str): Market symbol (used for precision).[0m
[38;5;238m 988[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        exchange (ccxt.Exchange): CCXT exchange instance (used for precision).[0m
[38;5;238m 989[0m   [38;5;238mâ”‚[0m 
[38;5;238m 990[0m   [38;5;238mâ”‚[0m 
[38;5;238m 991[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Returns:[0m
[38;5;238m 992[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        Tuple[Optional[float], Optional[float]]: (quantity, required_margin_estimate)[0m
[38;5;238m 993[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m           - quantity (float): The calculated position size in base currency (e.g., BTC).[0m
[38;5;238m 994[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m           - required_margin_estimate (float): Estimated USDT margin needed for the position.[0m
[38;5;238m 995[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m           Returns (None, None) if calculation is invalid or results in zero/negative size.[0m
[38;5;238m 996[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    [0m[38;2;98;114;164m"""[0m
[38;5;238m 997[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRisk Calc Input: Equity=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mequity[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Risk%=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mrisk_per_trade_pct[0m[38;2;189;147;249m:.3%[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, [0m[38;2;241;250;140m"[0m
[38;5;238m 998[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mEntry=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mentry_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, SL=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mstop_loss_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Lev=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mleverage[0m[38;2;248;248;242m}[0m[38;2;241;250;140mx, Symbol=[0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m 999[0m   [38;5;238mâ”‚[0m 
[38;5;238m1000[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Input Validation ---[0m
[38;5;238m1001[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242mentry_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mstop_loss_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m1002[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mRisk Calc: Invalid entry or stop-loss price (must be > 0).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1003[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m, [0m[38;2;189;147;249mNone[0m
[38;5;238m1004[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mprice_difference_per_unit[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;139;233;253mabs[0m[38;2;248;248;242m([0m[38;2;248;248;242mentry_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m-[0m[38;2;248;248;242m [0m[38;2;248;248;242mstop_loss_price[0m[38;2;248;248;242m)[0m
[38;5;238m1005[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mprice_difference_per_unit[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_QTY_EPSILON[0m[38;2;248;248;242m:[0m
[38;5;238m1006[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRisk Calc: Entry ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mentry_price[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) and stop-loss ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mstop_loss_price[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) prices are too close or identical. Cannot calculate size.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1007[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m, [0m[38;2;189;147;249mNone[0m
[38;5;238m1008[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;248;248;242mrisk_per_trade_pct[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m[38;2;248;248;242m:[0m
[38;5;238m1009[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRisk Calc: Invalid risk_per_trade_pct: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mrisk_per_trade_pct[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Must be between 0 and 1 (exclusive).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1010[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m, [0m[38;2;189;147;249mNone[0m
[38;5;238m1011[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mequity[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m:[0m
[38;5;238m1012[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRisk Calc: Invalid equity (<= 0): [0m[38;2;248;248;242m{[0m[38;2;248;248;242mequity[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1013[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m, [0m[38;2;189;147;249mNone[0m
[38;5;238m1014[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mleverage[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m:[0m
[38;5;238m1015[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRisk Calc: Invalid leverage (<= 0): [0m[38;2;248;248;242m{[0m[38;2;248;248;242mleverage[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1016[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m, [0m[38;2;189;147;249mNone[0m
[38;5;238m1017[0m   [38;5;238mâ”‚[0m 
[38;5;238m1018[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Calculation ---[0m
[38;5;238m1019[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m 1. Calculate Risk Amount in USDT[0m
[38;5;238m1020[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mrisk_amount_usdt[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mequity[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;248;248;242mrisk_per_trade_pct[0m
[38;5;238m1021[0m   [38;5;238mâ”‚[0m 
[38;5;238m1022[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m 2. Calculate Position Size (Quantity)[0m
[38;5;238m1023[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Quantity = Risk Amount / (Price difference per unit)[0m
[38;5;238m1024[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mquantity[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mrisk_amount_usdt[0m[38;2;248;248;242m [0m[38;2;255;121;198m/[0m[38;2;248;248;242m [0m[38;2;248;248;242mprice_difference_per_unit[0m
[38;5;238m1025[0m   [38;5;238mâ”‚[0m 
[38;5;238m1026[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Apply exchange precision to the calculated quantity *early*[0m
[38;5;238m1027[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m1028[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mquantity_precise_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mamount_to_precision[0m[38;2;248;248;242m([0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mquantity[0m[38;2;248;248;242m)[0m
[38;5;238m1029[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mquantity_precise[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mquantity_precise_str[0m[38;2;248;248;242m)[0m
[38;5;238m1030[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRisk Calc: Raw Qty=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mquantity[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Precise Qty=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mquantity_precise_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1031[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mquantity[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mquantity_precise[0m[38;2;248;248;242m  [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Use the precise quantity for further calculations[0m
[38;5;238m1032[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1033[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRisk Calc: Could not apply precision to quantity [0m[38;2;248;248;242m{[0m[38;2;248;248;242mquantity[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Using raw value. Error: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1034[0m   [38;5;238mâ”‚[0m 
[38;5;238m1035[0m   [38;5;238mâ”‚[0m 
[38;5;238m1036[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m 3. Check if calculated quantity is valid[0m
[38;5;238m1037[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mquantity[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_QTY_EPSILON[0m[38;2;248;248;242m:[0m
[38;5;238m1038[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRisk Calc: Calculated quantity ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mquantity[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) is zero or negligible based on risk parameters. [0m[38;2;241;250;140m"[0m
[38;5;238m1039[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                       [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRiskAmt=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mrisk_amount_usdt[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, PriceDiff=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mprice_difference_per_unit[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1040[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m, [0m[38;2;189;147;249mNone[0m
[38;5;238m1041[0m   [38;5;238mâ”‚[0m 
[38;5;238m1042[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m 4. Estimate Position Value and Required Margin (Initial Margin)[0m
[38;5;238m1043[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mposition_value_usdt[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mquantity[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price[0m
[38;5;238m1044[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Required Margin = Position Value / Leverage[0m
[38;5;238m1045[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mrequired_margin_estimate[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition_value_usdt[0m[38;2;248;248;242m [0m[38;2;255;121;198m/[0m[38;2;248;248;242m [0m[38;2;248;248;242mleverage[0m
[38;5;238m1046[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Note: This is the *initial* margin estimate. Actual margin requirements might[0m
[38;5;238m1047[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m include fees, funding rates, and vary slightly based on exact fill price.[0m
[38;5;238m1048[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m The margin *buffer* check happens later using free balance.[0m
[38;5;238m1049[0m   [38;5;238mâ”‚[0m 
[38;5;238m1050[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRisk Calc Output: RiskAmt=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mrisk_amount_usdt[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, PriceDiff=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mprice_difference_per_unit[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m [0m[38;2;241;250;140m"[0m
[38;5;238m1051[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m=> PreciseQty=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mquantity[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, EstPosValue=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mposition_value_usdt[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, EstMarginBase=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mrequired_margin_estimate[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1052[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242mquantity[0m[38;2;248;248;242m, [0m[38;2;248;248;242mrequired_margin_estimate[0m
[38;5;238m1053[0m   [38;5;238mâ”‚[0m 
[38;5;238m1054[0m   [38;5;238mâ”‚[0m 
[38;5;238m1055[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Place Order ---[0m
[38;5;238m1056[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123mplace_risked_market_order[0m[38;2;248;248;242m([0m
[38;5;238m1057[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mexchange[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;255;121;198m.[0m[38;2;248;248;242mExchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108msymbol[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mside[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m,[0m
[38;5;238m1058[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mrisk_percentage[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mcurrent_atr[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108msl_atr_multiplier[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m
[38;5;238m1059[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mleverage[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mmax_order_cap_usdt[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mmargin_check_buffer[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m
[38;5;238m1060[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;248;248;242m->[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[38;2;248;248;242mDict[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m, [0m[38;2;248;248;242mAny[0m[38;2;248;248;242m][0m[38;2;248;248;242m][0m[38;2;248;248;242m:[0m
[38;5;238m1061[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m
[38;5;238m1062[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Calculates position size based on risk & ATR SL, checks balance, limits, and margin,[0m
[38;5;238m1063[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    then places a market order if all checks pass. Sends SMS alerts.[0m
[38;5;238m1064[0m   [38;5;238mâ”‚[0m 
[38;5;238m1065[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Args:[0m
[38;5;238m1066[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        exchange (ccxt.Exchange): Initialized CCXT exchange object.[0m
[38;5;238m1067[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        symbol (str): Market symbol (e.g., 'BTC/USDT:USDT').[0m
[38;5;238m1068[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        side (str): 'buy' or 'sell'.[0m
[38;5;238m1069[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        risk_percentage (float): Risk per trade as a decimal (e.g., 0.01 for 1%).[0m
[38;5;238m1070[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        current_atr (Optional[float]): The current ATR value for SL calculation.[0m
[38;5;238m1071[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        sl_atr_multiplier (float): Multiplier for ATR to determine SL distance.[0m
[38;5;238m1072[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        leverage (int): Leverage confirmed for the symbol.[0m
[38;5;238m1073[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        max_order_cap_usdt (float): Maximum allowed position size in USDT value.[0m
[38;5;238m1074[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        margin_check_buffer (float): Buffer multiplier for checking available margin (e.g., 1.05 for 5% buffer).[0m
[38;5;238m1075[0m   [38;5;238mâ”‚[0m 
[38;5;238m1076[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Returns:[0m
[38;5;238m1077[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        Optional[Dict[str, Any]]: The CCXT order dictionary if the order was successfully placed, None otherwise.[0m
[38;5;238m1078[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    [0m[38;2;98;114;164m"""[0m
[38;5;238m1079[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;255;121;198m.[0m[38;2;80;250;123msplit[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140m/[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m[[0m[38;2;189;147;249m0[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m For concise SMS alerts[0m
[38;5;238m1080[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Initiating [0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m market order placement for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1081[0m   [38;5;238mâ”‚[0m 
[38;5;238m1082[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Pre-computation Checks ---[0m
[38;5;238m1083[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m:[0m
[38;5;238m1084[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Invalid ATR value ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) provided for SL calculation. Cannot place order.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1085[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ORDER FAIL ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Invalid ATR provided.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1086[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1087[0m   [38;5;238mâ”‚[0m 
[38;5;238m1088[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mentry_price_estimate[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1089[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mstop_loss_price[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1090[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mfinal_quantity[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1091[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m"[0m
[38;5;238m1092[0m   [38;5;238mâ”‚[0m 
[38;5;238m1093[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m1094[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- 1. Get Balance, Market Info, and Limits ---[0m
[38;5;238m1095[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Fetching balance and market details...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1096[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mbalance[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mfetch_balance[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m
[38;5;238m1097[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mmarket[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mmarket[0m[38;2;248;248;242m([0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m)[0m
[38;5;238m1098[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlimits[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mmarket[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mlimits[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m)[0m
[38;5;238m1099[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mamount_limits[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlimits[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mamount[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m)[0m
[38;5;238m1100[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mprice_limits[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlimits[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mprice[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m)[0m
[38;5;238m1101[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mmin_qty[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mamount_limits[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mmin[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m1102[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mmax_qty[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mamount_limits[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mmax[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m1103[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mqty_precision[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mmarket[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mprecision[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mamount[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Number of decimal places for quantity[0m
[38;5;238m1104[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mprice_precision[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mmarket[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mprecision[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mprice[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Number of decimal places for price[0m
[38;5;238m1105[0m   [38;5;238mâ”‚[0m 
[38;5;238m1106[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Get available equity/free balance in USDT[0m
[38;5;238m1107[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242musdt_balance[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mbalance[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;255;255;255mUSDT_SYMBOL[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m)[0m
[38;5;238m1108[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242musdt_total[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242musdt_balance[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mtotal[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Total equity[0m
[38;5;238m1109[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242musdt_free[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242musdt_balance[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mfree[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Free margin available[0m
[38;5;238m1110[0m   [38;5;238mâ”‚[0m 
[38;5;238m1111[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Use total equity for risk calculation, but free margin for placement check[0m
[38;5;238m1112[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Fallback logic if 'total' is None or zero[0m
[38;5;238m1113[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242musdt_total[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242musdt_total[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m:[0m
[38;5;238m1114[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: USDT 'total' balance is [0m[38;2;248;248;242m{[0m[38;2;248;248;242musdt_total[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Using 'free' balance ([0m[38;2;248;248;242m{[0m[38;2;248;248;242musdt_free[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) for equity calculation.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1115[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242musdt_equity[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242musdt_free[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242musdt_free[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m
[38;5;238m1116[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1117[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242musdt_equity[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242musdt_total[0m
[38;5;238m1118[0m   [38;5;238mâ”‚[0m 
[38;5;238m1119[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242musdt_equity[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242musdt_equity[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m:[0m
[38;5;238m1120[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Cannot determine valid account equity (USDT total/free is zero, negative, or None).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1121[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ORDER FAIL ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Zero/Invalid equity.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1122[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1123[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242musdt_free[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242musdt_free[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Free margin must be available[0m
[38;5;238m1124[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Invalid free margin (USDT free is [0m[38;2;248;248;242m{[0m[38;2;248;248;242musdt_free[0m[38;2;248;248;242m}[0m[38;2;241;250;140m).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1125[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ORDER FAIL ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Invalid free margin.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1126[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1127[0m   [38;5;238mâ”‚[0m 
[38;5;238m1128[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Account Balance -> Equity=[0m[38;2;248;248;242m{[0m[38;2;248;248;242musdt_equity[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT, Free Margin=[0m[38;2;248;248;242m{[0m[38;2;248;248;242musdt_free[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1129[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Market Limits -> MinQty=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmin_qty[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, MaxQty=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmax_qty[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, QtyPrec=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mqty_precision[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, PricePrec=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mprice_precision[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1130[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Market Price Limits -> MinPrice=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mprice_limits[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mmin[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, MaxPrice=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mprice_limits[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mmax[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1131[0m   [38;5;238mâ”‚[0m 
[38;5;238m1132[0m   [38;5;238mâ”‚[0m 
[38;5;238m1133[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- 2. Estimate Entry Price ---[0m
[38;5;238m1134[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Use a shallow order book fetch for a slightly more realistic entry price estimate than ticker 'last'[0m
[38;5;238m1135[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Fetching shallow OB (depth [0m[38;2;248;248;242m{[0m[38;2;255;255;255mSHALLOW_OB_FETCH_DEPTH[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) for entry price estimate...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1136[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mob_data[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123manalyze_order_book[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mSHALLOW_OB_FETCH_DEPTH[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mSHALLOW_OB_FETCH_DEPTH[0m[38;2;248;248;242m)[0m
[38;5;238m1137[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mbest_ask[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mob_data[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mbest_ask[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1138[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mbest_bid[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mob_data[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mbest_bid[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1139[0m   [38;5;238mâ”‚[0m 
[38;5;238m1140[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mside[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;255;255mSIDE_BUY[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mbest_ask[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mbest_ask[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m:[0m
[38;5;238m1141[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mentry_price_estimate[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mbest_ask[0m
[38;5;238m1142[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Using best ASK [0m[38;2;248;248;242m{[0m[38;2;248;248;242mentry_price_estimate[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m from shallow OB as BUY entry estimate.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1143[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melif[0m[38;2;248;248;242m [0m[38;2;248;248;242mside[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;255;255mSIDE_SELL[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mbest_bid[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mbest_bid[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m:[0m
[38;5;238m1144[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mentry_price_estimate[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mbest_bid[0m
[38;5;238m1145[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Using best BID [0m[38;2;248;248;242m{[0m[38;2;248;248;242mentry_price_estimate[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m from shallow OB as SELL entry estimate.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1146[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1147[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Fallback to ticker 'last' price if OB fetch fails or returns invalid prices[0m
[38;5;238m1148[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Shallow OB fetch failed or returned invalid bid/ask. Falling back to ticker 'last' price for entry estimate.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1149[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m1150[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mticker[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mfetch_ticker[0m[38;2;248;248;242m([0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m)[0m
[38;5;238m1151[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mentry_price_estimate[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mticker[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mlast[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m1152[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price_estimate[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Using ticker 'last' price [0m[38;2;248;248;242m{[0m[38;2;248;248;242mentry_price_estimate[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m as entry estimate.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1153[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242mticker_err[0m[38;2;248;248;242m:[0m
[38;5;238m1154[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Failed to fetch ticker price as fallback: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mticker_err[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1155[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mentry_price_estimate[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Ensure it's None if ticker fails too[0m
[38;5;238m1156[0m   [38;5;238mâ”‚[0m 
[38;5;238m1157[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Validate the estimated entry price[0m
[38;5;238m1158[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price_estimate[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price_estimate[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m:[0m
[38;5;238m1159[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Could not determine a valid entry price estimate (Estimate: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mentry_price_estimate[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Cannot place order.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1160[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ORDER FAIL ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): No valid entry price estimate.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1161[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1162[0m   [38;5;238mâ”‚[0m 
[38;5;238m1163[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- 3. Calculate Stop Loss Price ---[0m
[38;5;238m1164[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mstop_loss_distance[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;248;248;242msl_atr_multiplier[0m
[38;5;238m1165[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mside[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;255;255mSIDE_BUY[0m[38;2;248;248;242m:[0m
[38;5;238m1166[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mstop_loss_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price_estimate[0m[38;2;248;248;242m [0m[38;2;255;121;198m-[0m[38;2;248;248;242m [0m[38;2;248;248;242mstop_loss_distance[0m
[38;5;238m1167[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m SIDE_SELL[0m
[38;5;238m1168[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mstop_loss_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price_estimate[0m[38;2;248;248;242m [0m[38;2;255;121;198m+[0m[38;2;248;248;242m [0m[38;2;248;248;242mstop_loss_distance[0m
[38;5;238m1169[0m   [38;5;238mâ”‚[0m 
[38;5;238m1170[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Ensure SL price is positive and respects exchange minimum price limit[0m
[38;5;238m1171[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mmin_price_limit[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mprice_limits[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mmin[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m1172[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mmin_price_limit[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mstop_loss_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;248;248;242mmin_price_limit[0m[38;2;248;248;242m:[0m
[38;5;238m1173[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Calculated SL price [0m[38;2;248;248;242m{[0m[38;2;248;248;242mstop_loss_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m is below minimum limit [0m[38;2;248;248;242m{[0m[38;2;248;248;242mmin_price_limit[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Adjusting SL to minimum limit.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1174[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mstop_loss_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mmin_price_limit[0m
[38;5;238m1175[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melif[0m[38;2;248;248;242m [0m[38;2;248;248;242mstop_loss_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m:[0m
[38;5;238m1176[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Calculated SL price [0m[38;2;248;248;242m{[0m[38;2;248;248;242mstop_loss_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m is zero or negative. Adjusting SL to a small positive value (e.g., min price limit or tiny fraction).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1177[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Adjust to min price limit if available, otherwise a very small number might be risky.[0m
[38;5;238m1178[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;98;114;164m#[0m[38;2;98;114;164m For simplicity, let's prevent order if SL becomes invalid. A better approach might use a fixed % SL as fallback.[0m
[38;5;238m1179[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mmin_price_limit[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m:[0m
[38;5;238m1180[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mstop_loss_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mmin_price_limit[0m
[38;5;238m1181[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1182[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Calculated SL price is invalid ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mstop_loss_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) and no minimum price limit found. Cannot place order.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1183[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ORDER FAIL ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Invalid SL price calc.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1184[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1185[0m   [38;5;238mâ”‚[0m 
[38;5;238m1186[0m   [38;5;238mâ”‚[0m 
[38;5;238m1187[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Apply exchange price precision to the calculated SL price[0m
[38;5;238m1188[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m1189[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mstop_loss_price_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mprice_to_precision[0m[38;2;248;248;242m([0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mstop_loss_price[0m[38;2;248;248;242m)[0m
[38;5;238m1190[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mstop_loss_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mstop_loss_price_str[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Convert back to float after formatting[0m
[38;5;238m1191[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Calculated SL -> EntryEst=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mentry_price_estimate[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, [0m[38;2;241;250;140m"[0m
[38;5;238m1192[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mATR([0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_atr[0m[38;2;189;147;249m:.5f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) * [0m[38;2;248;248;242m{[0m[38;2;248;248;242msl_atr_multiplier[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (Dist=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mstop_loss_distance[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) => SL Price ~ [0m[38;2;248;248;242m{[0m[38;2;248;248;242mstop_loss_price_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1193[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1194[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Error applying precision to SL price [0m[38;2;248;248;242m{[0m[38;2;248;248;242mstop_loss_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Aborting.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1195[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1196[0m   [38;5;238mâ”‚[0m 
[38;5;238m1197[0m   [38;5;238mâ”‚[0m 
[38;5;238m1198[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- 4. Calculate Position Size and Estimate Initial Margin ---[0m
[38;5;238m1199[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mcalculated_quantity[0m[38;2;248;248;242m, [0m[38;2;248;248;242mrequired_margin_estimate[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mcalculate_position_size[0m[38;2;248;248;242m([0m
[38;5;238m1200[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mequity[0m[38;2;255;121;198m=[0m[38;2;248;248;242musdt_equity[0m[38;2;248;248;242m,[0m
[38;5;238m1201[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mrisk_per_trade_pct[0m[38;2;255;121;198m=[0m[38;2;248;248;242mrisk_percentage[0m[38;2;248;248;242m,[0m
[38;5;238m1202[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mentry_price[0m[38;2;255;121;198m=[0m[38;2;248;248;242mentry_price_estimate[0m[38;2;248;248;242m,[0m
[38;5;238m1203[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mstop_loss_price[0m[38;2;255;121;198m=[0m[38;2;248;248;242mstop_loss_price[0m[38;2;248;248;242m,[0m
[38;5;238m1204[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mleverage[0m[38;2;255;121;198m=[0m[38;2;248;248;242mleverage[0m[38;2;248;248;242m,[0m
[38;5;238m1205[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108msymbol[0m[38;2;255;121;198m=[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m
[38;5;238m1206[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mexchange[0m[38;2;255;121;198m=[0m[38;2;248;248;242mexchange[0m
[38;5;238m1207[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242m)[0m
[38;5;238m1208[0m   [38;5;238mâ”‚[0m 
[38;5;238m1209[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mcalculated_quantity[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mrequired_margin_estimate[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m:[0m
[38;5;238m1210[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Failed to calculate valid position size/margin based on risk parameters. Check logs from calculate_position_size.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1211[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ORDER FAIL ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Risk calculation failed.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1212[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1213[0m   [38;5;238mâ”‚[0m 
[38;5;238m1214[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mfinal_quantity[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mcalculated_quantity[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Start with the risk-calculated quantity[0m
[38;5;238m1215[0m   [38;5;238mâ”‚[0m 
[38;5;238m1216[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- 5. Apply Max Order Cap (USDT Value) ---[0m
[38;5;238m1217[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242morder_value_usdt[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mfinal_quantity[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price_estimate[0m
[38;5;238m1218[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242morder_value_usdt[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;248;248;242mmax_order_cap_usdt[0m[38;2;248;248;242m:[0m
[38;5;238m1219[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Initial risk-based order value [0m[38;2;248;248;242m{[0m[38;2;248;248;242morder_value_usdt[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT exceeds MAX Cap [0m[38;2;248;248;242m{[0m[38;2;248;248;242mmax_order_cap_usdt[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT. Capping quantity.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1220[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mfinal_quantity[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mmax_order_cap_usdt[0m[38;2;248;248;242m [0m[38;2;255;121;198m/[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price_estimate[0m
[38;5;238m1221[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Recalculate estimated margin based on the capped quantity[0m
[38;5;238m1222[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mrequired_margin_estimate[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242mmax_order_cap_usdt[0m[38;2;248;248;242m [0m[38;2;255;121;198m/[0m[38;2;248;248;242m [0m[38;2;248;248;242mleverage[0m[38;2;248;248;242m)[0m
[38;5;238m1223[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Quantity capped to ~ [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_quantity[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m based on Max Cap. New Est. Margin ~ [0m[38;2;248;248;242m{[0m[38;2;248;248;242mrequired_margin_estimate[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1224[0m   [38;5;238mâ”‚[0m 
[38;5;238m1225[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- 6. Apply Exchange Precision and Check Min/Max Quantity Limits ---[0m
[38;5;238m1226[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m1227[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mamount_to_precision[0m[38;2;248;248;242m([0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mfinal_quantity[0m[38;2;248;248;242m)[0m
[38;5;238m1228[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mfinal_quantity[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m)[0m
[38;5;238m1229[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Quantity after precision: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1230[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1231[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Error applying precision to final quantity [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_quantity[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Aborting.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1232[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1233[0m   [38;5;238mâ”‚[0m 
[38;5;238m1234[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Check if final quantity is effectively zero after precision[0m
[38;5;238m1235[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mfinal_quantity[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_QTY_EPSILON[0m[38;2;248;248;242m:[0m
[38;5;238m1236[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Final quantity [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m is zero or negligible after risk calc/capping/precision. Cannot place order.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1237[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m No order to place[0m
[38;5;238m1238[0m   [38;5;238mâ”‚[0m 
[38;5;238m1239[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Check against Min/Max quantity limits from the exchange[0m
[38;5;238m1240[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mmin_qty[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mfinal_quantity[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;248;248;242mmin_qty[0m[38;2;248;248;242m:[0m
[38;5;238m1241[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Final Qty [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m is LESS than exchange minimum quantity [0m[38;2;248;248;242m{[0m[38;2;248;248;242mmin_qty[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Skipping order.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1242[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Optionally, could place the minimum qty order, but that deviates from risk calc. Skipping is safer.[0m
[38;5;238m1243[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ORDER FAIL ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Qty [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m < Min [0m[38;2;248;248;242m{[0m[38;2;248;248;242mmin_qty[0m[38;2;248;248;242m}[0m[38;2;241;250;140m.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1244[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1245[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mmax_qty[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mfinal_quantity[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;248;248;242mmax_qty[0m[38;2;248;248;242m:[0m
[38;5;238m1246[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Final Qty [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m is GREATER than exchange maximum quantity [0m[38;2;248;248;242m{[0m[38;2;248;248;242mmax_qty[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Capping to max qty.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1247[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mfinal_quantity[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mmax_qty[0m
[38;5;238m1248[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Re-apply precision after capping to max_qty[0m
[38;5;238m1249[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m1250[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mamount_to_precision[0m[38;2;248;248;242m([0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mfinal_quantity[0m[38;2;248;248;242m)[0m
[38;5;238m1251[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mfinal_quantity[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m([0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m)[0m
[38;5;238m1252[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Recalculate estimated margin based on max quantity[0m
[38;5;238m1253[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mrequired_margin_estimate[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242m([0m[38;2;248;248;242mfinal_quantity[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price_estimate[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m/[0m[38;2;248;248;242m [0m[38;2;248;248;242mleverage[0m[38;2;248;248;242m)[0m
[38;5;238m1254[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Quantity capped to exchange max: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. New Est. Margin ~ [0m[38;2;248;248;242m{[0m[38;2;248;248;242mrequired_margin_estimate[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1255[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1256[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Error applying precision after capping to max qty [0m[38;2;248;248;242m{[0m[38;2;248;248;242mmax_qty[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Aborting.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1257[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1258[0m   [38;5;238mâ”‚[0m 
[38;5;238m1259[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Re-calculate final estimated position value and margin after all adjustments[0m
[38;5;238m1260[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mfinal_pos_value[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mfinal_quantity[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price_estimate[0m
[38;5;238m1261[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mfinal_req_margin[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mfinal_pos_value[0m[38;2;248;248;242m [0m[38;2;255;121;198m/[0m[38;2;248;248;242m [0m[38;2;248;248;242mleverage[0m
[38;5;238m1262[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Final Order Details -> Qty=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, [0m[38;2;241;250;140m"[0m
[38;5;238m1263[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mEst. Value=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_pos_value[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT, [0m[38;2;241;250;140m"[0m
[38;5;238m1264[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mEst. Req. Margin=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_req_margin[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1265[0m   [38;5;238mâ”‚[0m 
[38;5;238m1266[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- 7. Check Available Margin (using Free Balance and Buffer) ---[0m
[38;5;238m1267[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mrequired_margin_with_buffer[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mfinal_req_margin[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;248;248;242mmargin_check_buffer[0m
[38;5;238m1268[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242musdt_free[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;248;248;242mrequired_margin_with_buffer[0m[38;2;248;248;242m:[0m
[38;5;238m1269[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Insufficient FREE margin. [0m[38;2;241;250;140m"[0m
[38;5;238m1270[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                         [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRequires ~ [0m[38;2;248;248;242m{[0m[38;2;248;248;242mrequired_margin_with_buffer[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT [0m[38;2;241;250;140m"[0m
[38;5;238m1271[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                         [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m(Base: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_req_margin[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Buffer: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mmargin_check_buffer[0m[38;2;189;147;249m:.1%[0m[38;2;248;248;242m}[0m[38;2;241;250;140m), [0m[38;2;241;250;140m"[0m
[38;5;238m1272[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                         [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mAvailable Free: [0m[38;2;248;248;242m{[0m[38;2;248;248;242musdt_free[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1273[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ORDER FAIL ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Insufficient Free Margin (Need ~[0m[38;2;248;248;242m{[0m[38;2;248;248;242mrequired_margin_with_buffer[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Have [0m[38;2;248;248;242m{[0m[38;2;248;248;242musdt_free[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1274[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1275[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1276[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: Margin check passed. Required w/ Buffer: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mrequired_margin_with_buffer[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT <= Available Free: [0m[38;2;248;248;242m{[0m[38;2;248;248;242musdt_free[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1277[0m   [38;5;238mâ”‚[0m 
[38;5;238m1278[0m   [38;5;238mâ”‚[0m 
[38;5;238m1279[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- 8. Place the Market Order ---[0m
[38;5;238m1280[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m*** Placing [0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m MARKET ORDER: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m ***[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1281[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Ensure no extra params interfere with basic market order unless intended[0m
[38;5;238m1282[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mparams[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m{[0m[38;2;248;248;242m}[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Start fresh, add specific params if needed (e.g., timeInForce)[0m
[38;5;238m1283[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242morder[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcreate_market_order[0m[38;2;248;248;242m([0m
[38;5;238m1284[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108msymbol[0m[38;2;255;121;198m=[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m
[38;5;238m1285[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mside[0m[38;2;255;121;198m=[0m[38;2;248;248;242mside[0m[38;2;248;248;242m,[0m
[38;5;238m1286[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mamount[0m[38;2;255;121;198m=[0m[38;2;248;248;242mfinal_quantity[0m[38;2;248;248;242m,[0m
[38;5;238m1287[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[3;38;2;255;184;108mparams[0m[38;2;255;121;198m=[0m[38;2;248;248;242mparams[0m
[38;5;238m1288[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242m)[0m
[38;5;238m1289[0m   [38;5;238mâ”‚[0m 
[38;5;238m1290[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- 9. Post-Order Handling & Logging ---[0m
[38;5;238m1291[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Extract details from the returned order object (structure varies slightly by exchange/ccxt version)[0m
[38;5;238m1292[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mfilled_qty[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242morder[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mfilled[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Amount actually filled[0m
[38;5;238m1293[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mavg_fill_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242morder[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140maverage[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Average price if filled[0m
[38;5;238m1294[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242morder_id[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242morder[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mid[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m1295[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242morder_status[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242morder[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mstatus[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m1296[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242morder_cost[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242morder[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mcost[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Cost in quote currency (USDT)[0m
[38;5;238m1297[0m   [38;5;238mâ”‚[0m 
[38;5;238m1298[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mfill_price_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mavg_fill_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mavg_fill_price[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m"[0m
[38;5;238m1299[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mfilled_qty_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mfilled_qty[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mfilled_qty[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140m?[0m[38;2;241;250;140m"[0m
[38;5;238m1300[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242morder_id_short[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m([0m[38;2;248;248;242morder_id[0m[38;2;248;248;242m)[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m6[0m[38;2;248;248;242m:[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Last 6 chars for brevity[0m
[38;5;238m1301[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mcost_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242morder_cost[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242morder_cost[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m"[0m
[38;5;238m1302[0m   [38;5;238mâ”‚[0m 
[38;5;238m1303[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123msuccess[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m Market Order Placed Successfully! [0m[38;2;241;250;140m"[0m
[38;5;238m1304[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                       [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mID:...[0m[38;2;248;248;242m{[0m[38;2;248;248;242morder_id_short[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Status: [0m[38;2;248;248;242m{[0m[38;2;248;248;242morder_status[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, [0m[38;2;241;250;140m"[0m
[38;5;238m1305[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                       [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mFilled Qty: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfilled_qty_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m/[0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, [0m[38;2;241;250;140m"[0m
[38;5;238m1306[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                       [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mAvg Fill Price: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfill_price_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Cost: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcost_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1307[0m   [38;5;238mâ”‚[0m 
[38;5;238m1308[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Send SMS Alert for successful entry[0m
[38;5;238m1309[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242msms_msg[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ENTER [0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_quantity_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m @ ~[0m[38;2;248;248;242m{[0m[38;2;248;248;242mfill_price_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. [0m[38;2;241;250;140m"[0m
[38;5;238m1310[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                   [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSL ~ [0m[38;2;248;248;242m{[0m[38;2;248;248;242mstop_loss_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. ID:...[0m[38;2;248;248;242m{[0m[38;2;248;248;242morder_id_short[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Include calculated SL for reference[0m
[38;5;238m1311[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[38;2;248;248;242msms_msg[0m[38;2;248;248;242m)[0m
[38;5;238m1312[0m   [38;5;238mâ”‚[0m 
[38;5;238m1313[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- !!! CRITICAL SCALPING TODO !!! ---[0m
[38;5;238m1314[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m The calculated SL/TP based on estimated entry is NOT sufficient.[0m
[38;5;238m1315[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m You MUST place exchange-native SL/TP orders *after* this market order fills,[0m
[38;5;238m1316[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m using the actual `avg_fill_price` and `filled_qty`.[0m
[38;5;238m1317[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!![0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1318[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m!!! ACTION REQUIRED: Loop-based SL/TP is active for position ID ...[0m[38;2;248;248;242m{[0m[38;2;248;248;242morder_id_short[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. !!![0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1319[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m!!! This is UNSAFE. Implement exchange-native SL/TP orders based on fill price [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfill_price_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m !!![0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1320[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!![0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1321[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Example (Conceptual - Requires specific CCXT implementation for conditional orders):[0m
[38;5;238m1322[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m if avg_fill_price and filled_qty > 0:[0m
[38;5;238m1323[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m     actual_sl_price = avg_fill_price - stop_loss_distance # Recalculate based on fill[0m
[38;5;238m1324[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m     actual_tp_price = avg_fill_price + tp_distance # Recalculate based on fill[0m
[38;5;238m1325[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m     exchange.create_order(symbol, 'stopMarket', 'sell' if side == 'buy' else 'buy', filled_qty, params={'stopPrice': actual_sl_price, 'reduce_only': True})[0m
[38;5;238m1326[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m     exchange.create_order(symbol, 'takeProfitMarket', 'sell' if side == 'buy' else 'buy', filled_qty, params={'stopPrice': actual_tp_price, 'reduce_only': True})[0m
[38;5;238m1327[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m ---------------------------------------[0m
[38;5;238m1328[0m   [38;5;238mâ”‚[0m 
[38;5;238m1329[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;248;248;242morder[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Return the order dictionary[0m
[38;5;238m1330[0m   [38;5;238mâ”‚[0m 
[38;5;238m1331[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Exception Handling for Order Placement Process ---[0m
[38;5;238m1332[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mInsufficientFunds[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1333[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m This might occur if free margin calculation was slightly off or fees pushed it over[0m
[38;5;238m1334[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Insufficient funds error during order placement: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1335[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ORDER FAIL ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Insufficient funds reported by exchange![0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1336[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mNetworkError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1337[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Network error during order placement: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1338[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m SMS might fail too[0m
[38;5;238m1339[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mExchangeError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1340[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log specific exchange errors (e.g., invalid order params, margin issues not caught earlier)[0m
[38;5;238m1341[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Exchange error during order placement: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1342[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ORDER FAIL ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Exchange error ([0m[38;2;248;248;242m{[0m[38;2;139;233;253mtype[0m[38;2;248;248;242m([0m[38;2;248;248;242me[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;248;248;242m__name__[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Check logs.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1343[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mValueError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1344[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Catch potential errors from precision formatting or float conversions[0m
[38;5;238m1345[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m         [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Value error during price/amount processing: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1346[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1347[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPlace Order ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Unexpected critical error during order placement logic: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1348[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m1349[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ORDER FAIL ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mside[0m[38;2;255;121;198m.[0m[38;2;80;250;123mupper[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Unexpected error ([0m[38;2;248;248;242m{[0m[38;2;139;233;253mtype[0m[38;2;248;248;242m([0m[38;2;248;248;242me[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;248;248;242m__name__[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Check logs.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1350[0m   [38;5;238mâ”‚[0m 
[38;5;238m1351[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Return None if any exception occurred during the process[0m
[38;5;238m1352[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1353[0m   [38;5;238mâ”‚[0m 
[38;5;238m1354[0m   [38;5;238mâ”‚[0m 
[38;5;238m1355[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Trading Logic ---[0m
[38;5;238m1356[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123mtrade_logic[0m[38;2;248;248;242m([0m
[38;5;238m1357[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mexchange[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;255;121;198m.[0m[38;2;248;248;242mExchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108msymbol[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mdf[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mpd[0m[38;2;255;121;198m.[0m[38;2;248;248;242mDataFrame[0m[38;2;248;248;242m,[0m
[38;5;238m1358[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mst_len[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mst_mult[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mcf_st_len[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mcf_st_mult[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m
[38;5;238m1359[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108matr_len[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mvol_ma_len[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m
[38;5;238m1360[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mrisk_pct[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108msl_atr_mult[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mtp_atr_mult[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mleverage[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m,[0m
[38;5;238m1361[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[3;38;2;255;184;108mmax_order_cap[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mmargin_buffer[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m
[38;5;238m1362[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;248;248;242m->[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m:[0m
[38;5;238m1363[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m
[38;5;238m1364[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Executes the main trading logic for a single cycle.[0m
[38;5;238m1365[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    1. Calculates indicators (Supertrends, ATR, Volume).[0m
[38;5;238m1366[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    2. Analyzes Order Book (conditionally).[0m
[38;5;238m1367[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    3. Gets current position status.[0m
[38;5;238m1368[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    4. Logs current market state.[0m
[38;5;238m1369[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    5. Checks loop-based Stop-Loss / Take-Profit (UNSAFE FOR LIVE SCALPING, default OFF).[0m
[38;5;238m1370[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    6. Checks for entry signals based on dual Supertrend and optional confirmations.[0m
[38;5;238m1371[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    7. Executes entry or exit actions (closing existing position if reversing).[0m
[38;5;238m1372[0m   [38;5;238mâ”‚[0m 
[38;5;238m1373[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    *** WARNING: Contains optional loop-based SL/TP check which is unsuitable for live scalping. ***[0m
[38;5;238m1374[0m   [38;5;238mâ”‚[0m 
[38;5;238m1375[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Args:[0m
[38;5;238m1376[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        exchange (ccxt.Exchange): Initialized CCXT exchange instance.[0m
[38;5;238m1377[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        symbol (str): Trading symbol (e.g., 'BTC/USDT:USDT').[0m
[38;5;238m1378[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        df (pd.DataFrame): DataFrame with fresh OHLCV data.[0m
[38;5;238m1379[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        st_len, st_mult: Primary Supertrend parameters.[0m
[38;5;238m1380[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        cf_st_len, cf_st_mult: Confirmation Supertrend parameters.[0m
[38;5;238m1381[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        atr_len: ATR period for SL/TP calculation.[0m
[38;5;238m1382[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        vol_ma_len: Volume MA period.[0m
[38;5;238m1383[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        risk_pct: Risk per trade percentage.[0m
[38;5;238m1384[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        sl_atr_mult, tp_atr_mult: ATR multipliers for SL/TP.[0m
[38;5;238m1385[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        leverage: Confirmed leverage for the symbol.[0m
[38;5;238m1386[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        max_order_cap: Max USDT order value cap.[0m
[38;5;238m1387[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m        margin_buffer: Buffer for margin check before placing order.[0m
[38;5;238m1388[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    [0m[38;2;98;114;164m"""[0m
[38;5;238m1389[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mcycle_time_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mindex[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;80;250;123mstrftime[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;189;147;249m%Y[0m[38;2;241;250;140m-[0m[38;2;189;147;249m%m[0m[38;2;241;250;140m-[0m[38;2;189;147;249m%d[0m[38;2;241;250;140m [0m[38;2;189;147;249m%H[0m[38;2;241;250;140m:[0m[38;2;189;147;249m%M[0m[38;2;241;250;140m:[0m[38;2;189;147;249m%S[0m[38;2;241;250;140m [0m[38;2;189;147;249m%Z[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mempty[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m"[0m
[38;5;238m1390[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m========== New Check Cycle: [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m | Candle Time: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcycle_time_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m ==========[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1391[0m   [38;5;238mâ”‚[0m 
[38;5;238m1392[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Data Validation ---[0m
[38;5;238m1393[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Ensure sufficient data rows for the longest indicator lookback period + buffer[0m
[38;5;238m1394[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mrequired_rows[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;139;233;253mmax[0m[38;2;248;248;242m([0m[38;2;248;248;242mst_len[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mcf_st_len[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242matr_len[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mvol_ma_len[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m+[0m[38;2;248;248;242m [0m[38;2;189;147;249m5[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Add a small buffer[0m
[38;5;238m1395[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;139;233;253mlen[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m<[0m[38;2;248;248;242m [0m[38;2;248;248;242mrequired_rows[0m[38;2;248;248;242m:[0m
[38;5;238m1396[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: Insufficient data ([0m[38;2;248;248;242m{[0m[38;2;139;233;253mlen[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m}[0m[38;2;241;250;140m rows, [0m[38;2;241;250;140m"[0m
[38;5;238m1397[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                       [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mneed at least [0m[38;2;248;248;242m{[0m[38;2;248;248;242mrequired_rows[0m[38;2;248;248;242m}[0m[38;2;241;250;140m for indicators). Skipping logic cycle.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1398[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m
[38;5;238m1399[0m   [38;5;238mâ”‚[0m 
[38;5;238m1400[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Initialize variables[0m
[38;5;238m1401[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mob_data[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[38;2;248;248;242mDict[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m, [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m][0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1402[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1403[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242maction_taken_this_cycle[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mbool[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Flag to track if an order was placed/closed[0m
[38;5;238m1404[0m   [38;5;238mâ”‚[0m 
[38;5;238m1405[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m1406[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m === 1. Calculate Indicators ===[0m
[38;5;238m1407[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: Calculating technical indicators...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1408[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Calculate Primary Supertrend[0m
[38;5;238m1409[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mcalculate_supertrend[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mst_len[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mst_mult[0m[38;2;248;248;242m)[0m
[38;5;238m1410[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Calculate Confirmation Supertrend[0m
[38;5;238m1411[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mdf[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mcalculate_supertrend[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mcf_st_len[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mcf_st_mult[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mprefix[0m[38;2;255;121;198m=[0m[38;2;241;250;140m"[0m[38;2;241;250;140mconfirm_[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1412[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Calculate ATR (for SL/TP) and Volume metrics[0m
[38;5;238m1413[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mvol_atr_data[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123manalyze_volume_atr[0m[38;2;248;248;242m([0m[38;2;248;248;242mdf[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242matr_len[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mvol_ma_len[0m[38;2;248;248;242m)[0m
[38;5;238m1414[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mvol_atr_data[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140matr[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1415[0m   [38;5;238mâ”‚[0m 
[38;5;238m1416[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Validate Indicator Results ---[0m
[38;5;238m1417[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Check if essential columns exist and the last row has valid values[0m
[38;5;238m1418[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mrequired_indicator_cols[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mclose[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140msupertrend[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mtrend[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mst_long[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mst_short[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m
[38;5;238m1419[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                                   [0m[38;2;241;250;140m'[0m[38;2;241;250;140mconfirm_supertrend[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mconfirm_trend[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m
[38;5;238m1420[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;139;233;253mall[0m[38;2;248;248;242m([0m[38;2;248;248;242mcol[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242mcolumns[0m[38;2;248;248;242m [0m[38;2;255;121;198mfor[0m[38;2;248;248;242m [0m[38;2;248;248;242mcol[0m[38;2;248;248;242m [0m[38;2;255;121;198min[0m[38;2;248;248;242m [0m[38;2;248;248;242mrequired_indicator_cols[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m1421[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: One or more required indicator columns missing after calculation. Skipping cycle.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1422[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;255;121;198mreturn[0m
[38;5;238m1423[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m[38;2;248;248;242m[[0m[38;2;248;248;242mrequired_indicator_cols[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;80;250;123misnull[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123many[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m1424[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: Indicator calculation resulted in NA values for the latest candle. Skipping cycle.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1425[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mNA Values in last row:[0m[38;2;255;121;198m\n[0m[38;2;248;248;242m{[0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m[38;2;248;248;242m[[0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m[38;2;255;121;198m.[0m[38;2;80;250;123misnull[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m][0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1426[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;255;121;198mreturn[0m
[38;5;238m1427[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Validate ATR specifically, as it's crucial for risk management[0m
[38;5;238m1428[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m:[0m
[38;5;238m1429[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: Invalid ATR ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) calculated. Cannot determine SL/TP. Skipping cycle.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1430[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;255;121;198mreturn[0m
[38;5;238m1431[0m   [38;5;238mâ”‚[0m 
[38;5;238m1432[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m === Extract Data from the Last Closed Candle ===[0m
[38;5;238m1433[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlast_candle[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf[0m[38;2;255;121;198m.[0m[38;2;248;248;242miloc[0m[38;2;248;248;242m[[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m][0m
[38;5;238m1434[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mcurrent_price[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_candle[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mclose[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Price at the close of the last candle[0m
[38;5;238m1435[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mprimary_st_val[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_candle[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140msupertrend[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m
[38;5;238m1436[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mprimary_trend_up[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mbool[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_candle[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mtrend[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m
[38;5;238m1437[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mprimary_long_signal[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mbool[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_candle[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mst_long[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Primary ST flipped Long THIS candle[0m
[38;5;238m1438[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mprimary_short_signal[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mbool[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_candle[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mst_short[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Primary ST flipped Short THIS candle[0m
[38;5;238m1439[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mconfirm_st_val[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_candle[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mconfirm_supertrend[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m
[38;5;238m1440[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mconfirm_trend_up[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mbool[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mlast_candle[0m[38;2;248;248;242m[[0m[38;2;241;250;140m"[0m[38;2;241;250;140mconfirm_trend[0m[38;2;241;250;140m"[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Current state of Confirmation ST trend[0m
[38;5;238m1441[0m   [38;5;238mâ”‚[0m 
[38;5;238m1442[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m === 2. Analyze Order Book (Conditionally) ===[0m
[38;5;238m1443[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Fetch OB if configured to do so every cycle OR if a primary signal just occurred (potential entry)[0m
[38;5;238m1444[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;255;255mFETCH_ORDER_BOOK_PER_CYCLE[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mprimary_long_signal[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mprimary_short_signal[0m[38;2;248;248;242m:[0m
[38;5;238m1445[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: Fetching and analyzing order book...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1446[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mob_data[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123manalyze_order_book[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mORDER_BOOK_DEPTH[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mORDER_BOOK_FETCH_LIMIT[0m[38;2;248;248;242m)[0m
[38;5;238m1447[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1448[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: Order book fetch skipped (FETCH_PER_CYCLE=False and no primary signal generated this candle).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1449[0m   [38;5;238mâ”‚[0m 
[38;5;238m1450[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m === 3. Get Current Position Status ===[0m
[38;5;238m1451[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m This fetches the live position state from the exchange[0m
[38;5;238m1452[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mposition[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mget_current_position[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m)[0m
[38;5;238m1453[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mside[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m
[38;5;238m1454[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mposition_qty[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mqty[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m
[38;5;238m1455[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mentry_price[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mfloat[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mentry_price[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m
[38;5;238m1456[0m   [38;5;238mâ”‚[0m 
[38;5;238m1457[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m === 4. Log Current State ===[0m
[38;5;238m1458[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Prepare formatted strings for logging, handling None values[0m
[38;5;238m1459[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mvolume_ratio[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mvol_atr_data[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mvolume_ratio[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1460[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mvolume_spike[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mvolume_ratio[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mvolume_ratio[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;255;255;255mVOLUME_SPIKE_THRESHOLD[0m
[38;5;238m1461[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mbid_ask_ratio[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mob_data[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mbid_ask_ratio[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mob_data[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1462[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mspread_val[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mob_data[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mspread[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mob_data[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1463[0m   [38;5;238mâ”‚[0m 
[38;5;238m1464[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242matr_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_atr[0m[38;2;189;147;249m:.5f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m
[38;5;238m1465[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mvol_ratio_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mvolume_ratio[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mvolume_ratio[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m'[0m
[38;5;238m1466[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mvol_spike_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mvolume_spike[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mvolume_ratio[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m'[0m
[38;5;238m1467[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mbid_ask_ratio_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mbid_ask_ratio[0m[38;2;189;147;249m:.3f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mbid_ask_ratio[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m'[0m
[38;5;238m1468[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mspread_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;248;248;242m{[0m[38;2;248;248;242mspread_val[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mspread_val[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m'[0m
[38;5;238m1469[0m   [38;5;238mâ”‚[0m 
[38;5;238m1470[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mState | Price: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, ATR([0m[38;2;248;248;242m{[0m[38;2;248;248;242matr_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): [0m[38;2;248;248;242m{[0m[38;2;248;248;242matr_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1471[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mState | Volume: Ratio=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mvol_ratio_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Spike=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mvol_spike_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (Thr=[0m[38;2;248;248;242m{[0m[38;2;255;255;255mVOLUME_SPIKE_THRESHOLD[0m[38;2;189;147;249m:.1f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1472[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mState | ST([0m[38;2;248;248;242m{[0m[38;2;248;248;242mst_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m,[0m[38;2;248;248;242m{[0m[38;2;248;248;242mst_mult[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): [0m[38;2;248;248;242m{[0m[38;2;241;250;140m'[0m[38;2;241;250;140mUp[0m[38;2;241;250;140m'[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mprimary_trend_up[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mDown[0m[38;2;241;250;140m'[0m[38;2;248;248;242m}[0m[38;2;241;250;140m ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mprimary_st_val[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) | Signal: [0m[38;2;248;248;242m{[0m[38;2;241;250;140m'[0m[38;2;241;250;140mLONG[0m[38;2;241;250;140m'[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mprimary_long_signal[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mSHORT[0m[38;2;241;250;140m'[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mprimary_short_signal[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mNone[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1473[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mState | ConfirmST([0m[38;2;248;248;242m{[0m[38;2;248;248;242mcf_st_len[0m[38;2;248;248;242m}[0m[38;2;241;250;140m,[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcf_st_mult[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): [0m[38;2;248;248;242m{[0m[38;2;241;250;140m'[0m[38;2;241;250;140mUp[0m[38;2;241;250;140m'[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mconfirm_trend_up[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mDown[0m[38;2;241;250;140m'[0m[38;2;248;248;242m}[0m[38;2;241;250;140m ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mconfirm_st_val[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1474[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mState | OrderBook(D[0m[38;2;248;248;242m{[0m[38;2;255;255;255mORDER_BOOK_DEPTH[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): Ratio=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mbid_ask_ratio_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Spread=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mspread_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1475[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mState | Position: Side=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Qty=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mposition_qty[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Entry=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mentry_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1476[0m   [38;5;238mâ”‚[0m 
[38;5;238m1477[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m === 5. Check Stop-Loss / Take-Profit (Loop-based - HIGH RISK / INACCURATE / DEFAULT OFF) ===[0m
[38;5;238m1478[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;255;255mENABLE_LOOP_SLTP_CHECK[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m!=[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_NONE[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m:[0m
[38;5;238m1479[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m!!! Trade Logic: Checking active position SL/TP based on LAST CLOSED PRICE (LOOP CHECK - UNSAFE FOR SCALPING) !!![0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1480[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242msl_triggered[0m[38;2;248;248;242m, [0m[38;2;248;248;242mtp_triggered[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m[38;2;248;248;242m, [0m[38;2;189;147;249mFalse[0m
[38;5;238m1481[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mstop_price[0m[38;2;248;248;242m, [0m[38;2;248;248;242mprofit_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m, [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m
[38;5;238m1482[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242msl_distance[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;248;248;242msl_atr_mult[0m
[38;5;238m1483[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mtp_distance[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;248;248;242mtp_atr_mult[0m
[38;5;238m1484[0m   [38;5;238mâ”‚[0m 
[38;5;238m1485[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_LONG[0m[38;2;248;248;242m:[0m
[38;5;238m1486[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mstop_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m-[0m[38;2;248;248;242m [0m[38;2;248;248;242msl_distance[0m
[38;5;238m1487[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mprofit_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m+[0m[38;2;248;248;242m [0m[38;2;248;248;242mtp_distance[0m
[38;5;238m1488[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSL/TP Check (Long): Entry=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mentry_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, CurrentClose=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Target SL=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mstop_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Target TP=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mprofit_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1489[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;248;248;242mstop_price[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242msl_triggered[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m
[38;5;238m1490[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m>=[0m[38;2;248;248;242m [0m[38;2;248;248;242mprofit_price[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mtp_triggered[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m
[38;5;238m1491[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198melif[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_SHORT[0m[38;2;248;248;242m:[0m
[38;5;238m1492[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mstop_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m+[0m[38;2;248;248;242m [0m[38;2;248;248;242msl_distance[0m
[38;5;238m1493[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mprofit_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mentry_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m-[0m[38;2;248;248;242m [0m[38;2;248;248;242mtp_distance[0m
[38;5;238m1494[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSL/TP Check (Short): Entry=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mentry_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, CurrentClose=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Target SL=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mstop_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Target TP=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mprofit_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1495[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m>=[0m[38;2;248;248;242m [0m[38;2;248;248;242mstop_price[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242msl_triggered[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m
[38;5;238m1496[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_price[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;248;248;242mprofit_price[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mtp_triggered[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m
[38;5;238m1497[0m   [38;5;238mâ”‚[0m 
[38;5;238m1498[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Execute Close if SL/TP Triggered by this Inaccurate Loop Check ---[0m
[38;5;238m1499[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242msl_triggered[0m[38;2;248;248;242m:[0m
[38;5;238m1500[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mreason[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSL Loop @ [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (Target ~ [0m[38;2;248;248;242m{[0m[38;2;248;248;242mstop_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m
[38;5;238m1501[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m*** TRADE EXIT (LOOP CHECK): STOP-LOSS TRIGGERED! ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mreason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Closing [0m[38;2;248;248;242m{[0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. ***[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1502[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m!!! THIS SL TRIGGER IS BASED ON DELAYED CHECK - ACTUAL LOSS MAY BE SIGNIFICANTLY HIGHER !!![0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1503[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Pass the 'position' dict we got at the start of the cycle for info, but close_position re-validates[0m
[38;5;238m1504[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mclose_result[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mclose_position[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mreason[0m[38;2;255;121;198m=[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSL (Loop Check)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1505[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mclose_result[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242maction_taken_this_cycle[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m
[38;5;238m1506[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Exit logic for this cycle after attempting close, regardless of success[0m
[38;5;238m1507[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m because the condition was met. Prevents trying to enter immediately after SL.[0m
[38;5;238m1508[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mreturn[0m
[38;5;238m1509[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198melif[0m[38;2;248;248;242m [0m[38;2;248;248;242mtp_triggered[0m[38;2;248;248;242m:[0m
[38;5;238m1510[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mreason[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTP Loop @ [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (Target ~ [0m[38;2;248;248;242m{[0m[38;2;248;248;242mprofit_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m
[38;5;238m1511[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123msuccess[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m*** TRADE EXIT (LOOP CHECK): TAKE-PROFIT TRIGGERED! ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mreason[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Closing [0m[38;2;248;248;242m{[0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. ***[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1512[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m!!! TAKE PROFIT VIA LOOP CHECK MAY MISS BETTER FILLS OR EXPERIENCE SLIPPAGE !!![0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1513[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mclose_result[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mclose_position[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mreason[0m[38;2;255;121;198m=[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTP (Loop Check)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1514[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mclose_result[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242maction_taken_this_cycle[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m
[38;5;238m1515[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Exit logic for this cycle after attempting close[0m
[38;5;238m1516[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mreturn[0m
[38;5;238m1517[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1518[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: Position SL/TP not triggered based on last close price (Loop Check).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1519[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melif[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m!=[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_NONE[0m[38;2;248;248;242m:[0m
[38;5;238m1520[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log if position exists but SL/TP check couldn't run (e.g., bad entry price or ATR or disabled)[0m
[38;5;238m1521[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;255;255mENABLE_LOOP_SLTP_CHECK[0m[38;2;248;248;242m:[0m
[38;5;238m1522[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: Position ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) exists but loop-based SL/TP check skipped (Entry=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mentry_price[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, ATR=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m}[0m[38;2;241;250;140m).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1523[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1524[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: Loop-based SL/TP check is disabled (ENABLE_LOOP_SLTP_CHECK=False).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1525[0m   [38;5;238mâ”‚[0m 
[38;5;238m1526[0m   [38;5;238mâ”‚[0m 
[38;5;238m1527[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m === 6. Check for Entry Signals ===[0m
[38;5;238m1528[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Only proceed if no SL/TP exit was triggered above[0m
[38;5;238m1529[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: Checking entry signals...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1530[0m   [38;5;238mâ”‚[0m 
[38;5;238m1531[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Define Confirmation Conditions ---[0m
[38;5;238m1532[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Order Book Confirmation (only if required and data is available)[0m
[38;5;238m1533[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mob_check_required[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;255;255;255mFETCH_ORDER_BOOK_PER_CYCLE[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m If True, we need OB data every time[0m
[38;5;238m1534[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mob_available[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mob_data[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mbid_ask_ratio[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1535[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mpasses_long_ob[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mob_check_required[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242mob_available[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mbid_ask_ratio[0m[38;2;248;248;242m [0m[38;2;255;121;198m>=[0m[38;2;248;248;242m [0m[38;2;255;255;255mORDER_BOOK_RATIO_THRESHOLD_LONG[0m[38;2;248;248;242m)[0m
[38;5;238m1536[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mpasses_short_ob[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mob_check_required[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242mob_available[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mbid_ask_ratio[0m[38;2;248;248;242m [0m[38;2;255;121;198m<=[0m[38;2;248;248;242m [0m[38;2;255;255;255mORDER_BOOK_RATIO_THRESHOLD_SHORT[0m[38;2;248;248;242m)[0m
[38;5;238m1537[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mob_log_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRatio=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mbid_ask_ratio_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (LongThr=[0m[38;2;248;248;242m{[0m[38;2;255;255;255mORDER_BOOK_RATIO_THRESHOLD_LONG[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, ShortThr=[0m[38;2;248;248;242m{[0m[38;2;255;255;255mORDER_BOOK_RATIO_THRESHOLD_SHORT[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Required=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mob_check_required[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m
[38;5;238m1538[0m   [38;5;238mâ”‚[0m 
[38;5;238m1539[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Volume Confirmation (only if required and data is available)[0m
[38;5;238m1540[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mvolume_check_required[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;255;255;255mREQUIRE_VOLUME_SPIKE_FOR_ENTRY[0m
[38;5;238m1541[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mvolume_available[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mvolume_ratio[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Need ratio to check spike[0m
[38;5;238m1542[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mpasses_volume[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mvolume_check_required[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242mvolume_available[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mvolume_spike[0m[38;2;248;248;242m)[0m
[38;5;238m1543[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mvol_log_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRatio=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mvol_ratio_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Spike=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mvol_spike_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (Required=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mvolume_check_required[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m
[38;5;238m1544[0m   [38;5;238mâ”‚[0m 
[38;5;238m1545[0m   [38;5;238mâ”‚[0m 
[38;5;238m1546[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Long Entry Condition ---[0m
[38;5;238m1547[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242menter_long[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m
[38;5;238m1548[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m!=[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_LONG[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m          [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Prevent adding to existing long[0m
[38;5;238m1549[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mprimary_long_signal[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m                          [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Primary ST must have flipped Long THIS candle[0m
[38;5;238m1550[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mconfirm_trend_up[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m                             [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Confirmation ST trend must be Up (agreement)[0m
[38;5;238m1551[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mpasses_long_ob[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m                               [0m[38;2;98;114;164m#[0m[38;2;98;114;164m OB condition met (or not required)[0m
[38;5;238m1552[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mpasses_volume[0m[38;2;248;248;242m                                    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Volume condition met (or not required)[0m
[38;5;238m1553[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242m)[0m
[38;5;238m1554[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mEntry Check (Long): PrimaryFlip=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mprimary_long_signal[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, ConfirmTrendUp=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mconfirm_trend_up[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, [0m[38;2;241;250;140m"[0m
[38;5;238m1555[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                     [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mOB OK=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mpasses_long_ob[0m[38;2;248;248;242m}[0m[38;2;241;250;140m [[0m[38;2;248;248;242m{[0m[38;2;248;248;242mob_log_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m], Vol OK=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mpasses_volume[0m[38;2;248;248;242m}[0m[38;2;241;250;140m [[0m[38;2;248;248;242m{[0m[38;2;248;248;242mvol_log_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] [0m[38;2;241;250;140m"[0m
[38;5;238m1556[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                     [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m=> Enter Long = [0m[38;2;248;248;242m{[0m[38;2;248;248;242menter_long[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1557[0m   [38;5;238mâ”‚[0m 
[38;5;238m1558[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Short Entry Condition ---[0m
[38;5;238m1559[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242menter_short[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m
[38;5;238m1560[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m!=[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_SHORT[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m         [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Prevent adding to existing short[0m
[38;5;238m1561[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mprimary_short_signal[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m                         [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Primary ST must have flipped Short THIS candle[0m
[38;5;238m1562[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mconfirm_trend_up[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m                         [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Confirmation ST trend must be Down (agreement)[0m
[38;5;238m1563[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mpasses_short_ob[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m                              [0m[38;2;98;114;164m#[0m[38;2;98;114;164m OB condition met (or not required)[0m
[38;5;238m1564[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mpasses_volume[0m[38;2;248;248;242m                                    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Volume condition met (or not required)[0m
[38;5;238m1565[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242m)[0m
[38;5;238m1566[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mEntry Check (Short): PrimaryFlip=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mprimary_short_signal[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, ConfirmTrendDown=[0m[38;2;248;248;242m{[0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mconfirm_trend_up[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, [0m[38;2;241;250;140m"[0m
[38;5;238m1567[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                      [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mOB OK=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mpasses_short_ob[0m[38;2;248;248;242m}[0m[38;2;241;250;140m [[0m[38;2;248;248;242m{[0m[38;2;248;248;242mob_log_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m], Vol OK=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mpasses_volume[0m[38;2;248;248;242m}[0m[38;2;241;250;140m [[0m[38;2;248;248;242m{[0m[38;2;248;248;242mvol_log_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] [0m[38;2;241;250;140m"[0m
[38;5;238m1568[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                      [0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m=> Enter Short = [0m[38;2;248;248;242m{[0m[38;2;248;248;242menter_short[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1569[0m   [38;5;238mâ”‚[0m 
[38;5;238m1570[0m   [38;5;238mâ”‚[0m 
[38;5;238m1571[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m === 7. Execute Entry / Reversal Actions ===[0m
[38;5;238m1572[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242menter_long[0m[38;2;248;248;242m:[0m
[38;5;238m1573[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123msuccess[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m*** TRADE SIGNAL: CONFIRMED LONG ENTRY SIGNAL for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m at ~[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m ***[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1574[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_SHORT[0m[38;2;248;248;242m:[0m
[38;5;238m1575[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Reversal: Close Short, then Enter Long ---[0m
[38;5;238m1576[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Action: LONG signal received while SHORT. Attempting REVERSAL.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1577[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m 1. Close the existing short position[0m
[38;5;238m1578[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal Step 1: Closing existing SHORT position...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1579[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mclose_result[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mclose_position[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mreason[0m[38;2;255;121;198m=[0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal to Long[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1580[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242maction_taken_this_cycle[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Attempted an action[0m
[38;5;238m1581[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mclose_result[0m[38;2;248;248;242m:[0m
[38;5;238m1582[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal Step 1: Close SHORT order placed. Waiting [0m[38;2;248;248;242m{[0m[38;2;255;255;255mPOST_CLOSE_DELAY_SECONDS[0m[38;2;248;248;242m}[0m[38;2;241;250;140ms...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1583[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mtime[0m[38;2;255;121;198m.[0m[38;2;80;250;123msleep[0m[38;2;248;248;242m([0m[38;2;255;255;255mPOST_CLOSE_DELAY_SECONDS[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Allow time for closure to process/API update[0m
[38;5;238m1584[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m 2. Re-check position state AFTER attempting close[0m
[38;5;238m1585[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal Step 2: Re-checking position status after close attempt...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1586[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mcurrent_pos_after_close[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mget_current_position[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m)[0m
[38;5;238m1587[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_pos_after_close[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mside[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_NONE[0m[38;2;248;248;242m:[0m
[38;5;238m1588[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123msuccess[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal Step 2: Confirmed SHORT position closed.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1589[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m 3. Enter the new long position[0m
[38;5;238m1590[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal Step 3: Proceeding with LONG entry.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1591[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;80;250;123mplace_risked_market_order[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mSIDE_BUY[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mrisk_pct[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msl_atr_mult[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mleverage[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mmax_order_cap[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mmargin_buffer[0m[38;2;248;248;242m)[0m
[38;5;238m1592[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1593[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal Step 2: Failed to confirm SHORT position closure after reversal signal (Still showing: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_pos_after_close[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mside[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Skipping LONG entry.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1594[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1595[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                     [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal Step 1: Failed to place order to close SHORT position. Skipping LONG entry.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1596[0m   [38;5;238mâ”‚[0m 
[38;5;238m1597[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198melif[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_NONE[0m[38;2;248;248;242m:[0m
[38;5;238m1598[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- New Entry: Enter Long ---[0m
[38;5;238m1599[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Action: Entering NEW LONG position.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1600[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mplace_result[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mplace_risked_market_order[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mSIDE_BUY[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mrisk_pct[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msl_atr_mult[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mleverage[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mmax_order_cap[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mmargin_buffer[0m[38;2;248;248;242m)[0m
[38;5;238m1601[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mplace_result[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242maction_taken_this_cycle[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m
[38;5;238m1602[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1603[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Should not happen if enter_long condition is correct, but as a safeguard:[0m
[38;5;238m1604[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Action: Signal LONG ignored (already long? Check logic).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1605[0m   [38;5;238mâ”‚[0m 
[38;5;238m1606[0m   [38;5;238mâ”‚[0m 
[38;5;238m1607[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melif[0m[38;2;248;248;242m [0m[38;2;248;248;242menter_short[0m[38;2;248;248;242m:[0m
[38;5;238m1608[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123msuccess[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m*** TRADE SIGNAL: CONFIRMED SHORT ENTRY SIGNAL for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m at ~[0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_price[0m[38;2;189;147;249m:.4f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m ***[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1609[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_LONG[0m[38;2;248;248;242m:[0m
[38;5;238m1610[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Reversal: Close Long, then Enter Short ---[0m
[38;5;238m1611[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Action: SHORT signal received while LONG. Attempting REVERSAL.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1612[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m 1. Close the existing long position[0m
[38;5;238m1613[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal Step 1: Closing existing LONG position...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1614[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mclose_result[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mclose_position[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mreason[0m[38;2;255;121;198m=[0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal to Short[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1615[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242maction_taken_this_cycle[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Attempted an action[0m
[38;5;238m1616[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mclose_result[0m[38;2;248;248;242m:[0m
[38;5;238m1617[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal Step 1: Close LONG order placed. Waiting [0m[38;2;248;248;242m{[0m[38;2;255;255;255mPOST_CLOSE_DELAY_SECONDS[0m[38;2;248;248;242m}[0m[38;2;241;250;140ms...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1618[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mtime[0m[38;2;255;121;198m.[0m[38;2;80;250;123msleep[0m[38;2;248;248;242m([0m[38;2;255;255;255mPOST_CLOSE_DELAY_SECONDS[0m[38;2;248;248;242m)[0m
[38;5;238m1619[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m 2. Re-check position state AFTER attempting close[0m
[38;5;238m1620[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal Step 2: Re-checking position status after close attempt...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1621[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mcurrent_pos_after_close[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mget_current_position[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m)[0m
[38;5;238m1622[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_pos_after_close[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mside[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_NONE[0m[38;2;248;248;242m:[0m
[38;5;238m1623[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123msuccess[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal Step 2: Confirmed LONG position closed.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1624[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m 3. Enter the new short position[0m
[38;5;238m1625[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal Step 3: Proceeding with SHORT entry.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1626[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;80;250;123mplace_risked_market_order[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mSIDE_SELL[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mrisk_pct[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msl_atr_mult[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mleverage[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mmax_order_cap[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mmargin_buffer[0m[38;2;248;248;242m)[0m
[38;5;238m1627[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1628[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal Step 2: Failed to confirm LONG position closure after reversal signal (Still showing: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcurrent_pos_after_close[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mside[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Skipping SHORT entry.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1629[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1630[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mReversal Step 1: Failed to place order to close LONG position. Skipping SHORT entry.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1631[0m   [38;5;238mâ”‚[0m 
[38;5;238m1632[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198melif[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_NONE[0m[38;2;248;248;242m:[0m
[38;5;238m1633[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- New Entry: Enter Short ---[0m
[38;5;238m1634[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Action: Entering NEW SHORT position.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1635[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mplace_result[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mplace_risked_market_order[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mSIDE_SELL[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mrisk_pct[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mcurrent_atr[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msl_atr_mult[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mleverage[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mmax_order_cap[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mmargin_buffer[0m[38;2;248;248;242m)[0m
[38;5;238m1636[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mplace_result[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242maction_taken_this_cycle[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m
[38;5;238m1637[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1638[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Safeguard[0m
[38;5;238m1639[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Action: Signal SHORT ignored (already short? Check logic).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1640[0m   [38;5;238mâ”‚[0m 
[38;5;238m1641[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1642[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m No entry signal this cycle[0m
[38;5;238m1643[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242maction_taken_this_cycle[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Only log 'no signal' if no other action (like SL/TP close) happened[0m
[38;5;238m1644[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_NONE[0m[38;2;248;248;242m:[0m
[38;5;238m1645[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: No confirmed entry signal and no active position. Holding cash.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1646[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1647[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                     [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: Holding [0m[38;2;248;248;242m{[0m[38;2;248;248;242mposition_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m position. No new entry or exit signal this cycle.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1648[0m   [38;5;238mâ”‚[0m 
[38;5;238m1649[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1650[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Catch-all for unexpected errors within the main logic block[0m
[38;5;238m1651[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrade Logic: CRITICAL UNEXPECTED ERROR during cycle execution for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1652[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m1653[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Consider sending an SMS alert for critical logic failures[0m
[38;5;238m1654[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;255;121;198m.[0m[38;2;80;250;123msplit[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140m/[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m[[0m[38;2;189;147;249m0[0m[38;2;248;248;242m][0m[38;2;248;248;242m}[0m[38;2;241;250;140m] CRITICAL ERROR in trade_logic: [0m[38;2;248;248;242m{[0m[38;2;139;233;253mtype[0m[38;2;248;248;242m([0m[38;2;248;248;242me[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;248;248;242m__name__[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Check logs![0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1655[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mfinally[0m[38;2;248;248;242m:[0m
[38;5;238m1656[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log end of cycle regardless of outcome[0m
[38;5;238m1657[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m========== Cycle Check End: [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m ==========[0m[38;2;255;121;198m\n[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1658[0m   [38;5;238mâ”‚[0m 
[38;5;238m1659[0m   [38;5;238mâ”‚[0m 
[38;5;238m1660[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Graceful Shutdown ---[0m
[38;5;238m1661[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123mgraceful_shutdown[0m[38;2;248;248;242m([0m[3;38;2;255;184;108mexchange[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[38;2;248;248;242mccxt[0m[38;2;255;121;198m.[0m[38;2;248;248;242mExchange[0m[38;2;248;248;242m][0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108msymbol[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m][0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;248;248;242m->[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m:[0m
[38;5;238m1662[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m
[38;5;238m1663[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Attempts to close any open position for the given symbol before exiting.[0m
[38;5;238m1664[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Sends SMS alerts about the shutdown process.[0m
[38;5;238m1665[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    [0m[38;2;98;114;164m"""[0m
[38;5;238m1666[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mShutdown requested. Initiating graceful exit sequence...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1667[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;255;121;198m.[0m[38;2;80;250;123msplit[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140m/[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m[[0m[38;2;189;147;249m0[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mBot[0m[38;2;241;250;140m"[0m
[38;5;238m1668[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] Shutdown requested. Attempting to close open position if any.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1669[0m   [38;5;238mâ”‚[0m 
[38;5;238m1670[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m:[0m
[38;5;238m1671[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mGraceful Shutdown: Exchange not initialized or symbol not set. Cannot check or close position.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1672[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mreturn[0m
[38;5;238m1673[0m   [38;5;238mâ”‚[0m 
[38;5;238m1674[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m1675[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mGraceful Shutdown: Checking for active position for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1676[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Use the robust position check function[0m
[38;5;238m1677[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mposition[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mget_current_position[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m)[0m
[38;5;238m1678[0m   [38;5;238mâ”‚[0m 
[38;5;238m1679[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mside[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m!=[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_NONE[0m[38;2;248;248;242m:[0m
[38;5;238m1680[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mpos_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mside[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m
[38;5;238m1681[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mpos_qty[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140mqty[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m
[38;5;238m1682[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mGraceful Shutdown: Active [0m[38;2;248;248;242m{[0m[38;2;248;248;242mpos_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m position found ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mpos_qty[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m). Attempting to close...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1683[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Pass the freshly checked 'position' dict to the close function[0m
[38;5;238m1684[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mclose_result[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mclose_position[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242mposition[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mreason[0m[38;2;255;121;198m=[0m[38;2;241;250;140m"[0m[38;2;241;250;140mShutdown[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1685[0m   [38;5;238mâ”‚[0m 
[38;5;238m1686[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mclose_result[0m[38;2;248;248;242m:[0m
[38;5;238m1687[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mGraceful Shutdown: Close order placed. Waiting briefly for exchange processing...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1688[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Wait a bit longer on shutdown to increase chance of confirmation[0m
[38;5;238m1689[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mtime[0m[38;2;255;121;198m.[0m[38;2;80;250;123msleep[0m[38;2;248;248;242m([0m[38;2;255;255;255mPOST_CLOSE_DELAY_SECONDS[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;189;147;249m2[0m[38;2;248;248;242m)[0m
[38;5;238m1690[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Final Confirmation Check ---[0m
[38;5;238m1691[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mGraceful Shutdown: Performing final position check...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1692[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mfinal_pos_check[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mget_current_position[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m)[0m
[38;5;238m1693[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mfinal_pos_check[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;248;248;242mfinal_pos_check[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mside[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;255;255;255mPOSITION_SIDE_NONE[0m[38;2;248;248;242m:[0m
[38;5;238m1694[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                     [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123msuccess[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mGraceful Shutdown: Position successfully confirmed closed.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1695[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                     [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] Position confirmed CLOSED during shutdown.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1696[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1697[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                     [0m[38;2;248;248;242mfinal_side[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mfinal_pos_check[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mside[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mN/A[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m1698[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                     [0m[38;2;248;248;242mfinal_qty[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mfinal_pos_check[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mqty[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;189;147;249m.[0m[38;2;189;147;249m0[0m[38;2;248;248;242m)[0m
[38;5;238m1699[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                     [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mGraceful Shutdown: FAILED TO CONFIRM position closure after attempting close. Final check showed: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Qty: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_qty[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1700[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                     [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ERROR: Failed to confirm position closure on shutdown! Final state: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_side[0m[38;2;248;248;242m}[0m[38;2;241;250;140m Qty=[0m[38;2;248;248;242m{[0m[38;2;248;248;242mfinal_qty[0m[38;2;189;147;249m:.8f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. MANUAL CHECK REQUIRED.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1701[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1702[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;98;114;164m#[0m[38;2;98;114;164m close_position failed to even place the order[0m
[38;5;238m1703[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mGraceful Shutdown: Failed to place the close order for the active position. MANUAL INTERVENTION REQUIRED.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1704[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                 [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ERROR: Failed to PLACE close order during shutdown. MANUAL CHECK REQUIRED.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1705[0m   [38;5;238mâ”‚[0m 
[38;5;238m1706[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1707[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m No active position found during the check[0m
[38;5;238m1708[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mGraceful Shutdown: No active position found for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. No close action needed.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1709[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] No active position found during shutdown.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1710[0m   [38;5;238mâ”‚[0m 
[38;5;238m1711[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1712[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Catch errors during the shutdown process itself (e.g., API errors during final checks)[0m
[38;5;238m1713[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mGraceful Shutdown: An error occurred during the shutdown process: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1714[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m1715[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] Error during graceful shutdown sequence: [0m[38;2;248;248;242m{[0m[38;2;139;233;253mtype[0m[38;2;248;248;242m([0m[38;2;248;248;242me[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;248;248;242m__name__[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Check logs.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1716[0m   [38;5;238mâ”‚[0m 
[38;5;238m1717[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m--- Scalping Bot Shutdown Complete ---[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1718[0m   [38;5;238mâ”‚[0m 
[38;5;238m1719[0m   [38;5;238mâ”‚[0m 
[38;5;238m1720[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Main Execution ---[0m
[38;5;238m1721[0m   [38;5;238mâ”‚[0m [3;38;2;255;121;198mdef[0m[38;2;248;248;242m [0m[38;2;80;250;123mmain[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;248;248;242m->[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m:[0m
[38;5;238m1722[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m"""[0m
[38;5;238m1723[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    Main function to initialize the exchange connection, set up parameters,[0m
[38;5;238m1724[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    and run the main trading loop. Handles initialization errors and graceful shutdown.[0m
[38;5;238m1725[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m    [0m[38;2;98;114;164m"""[0m
[38;5;238m1726[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mbot_start_time_str[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mtime[0m[38;2;255;121;198m.[0m[38;2;80;250;123mstrftime[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;189;147;249m%Y[0m[38;2;241;250;140m-[0m[38;2;189;147;249m%m[0m[38;2;241;250;140m-[0m[38;2;189;147;249m%d[0m[38;2;241;250;140m [0m[38;2;189;147;249m%H[0m[38;2;241;250;140m:[0m[38;2;189;147;249m%M[0m[38;2;241;250;140m:[0m[38;2;189;147;249m%S[0m[38;2;241;250;140m [0m[38;2;189;147;249m%Z[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m
[38;5;238m1727[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m--- Bybit Scalping Bot Initializing v2.0.0 ([0m[38;2;248;248;242m{[0m[38;2;248;248;242mbot_start_time_str[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) ---[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1728[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m--- !!! LIVE FUTURES SCALPING MODE - EXTREME RISK INVOLVED !!! ---[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1729[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m--- ENSURE ALL PARAMETERS IN .env ARE CORRECTLY SET & TESTED ---[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1730[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;255;255mENABLE_LOOP_SLTP_CHECK[0m[38;2;248;248;242m:[0m
[38;5;238m1731[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m--- *** CRITICAL WARNING: LOOP-BASED SL/TP IS ACTIVE - UNSAFE & INACCURATE FOR LIVE SCALPING *** ---[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1732[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m--- *** YOU MUST IMPLEMENT EXCHANGE-NATIVE CONDITIONAL ORDERS FOR SAFE SL/TP MANAGEMENT *** ---[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1733[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1734[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m--- INFO: Loop-based SL/TP check is DISABLED (Recommended for safety). Use exchange-native orders. ---[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1735[0m   [38;5;238mâ”‚[0m 
[38;5;238m1736[0m   [38;5;238mâ”‚[0m 
[38;5;238m1737[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[38;2;248;248;242mccxt[0m[38;2;255;121;198m.[0m[38;2;248;248;242mExchange[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m
[38;5;238m1738[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;248;248;242mOptional[0m[38;2;248;248;242m[[0m[3;38;2;102;217;239mstr[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Will hold the validated symbol[0m
[38;5;238m1739[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mrun_bot[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mbool[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Flag to control the main loop[0m
[38;5;238m1740[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;248;248;242mcycle_count[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mint[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m
[38;5;238m1741[0m   [38;5;238mâ”‚[0m 
[38;5;238m1742[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m1743[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m === Initialize Exchange ===[0m
[38;5;238m1744[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123minitialize_exchange[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m
[38;5;238m1745[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m:[0m
[38;5;238m1746[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mBot exiting due to exchange initialization failure.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1747[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m SMS alert already sent by initialize_exchange on failure[0m
[38;5;238m1748[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Stop execution[0m
[38;5;238m1749[0m   [38;5;238mâ”‚[0m 
[38;5;238m1750[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m === Setup Trading Symbol and Leverage ===[0m
[38;5;238m1751[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Prompt user or use default, then validate[0m
[38;5;238m1752[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m1753[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mraw_symbol_input[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;139;233;253minput[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mEnter trading symbol (e.g., BTC/USDT:USDT) or press Enter for default [[0m[38;2;248;248;242m{[0m[38;2;255;255;255mDEFAULT_SYMBOL[0m[38;2;248;248;242m}[0m[38;2;241;250;140m]: [0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;80;250;123mstrip[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m
[38;5;238m1754[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242msymbol_to_validate[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mraw_symbol_input[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;255;255;255mDEFAULT_SYMBOL[0m
[38;5;238m1755[0m   [38;5;238mâ”‚[0m 
[38;5;238m1756[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mValidating symbol: [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol_to_validate[0m[38;2;248;248;242m}[0m[38;2;241;250;140m...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1757[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mmarket[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;80;250;123mmarket[0m[38;2;248;248;242m([0m[38;2;248;248;242msymbol_to_validate[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Throws BadSymbol if invalid[0m
[38;5;238m1758[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mmarket[0m[38;2;248;248;242m[[0m[38;2;241;250;140m'[0m[38;2;241;250;140msymbol[0m[38;2;241;250;140m'[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Use the CCXT canonical symbol format[0m
[38;5;238m1759[0m   [38;5;238mâ”‚[0m 
[38;5;238m1760[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Verify it's a contract market (swap/future)[0m
[38;5;238m1761[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mmarket[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mcontract[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mor[0m[38;2;248;248;242m [0m[38;2;248;248;242mmarket[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mspot[0m[38;2;241;250;140m'[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;189;147;249mTrue[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Double check it's not spot[0m
[38;5;238m1762[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mConfiguration Error: Symbol '[0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m' is not a valid SWAP or FUTURES market on [0m[38;2;248;248;242m{[0m[38;2;248;248;242mexchange[0m[38;2;255;121;198m.[0m[38;2;248;248;242mid[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Type: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mtype[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1763[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[ScalpBot] CRITICAL: Symbol [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m is not a contract market. Exiting.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1764[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mreturn[0m
[38;5;238m1765[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSuccessfully validated symbol: [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (Type: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket[0m[38;2;255;121;198m.[0m[38;2;80;250;123mget[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140mtype[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1766[0m   [38;5;238mâ”‚[0m 
[38;5;238m1767[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Set leverage for the validated symbol[0m
[38;5;238m1768[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;80;250;123mset_leverage[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mDEFAULT_LEVERAGE[0m[38;2;248;248;242m)[0m[38;2;248;248;242m:[0m
[38;5;238m1769[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLeverage setup failed for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m after retries. Cannot proceed safely. Exiting.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1770[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m SMS alert potentially sent by set_leverage on final failure[0m
[38;5;238m1771[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;255;121;198m.[0m[38;2;80;250;123msplit[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140m/[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m[[0m[38;2;189;147;249m0[0m[38;2;248;248;242m][0m[38;2;248;248;242m}[0m[38;2;241;250;140m] CRITICAL: Leverage setup FAILED for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Exiting.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1772[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mreturn[0m
[38;5;238m1773[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLeverage confirmed/set to [0m[38;2;248;248;242m{[0m[38;2;255;255;255mDEFAULT_LEVERAGE[0m[38;2;248;248;242m}[0m[38;2;241;250;140mx for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1774[0m   [38;5;238mâ”‚[0m 
[38;5;238m1775[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242m([0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mBadSymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mKeyError[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1776[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mConfiguration Error: Invalid or unsupported symbol '[0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol_to_validate[0m[38;2;248;248;242m}[0m[38;2;241;250;140m'. Error: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1777[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[ScalpBot] CRITICAL: Invalid symbol '[0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol_to_validate[0m[38;2;248;248;242m}[0m[38;2;241;250;140m'. Exiting.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1778[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m
[38;5;238m1779[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1780[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mConfiguration Error: Unexpected error during symbol/leverage setup: [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1781[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m
[38;5;238m1782[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m[ScalpBot] CRITICAL: Symbol/Leverage setup failed unexpectedly. Exiting.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1783[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mreturn[0m
[38;5;238m1784[0m   [38;5;238mâ”‚[0m 
[38;5;238m1785[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m === Log Configuration Summary ===[0m
[38;5;238m1786[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m--- Scalping Bot Configuration Summary ---[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1787[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTrading Pair: [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1788[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTimeframe: [0m[38;2;248;248;242m{[0m[38;2;255;255;255mDEFAULT_INTERVAL[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1789[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mLeverage: [0m[38;2;248;248;242m{[0m[38;2;255;255;255mDEFAULT_LEVERAGE[0m[38;2;248;248;242m}[0m[38;2;241;250;140mx[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1790[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRisk Per Trade: [0m[38;2;248;248;242m{[0m[38;2;255;255;255mRISK_PER_TRADE_PERCENTAGE[0m[38;2;189;147;249m:.3%[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1791[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mMax Position Value (Cap): [0m[38;2;248;248;242m{[0m[38;2;255;255;255mMAX_ORDER_USDT_AMOUNT[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m USDT[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1792[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSL Calculation: [0m[38;2;248;248;242m{[0m[38;2;255;255;255mATR_STOP_LOSS_MULTIPLIER[0m[38;2;248;248;242m}[0m[38;2;241;250;140m * ATR([0m[38;2;248;248;242m{[0m[38;2;255;255;255mATR_CALCULATION_PERIOD[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1793[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;255;255mENABLE_LOOP_SLTP_CHECK[0m[38;2;248;248;242m:[0m
[38;5;238m1794[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mTP Calculation: [0m[38;2;248;248;242m{[0m[38;2;255;255;255mATR_TAKE_PROFIT_MULTIPLIER[0m[38;2;248;248;242m}[0m[38;2;241;250;140m * ATR([0m[38;2;248;248;242m{[0m[38;2;255;255;255mATR_CALCULATION_PERIOD[0m[38;2;248;248;242m}[0m[38;2;241;250;140m) (Loop Check - Unsafe)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1795[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1796[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m             [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mTP Calculation: Loop Check Disabled[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1797[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mPrimary Supertrend: Length=[0m[38;2;248;248;242m{[0m[38;2;255;255;255mDEFAULT_ST_ATR_LENGTH[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Multiplier=[0m[38;2;248;248;242m{[0m[38;2;255;255;255mDEFAULT_ST_MULTIPLIER[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1798[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mConfirmation Supertrend: Length=[0m[38;2;248;248;242m{[0m[38;2;255;255;255mCONFIRM_ST_ATR_LENGTH[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Multiplier=[0m[38;2;248;248;242m{[0m[38;2;255;255;255mCONFIRM_ST_MULTIPLIER[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1799[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mVolume Analysis: MA=[0m[38;2;248;248;242m{[0m[38;2;255;255;255mVOLUME_MA_PERIOD[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Spike > [0m[38;2;248;248;242m{[0m[38;2;255;255;255mVOLUME_SPIKE_THRESHOLD[0m[38;2;248;248;242m}[0m[38;2;241;250;140mx MA (Required for Entry: [0m[38;2;248;248;242m{[0m[38;2;255;255;255mREQUIRE_VOLUME_SPIKE_FOR_ENTRY[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1800[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mOrder Book Analysis: Depth=[0m[38;2;248;248;242m{[0m[38;2;255;255;255mORDER_BOOK_DEPTH[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Long Ratio >= [0m[38;2;248;248;242m{[0m[38;2;255;255;255mORDER_BOOK_RATIO_THRESHOLD_LONG[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Short Ratio <= [0m[38;2;248;248;242m{[0m[38;2;255;255;255mORDER_BOOK_RATIO_THRESHOLD_SHORT[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1801[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mFetch Order Book Every Cycle: [0m[38;2;248;248;242m{[0m[38;2;255;255;255mFETCH_ORDER_BOOK_PER_CYCLE[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1802[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mMargin Check Buffer: [0m[38;2;248;248;242m{[0m[38;2;255;255;255mREQUIRED_MARGIN_BUFFER[0m[38;2;189;147;249m:.1%[0m[38;2;248;248;242m}[0m[38;2;241;250;140m (Requires [0m[38;2;248;248;242m{[0m[38;2;248;248;242m([0m[38;2;255;255;255mREQUIRED_MARGIN_BUFFER[0m[38;2;255;121;198m-[0m[38;2;189;147;249m1[0m[38;2;248;248;242m)[0m[38;2;255;121;198m*[0m[38;2;189;147;249m100[0m[38;2;189;147;249m:.1f[0m[38;2;248;248;242m}[0m[38;2;241;250;140m% extra free margin)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1803[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mCheck Interval (Sleep): [0m[38;2;248;248;242m{[0m[38;2;255;255;255mDEFAULT_SLEEP_SECONDS[0m[38;2;248;248;242m}[0m[38;2;241;250;140m seconds[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1804[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mSMS Alerts Enabled: [0m[38;2;248;248;242m{[0m[38;2;255;255;255mENABLE_SMS_ALERTS[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Recipient: [0m[38;2;248;248;242m{[0m[38;2;241;250;140m'[0m[38;2;241;250;140mSet[0m[38;2;241;250;140m'[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;255;255mSMS_RECIPIENT_NUMBER[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m'[0m[38;2;241;250;140mNot Set[0m[38;2;241;250;140m'[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, Timeout: [0m[38;2;248;248;242m{[0m[38;2;255;255;255mSMS_TIMEOUT_SECONDS[0m[38;2;248;248;242m}[0m[38;2;241;250;140ms[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1805[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mACTION REQUIRED: Review this configuration carefully. Does it align with your strategy and risk tolerance?[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1806[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;255;255mENABLE_LOOP_SLTP_CHECK[0m[38;2;248;248;242m:[0m
[38;5;238m1807[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mRISK WARNING: Loop-based SL/TP check is ACTIVE, INACCURATE & UNSAFE for live scalping.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1808[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mCurrent Logging Level: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetLevelName[0m[38;2;248;248;242m([0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;248;248;242mlevel[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1809[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m------------------------------------------[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1810[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Send startup confirmation SMS[0m
[38;5;238m1811[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;255;121;198m.[0m[38;2;80;250;123msplit[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140m/[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m[[0m[38;2;189;147;249m0[0m[38;2;248;248;242m][0m
[38;5;238m1812[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242msl_tp_status[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mLoop-based SL/TP ACTIVE (HIGH RISK)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;255;255mENABLE_LOOP_SLTP_CHECK[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mLoop SL/TP Disabled[0m[38;2;241;250;140m"[0m
[38;5;238m1813[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[ScalpBot] Configured for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m ([0m[38;2;248;248;242m{[0m[38;2;255;255;255mDEFAULT_INTERVAL[0m[38;2;248;248;242m}[0m[38;2;241;250;140m, [0m[38;2;248;248;242m{[0m[38;2;255;255;255mDEFAULT_LEVERAGE[0m[38;2;248;248;242m}[0m[38;2;241;250;140mx). [0m[38;2;248;248;242m{[0m[38;2;248;248;242msl_tp_status[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Starting main loop.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1814[0m   [38;5;238mâ”‚[0m 
[38;5;238m1815[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m === Main Trading Loop ===[0m
[38;5;238m1816[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;255;121;198mwhile[0m[38;2;248;248;242m [0m[38;2;248;248;242mrun_bot[0m[38;2;248;248;242m:[0m
[38;5;238m1817[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mcycle_start_time[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mtime[0m[38;2;255;121;198m.[0m[38;2;80;250;123mmonotonic[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Use monotonic clock for interval timing[0m
[38;5;238m1818[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mcycle_count[0m[38;2;248;248;242m [0m[38;2;255;121;198m+=[0m[38;2;248;248;242m [0m[38;2;189;147;249m1[0m
[38;5;238m1819[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m--- Cycle [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcycle_count[0m[38;2;248;248;242m}[0m[38;2;241;250;140m Start: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mtime[0m[38;2;255;121;198m.[0m[38;2;80;250;123mstrftime[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;189;147;249m%Y[0m[38;2;241;250;140m-[0m[38;2;189;147;249m%m[0m[38;2;241;250;140m-[0m[38;2;189;147;249m%d[0m[38;2;241;250;140m [0m[38;2;189;147;249m%H[0m[38;2;241;250;140m:[0m[38;2;189;147;249m%M[0m[38;2;241;250;140m:[0m[38;2;189;147;249m%S[0m[38;2;241;250;140m [0m[38;2;189;147;249m%Z[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m ---[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1820[0m   [38;5;238mâ”‚[0m 
[38;5;238m1821[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mtry[0m[38;2;248;248;242m:[0m
[38;5;238m1822[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m 1. Fetch Fresh Market Data[0m
[38;5;238m1823[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Determine required data length based on longest indicator period + buffer[0m
[38;5;238m1824[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mdata_limit[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;139;233;253mmax[0m[38;2;248;248;242m([0m[38;2;189;147;249m100[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mDEFAULT_ST_ATR_LENGTH[0m[38;2;255;121;198m*[0m[38;2;189;147;249m2[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mCONFIRM_ST_ATR_LENGTH[0m[38;2;255;121;198m*[0m[38;2;189;147;249m2[0m[38;2;248;248;242m,[0m
[38;5;238m1825[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                                 [0m[38;2;255;255;255mATR_CALCULATION_PERIOD[0m[38;2;255;121;198m*[0m[38;2;189;147;249m2[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mVOLUME_MA_PERIOD[0m[38;2;255;121;198m*[0m[38;2;189;147;249m2[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;255;121;198m+[0m[38;2;248;248;242m [0m[38;2;255;255;255mAPI_FETCH_LIMIT_BUFFER[0m
[38;5;238m1826[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mdf_market[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;80;250;123mget_market_data[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mDEFAULT_INTERVAL[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mlimit[0m[38;2;255;121;198m=[0m[38;2;248;248;242mdata_limit[0m[38;2;248;248;242m)[0m
[38;5;238m1827[0m   [38;5;238mâ”‚[0m 
[38;5;238m1828[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m 2. Execute Trading Logic (only if data is valid)[0m
[38;5;238m1829[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf_market[0m[38;2;248;248;242m [0m[38;2;255;121;198mis[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;189;147;249mNone[0m[38;2;248;248;242m [0m[38;2;255;121;198mand[0m[38;2;248;248;242m [0m[38;2;255;121;198mnot[0m[38;2;248;248;242m [0m[38;2;248;248;242mdf_market[0m[38;2;255;121;198m.[0m[38;2;248;248;242mempty[0m[38;2;248;248;242m:[0m
[38;5;238m1830[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Pass a copy of the dataframe to prevent accidental modification across cycles[0m
[38;5;238m1831[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;80;250;123mtrade_logic[0m[38;2;248;248;242m([0m
[38;5;238m1832[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[3;38;2;255;184;108mexchange[0m[38;2;255;121;198m=[0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108msymbol[0m[38;2;255;121;198m=[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mdf[0m[38;2;255;121;198m=[0m[38;2;248;248;242mdf_market[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcopy[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m,[0m
[38;5;238m1833[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[3;38;2;255;184;108mst_len[0m[38;2;255;121;198m=[0m[38;2;255;255;255mDEFAULT_ST_ATR_LENGTH[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mst_mult[0m[38;2;255;121;198m=[0m[38;2;255;255;255mDEFAULT_ST_MULTIPLIER[0m[38;2;248;248;242m,[0m
[38;5;238m1834[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[3;38;2;255;184;108mcf_st_len[0m[38;2;255;121;198m=[0m[38;2;255;255;255mCONFIRM_ST_ATR_LENGTH[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mcf_st_mult[0m[38;2;255;121;198m=[0m[38;2;255;255;255mCONFIRM_ST_MULTIPLIER[0m[38;2;248;248;242m,[0m
[38;5;238m1835[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[3;38;2;255;184;108matr_len[0m[38;2;255;121;198m=[0m[38;2;255;255;255mATR_CALCULATION_PERIOD[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[3;38;2;255;184;108mvol_ma_len[0m[38;2;255;121;198m=[0m[38;2;255;255;255mVOLUME_MA_PERIOD[0m[38;2;248;248;242m,[0m
[38;5;238m1836[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[3;38;2;255;184;108mrisk_pct[0m[38;2;255;121;198m=[0m[38;2;255;255;255mRISK_PER_TRADE_PERCENTAGE[0m[38;2;248;248;242m,[0m
[38;5;238m1837[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[3;38;2;255;184;108msl_atr_mult[0m[38;2;255;121;198m=[0m[38;2;255;255;255mATR_STOP_LOSS_MULTIPLIER[0m[38;2;248;248;242m,[0m
[38;5;238m1838[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[3;38;2;255;184;108mtp_atr_mult[0m[38;2;255;121;198m=[0m[38;2;255;255;255mATR_TAKE_PROFIT_MULTIPLIER[0m[38;2;248;248;242m,[0m
[38;5;238m1839[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[3;38;2;255;184;108mleverage[0m[38;2;255;121;198m=[0m[38;2;255;255;255mDEFAULT_LEVERAGE[0m[38;2;248;248;242m,[0m
[38;5;238m1840[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[3;38;2;255;184;108mmax_order_cap[0m[38;2;255;121;198m=[0m[38;2;255;255;255mMAX_ORDER_USDT_AMOUNT[0m[38;2;248;248;242m,[0m
[38;5;238m1841[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                        [0m[3;38;2;255;184;108mmargin_buffer[0m[38;2;255;121;198m=[0m[38;2;255;255;255mREQUIRED_MARGIN_BUFFER[0m
[38;5;238m1842[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242m)[0m
[38;5;238m1843[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1844[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log if data fetching failed in this cycle[0m
[38;5;238m1845[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mMain Loop (Cycle [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcycle_count[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): No valid market data received for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Skipping trade logic for this cycle.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1846[0m   [38;5;238mâ”‚[0m 
[38;5;238m1847[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Main Loop Exception Handling ---[0m
[38;5;238m1848[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Handle specific CCXT errors gracefully to allow continuation if possible[0m
[38;5;238m1849[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mRateLimitExceeded[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1850[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mRATE LIMIT EXCEEDED (Cycle [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcycle_count[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Sleeping for [0m[38;2;248;248;242m{[0m[38;2;255;255;255mDEFAULT_SLEEP_SECONDS[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;189;147;249m5[0m[38;2;248;248;242m}[0m[38;2;241;250;140m seconds...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1851[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] WARNING: Rate limit exceeded! Check API usage/frequency.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1852[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mtime[0m[38;2;255;121;198m.[0m[38;2;80;250;123msleep[0m[38;2;248;248;242m([0m[38;2;255;255;255mDEFAULT_SLEEP_SECONDS[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;189;147;249m5[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Longer sleep after rate limit hit[0m
[38;5;238m1853[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mNetworkError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1854[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Typically recoverable, log and continue after normal delay[0m
[38;5;238m1855[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mNetwork error in main loop (Cycle [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcycle_count[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Will retry next cycle.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1856[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Let the standard sleep handle the delay[0m
[38;5;238m1857[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mExchangeNotAvailable[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1858[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Exchange might be down for maintenance, sleep longer[0m
[38;5;238m1859[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mExchange not available (Cycle [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcycle_count[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Sleeping for [0m[38;2;248;248;242m{[0m[38;2;255;255;255mDEFAULT_SLEEP_SECONDS[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;189;147;249m10[0m[38;2;248;248;242m}[0m[38;2;241;250;140m seconds...[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1860[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ERROR: Exchange unavailable! ([0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m)[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1861[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mtime[0m[38;2;255;121;198m.[0m[38;2;80;250;123msleep[0m[38;2;248;248;242m([0m[38;2;255;255;255mDEFAULT_SLEEP_SECONDS[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;189;147;249m10[0m[38;2;248;248;242m)[0m
[38;5;238m1862[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mAuthenticationError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1863[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Critical: API keys likely invalid or expired. Stop the bot.[0m
[38;5;238m1864[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mAuthentication Error encountered in main loop (Cycle [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcycle_count[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. API keys may be invalid or permissions revoked. Stopping bot.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1865[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] CRITICAL: Authentication Error! Bot stopping NOW.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1866[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mrun_bot[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Stop the main loop permanently[0m
[38;5;238m1867[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[38;2;248;248;242mccxt[0m[38;2;248;248;242m.[0m[38;2;248;248;242mExchangeError[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1868[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Catch other specific exchange errors (e.g., invalid order params, margin issues not caught earlier)[0m
[38;5;238m1869[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123merror[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mUnhandled Exchange error in main loop (Cycle [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcycle_count[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1870[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[38;2;248;248;242mtraceback[0m[38;2;255;121;198m.[0m[38;2;80;250;123mformat_exc[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Log traceback for details[0m
[38;5;238m1871[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] ERROR: Unhandled Exchange error: [0m[38;2;248;248;242m{[0m[38;2;139;233;253mtype[0m[38;2;248;248;242m([0m[38;2;248;248;242me[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;248;248;242m__name__[0m[38;2;248;248;242m}[0m[38;2;241;250;140m. Check logs.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1872[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Continue after normal delay, hoping it's temporary[0m
[38;5;238m1873[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mException[0m[38;2;248;248;242m [0m[38;2;255;121;198mas[0m[38;2;248;248;242m [0m[38;2;248;248;242me[0m[38;2;248;248;242m:[0m
[38;5;238m1874[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Catch any other unexpected errors, log traceback, and stop the bot for safety[0m
[38;5;238m1875[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mexception[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m!!! UNEXPECTED CRITICAL ERROR in main loop (Cycle [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcycle_count[0m[38;2;248;248;242m}[0m[38;2;241;250;140m): [0m[38;2;248;248;242m{[0m[38;2;248;248;242me[0m[38;2;248;248;242m}[0m[38;2;241;250;140m !!![0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Logs full traceback[0m
[38;5;238m1876[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] CRITICAL UNEXPECTED ERROR in main loop: [0m[38;2;248;248;242m{[0m[38;2;139;233;253mtype[0m[38;2;248;248;242m([0m[38;2;248;248;242me[0m[38;2;248;248;242m)[0m[38;2;255;121;198m.[0m[38;2;248;248;242m__name__[0m[38;2;248;248;242m}[0m[38;2;241;250;140m! Bot stopping NOW.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1877[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mcritical[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mStopping bot due to unexpected critical error.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1878[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mrun_bot[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Stop the loop[0m
[38;5;238m1879[0m   [38;5;238mâ”‚[0m 
[38;5;238m1880[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Cycle Delay ---[0m
[38;5;238m1881[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Calculate elapsed time and sleep for the remaining duration of the interval[0m
[38;5;238m1882[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m            [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242mrun_bot[0m[38;2;248;248;242m:[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Only sleep if the bot is still supposed to be running[0m
[38;5;238m1883[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mcycle_end_time[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mtime[0m[38;2;255;121;198m.[0m[38;2;80;250;123mmonotonic[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m
[38;5;238m1884[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242melapsed_time[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242mcycle_end_time[0m[38;2;248;248;242m [0m[38;2;255;121;198m-[0m[38;2;248;248;242m [0m[38;2;248;248;242mcycle_start_time[0m
[38;5;238m1885[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242msleep_duration[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;139;233;253mmax[0m[38;2;248;248;242m([0m[38;2;189;147;249m0[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;255;255;255mDEFAULT_SLEEP_SECONDS[0m[38;2;248;248;242m [0m[38;2;255;121;198m-[0m[38;2;248;248;242m [0m[38;2;248;248;242melapsed_time[0m[38;2;248;248;242m)[0m
[38;5;238m1886[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mdebug[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mCycle [0m[38;2;248;248;242m{[0m[38;2;248;248;242mcycle_count[0m[38;2;248;248;242m}[0m[38;2;241;250;140m execution time: [0m[38;2;248;248;242m{[0m[38;2;248;248;242melapsed_time[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140ms. Sleeping for [0m[38;2;248;248;242m{[0m[38;2;248;248;242msleep_duration[0m[38;2;189;147;249m:.2f[0m[38;2;248;248;242m}[0m[38;2;241;250;140ms.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1887[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242msleep_duration[0m[38;2;248;248;242m [0m[38;2;255;121;198m>[0m[38;2;248;248;242m [0m[38;2;189;147;249m0[0m[38;2;248;248;242m:[0m
[38;5;238m1888[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m                    [0m[38;2;248;248;242mtime[0m[38;2;255;121;198m.[0m[38;2;80;250;123msleep[0m[38;2;248;248;242m([0m[38;2;248;248;242msleep_duration[0m[38;2;248;248;242m)[0m
[38;5;238m1889[0m   [38;5;238mâ”‚[0m 
[38;5;238m1890[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mexcept[0m[38;2;248;248;242m [0m[3;38;2;102;217;239mKeyboardInterrupt[0m[38;2;248;248;242m:[0m
[38;5;238m1891[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m User pressed Ctrl+C[0m
[38;5;238m1892[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123mwarning[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mShutdown requested via KeyboardInterrupt (Ctrl+C).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1893[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mrun_bot[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;189;147;249mFalse[0m[38;2;248;248;242m [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Ensure loop terminates if it was somehow still running[0m
[38;5;238m1894[0m   [38;5;238mâ”‚[0m 
[38;5;238m1895[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mfinally[0m[38;2;248;248;242m:[0m
[38;5;238m1896[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m --- Bot Shutdown Sequence ---[0m
[38;5;238m1897[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m This block executes whether the loop finished normally,[0m
[38;5;238m1898[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m was stopped by an error, or by KeyboardInterrupt.[0m
[38;5;238m1899[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m--- Initiating Scalping Bot Shutdown Sequence ---[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1900[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Attempt graceful shutdown (close position) only if exchange/symbol were initialized[0m
[38;5;238m1901[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123mgraceful_shutdown[0m[38;2;248;248;242m([0m[38;2;248;248;242mexchange[0m[38;2;248;248;242m,[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m)[0m
[38;5;238m1902[0m   [38;5;238mâ”‚[0m 
[38;5;238m1903[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mlogger[0m[38;2;255;121;198m.[0m[38;2;80;250;123minfo[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m--- Scalping Bot Shutdown Complete ---[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1904[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;248;248;242mmarket_base_final[0m[38;2;248;248;242m [0m[38;2;255;121;198m=[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;255;121;198m.[0m[38;2;80;250;123msplit[0m[38;2;248;248;242m([0m[38;2;241;250;140m'[0m[38;2;241;250;140m/[0m[38;2;241;250;140m'[0m[38;2;248;248;242m)[0m[38;2;248;248;242m[[0m[38;2;189;147;249m0[0m[38;2;248;248;242m][0m[38;2;248;248;242m [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242msymbol[0m[38;2;248;248;242m [0m[38;2;255;121;198melse[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140mBot[0m[38;2;241;250;140m"[0m
[38;5;238m1905[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Send final shutdown message[0m
[38;5;238m1906[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;80;250;123msend_sms_alert[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140m[[0m[38;2;248;248;242m{[0m[38;2;248;248;242mmarket_base_final[0m[38;2;248;248;242m}[0m[38;2;241;250;140m] Bot process has terminated.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1907[0m   [38;5;238mâ”‚[0m 
[38;5;238m1908[0m   [38;5;238mâ”‚[0m 
[38;5;238m1909[0m   [38;5;238mâ”‚[0m [38;2;98;114;164m#[0m[38;2;98;114;164m --- Script Entry Point ---[0m
[38;5;238m1910[0m   [38;5;238mâ”‚[0m [38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;248;248;242m__name__[0m[38;2;248;248;242m [0m[38;2;255;121;198m==[0m[38;2;248;248;242m [0m[38;2;241;250;140m"[0m[38;2;241;250;140m__main__[0m[38;2;241;250;140m"[0m[38;2;248;248;242m:[0m
[38;5;238m1911[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Print initial information to the console[0m
[38;5;238m1912[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;139;233;253mprint[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m--- Bybit USDT Futures Scalping Bot v2.0.0 ---[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1913[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;139;233;253mprint[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mINFO: Loading configuration from .env file.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1914[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;139;233;253mprint[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mINFO: Ensure API keys (BYBIT_API_KEY, BYBIT_API_SECRET) are set in .env.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1915[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;139;233;253mprint[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mINFO: For SMS alerts, set ENABLE_SMS_ALERTS=true and SMS_RECIPIENT_NUMBER in .env.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1916[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;139;233;253mprint[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mINFO: SMS requires Termux environment with Termux:API installed ('pkg install termux-api') and SMS permission granted.[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1917[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;139;233;253mprint[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[93mWARNING: LIVE TRADING IS ACTIVE BY DEFAULT. USE EXTREME CAUTION.[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[0m[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1918[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198mif[0m[38;2;248;248;242m [0m[38;2;255;255;255mENABLE_LOOP_SLTP_CHECK[0m[38;2;248;248;242m:[0m
[38;5;238m1919[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;139;233;253mprint[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[91m[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[1mCRITICAL: LOOP-BASED SL/TP IS ACTIVE - HIGHLY INACCURATE & UNSAFE FOR LIVE SCALPING.[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[0m[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1920[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;139;233;253mprint[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[91m[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[1mCRITICAL: IMPLEMENT EXCHANGE-NATIVE CONDITIONAL ORDERS FOR SAFE OPERATION.[0m[38;2;255;121;198m\033[0m[38;2;241;250;140m[0m[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1921[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;255;121;198melse[0m[38;2;248;248;242m:[0m
[38;5;238m1922[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m        [0m[38;2;139;233;253mprint[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140mINFO: Loop-based SL/TP check is DISABLED by default (recommended).[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1923[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;139;233;253mprint[0m[38;2;248;248;242m([0m[3;38;2;139;233;253mf[0m[38;2;241;250;140m"[0m[38;2;241;250;140mINFO: Initial logging level set to: [0m[38;2;248;248;242m{[0m[38;2;248;248;242mlogging[0m[38;2;255;121;198m.[0m[38;2;80;250;123mgetLevelName[0m[38;2;248;248;242m([0m[38;2;255;255;255mLOGGING_LEVEL[0m[38;2;248;248;242m)[0m[38;2;248;248;242m}[0m[38;2;241;250;140m"[0m[38;2;248;248;242m)[0m
[38;5;238m1924[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;139;233;253mprint[0m[38;2;248;248;242m([0m[38;2;241;250;140m"[0m[38;2;241;250;140m-[0m[38;2;241;250;140m"[0m[38;2;248;248;242m [0m[38;2;255;121;198m*[0m[38;2;248;248;242m [0m[38;2;189;147;249m40[0m[38;2;248;248;242m)[0m
[38;5;238m1925[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;98;114;164m#[0m[38;2;98;114;164m Start the main execution function[0m
[38;5;238m1926[0m   [38;5;238mâ”‚[0m [38;2;248;248;242m    [0m[38;2;80;250;123mmain[0m[38;2;248;248;242m([0m[38;2;248;248;242m)[0m
[38;5;238mâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[0m
